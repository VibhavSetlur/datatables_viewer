var Lr=Object.defineProperty;var Mr=(T,e,s)=>e in T?Lr(T,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):T[e]=s;var x=(T,e,s)=>Mr(T,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const Dr="modulepreload",Nr=function(T){return"/"+T},As={},Rr=function(e,s,i){let n=Promise.resolve();if(s&&s.length>0){let u=function(l){return Promise.all(l.map(w=>Promise.resolve(w).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),d=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));n=u(s.map(l=>{if(l=Nr(l),l in As)return;As[l]=!0;const w=l.endsWith(".css"),g=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${g}`))return;const S=document.createElement("link");if(S.rel=w?"stylesheet":Dr,w||(S.as="script"),S.crossOrigin="",S.href=l,d&&S.setAttribute("nonce",d),document.head.appendChild(S),w)return new Promise((k,R)=>{S.addEventListener("load",k),S.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return n.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};function Or(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}function Pr(T){if(Object.prototype.hasOwnProperty.call(T,"__esModule"))return T;var e=T.default;if(typeof e=="function"){var s=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(T).forEach(function(i){var n=Object.getOwnPropertyDescriptor(T,i);Object.defineProperty(s,i,n.get?n:{enumerable:!0,get:function(){return T[i]}})}),s}var Nt={exports:{}};const jr={},qr=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"})),Ls=Pr(qr);var Ms;function zr(){return Ms||(Ms=1,(function(T,e){var s=void 0,i=function(n){return s||(s=new Promise(function(o,u){var h=typeof n<"u"?n:{},d=h.onAbort;h.onAbort=function(t){u(new Error(t)),d&&d(t)},h.postRun=h.postRun||[],h.postRun.push(function(){o(h)}),T=void 0;var l;l||(l=typeof h<"u"?h:{});var w=typeof window=="object",g=typeof WorkerGlobalScope<"u",S=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";l.onRuntimeInitialized=function(){function t(p,v){switch(typeof v){case"boolean":Er(p,v?1:0);break;case"number":$r(p,v);break;case"string":kr(p,v,-1,-1);break;case"object":if(v===null)$s(p);else if(v.length!=null){var $=rt(v,st);_r(p,$,v.length,-1),nt($)}else it(p,"Wrong API use : tried to return a value of an unknown type ("+v+").",-1);break;default:$s(p)}}function r(p,v){for(var $=[],D=0;D<p;D+=1){var O=de(v+4*D,"i32"),V=wr(O);if(V===1||V===2)O=Tr(O);else if(V===3)O=Sr(O);else if(V===4){V=O,O=xr(V),V=Cr(V);for(var le=new Uint8Array(O),ae=0;ae<O;ae+=1)le[ae]=K[V+ae];O=le}else O=null;$.push(O)}return $}function a(p,v){this.Qa=p,this.db=v,this.Oa=1,this.lb=[]}function c(p,v){if(this.db=v,v=Ie(p)+1,this.eb=Lt(v),this.eb===null)throw Error("Unable to allocate memory for the SQL string");he(p,I,this.eb,v),this.kb=this.eb,this.Za=this.pb=null}function f(p){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),p!=null){var v=this.filename,$="/",D=v;if($&&($=typeof $=="string"?$:yt($),D=v?mt($+"/"+v):$),v=Jt(!0,!0),D=Ys(D,v),p){if(typeof p=="string"){$=Array(p.length);for(var O=0,V=p.length;O<V;++O)$[O]=p.charCodeAt(O);p=$}Je(D,v|146),$=Ne(D,577),ms($,p,0,p.length,0),Tt($),Je(D,v)}}this.handleError(A(this.filename,m)),this.db=de(m,"i32"),_s(this.db),this.fb={},this.Sa={}}var m=be(4),b=l.cwrap,A=b("sqlite3_open","number",["string","number"]),q=b("sqlite3_close_v2","number",["number"]),j=b("sqlite3_exec","number",["number","string","number","number","number"]),Y=b("sqlite3_changes","number",["number"]),se=b("sqlite3_prepare_v2","number",["number","string","number","number","number"]),ws=b("sqlite3_sql","string",["number"]),rr=b("sqlite3_normalized_sql","string",["number"]),xs=b("sqlite3_prepare_v2","number",["number","number","number","number","number"]),nr=b("sqlite3_bind_text","number",["number","number","number","number","number"]),Ss=b("sqlite3_bind_blob","number",["number","number","number","number","number"]),ir=b("sqlite3_bind_double","number",["number","number","number"]),ar=b("sqlite3_bind_int","number",["number","number","number"]),or=b("sqlite3_bind_parameter_index","number",["number","string"]),lr=b("sqlite3_step","number",["number"]),cr=b("sqlite3_errmsg","string",["number"]),ur=b("sqlite3_column_count","number",["number"]),dr=b("sqlite3_data_count","number",["number"]),hr=b("sqlite3_column_double","number",["number","number"]),Cs=b("sqlite3_column_text","string",["number","number"]),fr=b("sqlite3_column_blob","number",["number","number"]),pr=b("sqlite3_column_bytes","number",["number","number"]),mr=b("sqlite3_column_type","number",["number","number"]),gr=b("sqlite3_column_name","string",["number","number"]),br=b("sqlite3_reset","number",["number"]),yr=b("sqlite3_clear_bindings","number",["number"]),vr=b("sqlite3_finalize","number",["number"]),Ts=b("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),wr=b("sqlite3_value_type","number",["number"]),xr=b("sqlite3_value_bytes","number",["number"]),Sr=b("sqlite3_value_text","string",["number"]),Cr=b("sqlite3_value_blob","number",["number"]),Tr=b("sqlite3_value_double","number",["number"]),$r=b("sqlite3_result_double","",["number","number"]),$s=b("sqlite3_result_null","",["number"]),kr=b("sqlite3_result_text","",["number","string","number","number"]),_r=b("sqlite3_result_blob","",["number","number","number","number"]),Er=b("sqlite3_result_int","",["number","number"]),it=b("sqlite3_result_error","",["number","string","number"]),ks=b("sqlite3_aggregate_context","number",["number","number"]),_s=b("RegisterExtensionFunctions","number",["number"]),Es=b("sqlite3_update_hook","number",["number","number","number"]);a.prototype.bind=function(p){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(p)?this.Cb(p):p!=null&&typeof p=="object"?this.Db(p):!0},a.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var p=lr(this.Qa);switch(p){case 100:return!0;case 101:return!1;default:throw this.db.handleError(p)}},a.prototype.wb=function(p){return p==null&&(p=this.Oa,this.Oa+=1),hr(this.Qa,p)},a.prototype.Gb=function(p){if(p==null&&(p=this.Oa,this.Oa+=1),p=Cs(this.Qa,p),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(p)},a.prototype.Hb=function(p){return p==null&&(p=this.Oa,this.Oa+=1),Cs(this.Qa,p)},a.prototype.getBlob=function(p){p==null&&(p=this.Oa,this.Oa+=1);var v=pr(this.Qa,p);p=fr(this.Qa,p);for(var $=new Uint8Array(v),D=0;D<v;D+=1)$[D]=K[p+D];return $},a.prototype.get=function(p,v){v=v||{},p!=null&&this.bind(p)&&this.step(),p=[];for(var $=dr(this.Qa),D=0;D<$;D+=1)switch(mr(this.Qa,D)){case 1:var O=v.useBigInt?this.Gb(D):this.wb(D);p.push(O);break;case 2:p.push(this.wb(D));break;case 3:p.push(this.Hb(D));break;case 4:p.push(this.getBlob(D));break;default:p.push(null)}return p},a.prototype.getColumnNames=function(){for(var p=[],v=ur(this.Qa),$=0;$<v;$+=1)p.push(gr(this.Qa,$));return p},a.prototype.getAsObject=function(p,v){p=this.get(p,v),v=this.getColumnNames();for(var $={},D=0;D<v.length;D+=1)$[v[D]]=p[D];return $},a.prototype.getSQL=function(){return ws(this.Qa)},a.prototype.getNormalizedSQL=function(){return rr(this.Qa)},a.prototype.run=function(p){return p!=null&&this.bind(p),this.step(),this.reset()},a.prototype.sb=function(p,v){v==null&&(v=this.Oa,this.Oa+=1),p=Qt(p);var $=rt(p,st);this.lb.push($),this.db.handleError(nr(this.Qa,v,$,p.length-1,0))},a.prototype.Bb=function(p,v){v==null&&(v=this.Oa,this.Oa+=1);var $=rt(p,st);this.lb.push($),this.db.handleError(Ss(this.Qa,v,$,p.length,0))},a.prototype.rb=function(p,v){v==null&&(v=this.Oa,this.Oa+=1),this.db.handleError((p===(p|0)?ar:ir)(this.Qa,v,p))},a.prototype.Eb=function(p){p==null&&(p=this.Oa,this.Oa+=1),Ss(this.Qa,p,0,0,0)},a.prototype.tb=function(p,v){switch(v==null&&(v=this.Oa,this.Oa+=1),typeof p){case"string":this.sb(p,v);return;case"number":this.rb(p,v);return;case"bigint":this.sb(p.toString(),v);return;case"boolean":this.rb(p+0,v);return;case"object":if(p===null){this.Eb(v);return}if(p.length!=null){this.Bb(p,v);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+p+")."},a.prototype.Db=function(p){var v=this;return Object.keys(p).forEach(function($){var D=or(v.Qa,$);D!==0&&v.tb(p[$],D)}),!0},a.prototype.Cb=function(p){for(var v=0;v<p.length;v+=1)this.tb(p[v],v+1);return!0},a.prototype.reset=function(){return this.freemem(),yr(this.Qa)===0&&br(this.Qa)===0},a.prototype.freemem=function(){for(var p;(p=this.lb.pop())!==void 0;)nt(p)},a.prototype.free=function(){this.freemem();var p=vr(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,p},c.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var p=Ve(),v=be(4);ze(m),ze(v);try{this.db.handleError(xs(this.db.db,this.kb,-1,m,v)),this.kb=de(v,"i32");var $=de(m,"i32");return $===0?(this.mb(),{done:!0}):(this.Za=new a($,this.db),this.db.fb[$]=this.Za,{value:this.Za,done:!1})}catch(D){throw this.pb=pt(this.kb),this.mb(),D}finally{Be(p)}},c.prototype.mb=function(){nt(this.eb),this.eb=null},c.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:pt(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(c.prototype[Symbol.iterator]=function(){return this}),f.prototype.run=function(p,v){if(!this.db)throw"Database closed";if(v){p=this.prepare(p,v);try{p.step()}finally{p.free()}}else this.handleError(j(this.db,p,0,0,m));return this},f.prototype.exec=function(p,v,$){if(!this.db)throw"Database closed";var D=Ve(),O=null;try{var V=Et(p),le=be(4);for(p=[];de(V,"i8")!==0;){ze(m),ze(le),this.handleError(xs(this.db,V,-1,m,le));var ae=de(m,"i32");if(V=de(le,"i32"),ae!==0){var ne=null;for(O=new a(ae,this),v!=null&&O.bind(v);O.step();)ne===null&&(ne={columns:O.getColumnNames(),values:[]},p.push(ne)),ne.values.push(O.get(null,$));O.free()}}return p}catch(ce){throw O&&O.free(),ce}finally{Be(D)}},f.prototype.each=function(p,v,$,D,O){typeof v=="function"&&(D=$,$=v,v=void 0),p=this.prepare(p,v);try{for(;p.step();)$(p.getAsObject(null,O))}finally{p.free()}if(typeof D=="function")return D()},f.prototype.prepare=function(p,v){if(ze(m),this.handleError(se(this.db,p,-1,m,0)),p=de(m,"i32"),p===0)throw"Nothing to prepare";var $=new a(p,this);return v!=null&&$.bind(v),this.fb[p]=$},f.prototype.iterateStatements=function(p){return new c(p,this)},f.prototype.export=function(){Object.values(this.fb).forEach(function(v){v.free()}),Object.values(this.Sa).forEach(ge),this.Sa={},this.handleError(q(this.db));var p=Xs(this.filename);return this.handleError(A(this.filename,m)),this.db=de(m,"i32"),_s(this.db),p},f.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(p){p.free()}),Object.values(this.Sa).forEach(ge),this.Sa={},this.Ya&&(ge(this.Ya),this.Ya=void 0),this.handleError(q(this.db)),us("/"+this.filename),this.db=null)},f.prototype.handleError=function(p){if(p===0)return null;throw p=cr(this.db),Error(p)},f.prototype.getRowsModified=function(){return Y(this.db)},f.prototype.create_function=function(p,v){Object.prototype.hasOwnProperty.call(this.Sa,p)&&(ge(this.Sa[p]),delete this.Sa[p]);var $=He(function(D,O,V){O=r(O,V);try{var le=v.apply(null,O)}catch(ae){it(D,ae,-1);return}t(D,le)},"viii");return this.Sa[p]=$,this.handleError(Ts(this.db,p,v.length,1,0,$,0,0,0)),this},f.prototype.create_aggregate=function(p,v){var $=v.init||function(){return null},D=v.finalize||function(ne){return ne},O=v.step;if(!O)throw"An aggregate function must have a step function in "+p;var V={};Object.hasOwnProperty.call(this.Sa,p)&&(ge(this.Sa[p]),delete this.Sa[p]),v=p+"__finalize",Object.hasOwnProperty.call(this.Sa,v)&&(ge(this.Sa[v]),delete this.Sa[v]);var le=He(function(ne,ce,Dt){var Ce=ks(ne,1);Object.hasOwnProperty.call(V,Ce)||(V[Ce]=$()),ce=r(ce,Dt),ce=[V[Ce]].concat(ce);try{V[Ce]=O.apply(null,ce)}catch(Ar){delete V[Ce],it(ne,Ar,-1)}},"viii"),ae=He(function(ne){var ce=ks(ne,1);try{var Dt=D(V[ce])}catch(Ce){delete V[ce],it(ne,Ce,-1);return}t(ne,Dt),delete V[ce]},"vi");return this.Sa[p]=le,this.Sa[v]=ae,this.handleError(Ts(this.db,p,O.length-1,1,0,0,le,ae,0)),this},f.prototype.updateHook=function(p){this.Ya&&(Es(this.db,0,0),ge(this.Ya),this.Ya=void 0),p&&(this.Ya=He(function(v,$,D,O,V){switch($){case 18:v="insert";break;case 23:v="update";break;case 9:v="delete";break;default:throw"unknown operationCode in updateHook callback: "+$}if(D=D?Q(I,D):"",O=O?Q(I,O):"",V>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";p(v,D,O,Number(V))},"viiiij"),Es(this.db,this.Ya,0))},l.Database=f};var k={...l},R="./this.program",B=(t,r)=>{throw r},M="",E,_;if(S){var N=Ls;M=__dirname+"/",_=t=>(t=Ge(t)?new URL(t):t,N.readFileSync(t)),E=async t=>(t=Ge(t)?new URL(t):t,N.readFileSync(t,void 0)),!l.thisProgram&&1<process.argv.length&&(R=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),T.exports=l,B=(t,r)=>{throw process.exitCode=t,r}}else(w||g)&&(g?M=self.location.href:typeof document<"u"&&document.currentScript&&(M=document.currentScript.src),M=M.startsWith("blob:")?"":M.slice(0,M.replace(/[?#].*/,"").lastIndexOf("/")+1),g&&(_=t=>{var r=new XMLHttpRequest;return r.open("GET",t,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),E=async t=>{if(Ge(t))return new Promise((a,c)=>{var f=new XMLHttpRequest;f.open("GET",t,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?a(f.response):c(f.status)},f.onerror=c,f.send(null)});var r=await fetch(t,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw Error(r.status+" : "+r.url)});var z=l.print||console.log.bind(console),F=l.printErr||console.error.bind(console);Object.assign(l,k),k=null,l.thisProgram&&(R=l.thisProgram);var H=l.wasmBinary,U,X=!1,Z,K,I,re,W,J,ct,oe,ut,Ge=t=>t.startsWith("file://");function Ut(){var t=U.buffer;l.HEAP8=K=new Int8Array(t),l.HEAP16=re=new Int16Array(t),l.HEAPU8=I=new Uint8Array(t),l.HEAPU16=new Uint16Array(t),l.HEAP32=W=new Int32Array(t),l.HEAPU32=J=new Uint32Array(t),l.HEAPF32=ct=new Float32Array(t),l.HEAPF64=ut=new Float64Array(t),l.HEAP64=oe=new BigInt64Array(t),l.HEAPU64=new BigUint64Array(t)}var ve=0,qe=null;function Le(t){var r;throw(r=l.onAbort)==null||r.call(l,t),t="Aborted("+t+")",F(t),X=!0,new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info.")}var dt;async function Ps(t){if(!H)try{var r=await E(t);return new Uint8Array(r)}catch{}if(t==dt&&H)t=new Uint8Array(H);else if(_)t=_(t);else throw"both async and sync fetching of the wasm failed";return t}async function js(t,r){try{var a=await Ps(t);return await WebAssembly.instantiate(a,r)}catch(c){F(`failed to asynchronously prepare wasm: ${c}`),Le(c)}}async function qs(t){var r=dt;if(!H&&typeof WebAssembly.instantiateStreaming=="function"&&!Ge(r)&&!S)try{var a=fetch(r,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(a,t)}catch(c){F(`wasm streaming compile failed: ${c}`),F("falling back to ArrayBuffer instantiation")}return js(r,t)}class ht{constructor(r){x(this,"name","ExitStatus");this.message=`Program terminated with exit(${r})`,this.status=r}}var Ft=t=>{for(;0<t.length;)t.shift()(l)},Ht=[],Bt=[],zs=()=>{var t=l.preRun.shift();Bt.unshift(t)};function de(t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return K[t];case"i8":return K[t];case"i16":return re[t>>1];case"i32":return W[t>>2];case"i64":return oe[t>>3];case"float":return ct[t>>2];case"double":return ut[t>>3];case"*":return J[t>>2];default:Le(`invalid type for getValue: ${r}`)}}var ft=l.noExitRuntime||!0;function ze(t){var r="i32";switch(r.endsWith("*")&&(r="*"),r){case"i1":K[t]=0;break;case"i8":K[t]=0;break;case"i16":re[t>>1]=0;break;case"i32":W[t>>2]=0;break;case"i64":oe[t>>3]=BigInt(0);break;case"float":ct[t>>2]=0;break;case"double":ut[t>>3]=0;break;case"*":J[t>>2]=0;break;default:Le(`invalid type for setValue: ${r}`)}}var Vt=typeof TextDecoder<"u"?new TextDecoder:void 0,Q=(t,r=0,a=NaN)=>{var c=r+a;for(a=r;t[a]&&!(a>=c);)++a;if(16<a-r&&t.buffer&&Vt)return Vt.decode(t.subarray(r,a));for(c="";r<a;){var f=t[r++];if(f&128){var m=t[r++]&63;if((f&224)==192)c+=String.fromCharCode((f&31)<<6|m);else{var b=t[r++]&63;f=(f&240)==224?(f&15)<<12|m<<6|b:(f&7)<<18|m<<12|b<<6|t[r++]&63,65536>f?c+=String.fromCharCode(f):(f-=65536,c+=String.fromCharCode(55296|f>>10,56320|f&1023))}}else c+=String.fromCharCode(f)}return c},pt=(t,r)=>t?Q(I,t,r):"",Wt=(t,r)=>{for(var a=0,c=t.length-1;0<=c;c--){var f=t[c];f==="."?t.splice(c,1):f===".."?(t.splice(c,1),a++):a&&(t.splice(c,1),a--)}if(r)for(;a;a--)t.unshift("..");return t},mt=t=>{var r=t.charAt(0)==="/",a=t.slice(-1)==="/";return(t=Wt(t.split("/").filter(c=>!!c),!r).join("/"))||r||(t="."),t&&a&&(t+="/"),(r?"/":"")+t},Gt=t=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=r[0],r=r[1],!t&&!r?".":(r&&(r=r.slice(0,-1)),t+r)},Ke=t=>t&&t.match(/([^\/]+|\/)\/*$/)[1],Is=()=>{if(S){var t=Ls;return r=>t.randomFillSync(r)}return r=>crypto.getRandomValues(r)},Kt=t=>{(Kt=Is())(t)},Us=(...t)=>{for(var r="",a=!1,c=t.length-1;-1<=c&&!a;c--){if(a=0<=c?t[c]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";r=a+"/"+r,a=a.charAt(0)==="/"}return r=Wt(r.split("/").filter(f=>!!f),!a).join("/"),(a?"/":"")+r||"."},gt=[],Ie=t=>{for(var r=0,a=0;a<t.length;++a){var c=t.charCodeAt(a);127>=c?r++:2047>=c?r+=2:55296<=c&&57343>=c?(r+=4,++a):r+=3}return r},he=(t,r,a,c)=>{if(!(0<c))return 0;var f=a;c=a+c-1;for(var m=0;m<t.length;++m){var b=t.charCodeAt(m);if(55296<=b&&57343>=b){var A=t.charCodeAt(++m);b=65536+((b&1023)<<10)|A&1023}if(127>=b){if(a>=c)break;r[a++]=b}else{if(2047>=b){if(a+1>=c)break;r[a++]=192|b>>6}else{if(65535>=b){if(a+2>=c)break;r[a++]=224|b>>12}else{if(a+3>=c)break;r[a++]=240|b>>18,r[a++]=128|b>>12&63}r[a++]=128|b>>6&63}r[a++]=128|b&63}}return r[a]=0,a-f},Qt=(t,r)=>{var a=Array(Ie(t)+1);return t=he(t,a,0,a.length),r&&(a.length=t),a},Yt=[];function Xt(t,r){Yt[t]={input:[],output:[],cb:r},St(t,Fs)}var Fs={open(t){var r=Yt[t.node.rdev];if(!r)throw new C(43);t.tty=r,t.seekable=!1},close(t){t.tty.cb.fsync(t.tty)},fsync(t){t.tty.cb.fsync(t.tty)},read(t,r,a,c){if(!t.tty||!t.tty.cb.xb)throw new C(60);for(var f=0,m=0;m<c;m++){try{var b=t.tty.cb.xb(t.tty)}catch{throw new C(29)}if(b===void 0&&f===0)throw new C(6);if(b==null)break;f++,r[a+m]=b}return f&&(t.node.atime=Date.now()),f},write(t,r,a,c){if(!t.tty||!t.tty.cb.qb)throw new C(60);try{for(var f=0;f<c;f++)t.tty.cb.qb(t.tty,r[a+f])}catch{throw new C(29)}return c&&(t.node.mtime=t.node.ctime=Date.now()),f}},Hs={xb(){e:{if(!gt.length){var t=null;if(S){var r=Buffer.alloc(256),a=0,c=process.stdin.fd;try{a=N.readSync(c,r,0,256)}catch(f){if(f.toString().includes("EOF"))a=0;else throw f}0<a&&(t=r.slice(0,a).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(t=window.prompt("Input: "),t!==null&&(t+=`
`));if(!t){t=null;break e}gt=Qt(t,!0)}t=gt.shift()}return t},qb(t,r){r===null||r===10?(z(Q(t.output)),t.output=[]):r!=0&&t.output.push(r)},fsync(t){var r;0<((r=t.output)==null?void 0:r.length)&&(z(Q(t.output)),t.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},Bs={qb(t,r){r===null||r===10?(F(Q(t.output)),t.output=[]):r!=0&&t.output.push(r)},fsync(t){var r;0<((r=t.output)==null?void 0:r.length)&&(F(Q(t.output)),t.output=[])}},P={Wa:null,Xa(){return P.createNode(null,"/",16895,0)},createNode(t,r,a,c){if((a&61440)===24576||(a&61440)===4096)throw new C(63);return P.Wa||(P.Wa={dir:{node:{Ta:P.La.Ta,Ua:P.La.Ua,lookup:P.La.lookup,hb:P.La.hb,rename:P.La.rename,unlink:P.La.unlink,rmdir:P.La.rmdir,readdir:P.La.readdir,symlink:P.La.symlink},stream:{Va:P.Ma.Va}},file:{node:{Ta:P.La.Ta,Ua:P.La.Ua},stream:{Va:P.Ma.Va,read:P.Ma.read,write:P.Ma.write,ib:P.Ma.ib,jb:P.Ma.jb}},link:{node:{Ta:P.La.Ta,Ua:P.La.Ua,readlink:P.La.readlink},stream:{}},ub:{node:{Ta:P.La.Ta,Ua:P.La.Ua},stream:Qs}}),a=rs(t,r,a,c),te(a.mode)?(a.La=P.Wa.dir.node,a.Ma=P.Wa.dir.stream,a.Na={}):(a.mode&61440)===32768?(a.La=P.Wa.file.node,a.Ma=P.Wa.file.stream,a.Ra=0,a.Na=null):(a.mode&61440)===40960?(a.La=P.Wa.link.node,a.Ma=P.Wa.link.stream):(a.mode&61440)===8192&&(a.La=P.Wa.ub.node,a.Ma=P.Wa.ub.stream),a.atime=a.mtime=a.ctime=Date.now(),t&&(t.Na[r]=a,t.atime=t.mtime=t.ctime=a.atime),a},Sb(t){return t.Na?t.Na.subarray?t.Na.subarray(0,t.Ra):new Uint8Array(t.Na):new Uint8Array(0)},La:{Ta(t){var r={};return r.dev=(t.mode&61440)===8192?t.id:1,r.ino=t.id,r.mode=t.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=t.rdev,te(t.mode)?r.size=4096:(t.mode&61440)===32768?r.size=t.Ra:(t.mode&61440)===40960?r.size=t.link.length:r.size=0,r.atime=new Date(t.atime),r.mtime=new Date(t.mtime),r.ctime=new Date(t.ctime),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},Ua(t,r){for(var a of["mode","atime","mtime","ctime"])r[a]!=null&&(t[a]=r[a]);r.size!==void 0&&(r=r.size,t.Ra!=r&&(r==0?(t.Na=null,t.Ra=0):(a=t.Na,t.Na=new Uint8Array(r),a&&t.Na.set(a.subarray(0,Math.min(r,t.Ra))),t.Ra=r)))},lookup(){throw P.vb},hb(t,r,a,c){return P.createNode(t,r,a,c)},rename(t,r,a){try{var c=we(r,a)}catch{}if(c){if(te(t.mode))for(var f in c.Na)throw new C(55);wt(c)}delete t.parent.Na[t.name],r.Na[a]=t,t.name=a,r.ctime=r.mtime=t.parent.ctime=t.parent.mtime=Date.now()},unlink(t,r){delete t.Na[r],t.ctime=t.mtime=Date.now()},rmdir(t,r){var a=we(t,r),c;for(c in a.Na)throw new C(55);delete t.Na[r],t.ctime=t.mtime=Date.now()},readdir(t){return[".","..",...Object.keys(t.Na)]},symlink(t,r,a){return t=P.createNode(t,r,41471,0),t.link=a,t},readlink(t){if((t.mode&61440)!==40960)throw new C(28);return t.link}},Ma:{read(t,r,a,c,f){var m=t.node.Na;if(f>=t.node.Ra)return 0;if(t=Math.min(t.node.Ra-f,c),8<t&&m.subarray)r.set(m.subarray(f,f+t),a);else for(c=0;c<t;c++)r[a+c]=m[f+c];return t},write(t,r,a,c,f,m){if(r.buffer===K.buffer&&(m=!1),!c)return 0;if(t=t.node,t.mtime=t.ctime=Date.now(),r.subarray&&(!t.Na||t.Na.subarray)){if(m)return t.Na=r.subarray(a,a+c),t.Ra=c;if(t.Ra===0&&f===0)return t.Na=r.slice(a,a+c),t.Ra=c;if(f+c<=t.Ra)return t.Na.set(r.subarray(a,a+c),f),c}m=f+c;var b=t.Na?t.Na.length:0;if(b>=m||(m=Math.max(m,b*(1048576>b?2:1.125)>>>0),b!=0&&(m=Math.max(m,256)),b=t.Na,t.Na=new Uint8Array(m),0<t.Ra&&t.Na.set(b.subarray(0,t.Ra),0)),t.Na.subarray&&r.subarray)t.Na.set(r.subarray(a,a+c),f);else for(m=0;m<c;m++)t.Na[f+m]=r[a+m];return t.Ra=Math.max(t.Ra,f+c),c},Va(t,r,a){if(a===1?r+=t.position:a===2&&(t.node.mode&61440)===32768&&(r+=t.node.Ra),0>r)throw new C(28);return r},ib(t,r,a,c,f){if((t.node.mode&61440)!==32768)throw new C(43);if(t=t.node.Na,f&2||!t||t.buffer!==K.buffer){f=!0,c=65536*Math.ceil(r/65536);var m=ys(65536,c);if(m&&I.fill(0,m,m+c),c=m,!c)throw new C(48);t&&((0<a||a+r<t.length)&&(t.subarray?t=t.subarray(a,a+r):t=Array.prototype.slice.call(t,a,a+r)),K.set(t,c))}else f=!1,c=t.byteOffset;return{Kb:c,Ab:f}},jb(t,r,a,c){return P.Ma.write(t,r,0,c,a,!1),0}}},Jt=(t,r)=>{var a=0;return t&&(a|=365),r&&(a|=146),a},bt=null,Zt={},Me=[],Vs=1,pe=null,es=!1,ts=!0,ss={},C=class{constructor(t){x(this,"name","ErrnoError");this.Pa=t}},Ws=class{constructor(){x(this,"gb",{});x(this,"node",null)}get flags(){return this.gb.flags}set flags(t){this.gb.flags=t}get position(){return this.gb.position}set position(t){this.gb.position=t}},Gs=class{constructor(t,r,a,c){x(this,"La",{});x(this,"Ma",{});x(this,"ab",null);t||(t=this),this.parent=t,this.Xa=t.Xa,this.id=Vs++,this.name=r,this.mode=a,this.rdev=c,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(t){t?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(t){t?this.mode|=146:this.mode&=-147}};function ie(t,r={}){if(!t)throw new C(44);r.nb??(r.nb=!0),t.charAt(0)==="/"||(t="//"+t);var a=0;e:for(;40>a;a++){t=t.split("/").filter(A=>!!A);for(var c=bt,f="/",m=0;m<t.length;m++){var b=m===t.length-1;if(b&&r.parent)break;if(t[m]!==".")if(t[m]==="..")f=Gt(f),c=c.parent;else{f=mt(f+"/"+t[m]);try{c=we(c,t[m])}catch(A){if((A==null?void 0:A.Pa)===44&&b&&r.Jb)return{path:f};throw A}if(!c.ab||b&&!r.nb||(c=c.ab.root),(c.mode&61440)===40960&&(!b||r.$a)){if(!c.La.readlink)throw new C(52);c=c.La.readlink(c),c.charAt(0)==="/"||(c=Gt(f)+"/"+c),t=c+"/"+t.slice(m+1).join("/");continue e}}}return{path:f,node:c}}throw new C(32)}function yt(t){for(var r;;){if(t===t.parent)return t=t.Xa.zb,r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t;r=r?`${t.name}/${r}`:t.name,t=t.parent}}function vt(t,r){for(var a=0,c=0;c<r.length;c++)a=(a<<5)-a+r.charCodeAt(c)|0;return(t+a>>>0)%pe.length}function wt(t){var r=vt(t.parent.id,t.name);if(pe[r]===t)pe[r]=t.bb;else for(r=pe[r];r;){if(r.bb===t){r.bb=t.bb;break}r=r.bb}}function we(t,r){var a=te(t.mode)?(a=De(t,"x"))?a:t.La.lookup?0:2:54;if(a)throw new C(a);for(a=pe[vt(t.id,r)];a;a=a.bb){var c=a.name;if(a.parent.id===t.id&&c===r)return a}return t.La.lookup(t,r)}function rs(t,r,a,c){return t=new Gs(t,r,a,c),r=vt(t.parent.id,t.name),t.bb=pe[r],pe[r]=t}function te(t){return(t&61440)===16384}function ns(t){var r=["r","w","rw"][t&3];return t&512&&(r+="w"),r}function De(t,r){if(ts)return 0;if(!r.includes("r")||t.mode&292){if(r.includes("w")&&!(t.mode&146)||r.includes("x")&&!(t.mode&73))return 2}else return 2;return 0}function is(t,r){if(!te(t.mode))return 54;try{return we(t,r),20}catch{}return De(t,"wx")}function as(t,r,a){try{var c=we(t,r)}catch(f){return f.Pa}if(t=De(t,"wx"))return t;if(a){if(!te(c.mode))return 54;if(c===c.parent||yt(c)==="/")return 10}else if(te(c.mode))return 31;return 0}function Qe(t){if(!t)throw new C(63);return t}function ee(t){if(t=Me[t],!t)throw new C(8);return t}function os(t,r=-1){if(t=Object.assign(new Ws,t),r==-1)e:{for(r=0;4096>=r;r++)if(!Me[r])break e;throw new C(33)}return t.fd=r,Me[r]=t}function Ks(t,r=-1){var a,c;return t=os(t,r),(c=(a=t.Ma)==null?void 0:a.Rb)==null||c.call(a,t),t}function xt(t,r,a){var c=t==null?void 0:t.Ma.Ua;t=c?t:r,c??(c=r.La.Ua),Qe(c),c(t,a)}var Qs={open(t){var r,a;t.Ma=Zt[t.node.rdev].Ma,(a=(r=t.Ma).open)==null||a.call(r,t)},Va(){throw new C(70)}};function St(t,r){Zt[t]={Ma:r}}function ls(t,r){var a=r==="/";if(a&&bt)throw new C(10);if(!a&&r){var c=ie(r,{nb:!1});if(r=c.path,c=c.node,c.ab)throw new C(10);if(!te(c.mode))throw new C(54)}r={type:t,Wb:{},zb:r,Ib:[]},t=t.Xa(r),t.Xa=r,r.root=t,a?bt=t:c&&(c.ab=r,c.Xa&&c.Xa.Ib.push(r))}function Ye(t,r,a){var c=ie(t,{parent:!0}).node;if(t=Ke(t),!t)throw new C(28);if(t==="."||t==="..")throw new C(20);var f=is(c,t);if(f)throw new C(f);if(!c.La.hb)throw new C(63);return c.La.hb(c,t,r,a)}function Ys(t,r=438){return Ye(t,r&4095|32768,0)}function ue(t,r=511){return Ye(t,r&1023|16384,0)}function Xe(t,r,a){typeof a>"u"&&(a=r,r=438),Ye(t,r|8192,a)}function Ct(t,r){if(!Us(t))throw new C(44);var a=ie(r,{parent:!0}).node;if(!a)throw new C(44);r=Ke(r);var c=is(a,r);if(c)throw new C(c);if(!a.La.symlink)throw new C(63);a.La.symlink(a,r,t)}function cs(t){var r=ie(t,{parent:!0}).node;t=Ke(t);var a=we(r,t),c=as(r,t,!0);if(c)throw new C(c);if(!r.La.rmdir)throw new C(63);if(a.ab)throw new C(10);r.La.rmdir(r,t),wt(a)}function us(t){var r=ie(t,{parent:!0}).node;if(!r)throw new C(44);t=Ke(t);var a=we(r,t),c=as(r,t,!1);if(c)throw new C(c);if(!r.La.unlink)throw new C(63);if(a.ab)throw new C(10);r.La.unlink(r,t),wt(a)}function Ue(t,r){return t=ie(t,{$a:!r}).node,Qe(t.La.Ta)(t)}function ds(t,r,a,c){xt(t,r,{mode:a&4095|r.mode&-4096,ctime:Date.now(),Fb:c})}function Je(t,r){t=typeof t=="string"?ie(t,{$a:!0}).node:t,ds(null,t,r)}function hs(t,r,a){if(te(r.mode))throw new C(31);if((r.mode&61440)!==32768)throw new C(28);var c=De(r,"w");if(c)throw new C(c);xt(t,r,{size:a,timestamp:Date.now()})}function Ne(t,r,a=438){if(t==="")throw new C(44);if(typeof r=="string"){var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[r];if(typeof c>"u")throw Error(`Unknown file open mode: ${r}`);r=c}if(a=r&64?a&4095|32768:0,typeof t=="object")c=t;else{var f=t.endsWith("/");t=ie(t,{$a:!(r&131072),Jb:!0}),c=t.node,t=t.path}var m=!1;if(r&64)if(c){if(r&128)throw new C(20)}else{if(f)throw new C(31);c=Ye(t,a|511,0),m=!0}if(!c)throw new C(44);if((c.mode&61440)===8192&&(r&=-513),r&65536&&!te(c.mode))throw new C(54);if(!m&&(f=c?(c.mode&61440)===40960?32:te(c.mode)&&(ns(r)!=="r"||r&576)?31:De(c,ns(r)):44))throw new C(f);return r&512&&!m&&(f=c,f=typeof f=="string"?ie(f,{$a:!0}).node:f,hs(null,f,0)),r&=-131713,f=os({node:c,path:yt(c),flags:r,seekable:!0,position:0,Ma:c.Ma,Lb:[],error:!1}),f.Ma.open&&f.Ma.open(f),m&&Je(c,a&511),!l.logReadFiles||r&1||t in ss||(ss[t]=1),f}function Tt(t){if(t.fd===null)throw new C(8);t.ob&&(t.ob=null);try{t.Ma.close&&t.Ma.close(t)}catch(r){throw r}finally{Me[t.fd]=null}t.fd=null}function fs(t,r,a){if(t.fd===null)throw new C(8);if(!t.seekable||!t.Ma.Va)throw new C(70);if(a!=0&&a!=1&&a!=2)throw new C(28);t.position=t.Ma.Va(t,r,a),t.Lb=[]}function ps(t,r,a,c,f){if(0>c||0>f)throw new C(28);if(t.fd===null)throw new C(8);if((t.flags&2097155)===1)throw new C(8);if(te(t.node.mode))throw new C(31);if(!t.Ma.read)throw new C(28);var m=typeof f<"u";if(!m)f=t.position;else if(!t.seekable)throw new C(70);return r=t.Ma.read(t,r,a,c,f),m||(t.position+=r),r}function ms(t,r,a,c,f){if(0>c||0>f)throw new C(28);if(t.fd===null)throw new C(8);if((t.flags&2097155)===0)throw new C(8);if(te(t.node.mode))throw new C(31);if(!t.Ma.write)throw new C(28);t.seekable&&t.flags&1024&&fs(t,0,2);var m=typeof f<"u";if(!m)f=t.position;else if(!t.seekable)throw new C(70);return r=t.Ma.write(t,r,a,c,f,void 0),m||(t.position+=r),r}function Xs(t){var r,a=Ne(t,a||0);t=Ue(t).size;var c=new Uint8Array(t);return ps(a,c,0,t,0),r=c,Tt(a),r}function me(t,r,a){t=mt("/dev/"+t);var c=Jt(!!r,!!a);me.yb??(me.yb=64);var f=me.yb++<<8|0;St(f,{open(m){m.seekable=!1},close(){var m;(m=a==null?void 0:a.buffer)!=null&&m.length&&a(10)},read(m,b,A,q){for(var j=0,Y=0;Y<q;Y++){try{var se=r()}catch{throw new C(29)}if(se===void 0&&j===0)throw new C(6);if(se==null)break;j++,b[A+Y]=se}return j&&(m.node.atime=Date.now()),j},write(m,b,A,q){for(var j=0;j<q;j++)try{a(b[A+j])}catch{throw new C(29)}return q&&(m.node.mtime=m.node.ctime=Date.now()),j}}),Xe(t,c,f)}var G={};function xe(t,r,a){if(r.charAt(0)==="/")return r;if(t=t===-100?"/":ee(t).path,r.length==0){if(!a)throw new C(44);return t}return t+"/"+r}function Ze(t,r){W[t>>2]=r.dev,W[t+4>>2]=r.mode,J[t+8>>2]=r.nlink,W[t+12>>2]=r.uid,W[t+16>>2]=r.gid,W[t+20>>2]=r.rdev,oe[t+24>>3]=BigInt(r.size),W[t+32>>2]=4096,W[t+36>>2]=r.blocks;var a=r.atime.getTime(),c=r.mtime.getTime(),f=r.ctime.getTime();return oe[t+40>>3]=BigInt(Math.floor(a/1e3)),J[t+48>>2]=a%1e3*1e6,oe[t+56>>3]=BigInt(Math.floor(c/1e3)),J[t+64>>2]=c%1e3*1e6,oe[t+72>>3]=BigInt(Math.floor(f/1e3)),J[t+80>>2]=f%1e3*1e6,oe[t+88>>3]=BigInt(r.ino),0}var et=void 0,tt=()=>{var t=W[+et>>2];return et+=4,t},$t=0,Js=[0,31,60,91,121,152,182,213,244,274,305,335],Zs=[0,31,59,90,120,151,181,212,243,273,304,334],Fe={},gs=t=>{var r;Z=t,ft||0<$t||((r=l.onExit)==null||r.call(l,t),X=!0),B(t,new ht(t))},er=t=>{if(!X)try{if(t(),!(ft||0<$t))try{Z=t=Z,gs(t)}catch(r){r instanceof ht||r=="unwind"||B(1,r)}}catch(r){r instanceof ht||r=="unwind"||B(1,r)}},kt={},bs=()=>{if(!_t){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:R||"./this.program"},r;for(r in kt)kt[r]===void 0?delete t[r]:t[r]=kt[r];var a=[];for(r in t)a.push(`${r}=${t[r]}`);_t=a}return _t},_t,Et=t=>{var r=Ie(t)+1,a=be(r);return he(t,I,a,r),a},tr=(t,r,a,c)=>{var f={string:j=>{var Y=0;return j!=null&&j!==0&&(Y=Et(j)),Y},array:j=>{var Y=be(j.length);return K.set(j,Y),Y}};t=l["_"+t];var m=[],b=0;if(c)for(var A=0;A<c.length;A++){var q=f[a[A]];q?(b===0&&(b=Ve()),m[A]=q(c[A])):m[A]=c[A]}return a=t(...m),a=(function(j){return b!==0&&Be(b),r==="string"?j?Q(I,j):"":r==="boolean"?!!j:j})(a)},st=0,rt=(t,r)=>(r=r==1?be(t.length):Lt(t.length),t.subarray||t.slice||(t=new Uint8Array(t)),I.set(t,r),r),Se,At=[],fe,ge=t=>{Se.delete(fe.get(t)),fe.set(t,null),At.push(t)},He=(t,r)=>{if(!Se){Se=new WeakMap;var a=fe.length;if(Se)for(var c=0;c<0+a;c++){var f=fe.get(c);f&&Se.set(f,c)}}if(a=Se.get(t)||0)return a;if(At.length)a=At.pop();else{try{fe.grow(1)}catch(q){throw q instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":q}a=fe.length-1}try{fe.set(a,t)}catch(q){if(!(q instanceof TypeError))throw q;if(typeof WebAssembly.Function=="function"){var m=WebAssembly.Function;c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:r[0]=="v"?[]:[c[r[0]]]};for(var b=1;b<r.length;++b)f.parameters.push(c[r[b]]);r=new m(f,t)}else{c=[1],f=r.slice(0,1),r=r.slice(1),b={i:127,p:127,j:126,f:125,d:124,e:111},c.push(96);var A=r.length;128>A?c.push(A):c.push(A%128|128,A>>7);for(m of r)c.push(b[m]);f=="v"?c.push(0):c.push(1,b[f]),r=[0,97,115,109,1,0,0,0,1],m=c.length,128>m?r.push(m):r.push(m%128|128,m>>7),r.push(...c),r.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),r=new WebAssembly.Module(new Uint8Array(r)),r=new WebAssembly.Instance(r,{e:{f:t}}).exports.f}fe.set(a,r)}return Se.set(t,a),a};pe=Array(4096),ls(P,"/"),ue("/tmp"),ue("/home"),ue("/home/web_user"),(function(){ue("/dev"),St(259,{read:()=>0,write:(c,f,m,b)=>b,Va:()=>0}),Xe("/dev/null",259),Xt(1280,Hs),Xt(1536,Bs),Xe("/dev/tty",1280),Xe("/dev/tty1",1536);var t=new Uint8Array(1024),r=0,a=()=>(r===0&&(Kt(t),r=t.byteLength),t[--r]);me("random",a),me("urandom",a),ue("/dev/shm"),ue("/dev/shm/tmp")})(),(function(){ue("/proc");var t=ue("/proc/self");ue("/proc/self/fd"),ls({Xa(){var r=rs(t,"fd",16895,73);return r.Ma={Va:P.Ma.Va},r.La={lookup(a,c){a=+c;var f=ee(a);return a={parent:null,Xa:{zb:"fake"},La:{readlink:()=>f.path},id:a+1},a.parent=a},readdir(){return Array.from(Me.entries()).filter(([,a])=>a).map(([a])=>a.toString())}},r}},"/proc/self/fd")})(),P.vb=new C(44),P.vb.stack="<generic error, no stack>";var sr={a:(t,r,a,c)=>Le(`Assertion failed: ${t?Q(I,t):""}, at: `+[r?r?Q(I,r):"":"unknown filename",a,c?c?Q(I,c):"":"unknown function"]),i:function(t,r){try{return t=t?Q(I,t):"",Je(t,r),0}catch(a){if(typeof G>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},L:function(t,r,a){try{if(r=r?Q(I,r):"",r=xe(t,r),a&-8)return-28;var c=ie(r,{$a:!0}).node;return c?(t="",a&4&&(t+="r"),a&2&&(t+="w"),a&1&&(t+="x"),t&&De(c,t)?-2:0):-44}catch(f){if(typeof G>"u"||f.name!=="ErrnoError")throw f;return-f.Pa}},j:function(t,r){try{var a=ee(t);return ds(a,a.node,r,!1),0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},h:function(t){try{var r=ee(t);return xt(r,r.node,{timestamp:Date.now(),Fb:!1}),0}catch(a){if(typeof G>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},b:function(t,r,a){et=a;try{var c=ee(t);switch(r){case 0:var f=tt();if(0>f)break;for(;Me[f];)f++;return Ks(c,f).fd;case 1:case 2:return 0;case 3:return c.flags;case 4:return f=tt(),c.flags|=f,0;case 12:return f=tt(),re[f+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(m){if(typeof G>"u"||m.name!=="ErrnoError")throw m;return-m.Pa}},g:function(t,r){try{var a=ee(t),c=a.node,f=a.Ma.Ta;t=f?a:c,f??(f=c.La.Ta),Qe(f);var m=f(t);return Ze(r,m)}catch(b){if(typeof G>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},H:function(t,r){r=-9007199254740992>r||9007199254740992<r?NaN:Number(r);try{if(isNaN(r))return 61;var a=ee(t);if(0>r||(a.flags&2097155)===0)throw new C(28);return hs(a,a.node,r),0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},G:function(t,r){try{if(r===0)return-28;var a=Ie("/")+1;return r<a?-68:(he("/",I,t,r),a)}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},K:function(t,r){try{return t=t?Q(I,t):"",Ze(r,Ue(t,!0))}catch(a){if(typeof G>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},C:function(t,r,a){try{return r=r?Q(I,r):"",r=xe(t,r),ue(r,a),0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},J:function(t,r,a,c){try{r=r?Q(I,r):"";var f=c&256;return r=xe(t,r,c&4096),Ze(a,f?Ue(r,!0):Ue(r))}catch(m){if(typeof G>"u"||m.name!=="ErrnoError")throw m;return-m.Pa}},x:function(t,r,a,c){et=c;try{r=r?Q(I,r):"",r=xe(t,r);var f=c?tt():0;return Ne(r,a,f).fd}catch(m){if(typeof G>"u"||m.name!=="ErrnoError")throw m;return-m.Pa}},v:function(t,r,a,c){try{if(r=r?Q(I,r):"",r=xe(t,r),0>=c)return-28;var f=ie(r).node;if(!f)throw new C(44);if(!f.La.readlink)throw new C(28);var m=f.La.readlink(f),b=Math.min(c,Ie(m)),A=K[a+b];return he(m,I,a,c+1),K[a+b]=A,b}catch(q){if(typeof G>"u"||q.name!=="ErrnoError")throw q;return-q.Pa}},u:function(t){try{return t=t?Q(I,t):"",cs(t),0}catch(r){if(typeof G>"u"||r.name!=="ErrnoError")throw r;return-r.Pa}},f:function(t,r){try{return t=t?Q(I,t):"",Ze(r,Ue(t))}catch(a){if(typeof G>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},r:function(t,r,a){try{return r=r?Q(I,r):"",r=xe(t,r),a===0?us(r):a===512?cs(r):Le("Invalid flags passed to unlinkat"),0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},q:function(t,r,a){try{r=r?Q(I,r):"",r=xe(t,r,!0);var c=Date.now(),f,m;if(a){var b=J[a>>2]+4294967296*W[a+4>>2],A=W[a+8>>2];A==1073741823?f=c:A==1073741822?f=null:f=1e3*b+A/1e6,a+=16,b=J[a>>2]+4294967296*W[a+4>>2],A=W[a+8>>2],A==1073741823?m=c:A==1073741822?m=null:m=1e3*b+A/1e6}else m=f=c;if((m??f)!==null){t=f;var q=ie(r,{$a:!0}).node;Qe(q.La.Ua)(q,{atime:t,mtime:m})}return 0}catch(j){if(typeof G>"u"||j.name!=="ErrnoError")throw j;return-j.Pa}},m:()=>Le(""),l:()=>{ft=!1,$t=0},A:function(t,r){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),t=new Date(1e3*t),W[r>>2]=t.getSeconds(),W[r+4>>2]=t.getMinutes(),W[r+8>>2]=t.getHours(),W[r+12>>2]=t.getDate(),W[r+16>>2]=t.getMonth(),W[r+20>>2]=t.getFullYear()-1900,W[r+24>>2]=t.getDay();var a=t.getFullYear();W[r+28>>2]=(a%4!==0||a%100===0&&a%400!==0?Zs:Js)[t.getMonth()]+t.getDate()-1|0,W[r+36>>2]=-(60*t.getTimezoneOffset()),a=new Date(t.getFullYear(),6,1).getTimezoneOffset();var c=new Date(t.getFullYear(),0,1).getTimezoneOffset();W[r+32>>2]=(a!=c&&t.getTimezoneOffset()==Math.min(c,a))|0},y:function(t,r,a,c,f,m,b){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var A=ee(c);if((r&2)!==0&&(a&2)===0&&(A.flags&2097155)!==2)throw new C(2);if((A.flags&2097155)===1)throw new C(2);if(!A.Ma.ib)throw new C(43);if(!t)throw new C(28);var q=A.Ma.ib(A,t,f,r,a),j=q.Kb;return W[m>>2]=q.Ab,J[b>>2]=j,0}catch(Y){if(typeof G>"u"||Y.name!=="ErrnoError")throw Y;return-Y.Pa}},z:function(t,r,a,c,f,m){m=-9007199254740992>m||9007199254740992<m?NaN:Number(m);try{var b=ee(f);if(a&2){if(a=m,(b.node.mode&61440)!==32768)throw new C(43);if(!(c&2)){var A=I.slice(t,t+r);b.Ma.jb&&b.Ma.jb(b,A,a,r,c)}}}catch(q){if(typeof G>"u"||q.name!=="ErrnoError")throw q;return-q.Pa}},n:(t,r)=>{if(Fe[t]&&(clearTimeout(Fe[t].id),delete Fe[t]),!r)return 0;var a=setTimeout(()=>{delete Fe[t],er(()=>vs(t,performance.now()))},r);return Fe[t]={id:a,Xb:r},0},B:(t,r,a,c)=>{var f=new Date().getFullYear(),m=new Date(f,0,1).getTimezoneOffset();f=new Date(f,6,1).getTimezoneOffset(),J[t>>2]=60*Math.max(m,f),W[r>>2]=+(m!=f),r=b=>{var A=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(A/60)).padStart(2,"0")}${String(A%60).padStart(2,"0")}`},t=r(m),r=r(f),f<m?(he(t,I,a,17),he(r,I,c,17)):(he(t,I,c,17),he(r,I,a,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:t=>{var r=I.length;if(t>>>=0,2147483648<t)return!1;for(var a=1;4>=a;a*=2){var c=r*(1+.2/a);c=Math.min(c,t+100663296);e:{c=(Math.min(2147483648,65536*Math.ceil(Math.max(t,c)/65536))-U.buffer.byteLength+65535)/65536|0;try{U.grow(c),Ut();var f=1;break e}catch{}f=void 0}if(f)return!0}return!1},E:(t,r)=>{var a=0;return bs().forEach((c,f)=>{var m=r+a;for(f=J[t+4*f>>2]=m,m=0;m<c.length;++m)K[f++]=c.charCodeAt(m);K[f]=0,a+=c.length+1}),0},F:(t,r)=>{var a=bs();J[t>>2]=a.length;var c=0;return a.forEach(f=>c+=f.length+1),J[r>>2]=c,0},e:function(t){try{var r=ee(t);return Tt(r),0}catch(a){if(typeof G>"u"||a.name!=="ErrnoError")throw a;return a.Pa}},p:function(t,r){try{var a=ee(t);return K[r]=a.tty?2:te(a.mode)?3:(a.mode&61440)===40960?7:4,re[r+2>>1]=0,oe[r+8>>3]=BigInt(0),oe[r+16>>3]=BigInt(0),0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},w:function(t,r,a,c){try{e:{var f=ee(t);t=r;for(var m,b=r=0;b<a;b++){var A=J[t>>2],q=J[t+4>>2];t+=8;var j=ps(f,K,A,q,m);if(0>j){var Y=-1;break e}if(r+=j,j<q)break;typeof m<"u"&&(m+=j)}Y=r}return J[c>>2]=Y,0}catch(se){if(typeof G>"u"||se.name!=="ErrnoError")throw se;return se.Pa}},D:function(t,r,a,c){r=-9007199254740992>r||9007199254740992<r?NaN:Number(r);try{if(isNaN(r))return 61;var f=ee(t);return fs(f,r,a),oe[c>>3]=BigInt(f.position),f.ob&&r===0&&a===0&&(f.ob=null),0}catch(m){if(typeof G>"u"||m.name!=="ErrnoError")throw m;return m.Pa}},I:function(t){var a;try{var r=ee(t);return(a=r.Ma)!=null&&a.fsync?r.Ma.fsync(r):0}catch(c){if(typeof G>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},t:function(t,r,a,c){try{e:{var f=ee(t);t=r;for(var m,b=r=0;b<a;b++){var A=J[t>>2],q=J[t+4>>2];t+=8;var j=ms(f,K,A,q,m);if(0>j){var Y=-1;break e}if(r+=j,j<q)break;typeof m<"u"&&(m+=j)}Y=r}return J[c>>2]=Y,0}catch(se){if(typeof G>"u"||se.name!=="ErrnoError")throw se;return se.Pa}},k:gs},L;(async function(){var a;function t(c){var f;return L=c.exports,U=L.M,Ut(),fe=L.O,ve--,(f=l.monitorRunDependencies)==null||f.call(l,ve),ve==0&&qe&&(c=qe,qe=null,c()),L}ve++,(a=l.monitorRunDependencies)==null||a.call(l,ve);var r={a:sr};return l.instantiateWasm?new Promise(c=>{l.instantiateWasm(r,(f,m)=>{t(f),c(f.exports)})}):(dt??(dt=l.locateFile?l.locateFile("sql-wasm.wasm",M):M+"sql-wasm.wasm"),t((await qs(r)).instance))})(),l._sqlite3_free=t=>(l._sqlite3_free=L.P)(t),l._sqlite3_value_text=t=>(l._sqlite3_value_text=L.Q)(t),l._sqlite3_prepare_v2=(t,r,a,c,f)=>(l._sqlite3_prepare_v2=L.R)(t,r,a,c,f),l._sqlite3_step=t=>(l._sqlite3_step=L.S)(t),l._sqlite3_reset=t=>(l._sqlite3_reset=L.T)(t),l._sqlite3_exec=(t,r,a,c,f)=>(l._sqlite3_exec=L.U)(t,r,a,c,f),l._sqlite3_finalize=t=>(l._sqlite3_finalize=L.V)(t),l._sqlite3_column_name=(t,r)=>(l._sqlite3_column_name=L.W)(t,r),l._sqlite3_column_text=(t,r)=>(l._sqlite3_column_text=L.X)(t,r),l._sqlite3_column_type=(t,r)=>(l._sqlite3_column_type=L.Y)(t,r),l._sqlite3_errmsg=t=>(l._sqlite3_errmsg=L.Z)(t),l._sqlite3_clear_bindings=t=>(l._sqlite3_clear_bindings=L._)(t),l._sqlite3_value_blob=t=>(l._sqlite3_value_blob=L.$)(t),l._sqlite3_value_bytes=t=>(l._sqlite3_value_bytes=L.aa)(t),l._sqlite3_value_double=t=>(l._sqlite3_value_double=L.ba)(t),l._sqlite3_value_int=t=>(l._sqlite3_value_int=L.ca)(t),l._sqlite3_value_type=t=>(l._sqlite3_value_type=L.da)(t),l._sqlite3_result_blob=(t,r,a,c)=>(l._sqlite3_result_blob=L.ea)(t,r,a,c),l._sqlite3_result_double=(t,r)=>(l._sqlite3_result_double=L.fa)(t,r),l._sqlite3_result_error=(t,r,a)=>(l._sqlite3_result_error=L.ga)(t,r,a),l._sqlite3_result_int=(t,r)=>(l._sqlite3_result_int=L.ha)(t,r),l._sqlite3_result_int64=(t,r)=>(l._sqlite3_result_int64=L.ia)(t,r),l._sqlite3_result_null=t=>(l._sqlite3_result_null=L.ja)(t),l._sqlite3_result_text=(t,r,a,c)=>(l._sqlite3_result_text=L.ka)(t,r,a,c),l._sqlite3_aggregate_context=(t,r)=>(l._sqlite3_aggregate_context=L.la)(t,r),l._sqlite3_column_count=t=>(l._sqlite3_column_count=L.ma)(t),l._sqlite3_data_count=t=>(l._sqlite3_data_count=L.na)(t),l._sqlite3_column_blob=(t,r)=>(l._sqlite3_column_blob=L.oa)(t,r),l._sqlite3_column_bytes=(t,r)=>(l._sqlite3_column_bytes=L.pa)(t,r),l._sqlite3_column_double=(t,r)=>(l._sqlite3_column_double=L.qa)(t,r),l._sqlite3_bind_blob=(t,r,a,c,f)=>(l._sqlite3_bind_blob=L.ra)(t,r,a,c,f),l._sqlite3_bind_double=(t,r,a)=>(l._sqlite3_bind_double=L.sa)(t,r,a),l._sqlite3_bind_int=(t,r,a)=>(l._sqlite3_bind_int=L.ta)(t,r,a),l._sqlite3_bind_text=(t,r,a,c,f)=>(l._sqlite3_bind_text=L.ua)(t,r,a,c,f),l._sqlite3_bind_parameter_index=(t,r)=>(l._sqlite3_bind_parameter_index=L.va)(t,r),l._sqlite3_sql=t=>(l._sqlite3_sql=L.wa)(t),l._sqlite3_normalized_sql=t=>(l._sqlite3_normalized_sql=L.xa)(t),l._sqlite3_changes=t=>(l._sqlite3_changes=L.ya)(t),l._sqlite3_close_v2=t=>(l._sqlite3_close_v2=L.za)(t),l._sqlite3_create_function_v2=(t,r,a,c,f,m,b,A,q)=>(l._sqlite3_create_function_v2=L.Aa)(t,r,a,c,f,m,b,A,q),l._sqlite3_update_hook=(t,r,a)=>(l._sqlite3_update_hook=L.Ba)(t,r,a),l._sqlite3_open=(t,r)=>(l._sqlite3_open=L.Ca)(t,r);var Lt=l._malloc=t=>(Lt=l._malloc=L.Da)(t),nt=l._free=t=>(nt=l._free=L.Ea)(t);l._RegisterExtensionFunctions=t=>(l._RegisterExtensionFunctions=L.Fa)(t);var ys=(t,r)=>(ys=L.Ga)(t,r),vs=(t,r)=>(vs=L.Ha)(t,r),Be=t=>(Be=L.Ia)(t),be=t=>(be=L.Ja)(t),Ve=()=>(Ve=L.Ka)();l.stackSave=()=>Ve(),l.stackRestore=t=>Be(t),l.stackAlloc=t=>be(t),l.cwrap=(t,r,a,c)=>{var f=!a||a.every(m=>m==="number"||m==="boolean");return r!=="string"&&f&&!c?l["_"+t]:(...m)=>tr(t,r,a,m)},l.addFunction=He,l.removeFunction=ge,l.UTF8ToString=pt,l.ALLOC_NORMAL=st,l.allocate=rt,l.allocateUTF8OnStack=Et;function Mt(){function t(){var f;if(l.calledRun=!0,!X){if(!l.noFSInit&&!es){var r,a;es=!0,c??(c=l.stdin),r??(r=l.stdout),a??(a=l.stderr),c?me("stdin",c):Ct("/dev/tty","/dev/stdin"),r?me("stdout",null,r):Ct("/dev/tty","/dev/stdout"),a?me("stderr",null,a):Ct("/dev/tty1","/dev/stderr"),Ne("/dev/stdin",0),Ne("/dev/stdout",1),Ne("/dev/stderr",1)}if(L.N(),ts=!1,(f=l.onRuntimeInitialized)==null||f.call(l),l.postRun)for(typeof l.postRun=="function"&&(l.postRun=[l.postRun]);l.postRun.length;){var c=l.postRun.shift();Ht.unshift(c)}Ft(Ht)}}if(0<ve)qe=Mt;else{if(l.preRun)for(typeof l.preRun=="function"&&(l.preRun=[l.preRun]);l.preRun.length;)zs();Ft(Bt),0<ve?qe=Mt:l.setStatus?(l.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>l.setStatus(""),1),t()},1)):t()}}if(l.preInit)for(typeof l.preInit=="function"&&(l.preInit=[l.preInit]);0<l.preInit.length;)l.preInit.pop()();return Mt(),h}),s)};T.exports=i,T.exports.default=i})(Nt)),Nt.exports}var Ir=zr();const Ur=Or(Ir),at={"test/test/0":{upa:"test/test/0",dbPath:"/data/berdl_tables_ecoli_562_61143.db",configPath:"/config/berdl-tables.json"},"test/test/1":{upa:"test/test/1",dbPath:"/data/berdl_tables.db",configPath:"/config/berdl-tables.json"}},$e=class $e{constructor(){x(this,"db",null);x(this,"currentDbPath",null);x(this,"sqlPromise",null)}static getInstance(){return $e.instance||($e.instance=new $e),$e.instance}static isLocalDb(e){return e in at||e.startsWith("local/")}static getConfig(e){return at[e]||null}async initSql(){return this.sqlPromise||(this.sqlPromise=Ur({locateFile:e=>`https://sql.js.org/dist/${e}`})),this.sqlPromise}async loadDatabase(e){if(this.db&&this.currentDbPath===e)return;this.db&&(this.db.close(),this.db=null);const s=await this.initSql(),i=await fetch(e);if(!i.ok)throw new Error(`Failed to load database: ${i.status} ${i.statusText}`);const n=await i.arrayBuffer();this.db=new s.Database(new Uint8Array(n)),this.currentDbPath=e}async listTables(e){const s=at[e];if(!s)throw new Error(`Unknown local database UPA: ${e}`);if(await this.loadDatabase(s.dbPath),!this.db)throw new Error("Database not loaded");let i={};try{const n=await fetch(s.configPath);n.ok&&(i=await n.json())}catch(n){console.warn("Failed to load config:",n)}return this.listTablesFromDb(s.dbPath,i)}async listTablesFromDb(e,s={}){var o;if(await this.loadDatabase(e),!this.db)throw new Error("Database not loaded");const i=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),n=[];if(i.length>0&&i[0].values)for(const u of i[0].values){const h=u[0],d=this.db.exec(`SELECT COUNT(*) FROM "${h}"`),l=d.length>0?d[0].values[0][0]:0,w=this.db.exec(`PRAGMA table_info("${h}")`),g=w.length>0?w[0].values.length:0,S=(o=s.tables)==null?void 0:o[h];n.push({name:h,displayName:(S==null?void 0:S.displayName)||h,row_count:l,column_count:g,description:S==null?void 0:S.description})}return{tables:n,type:"berdl_tables",object_type:"KBaseFBA.GenomeDataLakeTables-2.0"}}async getTableData(e,s){let i;if(e.startsWith("local/")){if(!this.currentDbPath)throw new Error(`Database not loaded for UPA: ${e}`);i=this.currentDbPath}else{const z=at[e];if(!z)throw new Error(`Unknown local database UPA: ${e}`);i=z.dbPath}if(await this.loadDatabase(i),!this.db)throw new Error("Database not loaded");const n=s.table_name,o=s.limit||100,u=s.offset||0;let h="*";s.columns&&s.columns.length>0&&(h=s.columns.map(z=>`"${z}"`).join(", "));const d=[],l=[];if(s.search_value&&s.search_value.trim()){const z=this.db.exec(`PRAGMA table_info("${n}")`);if(z.length>0){const F=z[0].values.map(U=>`CAST("${U[1]}" AS TEXT) LIKE ?`);d.push(`(${F.join(" OR ")})`);const H=`%${s.search_value}%`;for(let U=0;U<z[0].values.length;U++)l.push(H)}}if(s.col_filter)for(const[z,F]of Object.entries(s.col_filter))F!=null&&F!==""&&(d.push(`CAST("${z}" AS TEXT) LIKE ?`),l.push(`%${F}%`));const w=d.length>0?`WHERE ${d.join(" AND ")}`:"";let g="";if(s.sort_column){const z=s.sort_order||"ASC";g=`ORDER BY "${s.sort_column}" ${z}`}const S=`SELECT COUNT(*) FROM "${n}" ${w}`,k=this.db.prepare(S);l.length>0&&k.bind(l),k.step();const R=k.get()[0];k.free();const B=`SELECT ${h} FROM "${n}" ${w} ${g} LIMIT ? OFFSET ?`,M=[...l,o,u],E=this.db.prepare(B);E.bind(M);const _=[],N=[];for(;E.step();){const z=E.get();if(_.length===0){const F=E.getColumnNames();_.push(...F)}N.push(z)}if(E.free(),_.length===0){const z=this.db.exec(`PRAGMA table_info("${n}")`);if(z.length>0)for(const F of z[0].values)_.push(F[1])}return{headers:_,data:N,total_count:R}}close(){this.db&&(this.db.close(),this.db=null,this.currentDbPath=null)}};x($e,"instance",null);let Pe=$e;const Fr=Object.freeze(Object.defineProperty({__proto__:null,LocalDbClient:Pe},Symbol.toStringTag,{value:"Module"})),Rt={};class Ds{constructor(e={}){x(this,"baseUrl");x(this,"token");x(this,"environment");x(this,"customHeaders");x(this,"cache");x(this,"cacheTTL");x(this,"localDb");this.environment=e.environment||"appdev",e.apiConfig?(this.baseUrl=e.apiConfig.url,this.customHeaders=e.apiConfig.headers||{}):(this.baseUrl=e.baseUrl||this.getDefaultUrl(this.environment),this.customHeaders=e.headers||{}),this.token=e.token||null,this.cache=new Map,this.cacheTTL=3e5,this.localDb=Pe.getInstance()}getDefaultUrl(e){const s=(Rt==null?void 0:Rt.VITE_API_URL)||typeof window<"u"&&window.__API_URL__;if(s)return s;const i={appdev:"https://appdev.kbase.us/services/berdl_table_scanner",prod:"https://kbase.us/services/berdl_table_scanner",local:"http://127.0.0.1:8000",local_integrated:"http://localhost:3000"};return i[e]||i.appdev}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json",...this.customHeaders};return this.token&&(e.Authorization=this.token),e}getCacheKey(e,s){return`${e}:${JSON.stringify(s||{})}`}getFromCache(e){const s=this.cache.get(e);return s&&Date.now()-s.timestamp<this.cacheTTL?s.data:null}setCache(e,s){this.cache.set(e,{data:s,timestamp:Date.now()})}clearCache(){this.cache.clear()}setToken(e){this.token=e,this.clearCache()}updateConfig(e){this.baseUrl=e.url,this.customHeaders=e.headers||{},this.clearCache()}setEnvironment(e){this.environment=e,this.baseUrl=this.getDefaultUrl(e),this.clearCache()}async request(e,s,i,n=!1){const o=this.getCacheKey(e,i);if(n&&s==="GET"){const g=this.getFromCache(o);if(g)return g}if(n&&s==="POST"){const g=this.getFromCache(o);if(g)return g}const u=e.startsWith("http")?e:`${this.baseUrl}${e}`,h={method:s,headers:this.getHeaders()};let d=u;if(i)if(s==="GET"){const g=new URL(u);Object.entries(i).forEach(([S,k])=>{k!=null&&g.searchParams.set(S,String(k))}),d=g.toString()}else h.body=JSON.stringify(i);const l=await fetch(d,h);if(!l.ok){let g=`HTTP ${l.status}`;try{const S=await l.json();g=S.detail||S.message||g}catch{g=`${g}: ${l.statusText}`}throw new Error(g)}const w=await l.json();return n&&this.setCache(o,w),w}async listTables(e){if(Pe.isLocalDb(e)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&e.startsWith("local/"))try{const n=e.replace("local/","");return this.request(`${this.baseUrl}/object/${n}/tables`,"GET",void 0,!0)}catch(n){console.warn("[ApiClient] Remote API query failed, trying local fallback:",n)}if(await this.isLocalServerAvailable()&&e.startsWith("local/"))try{const n=e.replace("local/","");return this.request(`http://localhost:3000/object/${n}/tables`,"GET",void 0,!0)}catch(n){console.warn("[ApiClient] Local server query failed, using client-side:",n)}return this.localDb.listTables(e)}return this.request(`/object/${e}/tables`,"GET",void 0,!0)}async isLocalServerAvailable(){try{return(await fetch("http://localhost:3000/health",{method:"GET",signal:AbortSignal.timeout(1e3)})).ok}catch{return!1}}async getTableData(e){const s=await this.isLocalServerAvailable();if(Pe.isLocalDb(e.berdl_table_id)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&e.berdl_table_id.startsWith("local/"))try{const o=e.berdl_table_id.replace("local/",""),u={...e,berdl_table_id:`local/${o}`,limit:e.limit||100,offset:e.offset||0};return this.request(`${this.baseUrl}/table-data`,"POST",u,!1)}catch(o){console.warn("[ApiClient] Remote API query failed, trying local fallback:",o)}if(s&&e.berdl_table_id.startsWith("local/"))try{const o="3000",u={...e,limit:e.limit||100,offset:e.offset||0};return this.request(`http://localhost:${o}/table-data`,"POST",u,!1)}catch(o){console.warn("[ApiClient] Local server query failed, using client-side:",o)}return this.localDb.getTableData(e.berdl_table_id,{table_name:e.table_name,limit:e.limit,offset:e.offset,columns:e.columns,sort_column:e.sort_column,sort_order:e.sort_order,search_value:e.search_value,col_filter:e.col_filter})}const i={...e,limit:e.limit||100,offset:e.offset||0,kb_env:this.environment};return this.request("/table-data","POST",i,!1)}}const Hr={enabled:!0,baseUrl:"http://127.0.0.1:8000",timeout:1e4,cacheEnabled:!0,cacheTTL:3e5,fallbackToStatic:!0};class Os{constructor(e={}){x(this,"settings");x(this,"cache");x(this,"token",null);x(this,"pendingRequests",new Map);this.settings={...Hr,...e},this.cache=new Map}setToken(e){this.token=e,this.clearCache()}getToken(){return this.token}updateSettings(e){this.settings={...this.settings,...e}}getSettings(){return{...this.settings}}isEnabled(){return this.settings.enabled}async resolve(e,s={}){if(!this.settings.enabled)return console.debug("[RemoteConfigProvider] Provider disabled"),null;const i=this.getCacheKey(e,s.fingerprint);if(!s.forceRefresh&&this.settings.cacheEnabled){const n=this.getFromCache(i);if(n)return console.debug(`[RemoteConfigProvider] Cache hit for ${e}`),{config:n.config,source:`cached:${n.source}`}}try{const n=`resolve:${i}`;if(this.pendingRequests.has(n)){const h=await this.pendingRequests.get(n);return h?{config:h.config,source:h.source}:null}const o=this.fetchWithTimeout(`/config/resolve/${encodeURIComponent(e)}`,{fingerprint:s.fingerprint,object_type:s.objectType});this.pendingRequests.set(n,o);const u=await o;if(this.pendingRequests.delete(n),u&&u.config)return this.settings.cacheEnabled&&this.setCache(i,{config:u.config,source:u.source,timestamp:Date.now(),fingerprint:u.fingerprint}),console.log(`[RemoteConfigProvider] Resolved config for ${e} from ${u.source}`),{config:u.config,source:u.source}}catch(n){this.pendingRequests.delete(`resolve:${i}`),console.warn(`[RemoteConfigProvider] Failed to resolve config for ${e}:`,n)}return null}async getTableListWithConfig(e){if(!this.settings.enabled)return null;try{return await this.fetchWithTimeout(`/object/${encodeURIComponent(e)}/tables`)}catch(s){return console.warn(`[RemoteConfigProvider] Failed to get table list for ${e}:`,s),null}}async generateConfig(e,s={}){if(!this.settings.enabled)return null;try{const i=await this.fetchWithTimeout(`/object/${encodeURIComponent(e)}/config/generate`,{force_regenerate:s.forceRegenerate||!1,ai_provider:s.aiProvider||"auto"},"POST");if(i&&i.config)return console.log(`[RemoteConfigProvider] Generated config for ${e}: ${i.status}`),i}catch(i){console.warn(`[RemoteConfigProvider] Failed to generate config for ${e}:`,i)}return null}async getConfigById(e){if(!this.settings.enabled)return null;try{const s=await this.fetchWithTimeout(`/config/${e}`);return(s==null?void 0:s.config)??null}catch(s){return console.warn(`[RemoteConfigProvider] Failed to get config ${e}:`,s),null}}async getConfigByFingerprint(e){if(!this.settings.enabled)return null;try{return await this.fetchWithTimeout(`/config/generated/${e}`)??null}catch(s){return console.warn(`[RemoteConfigProvider] Failed to get config by fingerprint ${e}:`,s),null}}async checkHealth(){try{const e=await this.fetchWithTimeout("/",{},"GET");return(e==null?void 0:e.status)==="running"}catch{return!1}}clearCache(){this.cache.clear(),console.debug("[RemoteConfigProvider] Cache cleared")}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}getCacheKey(e,s){return s?`${e}:${s}`:e}getFromCache(e){const s=this.cache.get(e);return s&&Date.now()-s.timestamp<this.settings.cacheTTL?s:(this.cache.delete(e),null)}setCache(e,s){this.cache.set(e,s);const i=100;this.cache.size>i&&Array.from(this.cache.keys()).slice(0,this.cache.size-i).forEach(o=>this.cache.delete(o))}async fetchWithTimeout(e,s,i="GET"){const n=new AbortController,o=setTimeout(()=>n.abort(),this.settings.timeout);try{let u=`${this.settings.baseUrl}${e}`;const h={method:i,headers:{"Content-Type":"application/json",Accept:"application/json"},signal:n.signal};if(this.token&&(h.headers.Authorization=this.token),s&&Object.keys(s).length>0)if(i==="GET"){const l=new URL(u);Object.entries(s).forEach(([w,g])=>{g!=null&&l.searchParams.set(w,String(g))}),u=l.toString()}else h.body=JSON.stringify(s);const d=await fetch(u,h);if(!d.ok){let l=`HTTP ${d.status}`;try{const w=await d.json();l=w.detail||w.message||l}catch{l=`${l}: ${d.statusText}`}throw new Error(l)}return await d.json()}finally{clearTimeout(o)}}}let We=null;function Oe(){return We||(We=new Os),We}function Br(T){return We=new Os(T),We}class Vr{constructor(){x(this,"registry");x(this,"remoteEnabled",!0);this.registry=je.getInstance()}setRemoteEnabled(e){this.remoteEnabled=e}isRemoteEnabled(){return this.remoteEnabled&&Oe().isEnabled()}async resolve(e,s={}){const i=s.preferRemote??this.remoteEnabled,n=this.findStaticConfig(e,s.objectType);if(n)return{config:n,source:"static",sourceDetail:`static:${n.id}`,fromCache:!0};if(i&&this.isRemoteEnabled())try{const u=await Oe().resolve(e,{fingerprint:s.fingerprint,objectType:s.objectType,forceRefresh:s.forceRefresh});if(u)return{config:u.config,source:"remote",sourceDetail:u.source,fromCache:u.source.startsWith("cached:")}}catch(o){console.warn("[ConfigResolver] Remote resolution failed:",o)}if(i&&this.isRemoteEnabled())try{const u=await Oe().generateConfig(e,{forceRegenerate:s.forceRefresh});if(u&&u.config)return{config:u.config,source:"generated",sourceDetail:`generated:${u.config_source}`,fromCache:u.cache_hit}}catch(o){console.warn("[ConfigResolver] Config generation failed:",o)}return console.log(`[ConfigResolver] Using default config for ${e}`),{config:this.createDefaultConfig(e),source:"default",sourceDetail:"minimal_fallback",fromCache:!1}}async resolveTable(e,s,i={}){var o;return((o=(await this.resolve(e,i)).config.tables)==null?void 0:o[s])??null}async resolveAndRegister(e,s={}){const i=await this.resolve(e,s);return i.config?(i.config.id||(i.config.id=this.generateConfigId(e)),this.registry.registerDataType(i.config),console.log(`[ConfigResolver] Registered ${i.config.id} from ${i.source}`),i.config):null}hasStaticConfig(e,s){return this.findStaticConfig(e,s)!==null}async getResolutionHints(e){const s=this.hasStaticConfig(e);let i=!1,n=!1;if(this.isRemoteEnabled())try{const h=await Oe().getTableListWithConfig(e);h&&(i=h.has_cached_config||h.has_builtin_config,n=!0)}catch{}let o="static";return i?o="remote":n&&!s&&(o="generate"),{hasRemoteConfig:i,hasStaticConfig:s,canGenerate:n,recommendedSource:o}}findStaticConfig(e,s){var n,o;const i=this.registry.getAppConfig();if(!(i!=null&&i.dataTypes))return null;for(const[u,h]of Object.entries(i.dataTypes))if((n=h.matches)!=null&&n.some(d=>this.matchPattern(e,d))){const d=this.registry.getDataType(u);if(d)return d}if(s){for(const[u,h]of Object.entries(i.dataTypes))if((o=h.matches)!=null&&o.some(d=>this.matchPattern(s,d))){const d=this.registry.getDataType(u);if(d)return d}}return null}matchPattern(e,s){if(s.includes("*")){const i=s.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return e===s}createDefaultConfig(e){return{id:this.generateConfigId(e),name:`Auto-generated: ${e}`,version:"1.0.0",description:"Minimal configuration generated from source reference",tables:{}}}generateConfigId(e){return`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`}}let Ot=null;function jt(){return Ot||(Ot=new Vr),Ot}const Pt={pageSize:50,theme:"light",density:"default",showRowNumbers:!0,locale:"en-US",dateFormat:"YYYY-MM-DD",numberFormat:{decimals:2,thousandsSeparator:",",decimalSeparator:"."}},Re={pageSize:50,density:"default",showRowNumbers:!0,enableSelection:!0,enableExport:!0,enableColumnReorder:!1,enableColumnResize:!0,defaultSortColumn:"",defaultSortOrder:"asc"},ot={visible:!0,sortable:!0,filterable:!0,searchable:!0},Wr={number:"right",integer:"right",float:"right",percentage:"right",currency:"right",filesize:"right",duration:"right",boolean:"center",date:"center",datetime:"center",timestamp:"center"},ye=class ye{constructor(){x(this,"appConfig",null);x(this,"dataTypes",new Map);x(this,"loadedUrls",new Set);x(this,"apiConfigs",new Map);x(this,"defaultApiId",null);x(this,"matchMap",new Map);x(this,"globalSettings",{...Pt});x(this,"remoteConfigEnabled",!1);x(this,"configApiSettings",null)}static getInstance(){return ye.instance||(ye.instance=new ye),ye.instance}static reset(){ye.instance=null}async initialize(e){if(this.appConfig=e,e.defaults&&(this.globalSettings={...Pt,...e.defaults,numberFormat:{...Pt.numberFormat,...e.defaults.numberFormat}}),e.apis)if(Object.values(e.apis).forEach(i=>{this.apiConfigs.set(i.id,i)}),e.apis.default)this.defaultApiId="default";else{const i=Object.keys(e.apis)[0];i&&(this.defaultApiId=i)}const s=[];for(const[i,n]of Object.entries(e.dataTypes))n.matches&&n.matches.forEach(o=>this.matchMap.set(o,i)),n.autoLoad!==!1&&s.push(this.loadDataType(i,n));await Promise.all(s)}async loadDataType(e,s){if(s.config){this.registerDataType(s.config);return}if(s.configUrl&&!this.loadedUrls.has(s.configUrl))try{const i=await fetch(s.configUrl);if(!i.ok){console.warn(`Failed to load config from ${s.configUrl}: ${i.status}`);return}const n=await i.json();this.registerDataType(n),this.loadedUrls.add(s.configUrl)}catch(i){console.error(`Error loading data type config from ${s.configUrl}:`,i)}}registerDataType(e){if(!e.id){console.error("DataTypeConfig must have an id");return}e.version||(console.warn(`DataTypeConfig ${e.id} missing version, defaulting to 1.0.0`),e.version="1.0.0"),this.dataTypes.set(e.id,e),console.log(`Registered data type: ${e.id} v${e.version}`)}unregisterDataType(e){return this.dataTypes.delete(e)}getDataType(e){return this.dataTypes.get(e)}hasDataType(e){return this.dataTypes.has(e)}getAllDataTypes(){return Array.from(this.dataTypes.values())}getDataTypeIds(){return Array.from(this.dataTypes.keys())}getTableSchema(e,s){const i=this.dataTypes.get(e);if(i)return i.tables[s]}getColumnSchema(e,s,i){const n=this.getTableSchema(e,s);if(n)return n.columns.find(o=>o.column===i)}getTableNames(e){const s=this.dataTypes.get(e);return s?Object.keys(s.tables):[]}getResolvedTableConfig(e,s){var d,l,w,g,S,k,R,B,M,E,_;const i=this.dataTypes.get(e);if(!i)return null;const n=i.tables[s];if(!n)return null;const o={...Re,pageSize:((d=i.defaults)==null?void 0:d.pageSize)??Re.pageSize,density:((l=i.defaults)==null?void 0:l.density)??Re.density,showRowNumbers:((w=i.defaults)==null?void 0:w.showRowNumbers)??Re.showRowNumbers,enableSelection:((g=i.defaults)==null?void 0:g.enableSelection)??Re.enableSelection,enableExport:((S=i.defaults)==null?void 0:S.enableExport)??Re.enableExport,...n.settings},u=[...i.sharedCategories||[],...n.categories||[]],h=n.columns.map(N=>this.resolveColumnConfig(N));return{name:s,displayName:n.displayName||s,settings:o,categories:u,columns:h,virtualColumns:n.virtualColumns||[],rowConfig:{selectable:((k=n.rowConfig)==null?void 0:k.selectable)??!0,clickable:((R=n.rowConfig)==null?void 0:R.clickable)??!1,clickAction:((B=n.rowConfig)==null?void 0:B.clickAction)??"",heightMode:((M=n.rowConfig)==null?void 0:M.heightMode)??"auto",height:((E=n.rowConfig)==null?void 0:E.height)??"auto",conditionalStyles:((_=n.rowConfig)==null?void 0:_.conditionalStyles)??[]}}}resolveColumnConfig(e){const s=e.dataType||"string",i=Wr[s]||"left";return{column:e.column,displayName:e.displayName||e.column.replace(/_/g," "),dataType:s,visible:e.visible??ot.visible,sortable:e.sortable??ot.sortable,filterable:e.filterable??ot.filterable,searchable:e.searchable??ot.searchable,copyable:e.copyable??s==="id",width:e.width||"auto",align:e.align||i,categories:e.categories||[],transform:e.transform}}getGlobalSettings(){return{...this.globalSettings}}getAppConfig(){return this.appConfig}getApiUrl(){var e,s;return((e=this.appConfig)==null?void 0:e.app.apiUrl)||this.defaultApiId&&((s=this.apiConfigs.get(this.defaultApiId))==null?void 0:s.url)||null}getApi(e){return e?this.apiConfigs.get(e):this.defaultApiId?this.apiConfigs.get(this.defaultApiId):void 0}getApis(){return Array.from(this.apiConfigs.values())}getDefaultApiId(){return this.defaultApiId}getAppName(){var e;return((e=this.appConfig)==null?void 0:e.app.name)||"DataTables Viewer"}detectDataType(e){const s=e.dataType||e.type||e.objectType||e.object_type;if(!s)return null;if(this.hasDataType(s))return s;if(this.matchMap.has(s))return this.matchMap.get(s);const i=s.toLowerCase().replace(/[^a-z0-9]/g,"_");if(this.hasDataType(i))return i;const n=this.getDataTypeIds()[0];return n?(console.warn(`Unknown data type "${s}", falling back to "${n}"`),n):null}static fromLegacyConfig(e){var i,n,o;const s={};if(e.tables)for(const[u,h]of Object.entries(e.tables))s[u]={displayName:h.name||u,categories:h.categories||[],columns:(h.columns||[]).map(d=>({column:d.column,displayName:d.displayName,dataType:d.dataType||"string",visible:d.visible,sortable:d.sortable,filterable:d.filterable,width:d.width,categories:d.categories,transform:d.transform})),settings:h.settings};return{id:"legacy",name:e.name||"Legacy Config",version:"1.0.0",description:e.description,defaults:{pageSize:(i=e.defaultSettings)==null?void 0:i.pageSize,density:(n=e.defaultSettings)==null?void 0:n.density,showRowNumbers:(o=e.defaultSettings)==null?void 0:o.showRowNumbers},tables:s}}initializeRemoteConfig(e){var i;const s=(i=this.appConfig)==null?void 0:i.configApi;if(s!=null&&s.enabled||e!=null&&e.enabled){const n={...s,...e,enabled:!0};Br(n),this.configApiSettings=n,this.remoteConfigEnabled=!0,console.log("[DataTypeRegistry] Remote config provider initialized")}}async resolveAndRegister(e,s){const n=await jt().resolve(e,{...s,preferRemote:this.remoteConfigEnabled});return n.config?(n.config.id||(n.config.id=`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`),this.registerDataType(n.config),console.log(`[DataTypeRegistry] Registered ${n.config.id} from ${n.source}`),n.config):null}isRemoteConfigEnabled(){return this.remoteConfigEnabled}getConfigApiSettings(){return this.configApiSettings}setAuthToken(e){this.remoteConfigEnabled&&Oe().setToken(e)}async resolveConfig(e,s){return jt().resolve(e,{...s,preferRemote:this.remoteConfigEnabled})}async hasConfigFor(e,s){var n;const i=this.getAppConfig();if(i!=null&&i.dataTypes){for(const[o,u]of Object.entries(i.dataTypes))if((n=u.matches)!=null&&n.some(h=>this.matchPattern(e,h)))return{hasConfig:!0,source:"static"}}if(this.remoteConfigEnabled)try{const u=await Oe().getTableListWithConfig(e);if(u!=null&&u.has_cached_config||u!=null&&u.has_builtin_config)return{hasConfig:!0,source:"remote"}}catch{}return{hasConfig:!1,source:"none"}}matchPattern(e,s){if(s.includes("*")){const i=s.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return e===s}};x(ye,"instance",null);let je=ye;class Ns{constructor(e){x(this,"registry");x(this,"legacyConfig",null);x(this,"currentDataTypeId",null);x(this,"isLegacyMode",!1);this.registry=je.getInstance(),e&&(this.isNewConfigFormat(e)?this.initializeFromAppConfig(e):this.initializeFromLegacyConfig(e))}isNewConfigFormat(e){var s;return e&&(e.dataTypes||((s=e.app)==null?void 0:s.name))}initializeFromAppConfig(e){this.isLegacyMode=!1,Object.entries(e.dataTypes||{}).forEach(([s,i])=>{i.config&&(this.registry.registerDataType(i.config),this.currentDataTypeId||(this.currentDataTypeId=s))})}initializeFromLegacyConfig(e){this.isLegacyMode=!0,this.legacyConfig=e;const s=je.fromLegacyConfig(e);this.registry.registerDataType(s),this.currentDataTypeId="legacy"}async initializeAsync(e){if(e)try{const s=await fetch(e);if(!s.ok){console.warn(`Failed to load config from ${e}`);return}const i=await s.json();if(this.isNewConfigFormat(i)){await this.registry.initialize(i);const n=this.registry.getDataTypeIds();n.length>0&&(this.currentDataTypeId=n[0])}else this.initializeFromLegacyConfig(i)}catch(s){console.error("Error loading configuration:",s)}}setCurrentDataType(e){if(this.registry.hasDataType(e))return this.currentDataTypeId=e,!0;const s=this.registry.detectDataType({dataType:e});return s?(this.currentDataTypeId=s,!0):(console.warn(`Data type "${e}" not found in registry`),!1)}getCurrentDataTypeId(){return this.currentDataTypeId}getCurrentDataType(){if(this.currentDataTypeId)return this.registry.getDataType(this.currentDataTypeId)}detectDataType(e){const s=this.registry.detectDataType(e);return s&&(this.currentDataTypeId=s),s}getTableConfig(e){var s,i;if(this.currentDataTypeId){const n=this.registry.getResolvedTableConfig(this.currentDataTypeId,e);if(n)return this.convertResolvedToLegacy(n)}if((i=(s=this.legacyConfig)==null?void 0:s.tables)!=null&&i[e]){const n=this.legacyConfig.tables[e];return{name:n.name||e,categories:n.categories||[],columns:n.columns||[],settings:{...this.legacyConfig.defaultSettings,...n.settings||{}}}}return{name:e,categories:[],columns:[],settings:this.getGlobalSettings()}}getTableSchema(e){if(this.currentDataTypeId)return this.registry.getTableSchema(this.currentDataTypeId,e)}getResolvedTableConfig(e){return this.currentDataTypeId?this.registry.getResolvedTableConfig(this.currentDataTypeId,e):null}hasTableConfig(e){var s;return this.currentDataTypeId&&this.registry.getTableSchema(this.currentDataTypeId,e)?!0:!!((s=this.legacyConfig)!=null&&s.tables&&Object.prototype.hasOwnProperty.call(this.legacyConfig.tables,e))}getTableNames(){var e;return this.currentDataTypeId?this.registry.getTableNames(this.currentDataTypeId):(e=this.legacyConfig)!=null&&e.tables?Object.keys(this.legacyConfig.tables):[]}getAppName(){var e;return this.registry.getAppName()||((e=this.legacyConfig)==null?void 0:e.name)||"DataTables Viewer"}getApi(e){return this.registry.getApi(e)}getApis(){return this.registry.getApis()}getDefaultApiId(){return this.registry.getDefaultApiId()}getApiUrl(){var e;return this.registry.getApiUrl()||((e=this.legacyConfig)==null?void 0:e.apiUrl)||null}getEnvironment(){var s;const e=this.registry.getAppConfig();return(e==null?void 0:e.app.environment)||((s=this.legacyConfig)==null?void 0:s.environment)||"local"}getGlobalSettings(){var i;const e=this.registry.getGlobalSettings(),s=((i=this.legacyConfig)==null?void 0:i.defaultSettings)||{};return{...e,...s}}convertResolvedToLegacy(e){return{name:e.displayName,categories:e.categories.map(s=>({id:s.id,name:s.name,icon:s.icon,color:s.color,description:s.description,defaultVisible:s.defaultVisible})),columns:e.columns.map(s=>({column:s.column,displayName:s.displayName,description:s.description,width:s.width,visible:s.visible,sortable:s.sortable,filterable:s.filterable,categories:s.categories,transform:Array.isArray(s.transform)?{type:"chain",options:{transforms:s.transform}}:s.transform})),settings:{pageSize:e.settings.pageSize,density:e.settings.density,showRowNumbers:e.settings.showRowNumbers,enableSelection:e.settings.enableSelection,enableExport:e.settings.enableExport}}}getRegistry(){return this.registry}isLegacy(){return this.isLegacyMode}initializeRemoteConfig(){this.registry.initializeRemoteConfig()}async resolveConfig(e,s){const n=await jt().resolve(e,{...s,preferRemote:this.registry.isRemoteConfigEnabled()});return n.config&&(this.registry.hasDataType(n.config.id)||this.registry.registerDataType(n.config),this.currentDataTypeId=n.config.id),n}isRemoteEnabled(){return this.registry.isRemoteConfigEnabled()}setAuthToken(e){this.registry.setAuthToken(e)}}const Rs={berdlTableId:null,activeTableName:null,availableTables:[],headers:[],columns:[],visibleColumns:new Set,data:[],totalCount:0,filteredCount:0,currentPage:0,pageSize:50,sortColumn:null,sortDirection:"asc",sortOrder:"asc",columnFilters:{},searchQuery:"",searchValue:"",selectedRows:new Set,loading:!1,error:null,theme:"light",density:"normal",showRowNumbers:!0,queryCached:!1,queryTime:void 0};class Gr{constructor(e={}){x(this,"state");x(this,"listeners");this.state={...Rs,...e},this.listeners=new Set}getState(){return{...this.state}}update(e){e.sortDirection&&!e.sortOrder?e.sortOrder=e.sortDirection:e.sortOrder&&!e.sortDirection&&(e.sortDirection=e.sortOrder),e.searchQuery!==void 0&&e.searchValue===void 0?e.searchValue=e.searchQuery:e.searchValue!==void 0&&e.searchQuery===void 0&&(e.searchQuery=e.searchValue),this.state={...this.state,...e},this.notify()}reset(){this.state={...Rs},this.notify()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}}class Kr{constructor(e){x(this,"categories");x(this,"columnsByCategory");x(this,"visibleCategories");x(this,"uncategorizedColumns");this.categories=new Map,this.columnsByCategory=new Map,this.visibleCategories=new Set,this.uncategorizedColumns=new Set,this.initialize(e)}initialize(e){(e.categories||[]).forEach(i=>{this.categories.set(i.id,{...i,visible:i.defaultVisible!==!1}),this.columnsByCategory.set(i.id,new Set),i.defaultVisible!==!1&&this.visibleCategories.add(i.id)}),e.columns&&this.setColumns(e.columns)}setColumns(e){this.uncategorizedColumns.clear(),this.categories.forEach((s,i)=>{var n;return(n=this.columnsByCategory.get(i))==null?void 0:n.clear()}),e.forEach(s=>{const i=s.column;let n=!1;s.categories&&Array.isArray(s.categories)&&s.categories.length>0&&s.categories.forEach(o=>{var u;this.categories.has(o)&&((u=this.columnsByCategory.get(o))==null||u.add(i),n=!0)}),n||this.uncategorizedColumns.add(i)})}getVisibleColumns(){const e=new Set;return this.visibleCategories.forEach(s=>{const i=this.columnsByCategory.get(s);i&&i.forEach(n=>e.add(n))}),this.uncategorizedColumns.forEach(s=>e.add(s)),e}getAllCategories(){return Array.from(this.categories.values()).map(e=>{var s;return{...e,visible:this.visibleCategories.has(e.id),columnCount:((s=this.columnsByCategory.get(e.id))==null?void 0:s.size)||0}})}getColumnsByCategory(){const e=new Map;return this.columnsByCategory.forEach((s,i)=>{e.set(i,Array.from(s))}),e}getUncategorizedColumns(){return Array.from(this.uncategorizedColumns)}toggleCategory(e){this.visibleCategories.has(e)?this.visibleCategories.delete(e):this.visibleCategories.add(e)}showAllCategories(){this.categories.forEach((e,s)=>{this.visibleCategories.add(s)})}}class It{constructor(e){x(this,"container");x(this,"id");x(this,"dom",{});this.container=e.container,this.id=e.id||`cmp-${Math.random().toString(36).substr(2,9)}`}mount(){this.render(),this.bindEvents()}destroy(){this.container.innerHTML="",this.dom={}}cacheDom(e){this.dom={};for(const[s,i]of Object.entries(e)){const n=this.container.querySelector(i);n&&(this.dom[s]=n)}}}class Qr extends It{constructor(s){super(s);x(this,"configManager");x(this,"stateManager");x(this,"categoryManager",null);x(this,"options");x(this,"expandedCategories",new Set);this.configManager=s.configManager,this.stateManager=s.stateManager,this.options=s,this.stateManager.subscribe(i=>{this.dom.loadBtn&&(this.dom.loadBtn.innerHTML=i.loading?'<span class="ts-spinner"></span> Loading...':'<i class="bi bi-lightning-charge-fill"></i> Load Data',this.dom.loadBtn.disabled=i.loading),this.updateLoadingState(i),!i.loading&&i.availableTables.length>0&&i.data.length>0&&i.activeTableName&&setTimeout(()=>{this.dom.sourceBody&&this.dom.sourceBody.style.display!=="none"&&(this.dom.sourceBody.style.display="none",this.dom.sourceArrow.classList.add("collapsed"))},500),i.activeTableName&&i.availableTables.length>0&&this.updateTableInfo(i.activeTableName),i.columns.length>0&&this.dom.controlList&&this.renderControlList(),this.renderFilterChips()})}setCategoryManager(s){this.categoryManager=s,this.renderControlList(),this.expandColumnsSection()}expandColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="block")}collapseColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="none")}render(){const s=this.configManager.getAppName()||"DataTables Viewer";this.container.innerHTML=`
            <header class="ts-sidebar-header">
                <div class="ts-brand">
                    <div class="ts-brand-icon"><i class="bi bi-grid-3x3-gap-fill"></i></div>
                    <span class="ts-brand-name">${s}</span>
                </div>
            </header>

            <div class="ts-sidebar-body">
                <!-- Connection -->
                <section class="ts-section" id="ts-source-section" style="padding: 0 4px;">
                    <div class="ts-section-header collapsible" id="ts-source-head">
                        <span class="ts-section-title">Data Source</span>
                        <div style="display:flex; align-items:center; gap:8px">
                            <i class="bi bi-chevron-down ts-section-arrow" id="ts-source-arrow"></i>
                            <i class="bi bi-database-fill-gear ts-text-muted"></i>
                        </div>
                    </div>
                    <div id="ts-source-body">
                        <div class="ts-field">
                            <label class="ts-label">Auth Token <span style="color:red">*</span></label>
                            <input type="password" class="ts-input" id="ts-token" placeholder="Enter KBase token...">
                        </div>
                        <div class="ts-field">
                            <label class="ts-label">Object ID / UPA</label>
                            <input type="text" class="ts-input" id="ts-berdl" 
                                placeholder="e.g., 76990/7/2" value="76990/7/2">
                        </div>
                        <button class="ts-btn-primary" id="ts-load" style="height: 34px;">
                            <i class="bi bi-lightning-charge-fill"></i> Load Data
                        </button>
                        <div id="ts-loading-indicator" style="display:none;margin-top:12px;padding:12px;background:var(--c-bg-surface);border-radius:var(--radius-sm);border:1px solid var(--c-border-subtle)">
                            <div style="display:flex;align-items:center;gap:10px;color:var(--c-text-secondary);font-size:13px">
                                <span class="ts-spinner" style="width:16px;height:16px"></span>
                                <span id="ts-loading-text">Loading data...</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table Selection -->
                <section class="ts-section" id="ts-nav-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Table</span>
                    </div>
                    <select class="ts-select" id="ts-table-select"></select>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
                        <button class="ts-btn-secondary" id="ts-view-schema">
                            <i class="bi bi-file-earmark-code"></i> Schema
                        </button>
                        <button class="ts-btn-secondary" id="ts-view-stats">
                            <i class="bi bi-graph-up"></i> Stats
                        </button>
                    </div>
                </section>

                <!-- Data Control (Unified Categories & Columns) -->
                <section class="ts-section" id="ts-control-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Data Control</span>
                        <div class="ts-section-actions">
                            <button class="ts-section-action" id="ts-control-expand-all">Expand All</button>
                            <button class="ts-section-action" id="ts-control-show-all">Show All</button>
                        </div>
                    </div>
                    <div class="ts-control-list" id="ts-control-list"></div>
                </section>

                <!-- Active Filters -->
                <section class="ts-section" id="ts-filters-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Filters</span>
                        <button class="ts-section-action" id="ts-clear-filters">Clear All</button>
                    </div>
                    <div class="ts-filter-chips" id="ts-filter-chips"></div>
                </section>
            </div>

            <footer class="ts-sidebar-footer">
                <div class="ts-btn-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="ts-btn-secondary" id="ts-export">
                        <i class="bi bi-download"></i> Export
                    </button>
                    <button class="ts-btn-secondary" id="ts-reset">
                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                    </button>
                </div>
            </footer>
        `,this.cacheDom({token:"#ts-token",berdl:"#ts-berdl",loadBtn:"#ts-load",sourceHead:"#ts-source-head",sourceBody:"#ts-source-body",sourceArrow:"#ts-source-arrow",loadingIndicator:"#ts-loading-indicator",loadingText:"#ts-loading-text",navSection:"#ts-nav-section",tableSelect:"#ts-table-select",viewSchema:"#ts-view-schema",viewStats:"#ts-view-stats",controlSection:"#ts-control-section",controlList:"#ts-control-list",controlExpandAll:"#ts-control-expand-all",controlShowAll:"#ts-control-show-all",filtersSection:"#ts-filters-section",filterChips:"#ts-filter-chips",clearFilters:"#ts-clear-filters",export:"#ts-export",reset:"#ts-reset"})}bindEvents(){var s,i,n,o,u,h,d,l,w;(s=this.dom.loadBtn)==null||s.addEventListener("click",()=>{this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.options.onLoadData()}),(i=this.dom.sourceHead)==null||i.addEventListener("click",()=>{const g=this.dom.sourceBody.style.display==="none";this.dom.sourceBody.style.display=g?"block":"none",this.dom.sourceArrow.classList.toggle("collapsed",!g)}),(n=this.dom.berdl)==null||n.addEventListener("keypress",g=>{g.key==="Enter"&&this.dom.loadBtn.click()}),(o=this.dom.tableSelect)==null||o.addEventListener("change",g=>{this.options.onTableChange(g.target.value)}),(u=this.dom.export)==null||u.addEventListener("click",()=>this.options.onExport()),(h=this.dom.reset)==null||h.addEventListener("click",()=>this.options.onReset()),(d=this.dom.controlList)==null||d.addEventListener("click",g=>{const S=g.target;if(S.closest(".ts-switch")){const k=S.closest(".ts-cat-group"),R=k==null?void 0:k.dataset.cat;R&&this.categoryManager&&(this.categoryManager.toggleCategory(R),this.stateManager.update({visibleColumns:this.categoryManager.getVisibleColumns()}),this.renderControlList());return}if(S.closest(".ts-cat-head")){const k=S.closest(".ts-cat-group"),R=k==null?void 0:k.dataset.cat;R&&(this.expandedCategories.has(R)?this.expandedCategories.delete(R):this.expandedCategories.add(R),k==null||k.classList.toggle("expanded"));return}if(S.matches('input[type="checkbox"]')){const k=S.dataset.col;if(k){const R=this.stateManager.getState();S.checked?R.visibleColumns.add(k):R.visibleColumns.delete(k),this.stateManager.update({visibleColumns:R.visibleColumns})}}}),(l=this.dom.controlExpandAll)==null||l.addEventListener("click",()=>{const g=this.dom.controlList.querySelectorAll(".ts-cat-group"),S=Array.from(g).some(k=>!k.classList.contains("expanded"));g.forEach(k=>{const R=k.dataset.cat;S?(k.classList.add("expanded"),R&&this.expandedCategories.add(R)):(k.classList.remove("expanded"),R&&this.expandedCategories.delete(R))}),this.dom.controlExpandAll.textContent=S?"Collapse All":"Expand All"}),(w=this.dom.controlShowAll)==null||w.addEventListener("click",()=>{this.toggleAllColumns()}),this.dom.viewSchema&&this.dom.viewSchema.addEventListener("click",()=>{const g=this.stateManager.getState();if(g.activeTableName)this.options.onShowSchema(g.activeTableName);else{const S=this.dom.tableSelect;S!=null&&S.value&&this.options.onShowSchema(S.value)}}),this.dom.viewStats&&this.dom.viewStats.addEventListener("click",()=>{const g=this.stateManager.getState();if(g.activeTableName)this.options.onShowStats(g.activeTableName);else{const S=this.dom.tableSelect;S!=null&&S.value&&this.options.onShowStats(S.value)}}),this.dom.clearFilters&&this.dom.clearFilters.addEventListener("click",()=>{this.stateManager.update({columnFilters:{},currentPage:0})})}updateTables(s){this.dom.navSection&&(s.length>0?(this.dom.navSection.style.display="block",this.dom.tableSelect.innerHTML="",s.forEach(i=>{const n=document.createElement("option");n.value=i.name;const o=i.row_count??i.count,u=typeof o=="number"?o.toLocaleString():"?";n.textContent=`${i.displayName||i.name} (${u} rows)`,this.dom.tableSelect.appendChild(n)})):this.dom.navSection.style.display="none")}updateTableInfo(s){this.dom.tableSelect&&this.dom.tableSelect.value!==s&&(this.dom.tableSelect.value=s)}renderControlList(){if(!this.dom.controlList)return;this.dom.controlSection.style.display="block";const s=this.stateManager.getState(),i=this.categoryManager?this.categoryManager.getAllCategories():[],n=this.categoryManager?this.categoryManager.getColumnsByCategory():new Map,o=this.categoryManager?this.categoryManager.getUncategorizedColumns():s.columns.map(d=>d.column);let u="";i.forEach(d=>{const l=n.get(d.id)||[];l.length!==0&&(u+=this.renderCategoryGroup(d,l,s))}),o.length>0&&(u+=this.renderCategoryGroup({id:"other",name:"Other Attributes",icon:"bi-three-dots",color:"#64748b",visible:!0},o,s,!0)),this.dom.controlList.innerHTML=u;const h=s.columns.every(d=>s.visibleColumns.has(d.column));this.dom.controlShowAll&&(this.dom.controlShowAll.textContent=h?"Hide All":"Show All")}renderCategoryGroup(s,i,n,o=!1){const u=n.columns.reduce((d,l)=>(d[l.column]=l,d),{});return`
            <div class="ts-cat-group ${this.expandedCategories.has(s.id)?"expanded":""}" data-cat="${s.id}">
                <div class="ts-cat-head">
                    <div class="ts-cat-info">
                        <i class="bi bi-chevron-down ts-cat-arrow"></i>
                        <i class="${s.icon||"bi bi-folder-fill"}" style="color:${s.color||"var(--c-accent)"}"></i>
                        <span class="ts-cat-name">${s.name}</span>
                        <span class="ts-cat-count">${i.length}</span>
                    </div>
                    ${o?"":`<div class="ts-switch ${s.visible?"on":""}"></div>`}
                </div>
                <div class="ts-cat-cols">
                    ${i.map(d=>{const l=u[d]||{displayName:d};return`
                            <label class="ts-col-item">
                                <input type="checkbox" data-col="${d}" ${n.visibleColumns.has(d)?"checked":""}>
                                <span>${l.displayName||d}</span>
                            </label>
                        `}).join("")}
                </div>
            </div>
        `}renderFilterChips(){const i=this.stateManager.getState().columnFilters,n=Object.keys(i).length>0;this.dom.filtersSection&&(this.dom.filtersSection.style.display=n?"block":"none"),this.dom.filterChips&&(this.dom.filterChips.innerHTML=Object.entries(i).map(([o,u])=>`
            <div class="ts-chip">
                <span class="ts-chip-label">${o}:</span>
                <span class="ts-chip-value">${u}</span>
                <button class="ts-chip-clear" data-col="${o}"><i class="bi bi-x"></i></button>
            </div>
        `).join(""),this.dom.filterChips.querySelectorAll(".ts-chip-clear").forEach(o=>{o.addEventListener("click",u=>{const h=u.currentTarget.dataset.col;if(h){const d={...this.stateManager.getState().columnFilters};delete d[h],this.stateManager.update({columnFilters:d,currentPage:0})}})}))}toggleAllColumns(){const s=this.stateManager.getState(),i=s.columns.every(o=>s.visibleColumns.has(o.column)),n=new Set(s.visibleColumns);s.columns.forEach(o=>{i?n.delete(o.column):n.add(o.column)}),this.stateManager.update({visibleColumns:n}),this.renderControlList()}getToken(){var s;return((s=this.dom.token)==null?void 0:s.value)||""}getBerdlId(){var s;return((s=this.dom.berdl)==null?void 0:s.value)||""}renderCategories(){this.renderControlList()}renderColumnList(){this.renderControlList()}updateLoadingState(s){if(!this.dom.loadingIndicator||!this.dom.loadingText)return;s.loading&&s.availableTables.length===0?(this.dom.loadingIndicator.style.display="block",this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.dom.loadingText.textContent="Fetching tables..."):this.dom.loadingIndicator.style.display="none"}}class Yr extends It{constructor(s){super(s);x(this,"options");x(this,"searchTimer");this.options=s}render(){this.container.innerHTML=`
            <div class="ts-search-box">
                <input type="text" id="ts-search" class="ts-search" 
                    placeholder="Search data..." 
                    aria-label="Search all table columns">
                <button class="ts-search-clear" id="ts-search-clear" aria-label="Clear search">
                    <i class="bi bi-x-lg"></i>
                </button>
                <i class="bi bi-search ts-search-icon"></i>
            </div>
            <div class="ts-spacer" style="flex:1"></div>
            <div class="ts-toolbar-actions">
                <button class="ts-tb-btn" id="ts-refresh" title="Refresh Data">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="ts-tb-icon" id="ts-settings-btn" title="Settings">
                    <i class="bi bi-gear-fill"></i>
                </button>
            </div>
        `,this.cacheDom({search:"#ts-search",searchClear:"#ts-search-clear",refresh:"#ts-refresh",settings:"#ts-settings-btn"})}bindEvents(){var s,i,n;(s=this.dom.search)==null||s.addEventListener("input",()=>{clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{const o=this.dom.search.value;this.options.onSearch(o)},300)}),(i=this.dom.searchClear)==null||i.addEventListener("click",()=>{this.dom.search.value="",this.options.onSearch(""),this.dom.search.focus()}),(n=this.dom.refresh)==null||n.addEventListener("click",()=>this.options.onRefresh())}getSettingsButton(){return this.dom.settings}setSearch(s){this.dom.search&&(this.dom.search.value=s)}focusSearch(){this.dom.search&&(this.dom.search.focus(),this.dom.search.select())}}const y=class y{static escapeHtml(e){if(e==null)return"";const s=document.createElement("div");return s.textContent=String(e),s.innerHTML}static apply(e,s,i){if(!s)return e!=null?y.escapeHtml(String(e)):"";if(Array.isArray(s))return y.chain(e,{transforms:s},i);const n=s;if(n.condition&&!y.evaluateCondition(n.condition,e,i))return n.fallback?typeof n.fallback=="string"?y.escapeHtml(n.fallback):y.apply(e,n.fallback,i):e!=null?y.escapeHtml(String(e)):"";const o=s.type;return typeof y[o]=="function"?y[o](e,s.options||{},i):y.customTransformers.has(o)?y.customTransformers.get(o)(e,s.options||{},i):(console.warn(`Unknown transformer type: "${o}"`),e!=null?y.escapeHtml(String(e)):"")}static evaluateCondition(e,s,i){const n=e.column?i[e.column]:s,o=e.value;switch(e.operator){case"eq":return n===o;case"neq":return n!==o;case"gt":return Number(n)>Number(o);case"gte":return Number(n)>=Number(o);case"lt":return Number(n)<Number(o);case"lte":return Number(n)<=Number(o);case"contains":return String(n).includes(String(o));case"startsWith":return String(n).startsWith(String(o));case"endsWith":return String(n).endsWith(String(o));case"regex":return new RegExp(String(o)).test(String(n));case"isEmpty":return n==null||n==="";case"isNotEmpty":return n!=null&&n!=="";default:return!0}}static chain(e,s,i){if(!s.transforms||!Array.isArray(s.transforms))return y.escapeHtml(String(e??""));let n=e;for(const o of s.transforms){if(s.transforms.indexOf(o)===s.transforms.length-1)return y.apply(n,o,i);n=y.apply(n,o,i)}return y.escapeHtml(String(n??""))}static number(e,s,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.decimals??2,u=s.locale||"en-US",h=s.prefix||"",d=s.suffix||"";let l;return s.notation==="scientific"?l=n.toExponential(o):s.notation==="compact"?l=new Intl.NumberFormat(u,{notation:"compact",maximumFractionDigits:o}).format(n):s.notation==="engineering"?l=n.toExponential(o):l=new Intl.NumberFormat(u,{minimumFractionDigits:s.minDecimals??0,maximumFractionDigits:o}).format(n),`<span class="ts-number">${y.escapeHtml(h)}${l}${y.escapeHtml(d)}</span>`}static percentage(e,s,i){if(e==null||e==="")return"";let n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));s.scale100!==!1&&n>=0&&n<=1&&(n*=100);const o=s.decimals??1,u=n.toFixed(o);if(s.showBar){const h=Math.min(100,Math.max(0,n)),d=s.color||"#6366f1";return`
                <div class="ts-percentage">
                    <div class="ts-percentage-bar" style="width:${h}%;background:${d}"></div>
                    <span class="ts-percentage-value">${u}%</span>
                </div>
            `}return`<span class="ts-number">${u}%</span>`}static currency(e,s,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.locale||"en-US",u=s.currency||"USD";return`<span class="ts-currency">${new Intl.NumberFormat(o,{style:"currency",currency:u,minimumFractionDigits:s.decimals??2,maximumFractionDigits:s.decimals??2}).format(n)}</span>`}static filesize(e,s,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.binary!==!1,u=o?["B","KiB","MiB","GiB","TiB","PiB"]:["B","KB","MB","GB","TB","PB"],h=o?1024:1e3;let d=n,l=0;for(;d>=h&&l<u.length-1;)d/=h,l++;const w=s.decimals??(l===0?0:2);return`<span class="ts-filesize">${d.toFixed(w)} ${u[l]}</span>`}static duration(e,s,i){if(e==null||e==="")return"";let n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.format||"short";if(o==="clock"){const d=Math.floor(n/3600),l=Math.floor(n%3600/60),w=Math.floor(n%60);return d>0?`<span class="ts-duration">${d}:${String(l).padStart(2,"0")}:${String(w).padStart(2,"0")}</span>`:`<span class="ts-duration">${l}:${String(w).padStart(2,"0")}</span>`}const u=[{name:o==="long"?"day":"d",seconds:86400},{name:o==="long"?"hour":"h",seconds:3600},{name:o==="long"?"minute":"m",seconds:60},{name:o==="long"?"second":"s",seconds:1}],h=[];for(const d of u)if(n>=d.seconds){const l=Math.floor(n/d.seconds);n%=d.seconds,o==="long"?h.push(`${l} ${d.name}${l!==1?"s":""}`):h.push(`${l}${d.name}`)}return`<span class="ts-duration">${h.join(o==="long"?", ":" ")||"0s"}</span>`}static date(e,s,i){if(e==null||e==="")return"";const n=new Date(e);if(isNaN(n.getTime()))return y.escapeHtml(String(e));const o=s.locale||"en-US";return s.relative?`<span class="ts-date" title="${n.toISOString()}">${y.relativeTime(n)}</span>`:`<span class="ts-date">${new Intl.DateTimeFormat(o,{dateStyle:s.dateStyle||"medium"}).format(n)}</span>`}static datetime(e,s,i){if(e==null||e==="")return"";const n=new Date(e);if(isNaN(n.getTime()))return y.escapeHtml(String(e));const o=s.locale||"en-US",u=s.timezone||void 0;return`<span class="ts-datetime">${new Intl.DateTimeFormat(o,{dateStyle:s.dateStyle||"medium",timeStyle:s.timeStyle||"short",timeZone:u}).format(n)}</span>`}static relativeTime(e){const i=new Date().getTime()-e.getTime(),n=Math.abs(i/1e3),o=i<0,u=[[31536e3,"year"],[2592e3,"month"],[86400,"day"],[3600,"hour"],[60,"minute"],[1,"second"]];for(const[h,d]of u)if(n>=h){const l=Math.floor(n/h),w=l!==1?"s":"";return o?`in ${l} ${d}${w}`:`${l} ${d}${w} ago`}return"just now"}static boolean(e,s,i){const n=e===!0||e==="true"||e===1||e==="1";if(s.trueIcon||s.falseIcon){const h=n?s.trueIcon||"bi-check-circle-fill":s.falseIcon||"bi-x-circle",d=n?s.trueColor||"#22c55e":s.falseColor||"#ef4444";return`<i class="${h}" style="color:${d};font-size:1.1em"></i>`}const o=n?s.trueText||"Yes":s.falseText||"No";return`<span class="ts-boolean" style="color:${n?s.trueColor||"#22c55e":s.falseColor||"#94a3b8"}">${y.escapeHtml(o)}</span>`}static heatmap(e,s,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.min??-4,u=s.max??4,h=s.colorScale||"diverging",d=(n-o)/(u-o),l=Math.max(0,Math.min(1,d));let w,g;if(h==="diverging"){let R,B,M;if(l<.5){const E=l*2;R=Math.round(59+196*E),B=Math.round(130+125*E),M=Math.round(246+9*E),g=E<.5?"#fff":"#1e293b"}else{const E=(l-.5)*2;R=Math.round(255+-16*E),B=Math.round(255+-187*E),M=Math.round(255+-187*E),g=E>.5?"#fff":"#1e293b"}w=`rgb(${R}, ${B}, ${M})`}else if(h==="sequential"){const R=Math.round(236+-228*l),B=Math.round(254+-109*l),M=Math.round(255+-77*l);w=`rgb(${R}, ${B}, ${M})`,g=l>.5?"#fff":"#1e293b"}else w="transparent",g="inherit";const S=s.decimals??2,k=s.showValue!==!1?n.toFixed(S):"";return`<span class="ts-heatmap" style="background:${w};color:${g}">${k}</span>`}static progress(e,s,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return y.escapeHtml(String(e));const o=s.max??100,u=Math.min(100,Math.max(0,n/o*100)),h=s.color||"#6366f1",d=s.showValue!==!1;return`
            <div class="ts-progress">
                <div class="ts-progress-bar" style="width:${u}%;background:${h}"></div>
                ${d?`<span class="ts-progress-value">${n}${s.suffix||""}</span>`:""}
            </div>
        `}static link(e,s,i={}){if(e==null||e==="")return"";const n=String(e),o=encodeURIComponent(n);let u=s.urlTemplate.replace(/\{value\}/g,o);i&&Object.keys(i).length>0&&Object.keys(i).forEach(g=>{const S=`{${g}}`;u.includes(S)&&(u=u.replace(new RegExp(S.replace(/[{}]/g,"\\$&"),"g"),encodeURIComponent(String(i[g]||""))))});let h=n;s.labelTemplate&&(h=s.labelTemplate.replace(/\{value\}/g,n),i&&Object.keys(i).length>0&&Object.keys(i).forEach(g=>{h=h.replace(new RegExp(`\\{${g}\\}`,"g"),String(i[g]||""))}));const d=s.target||"_blank",l=d==="_blank"?' rel="noopener noreferrer"':"",w=s.icon?`<i class="${s.icon}"></i> `:"";return`<a href="${u}" target="${d}"${l} class="ts-cell-link">${w}${y.escapeHtml(h)}</a>`}static replace(e,s){if(e==null||e==="")return"";const i=String(e),n=s.pattern||s.find,o=s.replaceWith||s.replace||"";if(!n)return i;if(s.isRegex)try{const u=s.flags||"g",h=new RegExp(n,u);return i.replace(h,o)}catch(u){return console.error("Invalid regex in replace transformer",u),i}return i.split(n).join(o)}static merge(e,s,i){if(!i||!s.columns||!Array.isArray(s.columns))return"";const n=s.skipEmpty!==!1;if(s.template){let h=s.template;return s.columns.forEach(d=>{const l=i[d],w=`{${d}}`;n&&(l==null||l==="")?(h=h.replace(new RegExp(`\\s*\\(${w}\\)`,"g"),""),h=h.replace(new RegExp(`${w}\\s*[|,;:]\\s*`,"g"),""),h=h.replace(new RegExp(`\\s*[|,;:]\\s*${w}`,"g"),""),h=h.replace(w,"")):h=h.replace(w,String(l||""))}),y.escapeHtml(h.trim())}const o=s.separator||" | ",u=s.columns.map(h=>i[h]).filter(h=>!n||h!=null&&h!=="").map(h=>String(h));return y.escapeHtml(u.join(o))}static badge(e,s,i){if(e==null||e==="")return"";const n=String(e);let h=(s.colorMap||{})[n]||s.color||s.defaultColor;if(!h){const w=["#6366f1","#ef4444","#10b981","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316"];let g=0;for(let S=0;S<n.length;S++)g=n.charCodeAt(S)+((g<<5)-g);h=w[Math.abs(g)%w.length]}const d=s.variant||"default";let l;return d==="subtle"?l=`background:${h}15;color:${h};border:none`:d==="outline"?l=`background:transparent;color:${h};border:1px solid ${h}`:l=`background:${h}20;color:${h};border:1px solid ${h}40`,`<span class="ts-badge" style="${l}">${y.escapeHtml(n)}</span>`}static array(e,s,i){if(e==null)return"";let n;if(Array.isArray(e))n=e;else if(typeof e=="string"){const l=s.separator||",";n=e.split(l).map(w=>w.trim()).filter(Boolean)}else return y.escapeHtml(String(e));const o=s.limit||5,u=n.slice(0,o),h=n.length-o,d=u.map(l=>y.badge(l,{color:s.color||"#6366f1",variant:"subtle"},i)).join(" ");return h>0?`${d} <span class="ts-badge-more">+${h}</span>`:d}static sequence(e,s){if(!e)return"";let i=String(e);if(s.chunkSize&&s.chunkSize>0){const d=new RegExp(`.{1,${s.chunkSize}}`,"g"),l=i.match(d);l&&(i=l.join(" "))}const n=s.maxLength||30,o=i,u=s.showCopyButton!==!1;i.length>n&&(i=i.substring(0,n)+"...");const h=u?`<button class="ts-copy-btn" data-id="${y.escapeHtml(o)}" title="Copy sequence"><i class="bi bi-clipboard"></i></button>`:"";return`<span class="ts-sequence" title="${y.escapeHtml(o)}">${y.escapeHtml(i)}${h}</span>`}static truncate(e,s){if(!e)return"";const i=String(e),n=s.length||50,o=s.ellipsis??"...";if(i.length<=n)return y.escapeHtml(i);const u=i.substring(0,n)+o;return`<span title="${y.escapeHtml(i)}">${y.escapeHtml(u)}</span>`}static preLoadOntology(e,s="custom"){const i=Date.now();Object.entries(e).forEach(([n,o])=>{const u=`${s}:${n}`;y.ontologyCache.set(u,{name:o,timestamp:i})})}static ontology(e,s,i){if(e==null||e==="")return"";const n=s.delimiter;if(n&&typeof e=="string"&&e.includes(n)){const o=e.split(n).map(u=>u.trim()).filter(Boolean);return o.length===0?"":`<div class="ts-ontology-list" style="display:flex;flex-wrap:wrap;gap:4px">
                ${o.map(u=>y.renderSingleOntologyTerm(u,s)).join("")}
            </div>`}return y.renderSingleOntologyTerm(String(e).trim(),s)}static renderSingleOntologyTerm(e,s){const i=`${s.ontologyType||"custom"}:${e}`,n=y.ontologyCache.get(i);return n&&Date.now()-n.timestamp<y.cacheTimeout?y.formatOntologyTerm(e,n.name,s):(y.lookupOntologyTerm(e,s,i),y.formatOntologyTerm(e,null,s))}static lookup(e,s,i){if(e==null||e==="")return"";const n=String(e);if(s.map&&typeof s.map=="object"){const o=s.map[n];if(o!==void 0)return y.escapeHtml(String(o))}if(s.apiUrl){const o=`lookup:${s.apiUrl}:${n}`,u=y.lookupCache.get(o);return u&&Date.now()-u.timestamp<y.cacheTimeout?y.escapeHtml(u.value):(y.performAsyncLookup(n,s,o),y.escapeHtml(n)+' <span class="ts-loading-indicator">...</span>')}return s.fallback?y.escapeHtml(s.fallback):y.escapeHtml(n)}static formatOntologyTerm(e,s,i){const n=i.showId!==!1,o=y.escapeHtml(e),u=i.style||"default";let h="#";i.urlTemplate&&(h=i.urlTemplate.replace(/\{value\}/g,encodeURIComponent(e))),s&&i.urlTemplate&&i.urlTemplate.includes("{name}")&&(h=h.replace(/\{name\}/g,encodeURIComponent(s)));const d=i.urlTemplate?"a":"span",l=i.urlTemplate?` href="${h}" target="_blank" rel="noopener noreferrer"`:"";if(u==="badge")return s?`<${d}${l} class="ts-badge ts-ontology-badge" data-term="${o}" style="text-decoration:none">${y.escapeHtml(s)}</${d}>`:`<${d}${l} class="ts-badge ts-ontology-badge ts-loading-term" data-term="${o}" style="text-decoration:none">${o}</${d}>`;if(s){const w=y.escapeHtml(s);return n?`<${d}${l} class="ts-ontology" data-term="${o}">${w} <span class="ts-ontology-id">(${o})</span></${d}>`:`<${d}${l} class="ts-ontology" data-term="${o}">${w}</${d}>`}return`<${d}${l} class="ts-ontology ts-loading-term" data-term="${o}">${o}</${d}>`}static async lookupOntologyTerm(e,s,i){try{let n=null;if(s.map&&s.map[e])n=s.map[e];else switch(s.ontologyType){case"GO":n=await y.lookupGO(e);break;case"KEGG":n=e;break;case"EC":n=e;break;case"custom":s.lookupEndpoint&&(n=await y.lookupCustom(e,s.lookupEndpoint));break}n&&(y.ontologyCache.set(i,{name:n,timestamp:Date.now()}),y.updateOntologyElements(e,n,s))}catch(n){console.warn(`Ontology lookup failed for ${e}`,n)}}static updateOntologyElements(e,s,i){document.querySelectorAll(`.ts-ontology[data-term="${e}"], .ts-ontology-badge[data-term="${e}"]`).forEach(o=>{o.classList.remove("ts-loading-term");const u=i.showId!==!1;o.classList.contains("ts-ontology-badge")?o.textContent=s:u?o.innerHTML=`${y.escapeHtml(s)} <span class="ts-ontology-id">(${y.escapeHtml(e)})</span>`:o.textContent=s})}static async lookupGO(e){var n,o;const s=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${e}`,{headers:{Accept:"application/json"}});return s.ok&&((o=(n=(await s.json()).results)==null?void 0:n[0])==null?void 0:o.name)||null}static async lookupCustom(e,s){const i=s.replace("{value}",encodeURIComponent(e)),n=await fetch(i);if(!n.ok)return null;const o=await n.json();return o.name||o.label||o.term||null}static async performAsyncLookup(e,s,i){try{const n=s.apiUrl.replace("{value}",encodeURIComponent(e)),o=await fetch(n);if(o.ok){const u=await o.json(),h=s.valuePath?u[s.valuePath]:u.value||u.name||u;h&&y.lookupCache.set(i,{value:String(h),timestamp:Date.now()})}}catch(n){console.error("Async lookup failed",n)}}static conditional(e,s,i){if(!s.conditions||!Array.isArray(s.conditions))return y.escapeHtml(String(e??""));for(const n of s.conditions)if(y.evaluateCondition(n.when,e,i)){if(n.transform)return y.apply(e,n.transform,i);if(n.value!==void 0)return y.escapeHtml(String(n.value))}return s.default?typeof s.default=="object"&&s.default.type?y.apply(e,s.default,i):y.escapeHtml(String(s.default)):y.escapeHtml(String(e??""))}static ontologyLookup(e,s,i){if(e==null||e==="")return"";let n;if(typeof e=="string"){const d=e.trim();if(d.startsWith("["))try{const l=JSON.parse(d);n=Array.isArray(l)?l.filter(Boolean).map(String):[d]}catch{n=[d]}else n=d.split(/[,;]/).map(l=>l.trim()).filter(Boolean)}else Array.isArray(e)?n=e.filter(Boolean).map(String):n=[String(e)];if(n.length===0)return"";const o=n.slice(0,s.limit||5).map(d=>y.renderOntologyLookupTerm(d,s)),u=n.length-(s.limit||5),h=u>0?`<span class="ts-ontology-more" title="${n.slice(s.limit||5).join(", ")}">+${u}</span>`:"";return`<div class="ts-ontology-lookup-list">${o.join("")}${h}</div>`}static renderOntologyLookupTerm(e,s){const i=s.idPattern||"(rxn\\d+|cpd\\d+)",n=e.match(new RegExp(i,"i")),o=n?n[1]:e,u=`ontolookup:${s.ontologyType||"custom"}:${o}`,h=y.ontologyCache.get(u),d=y.escapeHtml(e),l=s.showId!==!1,w=s.maxLength||50,g=s.style||"inline";let S="#";return s.urlTemplate&&(S=s.urlTemplate.replace(/\{id\}/g,encodeURIComponent(o))),h&&Date.now()-h.timestamp<y.cacheTimeout?y.formatOntologyLookupTerm(o,d,h.name,S,l,w,g):(y.lookupOntologyDescription(o,s,u),y.formatOntologyLookupTerm(o,d,null,S,l,w,g))}static formatOntologyLookupTerm(e,s,i,n,o,u,h){const d=y.escapeHtml(e),l=n!=="#",w=l?`href="${n}" target="_blank" rel="noopener noreferrer"`:"",g=l?"a":"span";if(h==="badge"){if(i){const S=i.length>u?i.substring(0,u)+"":i,k=`${s}: ${i}`;return`<${g} ${w} class="ts-badge ts-ontology-lookup-badge" data-term="${d}" title="${y.escapeHtml(k)}" style="text-decoration:none">
                    ${o?`<span class="ts-ontology-id">${d}</span>: `:""}
                    <span class="ts-ontology-name">${y.escapeHtml(S)}</span>
                </${g}>`}return`<${g} ${w} class="ts-badge ts-ontology-lookup-badge ts-loading-term" data-term="${d}" title="${s}" style="text-decoration:none">${d}</${g}>`}if(i){const S=i.length>u?i.substring(0,u)+"":i,k=`${s}: ${i}`;return`<${g} ${w} class="ts-ontology-lookup" data-term="${d}" title="${y.escapeHtml(k)}">
                ${o?`<span class="ts-ontology-id">${d}</span>: `:""}
                <span class="ts-ontology-name">${y.escapeHtml(S)}</span>
            </${g}>`}return`<${g} ${w} class="ts-ontology-lookup ts-loading-term" data-term="${d}" title="${s}">
            <span class="ts-ontology-id">${d}</span>
            <span class="ts-loading-indicator"></span>
        </${g}>`}static async lookupOntologyDescription(e,s,i){try{let n=null;switch(s.ontologyType||"custom"){case"modelseed_reactions":n=await y.lookupModelSeedReaction(e);break;case"modelseed_compounds":n=await y.lookupModelSeedCompound(e);break;case"go":n=await y.lookupGOTerm(e);break;case"kegg":n=await y.lookupKEGGOrtholog(e);break;case"pfam":n=await y.lookupPfamDomain(e);break;case"cog":n=await y.lookupCOG(e);break;case"ec":n=await y.lookupECNumber(e);break;case"so":n=await y.lookupSequenceOntology(e);break;case"uniref":n=await y.lookupUniRef(e);break;case"custom":if(s.apiUrl){const u=s.apiUrl.replace(/\{id\}/g,encodeURIComponent(e)),h=await fetch(u);if(h.ok){const d=await h.json();n=d.name||d.definition||d.equation||null}}break}n&&(y.ontologyCache.set(i,{name:n,timestamp:Date.now()}),y.updateOntologyLookupElements(e,n,s))}catch(n){console.warn(`Ontology lookup failed for ${e}`,n)}}static async lookupModelSeedReaction(e){var s,i;try{const n=await fetch(`https://modelseed.org/solr/reactions/select?q=id:${e}&wt=json`);if(!n.ok)return null;const o=await n.json();if(((i=(s=o.response)==null?void 0:s.docs)==null?void 0:i.length)>0){const u=o.response.docs[0];return u.definition||u.name||u.equation||null}return null}catch{return null}}static async lookupModelSeedCompound(e){var s,i;try{const n=await fetch(`https://modelseed.org/solr/compounds/select?q=id:${e}&wt=json`);if(!n.ok)return null;const o=await n.json();if(((i=(s=o.response)==null?void 0:s.docs)==null?void 0:i.length)>0){const u=o.response.docs[0];return u.name||u.formula||null}return null}catch{return null}}static async lookupGOTerm(e){var s,i;try{const n=e.startsWith("GO:")?e:`GO:${e}`,o=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${encodeURIComponent(n)}`,{headers:{Accept:"application/json"}});if(!o.ok)return null;const u=await o.json();return(i=(s=u.results)==null?void 0:s[0])!=null&&i.name?u.results[0].name:null}catch{return null}}static async lookupKEGGOrtholog(e){try{const s=e.replace(/^KEGG:/i,"").replace(/^ko:/i,""),i=await fetch(`https://rest.kegg.jp/get/${s}`);if(!i.ok)return null;const n=await i.text(),o=n.match(/^DEFINITION\s+(.+?)(?:\n|$)/m);if(o)return o[1].trim();const u=n.match(/^NAME\s+(.+?)(?:\n|$)/m);return u?u[1].trim():null}catch{return null}}static async lookupPfamDomain(e){var s;try{const i=e.startsWith("PF")?e:`PF${e}`,n=await fetch(`https://www.ebi.ac.uk/interpro/api/entry/pfam/${i}`,{headers:{Accept:"application/json"}});return n.ok&&((s=(await n.json()).metadata)==null?void 0:s.name)||null}catch{return null}}static async lookupCOG(e){try{const s=e.replace(/^COG:/i,"").trim();return s.length===1&&/^[A-Z]$/i.test(s)?await y.lookupCOGCategory(s.toUpperCase()):/^COG\d+$/i.test(s)?await y.lookupCOGId(s.toUpperCase()):null}catch{return null}}static async lookupCOGCategory(e){var s,i;try{const n=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/?cat=${encodeURIComponent(e)}&format=json`);if(n.ok){const o=await n.json();if((i=(s=o.results)==null?void 0:s[0])!=null&&i.fun_cat_description)return o.results[0].fun_cat_description}return null}catch{return null}}static async lookupCOGId(e){try{const s=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/${encodeURIComponent(e)}/?format=json`);if(!s.ok)return null;const i=await s.json();return i.cog_name?i.cog_name:i.fun_cat_description?i.fun_cat_description:null}catch{return null}}static async lookupECNumber(e){try{const s=e.replace(/^EC:/i,"").trim(),i=await fetch(`https://rest.kegg.jp/get/ec:${s}`);if(!i.ok)return null;const o=(await i.text()).match(/^NAME\s+(.+?)(?:\n|$)/m);return o?o[1].split(";")[0].trim():null}catch{return null}}static async lookupSequenceOntology(e){var s,i,n,o,u,h,d,l;try{const g=(e.startsWith("SO:")?e:`SO:${e}`).replace(":","_"),S=await fetch(`https://www.ebi.ac.uk/ols4/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${g}`,{headers:{Accept:"application/json"}});if(!S.ok){const R=await fetch(`https://www.ebi.ac.uk/ols/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${g}`,{headers:{Accept:"application/json"}});if(!R.ok)return null;const B=await R.json();return(n=(i=(s=B._embedded)==null?void 0:s.terms)==null?void 0:i[0])!=null&&n.label?B._embedded.terms[0].label:null}const k=await S.json();return(h=(u=(o=k._embedded)==null?void 0:o.terms)==null?void 0:u[0])!=null&&h.label?k._embedded.terms[0].label:(l=(d=k.elements)==null?void 0:d[0])!=null&&l.label?k.elements[0].label:null}catch{return null}}static async lookupUniRef(e){var s,i,n,o,u;try{let h=e;const d=e.match(/UniRef\d+_(\w+)/i);d&&(h=d[1]);const l=await fetch(`https://rest.uniprot.org/uniprotkb/${h}.json`);if(!l.ok)return null;const g=(await l.json()).proteinDescription;return(i=(s=g==null?void 0:g.recommendedName)==null?void 0:s.fullName)!=null&&i.value?g.recommendedName.fullName.value:(u=(o=(n=g==null?void 0:g.submissionNames)==null?void 0:n[0])==null?void 0:o.fullName)!=null&&u.value?g.submissionNames[0].fullName.value:null}catch{return null}}static updateOntologyLookupElements(e,s,i){const n=i.maxLength||50,o=i.showId!==!1,u=s.length>n?s.substring(0,n)+"":s;document.querySelectorAll(`.ts-ontology-lookup[data-term="${e}"], .ts-ontology-lookup-badge[data-term="${e}"]`).forEach(d=>{d.classList.remove("ts-loading-term"),d.setAttribute("title",`${e}: ${s}`);const l=o?`<span class="ts-ontology-id">${y.escapeHtml(e)}</span>: `:"";d.innerHTML=`${l}<span class="ts-ontology-name">${y.escapeHtml(u)}</span>`})}static register(e,s){y.customTransformers.set(e,s),console.log(`Registered custom transformer: ${e}`)}static unregister(e){return y.customTransformers.delete(e)}static getAvailableTransformers(){const e=["number","percentage","currency","filesize","duration","date","datetime","boolean","heatmap","progress","link","replace","merge","badge","array","sequence","truncate","ontology","ontologyLookup","lookup","chain","conditional"],s=Array.from(y.customTransformers.keys());return[...e,...s]}static custom(e,s,i){const n=y.customTransformers.get(s.functionName);if(!n)return e?String(e):"";try{return n(e,s.params||{},i)}catch(o){return console.error("Custom transformer error",o),e?String(e):""}}};x(y,"ontologyCache",new Map),x(y,"lookupCache",new Map),x(y,"cacheTimeout",36e5),x(y,"customTransformers",new Map);let Ae=y;class Xr extends It{constructor(s){super(s);x(this,"stateManager");x(this,"options");x(this,"tooltip",null);x(this,"focusedFilterCol",null);x(this,"selectionStart",null);x(this,"selectionEnd",null);x(this,"filterDebounceTimer",null);x(this,"selection",new Set);this.stateManager=s.stateManager,this.options=s,this.stateManager.subscribe(()=>{this.render()})}render(){const s=this.stateManager.getState();if(s.columns.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-inbox-fill"></i></div>
                    <h3 class="ts-empty-title">No Data Loaded</h3>
                    <p class="text-muted">Select a data source from the sidebar to begin.</p>
                </div>`;return}const i=s.columns.filter(h=>s.visibleColumns.has(h.column));if(i.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-layout-three-columns"></i></div>
                    <h3 class="ts-empty-title">All Columns Hidden</h3>
                    <p class="text-muted">Enable columns in the sidebar to view data.</p>
                </div>`;return}const n=s.searchValue.toLowerCase();let o='<table class="ts-table"><thead><tr>';const u=s.data.length>0&&s.data.every((h,d)=>this.selection.has(d));if(o+=`<th class="ts-col-select ts-col-fixed"><input type="checkbox" id="ts-select-all" ${u?"checked":""}></th>`,s.showRowNumbers&&(o+='<th class="ts-col-num ts-col-fixed">#</th>'),i.forEach((h,d)=>{const w=d===0&&!s.showRowNumbers?"ts-col-fixed":"",g=h.sortable?"sortable":"";let S=s.sortColumn===h.column?s.sortOrder==="asc"?' <i class="bi bi-sort-up"></i>':' <i class="bi bi-sort-down"></i>':"";o+=`<th class="${w} ${g}" data-col="${h.column}" style="width:${h.width}">${h.displayName||h.column}${S}</th>`}),o+='</tr><tr class="ts-filter-row">',o+='<th class="ts-col-select ts-col-fixed"></th>',s.showRowNumbers&&(o+='<th class="ts-col-num ts-col-fixed"></th>'),i.forEach((h,d)=>{const w=d===0&&!s.showRowNumbers?"ts-col-fixed":"",g=s.columnFilters[h.column]||"";o+=`<th class="${w}">`,h.filterable!==!1&&(o+=`<div class="ts-filter-wrap"><input class="ts-filter-input ${g?"has-value":""}" data-col="${h.column}" value="${Ae.escapeHtml(g)}" placeholder="Filter..."><button class="ts-filter-clear" data-col="${h.column}"><i class="bi bi-x"></i></button></div>`),o+="</th>"}),o+="</tr></thead><tbody>",s.data.length===0){const h=i.length+(s.showRowNumbers?1:0);o+=`<tr><td colspan="${h}" style="text-align:center;padding:32px;color:var(--text-muted)"><i class="bi bi-search" style="font-size:20px;opacity:.3;display:block;margin-bottom:6px"></i>No matching records</td></tr>`}else{const h=s.currentPage*s.pageSize+1;s.data.forEach((d,l)=>{const w=this.isRowSelected(l),g=h+l;o+=`<tr class="${w?"selected":""}" data-idx="${l}">`,o+=`<td class="ts-col-select ts-col-fixed"><input type="checkbox" class="ts-row-checkbox" data-idx="${l}" ${w?"checked":""}></td>`,s.showRowNumbers&&(o+=`<td class="ts-col-num ts-col-fixed">${g}</td>`),i.forEach((S,k)=>{const B=k===0&&!s.showRowNumbers?"ts-col-fixed":"",M=d[S.column];let E="";if(S.transform)E=Ae.apply(M,S.transform,d);else if(S.column.includes("ID")||S.column==="ID"){const _=Ae.escapeHtml(M);E=`<span class="ts-copy-id"><span class="ts-mono">${_}</span><button class="ts-copy-btn" data-id="${_}"><i class="bi bi-clipboard"></i></button></span>`}else E=Ae.escapeHtml(M);n&&(E=this.highlightText(E,n)),o+=`<td class="${B}">${E}</td>`}),o+="</tr>"})}o+="</tbody></table>",this.container.innerHTML=o,this.bindEvents(),this.restoreFocus()}restoreFocus(){if(this.focusedFilterCol){const s=this.container.querySelector(`input.ts-filter-input[data-col="${this.focusedFilterCol}"]`);s&&(s.focus(),this.selectionStart!==null&&this.selectionEnd!==null&&s.setSelectionRange(this.selectionStart,this.selectionEnd))}}getSelection(){return this.selection}clearSelection(){this.selection.clear(),this.render()}selectAll(){this.stateManager.getState().data.forEach((i,n)=>this.selection.add(n)),this.render(),this.options.onRowSelect(-1,!0,!0)}clearFilterFocus(){this.focusedFilterCol=null,this.selectionStart=null,this.selectionEnd=null,this.filterDebounceTimer&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null)}isRowSelected(s){return this.selection.has(s)}bindEvents(){this.container.addEventListener("change",s=>{const i=s.target;if(i.id==="ts-select-all"){const n=this.stateManager.getState();i.checked?n.data.forEach((o,u)=>this.selection.add(u)):this.selection.clear(),this.render(),this.options.onRowSelect(-1,i.checked,!0);return}if(i.classList.contains("ts-row-checkbox")){const n=parseInt(i.dataset.idx||"-1");n>=0&&(i.checked?this.selection.add(n):this.selection.delete(n),this.render(),this.options.onRowSelect(n,i.checked));return}}),this.container.onclick=s=>{var h;const i=s.target,n=i.closest("th.sortable");if(n){const d=n.dataset.col;if(d){const l=this.stateManager.getState(),w=l.sortColumn===d&&l.sortOrder==="asc"?"desc":"asc";this.options.onSort(d,w)}return}const o=i.closest(".ts-filter-clear");if(o){const d=o.dataset.col;d&&this.options.onFilter(d,"");return}if(i.tagName!=="BUTTON"&&i.tagName!=="INPUT"&&!i.closest("a")&&!i.closest(".ts-copy-btn")){const d=i.closest("tr");if(d&&((h=d.parentElement)==null?void 0:h.tagName)==="TBODY"){const l=parseInt(d.dataset.idx||"-1");if(l>=0){const w=this.selection.has(l);w?this.selection.delete(l):this.selection.add(l),this.render(),this.options.onRowSelect(l,!w)}}}const u=i.closest(".ts-copy-btn");if(u){const d=u.dataset.id;d&&navigator.clipboard.writeText(d)}},this.container.oninput=s=>{const i=s.target;if(i.classList.contains("ts-filter-input")){const n=i.dataset.col;n&&(this.focusedFilterCol=n,this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd,this.filterDebounceTimer&&clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=setTimeout(()=>{this.options.onFilter(n,i.value)},300))}},this.container.onkeyup=s=>{const i=s.target;i.classList.contains("ts-filter-input")&&(this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd)},this.container.addEventListener("focusin",s=>{const i=s.target;i.classList.contains("ts-filter-input")?this.focusedFilterCol=i.dataset.col||null:this.focusedFilterCol=null}),this.container.onmouseover=s=>{var n;const i=s.target.closest("td");if(i&&i.scrollWidth>i.clientWidth){const o=(n=i.textContent)==null?void 0:n.trim();o&&this.showTooltip(s,o)}},this.container.onmouseout=s=>{s.target.closest("td")&&this.hideTooltip()}}showTooltip(s,i){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="ts-tooltip",this.tooltip.id="ts-tooltip",document.body.appendChild(this.tooltip)),this.tooltip.textContent=i,this.tooltip.classList.add("show"),this.tooltip.style.left=s.clientX+10+"px",this.tooltip.style.top=s.clientY+10+"px"}hideTooltip(){this.tooltip&&this.tooltip.classList.remove("show")}highlightText(s,i){if(!i)return s;const n=new RegExp(`(${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return s.replace(n,'<mark class="highlight">$1</mark>')}}const ke=class ke{constructor(){x(this,"listeners",new Map);x(this,"wildcardListeners",new Set);x(this,"eventHistory",[]);x(this,"maxHistorySize",100);x(this,"debug",!1);typeof localStorage<"u"&&(this.debug=localStorage.getItem("DATATABLE_DEBUG")==="true")}static getInstance(){return ke.instance||(ke.instance=new ke),ke.instance}on(e,s){this.listeners.has(e)||this.listeners.set(e,new Set);const i={callback:s,once:!1};return this.listeners.get(e).add(i),()=>{var n;(n=this.listeners.get(e))==null||n.delete(i)}}once(e,s){this.listeners.has(e)||this.listeners.set(e,new Set);const i={callback:s,once:!0};return this.listeners.get(e).add(i),()=>{var n;(n=this.listeners.get(e))==null||n.delete(i)}}off(e,s){if(!s){this.listeners.delete(e);return}const i=this.listeners.get(e);if(i){for(const n of i)if(n.callback===s){i.delete(n);break}}}onAny(e){return this.wildcardListeners.add(e),()=>{this.wildcardListeners.delete(e)}}emit(e,s){this.debug&&console.log(`[EventBus] ${e}`,s),this.eventHistory.push({event:e,data:s,timestamp:Date.now()}),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift();const i=this.listeners.get(e);if(i){const n=[];for(const o of i)try{o.callback(s),o.once&&n.push(o)}catch(u){console.error(`[EventBus] Error in listener for ${e}:`,u)}for(const o of n)i.delete(o)}for(const n of this.wildcardListeners)try{n(e,s)}catch(o){console.error("[EventBus] Error in wildcard listener:",o)}if(this.listeners.has("*")){const n=this.listeners.get("*");if(n){const o={event:e,data:s};for(const u of n)u.callback(o)}}}getHistory(){return[...this.eventHistory]}clearHistory(){this.eventHistory=[]}setDebug(e){this.debug=e,typeof localStorage<"u"&&localStorage.setItem("DATATABLE_DEBUG",e?"true":"false")}listenerCount(e){var s;return((s=this.listeners.get(e))==null?void 0:s.size)??0}clear(e){e?this.listeners.delete(e):(this.listeners.clear(),this.wildcardListeners.clear())}};x(ke,"instance");let qt=ke;const Te=qt.getInstance(),_e=class _e{constructor(){x(this,"defaults",{format:"csv",filename:"export",includeHeaders:!0,delimiter:",",lineEnding:"unix",jsonPretty:!1,chunkSize:1e3})}static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}async export(e,s){const i=Date.now(),n={...this.defaults,...s};Te.emit("export:started",{format:n.format,rowCount:e.length});try{const o=n.columns||this.inferColumns(e);let u,h,d;switch(n.format){case"csv":u=this.toCSV(e,o,n),h="text/csv;charset=utf-8",d="csv";break;case"tsv":u=this.toCSV(e,o,{...n,delimiter:"	"}),h="text/tab-separated-values;charset=utf-8",d="tsv";break;case"json":u=this.toJSON(e,o,n),h="application/json;charset=utf-8",d="json";break;case"json-lines":u=this.toJSONLines(e,o,n),h="application/x-ndjson;charset=utf-8",d="jsonl";break;case"xlsx":console.warn("XLSX export not yet implemented, falling back to CSV"),u=this.toCSV(e,o,n),h="text/csv;charset=utf-8",d="csv";break;default:throw new Error(`Unsupported export format: ${n.format}`)}const l=`${n.filename}.${d}`;this.downloadFile(u,l,h);const w={success:!0,filename:l,format:n.format,rowCount:e.length,byteSize:new Blob([u]).size,duration:Date.now()-i};return Te.emit("export:completed",w),w}catch(o){const u={success:!1,filename:n.filename,format:n.format,rowCount:0,byteSize:0,duration:Date.now()-i,error:o.message||String(o)};return Te.emit("export:failed",{...u,error:u.error}),u}}async toClipboard(e,s){const i={format:"tsv",includeHeaders:!0,...s};try{const n=i.columns||this.inferColumns(e),o=this.toCSV(e,n,{...this.defaults,...i,delimiter:"	"});return await navigator.clipboard.writeText(o),Te.emit("export:clipboard",{rowCount:e.length}),!0}catch(n){return console.error("Failed to copy to clipboard:",n),!1}}getExtension(e){return{csv:"csv",tsv:"tsv",json:"json","json-lines":"jsonl",xlsx:"xlsx"}[e]||"txt"}getMimeType(e){return{csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json","json-lines":"application/x-ndjson",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}[e]||"text/plain"}toCSV(e,s,i){const n=[],o=i.lineEnding==="windows"?`\r
`:`
`,u=i.delimiter;i.includeHeaders&&n.push(s.map(h=>this.escapeCSV(h.header,u)).join(u));for(let h=0;h<e.length;h++){const d=e[h],l=s.map(w=>{let g=d[w.key];return w.transform&&(g=w.transform(g,d)),this.escapeCSV(this.formatValue(g),u)});if(n.push(l.join(u)),i.chunkSize&&h>0&&h%i.chunkSize===0){const w=h/e.length*100;Te.emit("export:progress",{progress:w,processed:h,total:e.length})}}return n.join(o)}toJSON(e,s,i){const n=e.map(o=>{const u={};return s.forEach(h=>{let d=o[h.key];h.transform&&(d=h.transform(d,o)),u[h.key]=d}),u});return i.jsonPretty?JSON.stringify(n,null,2):JSON.stringify(n)}toJSONLines(e,s,i){const n=i.lineEnding==="windows"?`\r
`:`
`;return e.map(o=>{const u={};return s.forEach(h=>{let d=o[h.key];h.transform&&(d=h.transform(d,o)),u[h.key]=d}),JSON.stringify(u)}).join(n)}inferColumns(e){if(e.length===0)return[];const s=new Set;return e.forEach(i=>{Object.keys(i).forEach(n=>s.add(n))}),Array.from(s).map(i=>({key:i,header:i.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}))}escapeCSV(e,s){return e.includes('"')||e.includes(s)||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}formatValue(e){return e==null?"":typeof e=="object"?JSON.stringify(e):String(e)}downloadFile(e,s,i){const n=new Blob([e],{type:i}),o=URL.createObjectURL(n),u=document.createElement("a");u.href=o,u.download=s,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(o)}};x(_e,"instance");let zt=_e;const Jr=zt.getInstance(),Ee=class Ee{constructor(){x(this,"shortcuts",new Map);x(this,"keyMap",new Map);x(this,"enabled",!0);this.bindGlobalHandler()}static getInstance(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}register(e){const s=this.normalizeKeys(e.keys);this.keyMap.has(s)&&console.warn(`Shortcut conflict: ${e.keys} is already registered for ${this.keyMap.get(s)}`),this.shortcuts.set(e.id,{...e,enabled:e.enabled!==!1,preventDefault:e.preventDefault!==!1}),this.keyMap.set(s,e.id)}unregister(e){const s=this.shortcuts.get(e);if(s){const i=this.normalizeKeys(s.keys);this.keyMap.delete(i),this.shortcuts.delete(e)}}setEnabled(e,s){const i=this.shortcuts.get(e);i&&(i.enabled=s)}setGlobalEnabled(e){this.enabled=e}getShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(e){return this.getShortcuts().filter(s=>s.category===e)}showHelp(){Te.emit("modal:opened",{type:"keyboard-help"});const e=this.renderHelpContent();document.dispatchEvent(new CustomEvent("keyboard-help",{detail:{content:e}}))}hideHelp(){Te.emit("modal:closed",{type:"keyboard-help"})}bindGlobalHandler(){document.addEventListener("keydown",e=>{if(!this.enabled||this.isInputElement(e.target)&&e.key!=="Escape")return;const s=this.eventToNormalizedKey(e),i=this.keyMap.get(s);if(i){const n=this.shortcuts.get(i);if(n&&n.enabled){n.preventDefault&&e.preventDefault();try{n.handler(e)}catch(o){console.error(`Error in shortcut handler ${i}:`,o)}}}})}isInputElement(e){const s=e.tagName.toLowerCase();return s==="input"||s==="textarea"||s==="select"||e.contentEditable==="true"}normalizeKeys(e){const s=e.toLowerCase().split("+").map(o=>o.trim()),i=[];(s.includes("ctrl")||s.includes("control"))&&i.push("ctrl"),s.includes("alt")&&i.push("alt"),s.includes("shift")&&i.push("shift"),(s.includes("meta")||s.includes("cmd")||s.includes("command"))&&i.push("meta");const n=s.find(o=>!["ctrl","control","alt","shift","meta","cmd","command"].includes(o));return n&&i.push(n),i.join("+")}eventToNormalizedKey(e){const s=[];e.ctrlKey&&s.push("ctrl"),e.altKey&&s.push("alt"),e.shiftKey&&s.push("shift"),e.metaKey&&s.push("meta");let i=e.key.toLowerCase();return i===" "&&(i="space"),i==="arrowup"&&(i="up"),i==="arrowdown"&&(i="down"),i==="arrowleft"&&(i="left"),i==="arrowright"&&(i="right"),["control","alt","shift","meta"].includes(i)||s.push(i),s.join("+")}renderHelpContent(){const e={navigation:{title:"Navigation",icon:"bi-compass"},selection:{title:"Selection",icon:"bi-check2-square"},actions:{title:"Actions",icon:"bi-lightning"},filters:{title:"Filters",icon:"bi-funnel"},general:{title:"General",icon:"bi-gear"}};let s='<div class="keyboard-help">';for(const[i,n]of Object.entries(e)){const o=this.getShortcutsByCategory(i);if(o.length!==0){s+=`
                <div class="keyboard-help-category">
                    <h3><i class="${n.icon}"></i> ${n.title}</h3>
                    <div class="keyboard-help-list">
            `;for(const u of o){const h=this.formatKeysForDisplay(u.keys);s+=`
                    <div class="keyboard-help-item">
                        <span class="keyboard-help-desc">${u.description}</span>
                        <span class="keyboard-help-keys">${h}</span>
                    </div>
                `}s+="</div></div>"}}return s+="</div>",s}formatKeysForDisplay(e){return e.split("+").map(s=>`<kbd>${s.charAt(0).toUpperCase()+s.slice(1)}</kbd>`).join(" + ")}};x(Ee,"instance");let lt=Ee;function Zr(T){const e=lt.getInstance();e.register({id:"help",keys:"?",description:"Show keyboard shortcuts",category:"general",handler:()=>e.showHelp()}),e.register({id:"close-modal",keys:"Escape",description:"Close modal / Clear selection",category:"general",handler:()=>{var i;const s=document.querySelector(".ts-modal-overlay.show");if(s){s.classList.remove("show");return}(i=T.onClearSelection)==null||i.call(T)}}),T.onSearch&&(e.register({id:"search",keys:"Ctrl+F",description:"Focus search box",category:"filters",handler:T.onSearch}),e.register({id:"search-alt",keys:"/",description:"Focus search box",category:"filters",handler:T.onSearch})),T.onExport&&e.register({id:"export",keys:"Ctrl+E",description:"Export data",category:"actions",handler:T.onExport}),T.onRefresh&&e.register({id:"refresh",keys:"Ctrl+R",description:"Refresh data",category:"actions",handler:T.onRefresh,preventDefault:!0}),T.onReset&&e.register({id:"reset",keys:"Ctrl+Shift+R",description:"Reset all filters",category:"actions",handler:T.onReset,preventDefault:!0}),T.onShowSchema&&e.register({id:"schema",keys:"Ctrl+I",description:"Show database schema",category:"actions",handler:T.onShowSchema}),T.onSelectAll&&e.register({id:"select-all",keys:"Ctrl+A",description:"Select all rows",category:"selection",handler:T.onSelectAll}),T.onClearSelection&&e.register({id:"clear-selection",keys:"Ctrl+D",description:"Clear selection",category:"selection",handler:T.onClearSelection}),T.onNextPage&&e.register({id:"next-page",keys:"Ctrl+Right",description:"Next page",category:"navigation",handler:T.onNextPage}),T.onPrevPage&&e.register({id:"prev-page",keys:"Ctrl+Left",description:"Previous page",category:"navigation",handler:T.onPrevPage}),T.onFirstPage&&e.register({id:"first-page",keys:"Ctrl+Home",description:"First page",category:"navigation",handler:T.onFirstPage}),T.onLastPage&&e.register({id:"last-page",keys:"Ctrl+End",description:"Last page",category:"navigation",handler:T.onLastPage}),T.onToggleTheme&&e.register({id:"toggle-theme",keys:"Ctrl+Shift+T",description:"Toggle dark/light theme",category:"general",handler:T.onToggleTheme})}lt.getInstance();class en{constructor(e){x(this,"container");x(this,"configUrl");x(this,"configManager");x(this,"registry");x(this,"client");x(this,"stateManager");x(this,"categoryManager",null);x(this,"sidebar");x(this,"toolbar");x(this,"grid");x(this,"theme","light");x(this,"density","normal");x(this,"dom",{});if(!e.container)throw new Error("Container required");this.container=e.container,this.configUrl=e.configUrl||null,this.client=e.client||new Ds,this.registry=je.getInstance(),this.stateManager=new Gr,this.stateManager.subscribe(this.onStateChange.bind(this));const s=localStorage.getItem("ts-theme"),i=localStorage.getItem("ts-density");s&&(this.theme=s),i&&(this.density=i)}async init(){try{await this.loadConfiguration();const e=this.configManager.getEnvironment(),s=this.configManager.getApis();let n=this.configManager.getDefaultApiId()||(s.length>0?s[0].id:null);if(n){const u=this.configManager.getApi(n);u&&this.client.updateConfig(u)}else{const u=this.configManager.getApiUrl();u?this.client=new Ds({environment:e,baseUrl:u}):this.client.setEnvironment(e)}const o=this.configManager.getGlobalSettings();this.stateManager.update({pageSize:o.pageSize||50,showRowNumbers:o.showRowNumbers!==!1}),this.loadStateFromUrl(),this.renderLayout(),this.initComponents()}catch(e){this.container.innerHTML=`<div class="ts-alert ts-alert-danger"><i class="bi bi-x-circle-fill"></i> ${e.message}</div>`}}renderLayout(){this.container.innerHTML=`
            <div class="ts-app" data-theme="${this.theme}" data-density="${this.density}">
                <aside class="ts-sidebar" id="ts-sidebar-container"></aside>
                <main class="ts-main">
                    <header class="ts-toolbar" id="ts-toolbar-container"></header>
                    <div id="ts-alert"></div>
                    <div class="ts-performance-indicator" id="ts-performance" style="display:none">
                        <span class="ts-perf-cached" id="ts-perf-cached" style="display:none">
                            <i class="bi bi-lightning-charge-fill"></i> Cached
                        </span>
                        <span class="ts-perf-time" id="ts-perf-time" style="display:none"></span>
                    </div>
                    <div class="ts-grid-header" id="ts-grid-header" style="display:none">
                        <div class="ts-grid-header-content">
                            <div class="ts-db-info">
                                <i class="bi bi-database"></i>
                                <span id="ts-db-name">Database</span>
                            </div>
                            <div class="ts-table-info">
                                <i class="bi bi-table"></i>
                                <span id="ts-active-table-name">Table</span>
                            </div>
                        </div>
                    </div>
                    <div class="ts-grid-wrapper" style="position:relative">
                        <div class="ts-loading-overlay" id="ts-loading-overlay" style="display:none">
                            <div class="ts-loading-spinner-wrapper">
                                <span class="ts-spinner" style="width:32px;height:32px"></span>
                                <span class="ts-loading-text" style="margin-top:12px;font-size:13px;color:var(--c-text-secondary)">Loading...</span>
                            </div>
                        </div>
                        <div class="ts-grid" id="ts-grid-container"></div>
                    </div>
                    <footer class="ts-footer">
                        <div class="ts-status" id="ts-status">Ready</div>
                        <div class="ts-table-name" id="ts-table-name"></div>
                        <div class="ts-pager" id="ts-pager"></div>
                    </footer>
                </main>
                
                <div class="ts-settings-popup" id="ts-settings-popup" style="top: 70px; right: 24px; bottom: auto;">
                    <div class="ts-settings-header">Settings</div>
                     <div class="ts-settings-body">
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-moon-stars"></i> Theme</div>
                            <div class="ts-switch ${this.theme==="dark"?"on":""}" id="ts-theme-toggle"></div>
                        </div>
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-arrows-angle-expand"></i> Density</div>
                            <div class="ts-density-options">
                                <button class="ts-density-opt ${this.density==="compact"?"active":""}" data-density="compact" title="Compact"><i class="bi bi-list"></i></button>
                                <button class="ts-density-opt ${this.density==="normal"?"active":""}" data-density="normal" title="Normal"><i class="bi bi-list-ul"></i></button>
                                <button class="ts-density-opt ${this.density==="comfortable"?"active":""}" data-density="comfortable" title="Comfortable"><i class="bi bi-card-heading"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,this.dom.status=this.container.querySelector("#ts-status"),this.dom.pager=this.container.querySelector("#ts-pager"),this.dom.alert=this.container.querySelector("#ts-alert"),this.dom.tableName=this.container.querySelector("#ts-table-name"),this.dom.loadingOverlay=this.container.querySelector("#ts-loading-overlay"),this.dom.performance=this.container.querySelector("#ts-performance"),this.dom.perfCached=this.container.querySelector("#ts-perf-cached"),this.dom.perfTime=this.container.querySelector("#ts-perf-time")}initComponents(){this.sidebar=new Qr({container:this.container.querySelector("#ts-sidebar-container"),configManager:this.configManager,stateManager:this.stateManager,onApiChange:o=>this.switchApi(o),onLoadData:()=>this.loadObject(),onTableChange:o=>this.switchTable(o),onExport:()=>this.exportCsv(),onReset:()=>this.reset(),onShowSchema:o=>this.showDatabaseSchema(o),onShowStats:o=>this.showColumnStatistics(o)}),this.sidebar.mount(),this.toolbar=new Yr({container:this.container.querySelector("#ts-toolbar-container"),onSearch:o=>{this.stateManager.update({searchValue:o,currentPage:0}),this.fetchData()},onRefresh:()=>this.softRefresh()}),this.toolbar.mount(),this.initKeyboardShortcuts();const e=this.toolbar.getSettingsButton();e&&e.addEventListener("click",o=>{o.stopPropagation();const u=this.container.querySelector("#ts-settings-popup");u==null||u.classList.toggle("show")});const s=this.container.querySelector("#ts-theme-toggle"),i=this.container.querySelectorAll(".ts-density-opt"),n=this.container.querySelector(".ts-app");s==null||s.addEventListener("click",()=>{this.toggleTheme(),s.classList.toggle("on",this.theme==="dark")}),i.forEach(o=>{o.addEventListener("click",()=>{this.density=o.dataset.density,n==null||n.setAttribute("data-density",this.density),i.forEach(u=>u.classList.remove("active")),o.classList.add("active"),localStorage.setItem("ts-density",this.density)})}),this.grid=new Xr({container:this.container.querySelector("#ts-grid-container"),stateManager:this.stateManager,onSort:(o,u)=>{this.stateManager.update({sortColumn:o,sortOrder:u,currentPage:0}),this.fetchData()},onFilter:(o,u)=>{const d={...this.stateManager.getState().columnFilters};u?d[o]=u:delete d[o],this.stateManager.update({columnFilters:d,currentPage:0}),this.fetchData()},onRowSelect:()=>this.updateSelectionStatus()}),this.grid.mount()}initKeyboardShortcuts(){Zr({onSearch:()=>this.toolbar.focusSearch(),onExport:()=>this.exportCsv(),onRefresh:()=>this.softRefresh(),onReset:()=>this.reset(),onSelectAll:()=>this.grid.selectAll(),onClearSelection:()=>this.grid.clearSelection(),onToggleTheme:()=>this.toggleTheme(),onShowSchema:()=>{const e=this.stateManager.getState();e.activeTableName&&this.showDatabaseSchema(e.activeTableName)},onNextPage:()=>this.nextPage(),onPrevPage:()=>this.prevPage(),onFirstPage:()=>this.goToPage(0),onLastPage:()=>{const e=this.stateManager.getState(),s=Math.ceil(e.totalCount/e.pageSize);this.goToPage(s-1)}})}async loadObject(){const e=this.sidebar.getToken(),s=this.sidebar.getBerdlId();if(s==="test/test/test")this.switchApi("test_data");else if(this.switchApi("default"),!e){this.showAlert("Auth token required","danger");return}if(!s){this.showAlert("Object ID required","danger");return}this.client.setToken(e),this.stateManager.update({berdlTableId:s,loading:!0,error:null});try{const i=await this.client.listTables(s),n=this.registry.detectDataType(i);n&&this.configManager.setCurrentDataType(n);const o=i.tables||[];if(this.stateManager.update({availableTables:o}),o.length===0){this.showAlert("No tables found","warning");return}this.sidebar.updateTables(o);const u=this._initialTable,h=u&&o.find(d=>d.name===u)?u:o[0].name;this.switchTable(h)}catch(i){this.showAlert(i.message,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async switchTable(e){this.stateManager.update({activeTableName:e});const s=this.configManager.getTableConfig(e);this.categoryManager=new Kr(s),this.categoryManager.showAllCategories(),this.sidebar.setCategoryManager(this.categoryManager),this.sidebar.updateTableInfo(e),this.stateManager.update({currentPage:0,sortColumn:null,columnFilters:{},searchValue:"",data:[],headers:[],columns:[]}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.loadTableDependencies(e).then(()=>{const i=this.stateManager.getState();i.activeTableName===e&&this.stateManager.update({data:[...i.data]})}),await this.fetchData()}async loadTableDependencies(e){var n;const i=this.configManager.getTableConfig(e).columns||[];for(const o of i){if(!o.transform)continue;const u=Array.isArray(o.transform)?o.transform:[o.transform];for(const h of u)if(h.type==="ontology"&&((n=h.options)!=null&&n.lookupTable)){const d=h.options.lookupTable,l=h.options.lookupKey||"id",w=h.options.lookupValue||"name";try{const g=this.stateManager.getState();if(!g.berdlTableId)continue;const S=await this.client.getTableData({berdl_table_id:g.berdlTableId,table_name:d,limit:1e4,offset:0}),k={},R=S.headers,B=R.indexOf(l),M=R.indexOf(w);B!==-1&&M!==-1&&(S.data.forEach(E=>{const _=String(E[B]),N=String(E[M]);k[_]=N}),Ae.preLoadOntology(k,h.options.ontologyType||"custom"))}catch(g){console.warn(`Failed to load dependency table ${d}`,g)}}}}async fetchData(){const e=this.stateManager.getState();if(!(!e.activeTableName||!e.berdlTableId)){this.stateManager.update({loading:!0});try{const s=await this.client.getTableData({berdl_table_id:e.berdlTableId,table_name:e.activeTableName,limit:e.pageSize,offset:e.currentPage*e.pageSize,search_value:e.searchValue||void 0,sort_column:e.sortColumn||void 0,sort_order:e.sortOrder==="asc"?"ASC":"DESC",col_filter:Object.keys(e.columnFilters).length?e.columnFilters:void 0});this.processColumns(s.headers,e.activeTableName);let i=(s.data||[]).map(n=>{const o={};return s.headers.forEach((u,h)=>{o[u]=n[h]}),o});e.sortColumn&&i.length>0&&(i=this.sortWithNullsLast(i,e.sortColumn,e.sortOrder||"asc")),this.updatePerformanceIndicator(s.cached,s.execution_time_ms),this.stateManager.update({headers:s.headers,data:i,totalCount:s.total_count||0,queryCached:s.cached||!1,queryTime:s.execution_time_ms})}catch(s){this.showAlert(s.message,"danger")}finally{this.stateManager.update({loading:!1})}}}processColumns(e,s){const n=this.configManager.getTableConfig(s).columns||[],o=[],u=new Set;n.forEach(d=>{o.push({...d,visible:d.visible!==!1,sortable:d.sortable!==!1,filterable:d.filterable!==!1,width:d.width||"auto"}),u.add(d.column)});const h=d=>{const l=d.toLowerCase();return l.match(/^(id|name|display_name|label)$/)||l.endsWith("_id")||l.endsWith("_name")?["core"]:l.match(/^(deleted|row_hash|last_synced|created_at|updated_at|sync_.*)$/)?["metadata"]:l.match(/^(error|status|report|message|valid|significance)$/)?["status"]:[]};e.forEach(d=>{u.has(d)||o.push({column:d,displayName:d.replace(/_/g," "),visible:!0,sortable:!0,filterable:!0,width:"auto",categories:h(d)})}),this.stateManager.update({columns:o}),this.categoryManager&&(this.categoryManager.setColumns(o),this.stateManager.update({visibleColumns:this.categoryManager.getVisibleColumns()}))}switchApi(e){const s=this.configManager.getApi(e);s&&(this.client.updateConfig(s),this.reset())}softRefresh(){this.fetchData()}reset(){this.grid.clearFilterFocus(),this.stateManager.update({sortColumn:null,sortOrder:"asc",searchValue:"",columnFilters:{},currentPage:0}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.sidebar.renderFilterChips(),this.fetchData()}nextPage(){const e=this.stateManager.getState(),s=Math.ceil(e.totalCount/e.pageSize);e.currentPage<s-1&&this.goToPage(e.currentPage+1)}prevPage(){const e=this.stateManager.getState();e.currentPage>0&&this.goToPage(e.currentPage-1)}goToPage(e){e>=0&&(this.stateManager.update({currentPage:e}),this.fetchData())}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",localStorage.setItem("ts-theme",this.theme);const e=this.container.querySelector(".ts-app");e&&e.setAttribute("data-theme",this.theme)}async exportCsv(){const e=this.stateManager.getState();if(e.data.length===0)return;const s=this.grid.getSelection(),n=s.size>0?e.data.filter((o,u)=>s.has(u)):e.data;await Jr.export(n,{format:"csv",filename:`export_${e.activeTableName||"data"}_${new Date().toISOString().split("T")[0]}`,columns:e.columns.filter(o=>e.visibleColumns.has(o.column)).map(o=>({key:o.column,header:o.displayName||o.column})),includeHeaders:!0})}onStateChange(e){this.updateStatusBar(e),this.updatePagination(e),this.updateLoadingOverlay(e),this.syncStateToUrl(),e.error&&this.showAlert(e.error,"danger")}updateLoadingOverlay(e){if(!this.dom.loadingOverlay)return;e.loading&&e.availableTables.length>0?this.dom.loadingOverlay.style.display="flex":this.dom.loadingOverlay.style.display="none"}updateStatusBar(e){var h,d;if(!this.dom.status)return;let s="";const i=[];if(e.queryCached&&i.push(" Cached"),e.queryTime!==void 0&&i.push(`${e.queryTime}ms`),e.totalCount>0){const l=e.currentPage*e.pageSize+1,w=Math.min((e.currentPage+1)*e.pageSize,e.totalCount),g=Math.ceil(e.totalCount/e.pageSize);s=`<div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-size:13px;font-weight:600;color:var(--c-text-primary)">Rows: <strong>${l.toLocaleString()}</strong>  <strong>${w.toLocaleString()}</strong> of <strong>${e.totalCount.toLocaleString()}</strong></div>
                <div style="font-size:11px;color:var(--c-text-muted);display:flex;gap:8px;align-items:center">
                    <span>Page ${e.currentPage+1} of ${g||1}</span>
                    ${i.length>0?`<span style="display:flex;align-items:center;gap:4px">${i.join("  ")}</span>`:""}
                </div>
            </div>`;const S=((d=(h=this.grid)==null?void 0:h.getSelection())==null?void 0:d.size)||0;S>0&&(s+=`<div style="margin-top:4px;font-size:11px"><span class="ts-selection-info">${S} row${S!==1?"s":""} selected</span></div>`)}else s='<div style="font-size:13px">Ready</div>';this.dom.status.innerHTML=s,this.dom.tableName&&(e.activeTableName?this.dom.tableName.innerHTML=`<span style="color:var(--c-text-muted);font-size:13px;font-weight:500">${e.activeTableName}</span>`:this.dom.tableName.innerHTML="");const n=this.container.querySelector("#ts-grid-header"),o=this.container.querySelector("#ts-db-name"),u=this.container.querySelector("#ts-active-table-name");n&&o&&u&&(e.activeTableName&&e.berdlTableId?(n.style.display="block",o.textContent=e.berdlTableId,u.textContent=e.activeTableName):n.style.display="none")}updateSelectionStatus(){const e=this.stateManager.getState();this.updateStatusBar(e)}updatePagination(e){if(!this.dom.pager)return;const s=Math.ceil(e.totalCount/e.pageSize),i=e.currentPage;this.dom.pager.innerHTML=`
            <button class="ts-page-btn" data-page="${i-1}" ${i<=0?"disabled":""}><i class="bi bi-chevron-left"></i></button>
            <span class="ts-page-info">${i+1} / ${s||1}</span>
            <button class="ts-page-btn" data-page="${i+1}" ${i>=s-1?"disabled":""}><i class="bi bi-chevron-right"></i></button>
        `,this.dom.pager.querySelectorAll(".ts-page-btn").forEach(n=>{n.addEventListener("click",()=>{const o=parseInt(n.dataset.page||"0");o>=0&&o<s&&this.goToPage(o)})})}syncStateToUrl(){const e=this.stateManager.getState(),s=new URLSearchParams;e.activeTableName&&s.set("table",e.activeTableName),e.sortColumn&&s.set("sort",`${e.sortColumn}:${e.sortOrder}`),e.currentPage>0&&s.set("page",String(e.currentPage+1));const i=s.toString()?`?${s.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}loadStateFromUrl(){const s=new URLSearchParams(window.location.search).get("table");s&&(this._initialTable=s)}async loadConfiguration(){const e="/config/index.json";try{const i=await fetch(e);if(i.ok){const n=await i.json();if(n.dataTypes){await this.registry.initialize(n),this.configManager=new Ns(n);return}}}catch{}let s={};if(this.configUrl)try{const i=await fetch(this.configUrl);i.ok&&(s=await i.json())}catch{}!Object.keys(s).length&&window.DEFAULT_CONFIG&&(s=window.DEFAULT_CONFIG),this.configManager=new Ns(s)}showAlert(e,s){this.dom.alert&&(this.dom.alert.innerHTML=`<div class="ts-alert ts-alert-${s}">${e}</div>`,setTimeout(()=>{this.dom.alert&&(this.dom.alert.innerHTML="")},4e3))}showDatabaseSchema(e){const s=this.stateManager.getState(),i=s.availableTables||[];let n="",o=[],u=!1;const h=(M,E="")=>{const _=E.trim().length>0;return`
            <div class="glass-sidebar" style="width:260px;display:flex;flex-direction:column;">
                <div style="padding:16px;border-bottom:1px solid var(--c-border-subtle)">
                    <h3 style="font-size:11px;text-transform:uppercase;color:var(--c-text-muted);font-weight:700;letter-spacing:0.08em;display:flex;align-items:center;gap:8px;margin-bottom:12px">
                        <i class="bi bi-database" style="font-size:14px"></i> Database Schema
                    </h3>
                    <div style="position:relative;margin-bottom:8px">
                        <input type="text" id="ts-db-search" placeholder="Search tables, columns, data..." 
                            value="${E}"
                            style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:100%;outline:none;color:var(--c-text-primary);box-sizing:border-box">
                        <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted);pointer-events:none"></i>
                        ${_?'<button id="ts-db-search-clear" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--c-text-muted);cursor:pointer;padding:2px;font-size:14px"><i class="bi bi-x"></i></button>':""}
                    </div>
                    ${_?`
                        <div style="display:flex;gap:4px;margin-top:4px">
                            <button id="ts-search-data-btn" class="ts-btn-secondary" style="flex:1;height:28px;font-size:11px;padding:0 8px;${u?"opacity:0.6":""}" ${u?"disabled":""}>
                                <i class="bi bi-${u?"hourglass-split":"search"}"></i> ${u?"Searching...":"Search Data"}
                            </button>
                        </div>
                    `:""}
                </div>
                <div style="flex:1;overflow-y:auto;padding:12px">
                    ${_?`
                        <div style="margin-bottom:8px;padding:0 14px">
                            <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">
                                ${o.length>0?`Results (${o.length})`:"No Results"}
                            </span>
                        </div>
                        ${o.length>0?o.map(N=>{const z=N.columns.length+(N.hasDataMatches?1:0);return`
                                <div class="ts-nav-item ${M===N.table.name?"active":""}" 
                                     data-target="${N.table.name}" 
                                     data-search="${E}"
                                     style="cursor:pointer">
                                    <i class="bi bi-table"></i> 
                                    <div style="flex:1;min-width:0">
                                        <div style="font-weight:${M===N.table.name?"600":"500"}">${N.table.name}</div>
                                        <div style="font-size:10px;color:var(--c-text-muted);margin-top:2px">
                                            ${z} match${z!==1?"es":""}
                                            ${N.hasDataMatches?"  Has data matches":""}
                                        </div>
                                    </div>
                                </div>
                            `}).join(""):`
                            <div style="padding:24px;text-align:center;color:var(--c-text-muted)">
                                <i class="bi bi-search" style="font-size:24px;display:block;margin-bottom:8px;opacity:0.5"></i>
                                <div style="font-size:12px">No matches found</div>
                            </div>
                        `}
                    `:`
                        <div class="ts-nav-item ${M?"":"active"}" data-target="__overview__">
                            <i class="bi bi-grid-1x2"></i> Overview
                        </div>
                        <div style="margin-top:12px;margin-bottom:8px;padding:0 14px">
                            <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">Tables (${i.length})</span>
                        </div>
                        ${i.map(N=>`
                            <div class="ts-nav-item ${M===N.name?"active":""}" data-target="${N.name}">
                                <i class="bi bi-table"></i> 
                                <span style="flex:1">${N.name}</span>
                                <span style="font-size:11px;color:var(--c-text-muted)">${(N.row_count||0).toLocaleString()}</span>
                            </div>
                        `).join("")}
                    `}
                </div>
            </div>
        `},d=()=>{const M=i.length,E=i.reduce((_,N)=>_+(N.row_count||0),0);return n&&o.length>0?`
                    <div style="padding:40px;max-width:960px;margin:0 auto">
                        <div style="margin-bottom:32px">
                            <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">
                                Search Results for "${n}"
                            </h2>
                            <p style="color:var(--c-text-secondary);font-size:14px">Found ${o.length} table${o.length!==1?"s":""} with matches</p>
                        </div>

                        <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:16px">
                            ${o.map(_=>{const N=_.columns.length+(_.hasDataMatches?1:0);return`
                                    <div class="ts-card-nav" data-target="${_.table.name}" data-search="${n}" style="cursor:pointer">
                                        <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px">
                                            <i class="bi bi-table"></i>
                                        </div>
                                        <div style="flex:1">
                                            <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${_.table.name}</div>
                                            <div style="font-size:12px;color:var(--c-text-muted);margin-top:4px">
                                                ${N} match${N!==1?"es":""}
                                                ${_.hasDataMatches?"  Data matches":""}
                                                ${_.columns.length>0?`  ${_.columns.length} column${_.columns.length!==1?"s":""}`:""}
                                            </div>
                                            ${_.columns.length>0?`
                                                <div style="margin-top:8px;font-size:11px;color:var(--c-text-muted);max-height:60px;overflow-y:auto">
                                                    ${_.columns.slice(0,3).map(z=>`
                                                        <div style="padding:2px 0"> ${z.displayName||z.column}</div>
                                                    `).join("")}
                                                    ${_.columns.length>3?`<div style="padding:2px 0;font-style:italic">+ ${_.columns.length-3} more</div>`:""}
                                                </div>
                                            `:""}
                                        </div>
                                        <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                                    </div>
                                `}).join("")}
                        </div>
                    </div>
                `:`
                <div style="padding:48px;max-width:900px;margin:0 auto">
                    <div style="text-align:center;margin-bottom:48px">
                        <div style="width:80px;height:80px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 20px;box-shadow:0 8px 24px var(--c-accent-glow)">
                            <i class="bi bi-database"></i>
                        </div>
                        <h2 style="font-size:28px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">Database Overview</h2>
                        <p style="color:var(--c-text-secondary);font-size:14px">${s.berdlTableId||"Connected Database"}</p>
                    </div>

                    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:20px;margin-bottom:48px">
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Tables</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${M}</div>
                        </div>
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Records</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${E.toLocaleString()}</div>
                        </div>
                    </div>

                    <h3 style="font-size:12px;font-weight:700;margin-bottom:20px;color:var(--c-text-muted);text-transform:uppercase;letter-spacing:0.08em">Available Tables</h3>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px">
                        ${i.map(_=>`
                            <div class="ts-card-nav" data-target="${_.name}">
                                <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px"><i class="bi bi-table"></i></div>
                                <div style="flex:1">
                                    <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${_.name}</div>
                                    <div style="font-size:12px;color:var(--c-text-muted);margin-top:2px">${(_.row_count||0).toLocaleString()} records</div>
                                </div>
                                <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `},l=M=>{var H,U,X;const E=this.configManager.getTableConfig(M),_=s.activeTableName===M,N=_?s.columns:E.columns||[],z=(E==null?void 0:E.name)||M,F=((H=E==null?void 0:E.settings)==null?void 0:H.description)||"No description available for this table.";return`
                <div style="padding:40px;max-width:960px;margin:0 auto">
                    <div style="margin-bottom:36px">
                        <div style="display:flex;align-items:flex-start;gap:20px">
                            <div style="width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;box-shadow:0 4px 16px var(--c-accent-glow)">
                                <i class="${((U=E==null?void 0:E.settings)==null?void 0:U.icon)||"bi bi-table"}"></i>
                            </div>
                            <div style="flex:1">
                                <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin:0 0 8px 0">${z}</h2>
                                <div style="font-size:14px;color:var(--c-text-secondary);line-height:1.6;margin-bottom:16px;max-width:600px">
                                    ${F}
                                </div>
                                <div style="display:flex;gap:20px;font-size:13px;color:var(--c-text-muted)">
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-layout-three-columns"></i> ${N.length} Columns</span>
                                    ${_?`<span style="display:flex;align-items:center;gap:6px"><i class="bi bi-list-ol"></i> ${(X=s.totalCount)==null?void 0:X.toLocaleString()} Records</span>`:""}
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-${_?'check-circle-fill" style="color:var(--success)':"circle"}"></i> ${_?"Currently Loaded":"Not Loaded"}</span>
                                </div>
                            </div>
                            <button id="ts-export-current" class="ts-btn-secondary" data-table="${M}" style="height:40px;padding:0 20px">
                                <i class="bi bi-download"></i> Export Schema
                            </button>
                        </div>
                    </div>

                    <div class="glass-panel" style="overflow:hidden">
                        <div style="padding:14px 20px;border-bottom:1px solid var(--c-border-subtle);display:flex;justify-content:space-between;align-items:center;background:rgba(248,250,252,0.3)">
                            <h4 style="margin:0;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);display:flex;align-items:center;gap:8px">
                                <i class="bi bi-list-columns-reverse"></i> Schema Definition
                            </h4>
                            <div style="position:relative">
                                <input type="text" id="ts-schema-filter" placeholder="Search columns..." style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:220px;outline:none;color:var(--c-text-primary)">
                                <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted)"></i>
                            </div>
                        </div>
                        <div id="ts-schema-items-container" style="max-height:55vh;overflow-y:auto">
                            ${N.length===0?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-info-circle" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>No column information available. Load this table to see details.</div>':N.map(Z=>this.renderSchemaItem(Z)).join("")}
                        </div>
                    </div>
                </div>
             `},w=`
            <div style="display:flex;height:100%;overflow:hidden">
                <div id="ts-schema-sidebar">${h(e||null)}</div>
                <div id="ts-schema-main" style="flex:1;overflow-y:auto;background:var(--c-bg-app-solid);position:relative">
                    ${e?l(e):d()}
                </div>
            </div>
        `,g=this.createModal("Database Explorer",w),S=g.querySelector(".ts-modal-body");S&&(S.style.padding="0",S.style.height="calc(80vh - 60px)");const k=(M,E=n)=>{const _=g.querySelector("#ts-schema-sidebar"),N=g.querySelector("#ts-schema-main");_&&(_.innerHTML=h(M==="__overview__"?null:M,E)),N&&(N.innerHTML=M==="__overview__"?d():l(M),N.scrollTop=0),B()},R=async(M,E=!1)=>{if(n=M.trim(),o=[],!n){k("__overview__");return}const _=n.toLowerCase();for(const N of i){const z=N.name.toLowerCase().includes(_),F=this.configManager.getTableConfig(N.name),X=(s.activeTableName===N.name?s.columns:F.columns||[]).filter(Z=>{const K=(Z.displayName||Z.column||"").toLowerCase(),I=(Z.column||"").toLowerCase(),re=(Z.description||"").toLowerCase();return K.includes(_)||I.includes(_)||re.includes(_)});(z||X.length>0)&&o.push({table:N,columns:X,hasDataMatches:!1})}if(E&&s.berdlTableId){u=!0;const N=g.querySelector("#ts-schema-sidebar");N&&(N.innerHTML=h(null,n)),B();const z=i.map(async F=>{try{if((await this.client.getTableData({berdl_table_id:s.berdlTableId,table_name:F.name,limit:1,offset:0,search_value:n})).total_count>0){const U=o.find(X=>X.table.name===F.name);U?U.hasDataMatches=!0:o.push({table:F,columns:[],hasDataMatches:!0})}}catch(H){console.warn(`Failed to search data in table ${F.name}`,H)}});await Promise.all(z),u=!1}k("__overview__")},B=()=>{const M=g.querySelector("#ts-db-search"),E=g.querySelector("#ts-db-search-clear"),_=g.querySelector("#ts-search-data-btn");if(M){let H=null;M.addEventListener("input",()=>{const U=M.value;n=U,H&&clearTimeout(H),H=setTimeout(()=>{R(U,!1)},300)}),M.addEventListener("keypress",U=>{U.key==="Enter"&&(U.preventDefault(),H&&clearTimeout(H),R(M.value,!1))})}E&&E.addEventListener("click",()=>{M&&(M.value=""),n="",o=[],u=!1,k("__overview__","")}),_&&_.addEventListener("click",async()=>{!n||u||await R(n,!0)}),g.querySelectorAll(".ts-nav-item, .ts-card-nav").forEach(H=>{H.addEventListener("click",()=>{const U=H.dataset.target,X=H.dataset.search;if(U)if(U!=="__overview__"&&X){const Z=g.querySelector(".ts-modal-close");Z&&Z.click(),this.switchTable(U).then(()=>{this.stateManager.update({searchValue:X,currentPage:0}),this.fetchData()})}else k(U,X||n)})});const N=g.querySelector("#ts-schema-filter"),z=g.querySelector("#ts-schema-items-container");N&&z&&N.addEventListener("input",()=>{const H=N.value.toLowerCase();z.querySelectorAll(".ts-schema-item").forEach(U=>{const X=(U.textContent||"").toLowerCase();U.style.display=X.includes(H)?"flex":"none"})});const F=g.querySelector("#ts-export-current");F==null||F.addEventListener("click",()=>{const H=F.dataset.table;if(!H)return;const U=this.configManager.getTableConfig(H),X=s.activeTableName===H?s.columns:U.columns||[],Z=JSON.stringify(U||{tableName:H,columns:X},null,2),K=new Blob([Z],{type:"application/json"}),I=URL.createObjectURL(K),re=document.createElement("a");re.href=I,re.download=`${H}_schema.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re)})};B()}renderSchemaItem(e){const s=[];e.sortable&&s.push({l:"Sortable",bg:"#dbeafe",fg:"#1d4ed8"}),e.filterable&&s.push({l:"Filterable",bg:"#d1fae5",fg:"#059669"}),e.copyable&&s.push({l:"Copyable",bg:"#e2e8f0",fg:"#475569"}),e.pin&&s.push({l:"Pinned",bg:"#ede9fe",fg:"#7c3aed"});const i=s.map(n=>`<span style="font-size:10px;padding:3px 8px;border-radius:4px;background:${n.bg};color:${n.fg};margin-right:6px;font-weight:500">${n.l}</span>`).join("");return`
            <div class="ts-schema-item">
                <div style="padding-top:4px;flex-shrink:0"><i class="bi bi-hash" style="color:var(--c-accent);font-size:16px"></i></div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:12px">
                        <span class="ts-schema-name">${e.displayName||e.column}</span>
                        <span class="ts-schema-type">${e.dataType||"string"}</span>
                    </div>
                    ${e.description?`<div class="ts-schema-desc">${e.description}</div>`:""}
                    <div style="display:flex;align-items:center;margin-top:8px;flex-wrap:wrap;gap:4px">
                        ${i}
                        <span style="font-size:11px;color:var(--c-text-muted);font-family:'JetBrains Mono',monospace;margin-left:auto">col: ${e.column}</span>
                    </div>
                </div>
            </div>
        `}isValueEmpty(e){if(e==null)return!0;if(typeof e=="string"){const s=e.trim();if(s===""||s.length===0||s.toLowerCase()==="null"||s.toLowerCase()==="undefined"||s==="-")return!0}return!!(Array.isArray(e)&&e.length===0||typeof e=="number"&&isNaN(e)||typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0)}sortWithNullsLast(e,s,i){return!e||e.length===0||!s||!e.some(o=>s in o)?e:[...e].sort((o,u)=>{const h=o==null?void 0:o[s],d=u==null?void 0:u[s],l=this.isValueEmpty(h),w=this.isValueEmpty(d);if(l&&w)return 0;if(l)return 1;if(w)return-1;let g=0;if(typeof h==="number"&&typeof d==="number"){if(isNaN(h)&&isNaN(d))return 0;if(isNaN(h))return 1;if(isNaN(d))return-1;g=h-d}else if(h instanceof Date&&d instanceof Date)g=h.getTime()-d.getTime();else{const R=String(h??"").trim().toLowerCase(),B=String(d??"").trim().toLowerCase();R<B?g=-1:R>B?g=1:g=0}return i==="desc"?-g:g})}async loadDatabaseFromFile(e){try{this.stateManager.update({loading:!0,error:null});const s=`/data/${e}.db`,i=`/config/${e}.json`;let n=null;try{const g=await fetch(i);g.ok&&(n=await g.json(),this.registry.registerDataType(n),this.configManager.setCurrentDataType(n.id||e))}catch(g){console.warn("No config file found, using default:",g)}const{LocalDbClient:o}=await Rr(async()=>{const{LocalDbClient:g}=await Promise.resolve().then(()=>Fr);return{LocalDbClient:g}},void 0),u=o.getInstance(),h=`local/${e}`;await u.loadDatabase(s);const l=(await u.listTablesFromDb(s,n)).tables||[];if(l.length===0)throw new Error("No tables found in database");this.stateManager.update({availableTables:l,berdlTableId:h}),this.sidebar.updateTables(l);const w=l[0].name;await this.switchTable(w),this.showAlert(`Loaded database: ${e}`,"success")}catch(s){throw this.showAlert(s.message||"Failed to load database","danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1}),s}finally{this.stateManager.update({loading:!1})}}updatePerformanceIndicator(e,s){if(!this.dom.performance)return;const i=e!==void 0||s!==void 0;this.dom.performance&&(this.dom.performance.style.display=i?"flex":"none"),this.dom.perfCached&&(this.dom.perfCached.style.display=e?"inline-flex":"none"),this.dom.perfTime&&s!==void 0?(this.dom.perfTime.textContent=`${s}ms`,this.dom.perfTime.style.display="inline-flex"):this.dom.perfTime&&(this.dom.perfTime.style.display="none")}async showColumnStatistics(e){const s=this.stateManager.getState();if(!s.berdlTableId||!e){this.showAlert("No table selected","warning");return}try{this.stateManager.update({loading:!0});const i=s.berdlTableId.replace("local/",""),o=await fetch(`http://localhost:3000/object/${i}/tables/${e}/stats`);if(!o.ok)throw new Error("Failed to load statistics");const u=await o.json(),h=`
                <div style="padding:24px;max-width:800px">
                    <h2 style="margin-bottom:20px;font-size:18px;font-weight:600">
                        <i class="bi bi-graph-up"></i> Column Statistics: ${e}
                    </h2>
                    <div style="margin-bottom:16px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm);font-size:13px">
                        <strong>Total Rows:</strong> ${u.row_count.toLocaleString()}
                    </div>
                    <div style="display:grid;gap:12px">
                        ${u.columns.map(d=>`
                            <div style="padding:16px;background:var(--c-bg-surface);border:1px solid var(--c-border-subtle);border-radius:var(--radius-md)">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                    <h3 style="font-size:14px;font-weight:600">${d.column}</h3>
                                    <span style="font-size:11px;color:var(--c-text-muted);text-transform:uppercase">${d.type}</span>
                                </div>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px;font-size:12px">
                                    <div><strong>Nulls:</strong> ${d.null_count.toLocaleString()}</div>
                                    <div><strong>Distinct:</strong> ${d.distinct_count.toLocaleString()}</div>
                                    ${d.min!==void 0?`<div><strong>Min:</strong> ${d.min}</div>`:""}
                                    ${d.max!==void 0?`<div><strong>Max:</strong> ${d.max}</div>`:""}
                                    ${d.mean!==void 0?`<div><strong>Mean:</strong> ${d.mean.toFixed(2)}</div>`:""}
                                    ${d.median!==void 0?`<div><strong>Median:</strong> ${d.median}</div>`:""}
                                    ${d.stddev!==void 0?`<div><strong>StdDev:</strong> ${d.stddev.toFixed(2)}</div>`:""}
                                </div>
                                ${d.sample_values&&d.sample_values.length>0?`
                                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--c-border-subtle)">
                                        <div style="font-size:11px;color:var(--c-text-muted);margin-bottom:6px">Sample Values:</div>
                                        <div style="display:flex;flex-wrap:gap:4px">
                                            ${d.sample_values.slice(0,10).map(l=>`
                                                <span style="padding:2px 8px;background:var(--c-bg-surface-alt);border-radius:4px;font-size:11px;font-family:monospace">${String(l).substring(0,30)}</span>
                                            `).join("")}
                                        </div>
                                    </div>
                                `:""}
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;this.createModal(`Column Statistics: ${e}`,h)}catch(i){this.showAlert(`Failed to load statistics: ${i.message}`,"danger")}finally{this.stateManager.update({loading:!1})}}createModal(e,s){var u;const i=document.querySelector(".ts-modal-overlay");i&&i.remove();const n=document.createElement("div");n.className="ts-modal-overlay",n.innerHTML=`
            <div class="ts-modal">
                <div class="ts-modal-header">
                    <span class="ts-modal-title">${e}</span>
                    <button class="ts-modal-close"><i class="bi bi-x-lg"></i></button>
                </div>
                <div class="ts-modal-body">${s}</div>
            </div>
        `,document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("show"));const o=()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),200)};return(u=n.querySelector(".ts-modal-close"))==null||u.addEventListener("click",o),n.addEventListener("click",h=>{h.target===n&&o()}),n}}document.addEventListener("DOMContentLoaded",async()=>{const T=document.querySelector("#app");if(T){const s=new URLSearchParams(window.location.search).get("db"),i=new en({container:T,configUrl:"genome-data.config.json"});if(await i.init(),s)try{await i.loadDatabaseFromFile(s)}catch(n){console.error("Failed to load database from URL parameter:",n),T.innerHTML=`
                    <div class="ts-alert ts-alert-danger">
                        <i class="bi bi-x-circle-fill"></i> 
                        Failed to load database: ${n.message}
                        <br><br>
                        <small>Usage: ?db=filename (without .db extension)</small>
                        <br>
                        <small>Database file should be at: /data/${s}.db</small>
                    </div>
                `}window.tableRenderer=i}else console.error("App container #app not found")});
