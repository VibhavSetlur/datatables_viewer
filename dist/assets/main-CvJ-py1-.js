var Pa=Object.defineProperty;var ja=(k,t,e)=>t in k?Pa(k,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):k[t]=e;var T=(k,t,e)=>ja(k,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const qa="modulepreload",Ua=function(k){return"/"+k},Fs={},wt=function(t,e,n){let i=Promise.resolve();if(e&&e.length>0){let u=function(o){return Promise.all(o.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),c=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));i=u(e.map(o=>{if(o=Ua(o),o in Fs)return;Fs[o]=!0;const p=o.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${m}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":qa,p||(y.as="script"),y.crossOrigin="",y.href=o,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((E,x)=>{y.addEventListener("load",E),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&r(h.reason);return t().catch(r)})};function za(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}function Ha(k){if(Object.prototype.hasOwnProperty.call(k,"__esModule"))return k;var t=k.default;if(typeof t=="function"){var e=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(k).forEach(function(n){var i=Object.getOwnPropertyDescriptor(k,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return k[n]}})}),e}var qe={exports:{}};const Ba={},Va=Object.freeze(Object.defineProperty({__proto__:null,default:Ba},Symbol.toStringTag,{value:"Module"})),Ps=Ha(Va);var js;function Ga(){return js||(js=1,(function(k,t){var e=void 0,n=function(i){return e||(e=new Promise(function(r,u){var h=typeof i<"u"?i:{},c=h.onAbort;h.onAbort=function(s){u(new Error(s)),c&&c(s)},h.postRun=h.postRun||[],h.postRun.push(function(){r(h)}),k=void 0;var o;o||(o=typeof h<"u"?h:{});var p=typeof window=="object",m=typeof WorkerGlobalScope<"u",y=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";o.onRuntimeInitialized=function(){function s(g,_){switch(typeof _){case"boolean":Ia(g,_?1:0);break;case"number":Na(g,_);break;case"string":Ra(g,_,-1,-1);break;case"object":if(_===null)Ns(g);else if(_.length!=null){var O=de(_,ce);Oa(g,O,_.length,-1),ue(O)}else he(g,"Wrong API use : tried to return a value of an unknown type ("+_+").",-1);break;default:Ns(g)}}function a(g,_){for(var O=[],P=0;P<g;P+=1){var U=bt(_+4*P,"i32"),Y=ka(U);if(Y===1||Y===2)U=Da(U);else if(Y===3)U=La(U);else if(Y===4){Y=U,U=Ma(Y),Y=Aa(Y);for(var ft=new Uint8Array(U),ut=0;ut<U;ut+=1)ft[ut]=L[Y+ut];U=ft}else U=null;O.push(U)}return O}function l(g,_){this.Qa=g,this.db=_,this.Oa=1,this.lb=[]}function d(g,_){if(this.db=_,_=Kt(g)+1,this.eb=Fe(_),this.eb===null)throw Error("Unable to allocate memory for the SQL string");yt(g,R,this.eb,_),this.kb=this.eb,this.Za=this.pb=null}function f(g){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),g!=null){var _=this.filename,O="/",P=_;if(O&&(O=typeof O=="string"?O:$e(O),P=_?xe(O+"/"+_):O),_=rs(!0,!0),P=na(P,_),g){if(typeof g=="string"){O=Array(g.length);for(var U=0,Y=g.length;U<Y;++U)O[U]=g.charCodeAt(U);g=O}ie(P,_|146),O=Ht(P,577),Ts(O,g,0,g.length,0),Ae(O),ie(P,_)}}this.handleError(I(this.filename,b)),this.db=bt(b,"i32"),Os(this.db),this.fb={},this.Sa={}}var b=$t(4),w=o.cwrap,I=w("sqlite3_open","number",["string","number"]),V=w("sqlite3_close_v2","number",["number"]),B=w("sqlite3_exec","number",["number","string","number","number","number"]),et=w("sqlite3_changes","number",["number"]),lt=w("sqlite3_prepare_v2","number",["number","string","number","number","number"]),ks=w("sqlite3_sql","string",["number"]),ua=w("sqlite3_normalized_sql","string",["number"]),Ms=w("sqlite3_prepare_v2","number",["number","number","number","number","number"]),ha=w("sqlite3_bind_text","number",["number","number","number","number","number"]),Ls=w("sqlite3_bind_blob","number",["number","number","number","number","number"]),fa=w("sqlite3_bind_double","number",["number","number","number"]),ma=w("sqlite3_bind_int","number",["number","number","number"]),pa=w("sqlite3_bind_parameter_index","number",["number","string"]),ga=w("sqlite3_step","number",["number"]),ba=w("sqlite3_errmsg","string",["number"]),ya=w("sqlite3_column_count","number",["number"]),va=w("sqlite3_data_count","number",["number"]),wa=w("sqlite3_column_double","number",["number","number"]),As=w("sqlite3_column_text","string",["number","number"]),Sa=w("sqlite3_column_blob","number",["number","number"]),xa=w("sqlite3_column_bytes","number",["number","number"]),Ta=w("sqlite3_column_type","number",["number","number"]),Ca=w("sqlite3_column_name","string",["number","number"]),$a=w("sqlite3_reset","number",["number"]),_a=w("sqlite3_clear_bindings","number",["number"]),Ea=w("sqlite3_finalize","number",["number"]),Ds=w("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),ka=w("sqlite3_value_type","number",["number"]),Ma=w("sqlite3_value_bytes","number",["number"]),La=w("sqlite3_value_text","string",["number"]),Aa=w("sqlite3_value_blob","number",["number"]),Da=w("sqlite3_value_double","number",["number"]),Na=w("sqlite3_result_double","",["number","number"]),Ns=w("sqlite3_result_null","",["number"]),Ra=w("sqlite3_result_text","",["number","string","number","number"]),Oa=w("sqlite3_result_blob","",["number","number","number","number"]),Ia=w("sqlite3_result_int","",["number","number"]),he=w("sqlite3_result_error","",["number","string","number"]),Rs=w("sqlite3_aggregate_context","number",["number","number"]),Os=w("RegisterExtensionFunctions","number",["number"]),Is=w("sqlite3_update_hook","number",["number","number","number"]);l.prototype.bind=function(g){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(g)?this.Cb(g):g!=null&&typeof g=="object"?this.Db(g):!0},l.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var g=ga(this.Qa);switch(g){case 100:return!0;case 101:return!1;default:throw this.db.handleError(g)}},l.prototype.wb=function(g){return g==null&&(g=this.Oa,this.Oa+=1),wa(this.Qa,g)},l.prototype.Gb=function(g){if(g==null&&(g=this.Oa,this.Oa+=1),g=As(this.Qa,g),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(g)},l.prototype.Hb=function(g){return g==null&&(g=this.Oa,this.Oa+=1),As(this.Qa,g)},l.prototype.getBlob=function(g){g==null&&(g=this.Oa,this.Oa+=1);var _=xa(this.Qa,g);g=Sa(this.Qa,g);for(var O=new Uint8Array(_),P=0;P<_;P+=1)O[P]=L[g+P];return O},l.prototype.get=function(g,_){_=_||{},g!=null&&this.bind(g)&&this.step(),g=[];for(var O=va(this.Qa),P=0;P<O;P+=1)switch(Ta(this.Qa,P)){case 1:var U=_.useBigInt?this.Gb(P):this.wb(P);g.push(U);break;case 2:g.push(this.wb(P));break;case 3:g.push(this.Hb(P));break;case 4:g.push(this.getBlob(P));break;default:g.push(null)}return g},l.prototype.getColumnNames=function(){for(var g=[],_=ya(this.Qa),O=0;O<_;O+=1)g.push(Ca(this.Qa,O));return g},l.prototype.getAsObject=function(g,_){g=this.get(g,_),_=this.getColumnNames();for(var O={},P=0;P<_.length;P+=1)O[_[P]]=g[P];return O},l.prototype.getSQL=function(){return ks(this.Qa)},l.prototype.getNormalizedSQL=function(){return ua(this.Qa)},l.prototype.run=function(g){return g!=null&&this.bind(g),this.step(),this.reset()},l.prototype.sb=function(g,_){_==null&&(_=this.Oa,this.Oa+=1),g=as(g);var O=de(g,ce);this.lb.push(O),this.db.handleError(ha(this.Qa,_,O,g.length-1,0))},l.prototype.Bb=function(g,_){_==null&&(_=this.Oa,this.Oa+=1);var O=de(g,ce);this.lb.push(O),this.db.handleError(Ls(this.Qa,_,O,g.length,0))},l.prototype.rb=function(g,_){_==null&&(_=this.Oa,this.Oa+=1),this.db.handleError((g===(g|0)?ma:fa)(this.Qa,_,g))},l.prototype.Eb=function(g){g==null&&(g=this.Oa,this.Oa+=1),Ls(this.Qa,g,0,0,0)},l.prototype.tb=function(g,_){switch(_==null&&(_=this.Oa,this.Oa+=1),typeof g){case"string":this.sb(g,_);return;case"number":this.rb(g,_);return;case"bigint":this.sb(g.toString(),_);return;case"boolean":this.rb(g+0,_);return;case"object":if(g===null){this.Eb(_);return}if(g.length!=null){this.Bb(g,_);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+g+")."},l.prototype.Db=function(g){var _=this;return Object.keys(g).forEach(function(O){var P=pa(_.Qa,O);P!==0&&_.tb(g[O],P)}),!0},l.prototype.Cb=function(g){for(var _=0;_<g.length;_+=1)this.tb(g[_],_+1);return!0},l.prototype.reset=function(){return this.freemem(),_a(this.Qa)===0&&$a(this.Qa)===0},l.prototype.freemem=function(){for(var g;(g=this.lb.pop())!==void 0;)ue(g)},l.prototype.free=function(){this.freemem();var g=Ea(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,g},d.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var g=Zt(),_=$t(4);Wt(b),Wt(_);try{this.db.handleError(Ms(this.db.db,this.kb,-1,b,_)),this.kb=bt(_,"i32");var O=bt(b,"i32");return O===0?(this.mb(),{done:!0}):(this.Za=new l(O,this.db),this.db.fb[O]=this.Za,{value:this.Za,done:!1})}catch(P){throw this.pb=Se(this.kb),this.mb(),P}finally{Jt(g)}},d.prototype.mb=function(){ue(this.eb),this.eb=null},d.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:Se(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(d.prototype[Symbol.iterator]=function(){return this}),f.prototype.run=function(g,_){if(!this.db)throw"Database closed";if(_){g=this.prepare(g,_);try{g.step()}finally{g.free()}}else this.handleError(B(this.db,g,0,0,b));return this},f.prototype.exec=function(g,_,O){if(!this.db)throw"Database closed";var P=Zt(),U=null;try{var Y=Oe(g),ft=$t(4);for(g=[];bt(Y,"i8")!==0;){Wt(b),Wt(ft),this.handleError(Ms(this.db,Y,-1,b,ft));var ut=bt(b,"i32");if(Y=bt(ft,"i32"),ut!==0){var ct=null;for(U=new l(ut,this),_!=null&&U.bind(_);U.step();)ct===null&&(ct={columns:U.getColumnNames(),values:[]},g.push(ct)),ct.values.push(U.get(null,O));U.free()}}return g}catch(mt){throw U&&U.free(),mt}finally{Jt(P)}},f.prototype.each=function(g,_,O,P,U){typeof _=="function"&&(P=O,O=_,_=void 0),g=this.prepare(g,_);try{for(;g.step();)O(g.getAsObject(null,U))}finally{g.free()}if(typeof P=="function")return P()},f.prototype.prepare=function(g,_){if(Wt(b),this.handleError(lt(this.db,g,-1,b,0)),g=bt(b,"i32"),g===0)throw"Nothing to prepare";var O=new l(g,this);return _!=null&&O.bind(_),this.fb[g]=O},f.prototype.iterateStatements=function(g){return new d(g,this)},f.prototype.export=function(){Object.values(this.fb).forEach(function(_){_.free()}),Object.values(this.Sa).forEach(Ct),this.Sa={},this.handleError(V(this.db));var g=ia(this.filename);return this.handleError(I(this.filename,b)),this.db=bt(b,"i32"),Os(this.db),g},f.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(g){g.free()}),Object.values(this.Sa).forEach(Ct),this.Sa={},this.Ya&&(Ct(this.Ya),this.Ya=void 0),this.handleError(V(this.db)),ys("/"+this.filename),this.db=null)},f.prototype.handleError=function(g){if(g===0)return null;throw g=ba(this.db),Error(g)},f.prototype.getRowsModified=function(){return et(this.db)},f.prototype.create_function=function(g,_){Object.prototype.hasOwnProperty.call(this.Sa,g)&&(Ct(this.Sa[g]),delete this.Sa[g]);var O=Yt(function(P,U,Y){U=a(U,Y);try{var ft=_.apply(null,U)}catch(ut){he(P,ut,-1);return}s(P,ft)},"viii");return this.Sa[g]=O,this.handleError(Ds(this.db,g,_.length,1,0,O,0,0,0)),this},f.prototype.create_aggregate=function(g,_){var O=_.init||function(){return null},P=_.finalize||function(ct){return ct},U=_.step;if(!U)throw"An aggregate function must have a step function in "+g;var Y={};Object.hasOwnProperty.call(this.Sa,g)&&(Ct(this.Sa[g]),delete this.Sa[g]),_=g+"__finalize",Object.hasOwnProperty.call(this.Sa,_)&&(Ct(this.Sa[_]),delete this.Sa[_]);var ft=Yt(function(ct,mt,je){var Rt=Rs(ct,1);Object.hasOwnProperty.call(Y,Rt)||(Y[Rt]=O()),mt=a(mt,je),mt=[Y[Rt]].concat(mt);try{Y[Rt]=U.apply(null,mt)}catch(Fa){delete Y[Rt],he(ct,Fa,-1)}},"viii"),ut=Yt(function(ct){var mt=Rs(ct,1);try{var je=P(Y[mt])}catch(Rt){delete Y[mt],he(ct,Rt,-1);return}s(ct,je),delete Y[mt]},"vi");return this.Sa[g]=ft,this.Sa[_]=ut,this.handleError(Ds(this.db,g,U.length-1,1,0,0,ft,ut,0)),this},f.prototype.updateHook=function(g){this.Ya&&(Is(this.db,0,0),Ct(this.Ya),this.Ya=void 0),g&&(this.Ya=Yt(function(_,O,P,U,Y){switch(O){case 18:_="insert";break;case 23:_="update";break;case 9:_="delete";break;default:throw"unknown operationCode in updateHook callback: "+O}if(P=P?tt(R,P):"",U=U?tt(R,U):"",Y>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";g(_,P,U,Number(Y))},"viiiij"),Is(this.db,this.Ya,0))},o.Database=f};var E={...o},x="./this.program",S=(s,a)=>{throw a},v="",$,M;if(y){var N=Ps;v=__dirname+"/",M=s=>(s=nt(s)?new URL(s):s,N.readFileSync(s)),$=async s=>(s=nt(s)?new URL(s):s,N.readFileSync(s,void 0)),!o.thisProgram&&1<process.argv.length&&(x=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),k.exports=o,S=(s,a)=>{throw process.exitCode=s,a}}else(p||m)&&(m?v=self.location.href:typeof document<"u"&&document.currentScript&&(v=document.currentScript.src),v=v.startsWith("blob:")?"":v.slice(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1),m&&(M=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),$=async s=>{if(nt(s))return new Promise((l,d)=>{var f=new XMLHttpRequest;f.open("GET",s,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?l(f.response):d(f.status)},f.onerror=d,f.send(null)});var a=await fetch(s,{credentials:"same-origin"});if(a.ok)return a.arrayBuffer();throw Error(a.status+" : "+a.url)});var G=o.print||console.log.bind(console),D=o.printErr||console.error.bind(console);Object.assign(o,E),E=null,o.thisProgram&&(x=o.thisProgram);var q=o.wasmBinary,j,K=!1,J,L,R,at,W,X,St,H,st,nt=s=>s.startsWith("file://");function it(){var s=j.buffer;o.HEAP8=L=new Int8Array(s),o.HEAP16=at=new Int16Array(s),o.HEAPU8=R=new Uint8Array(s),o.HEAPU16=new Uint16Array(s),o.HEAP32=W=new Int32Array(s),o.HEAPU32=X=new Uint32Array(s),o.HEAPF32=St=new Float32Array(s),o.HEAPF64=st=new Float64Array(s),o.HEAP64=H=new BigInt64Array(s),o.HEAPU64=new BigUint64Array(s)}var pt=0,Lt=null;function qt(s){var a;throw(a=o.onAbort)==null||a.call(o,s),s="Aborted("+s+")",D(s),K=!0,new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info.")}var ye;async function Bs(s){if(!q)try{var a=await $(s);return new Uint8Array(a)}catch{}if(s==ye&&q)s=new Uint8Array(q);else if(M)s=M(s);else throw"both async and sync fetching of the wasm failed";return s}async function Vs(s,a){try{var l=await Bs(s);return await WebAssembly.instantiate(l,a)}catch(d){D(`failed to asynchronously prepare wasm: ${d}`),qt(d)}}async function Gs(s){var a=ye;if(!q&&typeof WebAssembly.instantiateStreaming=="function"&&!nt(a)&&!y)try{var l=fetch(a,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(l,s)}catch(d){D(`wasm streaming compile failed: ${d}`),D("falling back to ArrayBuffer instantiation")}return Vs(a,s)}class ve{constructor(a){T(this,"name","ExitStatus");this.message=`Program terminated with exit(${a})`,this.status=a}}var Xe=s=>{for(;0<s.length;)s.shift()(o)},Ye=[],Je=[],Ws=()=>{var s=o.preRun.shift();Je.unshift(s)};function bt(s,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":return L[s];case"i8":return L[s];case"i16":return at[s>>1];case"i32":return W[s>>2];case"i64":return H[s>>3];case"float":return St[s>>2];case"double":return st[s>>3];case"*":return X[s>>2];default:qt(`invalid type for getValue: ${a}`)}}var we=o.noExitRuntime||!0;function Wt(s){var a="i32";switch(a.endsWith("*")&&(a="*"),a){case"i1":L[s]=0;break;case"i8":L[s]=0;break;case"i16":at[s>>1]=0;break;case"i32":W[s>>2]=0;break;case"i64":H[s>>3]=BigInt(0);break;case"float":St[s>>2]=0;break;case"double":st[s>>3]=0;break;case"*":X[s>>2]=0;break;default:qt(`invalid type for setValue: ${a}`)}}var Ze=typeof TextDecoder<"u"?new TextDecoder:void 0,tt=(s,a=0,l=NaN)=>{var d=a+l;for(l=a;s[l]&&!(l>=d);)++l;if(16<l-a&&s.buffer&&Ze)return Ze.decode(s.subarray(a,l));for(d="";a<l;){var f=s[a++];if(f&128){var b=s[a++]&63;if((f&224)==192)d+=String.fromCharCode((f&31)<<6|b);else{var w=s[a++]&63;f=(f&240)==224?(f&15)<<12|b<<6|w:(f&7)<<18|b<<12|w<<6|s[a++]&63,65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode(55296|f>>10,56320|f&1023))}}else d+=String.fromCharCode(f)}return d},Se=(s,a)=>s?tt(R,s,a):"",ts=(s,a)=>{for(var l=0,d=s.length-1;0<=d;d--){var f=s[d];f==="."?s.splice(d,1):f===".."?(s.splice(d,1),l++):l&&(s.splice(d,1),l--)}if(a)for(;l;l--)s.unshift("..");return s},xe=s=>{var a=s.charAt(0)==="/",l=s.slice(-1)==="/";return(s=ts(s.split("/").filter(d=>!!d),!a).join("/"))||a||(s="."),s&&l&&(s+="/"),(a?"/":"")+s},es=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.slice(0,-1)),s+a)},ee=s=>s&&s.match(/([^\/]+|\/)\/*$/)[1],Ks=()=>{if(y){var s=Ps;return a=>s.randomFillSync(a)}return a=>crypto.getRandomValues(a)},ss=s=>{(ss=Ks())(s)},Qs=(...s)=>{for(var a="",l=!1,d=s.length-1;-1<=d&&!l;d--){if(l=0<=d?s[d]:"/",typeof l!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!l)return"";a=l+"/"+a,l=l.charAt(0)==="/"}return a=ts(a.split("/").filter(f=>!!f),!l).join("/"),(l?"/":"")+a||"."},Te=[],Kt=s=>{for(var a=0,l=0;l<s.length;++l){var d=s.charCodeAt(l);127>=d?a++:2047>=d?a+=2:55296<=d&&57343>=d?(a+=4,++l):a+=3}return a},yt=(s,a,l,d)=>{if(!(0<d))return 0;var f=l;d=l+d-1;for(var b=0;b<s.length;++b){var w=s.charCodeAt(b);if(55296<=w&&57343>=w){var I=s.charCodeAt(++b);w=65536+((w&1023)<<10)|I&1023}if(127>=w){if(l>=d)break;a[l++]=w}else{if(2047>=w){if(l+1>=d)break;a[l++]=192|w>>6}else{if(65535>=w){if(l+2>=d)break;a[l++]=224|w>>12}else{if(l+3>=d)break;a[l++]=240|w>>18,a[l++]=128|w>>12&63}a[l++]=128|w>>6&63}a[l++]=128|w&63}}return a[l]=0,l-f},as=(s,a)=>{var l=Array(Kt(s)+1);return s=yt(s,l,0,l.length),a&&(l.length=s),l},ns=[];function is(s,a){ns[s]={input:[],output:[],cb:a},Me(s,Xs)}var Xs={open(s){var a=ns[s.node.rdev];if(!a)throw new A(43);s.tty=a,s.seekable=!1},close(s){s.tty.cb.fsync(s.tty)},fsync(s){s.tty.cb.fsync(s.tty)},read(s,a,l,d){if(!s.tty||!s.tty.cb.xb)throw new A(60);for(var f=0,b=0;b<d;b++){try{var w=s.tty.cb.xb(s.tty)}catch{throw new A(29)}if(w===void 0&&f===0)throw new A(6);if(w==null)break;f++,a[l+b]=w}return f&&(s.node.atime=Date.now()),f},write(s,a,l,d){if(!s.tty||!s.tty.cb.qb)throw new A(60);try{for(var f=0;f<d;f++)s.tty.cb.qb(s.tty,a[l+f])}catch{throw new A(29)}return d&&(s.node.mtime=s.node.ctime=Date.now()),f}},Ys={xb(){t:{if(!Te.length){var s=null;if(y){var a=Buffer.alloc(256),l=0,d=process.stdin.fd;try{l=N.readSync(d,a,0,256)}catch(f){if(f.toString().includes("EOF"))l=0;else throw f}0<l&&(s=a.slice(0,l).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(s=window.prompt("Input: "),s!==null&&(s+=`
`));if(!s){s=null;break t}Te=as(s,!0)}s=Te.shift()}return s},qb(s,a){a===null||a===10?(G(tt(s.output)),s.output=[]):a!=0&&s.output.push(a)},fsync(s){var a;0<((a=s.output)==null?void 0:a.length)&&(G(tt(s.output)),s.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},Js={qb(s,a){a===null||a===10?(D(tt(s.output)),s.output=[]):a!=0&&s.output.push(a)},fsync(s){var a;0<((a=s.output)==null?void 0:a.length)&&(D(tt(s.output)),s.output=[])}},z={Wa:null,Xa(){return z.createNode(null,"/",16895,0)},createNode(s,a,l,d){if((l&61440)===24576||(l&61440)===4096)throw new A(63);return z.Wa||(z.Wa={dir:{node:{Ta:z.La.Ta,Ua:z.La.Ua,lookup:z.La.lookup,hb:z.La.hb,rename:z.La.rename,unlink:z.La.unlink,rmdir:z.La.rmdir,readdir:z.La.readdir,symlink:z.La.symlink},stream:{Va:z.Ma.Va}},file:{node:{Ta:z.La.Ta,Ua:z.La.Ua},stream:{Va:z.Ma.Va,read:z.Ma.read,write:z.Ma.write,ib:z.Ma.ib,jb:z.Ma.jb}},link:{node:{Ta:z.La.Ta,Ua:z.La.Ua,readlink:z.La.readlink},stream:{}},ub:{node:{Ta:z.La.Ta,Ua:z.La.Ua},stream:aa}}),l=us(s,a,l,d),ot(l.mode)?(l.La=z.Wa.dir.node,l.Ma=z.Wa.dir.stream,l.Na={}):(l.mode&61440)===32768?(l.La=z.Wa.file.node,l.Ma=z.Wa.file.stream,l.Ra=0,l.Na=null):(l.mode&61440)===40960?(l.La=z.Wa.link.node,l.Ma=z.Wa.link.stream):(l.mode&61440)===8192&&(l.La=z.Wa.ub.node,l.Ma=z.Wa.ub.stream),l.atime=l.mtime=l.ctime=Date.now(),s&&(s.Na[a]=l,s.atime=s.mtime=s.ctime=l.atime),l},Sb(s){return s.Na?s.Na.subarray?s.Na.subarray(0,s.Ra):new Uint8Array(s.Na):new Uint8Array(0)},La:{Ta(s){var a={};return a.dev=(s.mode&61440)===8192?s.id:1,a.ino=s.id,a.mode=s.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=s.rdev,ot(s.mode)?a.size=4096:(s.mode&61440)===32768?a.size=s.Ra:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.atime=new Date(s.atime),a.mtime=new Date(s.mtime),a.ctime=new Date(s.ctime),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},Ua(s,a){for(var l of["mode","atime","mtime","ctime"])a[l]!=null&&(s[l]=a[l]);a.size!==void 0&&(a=a.size,s.Ra!=a&&(a==0?(s.Na=null,s.Ra=0):(l=s.Na,s.Na=new Uint8Array(a),l&&s.Na.set(l.subarray(0,Math.min(a,s.Ra))),s.Ra=a)))},lookup(){throw z.vb},hb(s,a,l,d){return z.createNode(s,a,l,d)},rename(s,a,l){try{var d=At(a,l)}catch{}if(d){if(ot(s.mode))for(var f in d.Na)throw new A(55);Ee(d)}delete s.parent.Na[s.name],a.Na[l]=s,s.name=l,a.ctime=a.mtime=s.parent.ctime=s.parent.mtime=Date.now()},unlink(s,a){delete s.Na[a],s.ctime=s.mtime=Date.now()},rmdir(s,a){var l=At(s,a),d;for(d in l.Na)throw new A(55);delete s.Na[a],s.ctime=s.mtime=Date.now()},readdir(s){return[".","..",...Object.keys(s.Na)]},symlink(s,a,l){return s=z.createNode(s,a,41471,0),s.link=l,s},readlink(s){if((s.mode&61440)!==40960)throw new A(28);return s.link}},Ma:{read(s,a,l,d,f){var b=s.node.Na;if(f>=s.node.Ra)return 0;if(s=Math.min(s.node.Ra-f,d),8<s&&b.subarray)a.set(b.subarray(f,f+s),l);else for(d=0;d<s;d++)a[l+d]=b[f+d];return s},write(s,a,l,d,f,b){if(a.buffer===L.buffer&&(b=!1),!d)return 0;if(s=s.node,s.mtime=s.ctime=Date.now(),a.subarray&&(!s.Na||s.Na.subarray)){if(b)return s.Na=a.subarray(l,l+d),s.Ra=d;if(s.Ra===0&&f===0)return s.Na=a.slice(l,l+d),s.Ra=d;if(f+d<=s.Ra)return s.Na.set(a.subarray(l,l+d),f),d}b=f+d;var w=s.Na?s.Na.length:0;if(w>=b||(b=Math.max(b,w*(1048576>w?2:1.125)>>>0),w!=0&&(b=Math.max(b,256)),w=s.Na,s.Na=new Uint8Array(b),0<s.Ra&&s.Na.set(w.subarray(0,s.Ra),0)),s.Na.subarray&&a.subarray)s.Na.set(a.subarray(l,l+d),f);else for(b=0;b<d;b++)s.Na[f+b]=a[l+b];return s.Ra=Math.max(s.Ra,f+d),d},Va(s,a,l){if(l===1?a+=s.position:l===2&&(s.node.mode&61440)===32768&&(a+=s.node.Ra),0>a)throw new A(28);return a},ib(s,a,l,d,f){if((s.node.mode&61440)!==32768)throw new A(43);if(s=s.node.Na,f&2||!s||s.buffer!==L.buffer){f=!0,d=65536*Math.ceil(a/65536);var b=_s(65536,d);if(b&&R.fill(0,b,b+d),d=b,!d)throw new A(48);s&&((0<l||l+a<s.length)&&(s.subarray?s=s.subarray(l,l+a):s=Array.prototype.slice.call(s,l,l+a)),L.set(s,d))}else f=!1,d=s.byteOffset;return{Kb:d,Ab:f}},jb(s,a,l,d){return z.Ma.write(s,a,0,d,l,!1),0}}},rs=(s,a)=>{var l=0;return s&&(l|=365),a&&(l|=146),l},Ce=null,os={},Ut=[],Zs=1,xt=null,ls=!1,cs=!0,ds={},A=class{constructor(s){T(this,"name","ErrnoError");this.Pa=s}},ta=class{constructor(){T(this,"gb",{});T(this,"node",null)}get flags(){return this.gb.flags}set flags(s){this.gb.flags=s}get position(){return this.gb.position}set position(s){this.gb.position=s}},ea=class{constructor(s,a,l,d){T(this,"La",{});T(this,"Ma",{});T(this,"ab",null);s||(s=this),this.parent=s,this.Xa=s.Xa,this.id=Zs++,this.name=a,this.mode=l,this.rdev=d,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(s){s?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(s){s?this.mode|=146:this.mode&=-147}};function dt(s,a={}){if(!s)throw new A(44);a.nb??(a.nb=!0),s.charAt(0)==="/"||(s="//"+s);var l=0;t:for(;40>l;l++){s=s.split("/").filter(I=>!!I);for(var d=Ce,f="/",b=0;b<s.length;b++){var w=b===s.length-1;if(w&&a.parent)break;if(s[b]!==".")if(s[b]==="..")f=es(f),d=d.parent;else{f=xe(f+"/"+s[b]);try{d=At(d,s[b])}catch(I){if((I==null?void 0:I.Pa)===44&&w&&a.Jb)return{path:f};throw I}if(!d.ab||w&&!a.nb||(d=d.ab.root),(d.mode&61440)===40960&&(!w||a.$a)){if(!d.La.readlink)throw new A(52);d=d.La.readlink(d),d.charAt(0)==="/"||(d=es(f)+"/"+d),s=d+"/"+s.slice(b+1).join("/");continue t}}}return{path:f,node:d}}throw new A(32)}function $e(s){for(var a;;){if(s===s.parent)return s=s.Xa.zb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}}function _e(s,a){for(var l=0,d=0;d<a.length;d++)l=(l<<5)-l+a.charCodeAt(d)|0;return(s+l>>>0)%xt.length}function Ee(s){var a=_e(s.parent.id,s.name);if(xt[a]===s)xt[a]=s.bb;else for(a=xt[a];a;){if(a.bb===s){a.bb=s.bb;break}a=a.bb}}function At(s,a){var l=ot(s.mode)?(l=zt(s,"x"))?l:s.La.lookup?0:2:54;if(l)throw new A(l);for(l=xt[_e(s.id,a)];l;l=l.bb){var d=l.name;if(l.parent.id===s.id&&d===a)return l}return s.La.lookup(s,a)}function us(s,a,l,d){return s=new ea(s,a,l,d),a=_e(s.parent.id,s.name),s.bb=xt[a],xt[a]=s}function ot(s){return(s&61440)===16384}function hs(s){var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a}function zt(s,a){if(cs)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function fs(s,a){if(!ot(s.mode))return 54;try{return At(s,a),20}catch{}return zt(s,"wx")}function ms(s,a,l){try{var d=At(s,a)}catch(f){return f.Pa}if(s=zt(s,"wx"))return s;if(l){if(!ot(d.mode))return 54;if(d===d.parent||$e(d)==="/")return 10}else if(ot(d.mode))return 31;return 0}function se(s){if(!s)throw new A(63);return s}function rt(s){if(s=Ut[s],!s)throw new A(8);return s}function ps(s,a=-1){if(s=Object.assign(new ta,s),a==-1)t:{for(a=0;4096>=a;a++)if(!Ut[a])break t;throw new A(33)}return s.fd=a,Ut[a]=s}function sa(s,a=-1){var l,d;return s=ps(s,a),(d=(l=s.Ma)==null?void 0:l.Rb)==null||d.call(l,s),s}function ke(s,a,l){var d=s==null?void 0:s.Ma.Ua;s=d?s:a,d??(d=a.La.Ua),se(d),d(s,l)}var aa={open(s){var a,l;s.Ma=os[s.node.rdev].Ma,(l=(a=s.Ma).open)==null||l.call(a,s)},Va(){throw new A(70)}};function Me(s,a){os[s]={Ma:a}}function gs(s,a){var l=a==="/";if(l&&Ce)throw new A(10);if(!l&&a){var d=dt(a,{nb:!1});if(a=d.path,d=d.node,d.ab)throw new A(10);if(!ot(d.mode))throw new A(54)}a={type:s,Wb:{},zb:a,Ib:[]},s=s.Xa(a),s.Xa=a,a.root=s,l?Ce=s:d&&(d.ab=a,d.Xa&&d.Xa.Ib.push(a))}function ae(s,a,l){var d=dt(s,{parent:!0}).node;if(s=ee(s),!s)throw new A(28);if(s==="."||s==="..")throw new A(20);var f=fs(d,s);if(f)throw new A(f);if(!d.La.hb)throw new A(63);return d.La.hb(d,s,a,l)}function na(s,a=438){return ae(s,a&4095|32768,0)}function gt(s,a=511){return ae(s,a&1023|16384,0)}function ne(s,a,l){typeof l>"u"&&(l=a,a=438),ae(s,a|8192,l)}function Le(s,a){if(!Qs(s))throw new A(44);var l=dt(a,{parent:!0}).node;if(!l)throw new A(44);a=ee(a);var d=fs(l,a);if(d)throw new A(d);if(!l.La.symlink)throw new A(63);l.La.symlink(l,a,s)}function bs(s){var a=dt(s,{parent:!0}).node;s=ee(s);var l=At(a,s),d=ms(a,s,!0);if(d)throw new A(d);if(!a.La.rmdir)throw new A(63);if(l.ab)throw new A(10);a.La.rmdir(a,s),Ee(l)}function ys(s){var a=dt(s,{parent:!0}).node;if(!a)throw new A(44);s=ee(s);var l=At(a,s),d=ms(a,s,!1);if(d)throw new A(d);if(!a.La.unlink)throw new A(63);if(l.ab)throw new A(10);a.La.unlink(a,s),Ee(l)}function Qt(s,a){return s=dt(s,{$a:!a}).node,se(s.La.Ta)(s)}function vs(s,a,l,d){ke(s,a,{mode:l&4095|a.mode&-4096,ctime:Date.now(),Fb:d})}function ie(s,a){s=typeof s=="string"?dt(s,{$a:!0}).node:s,vs(null,s,a)}function ws(s,a,l){if(ot(a.mode))throw new A(31);if((a.mode&61440)!==32768)throw new A(28);var d=zt(a,"w");if(d)throw new A(d);ke(s,a,{size:l,timestamp:Date.now()})}function Ht(s,a,l=438){if(s==="")throw new A(44);if(typeof a=="string"){var d={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof d>"u")throw Error(`Unknown file open mode: ${a}`);a=d}if(l=a&64?l&4095|32768:0,typeof s=="object")d=s;else{var f=s.endsWith("/");s=dt(s,{$a:!(a&131072),Jb:!0}),d=s.node,s=s.path}var b=!1;if(a&64)if(d){if(a&128)throw new A(20)}else{if(f)throw new A(31);d=ae(s,l|511,0),b=!0}if(!d)throw new A(44);if((d.mode&61440)===8192&&(a&=-513),a&65536&&!ot(d.mode))throw new A(54);if(!b&&(f=d?(d.mode&61440)===40960?32:ot(d.mode)&&(hs(a)!=="r"||a&576)?31:zt(d,hs(a)):44))throw new A(f);return a&512&&!b&&(f=d,f=typeof f=="string"?dt(f,{$a:!0}).node:f,ws(null,f,0)),a&=-131713,f=ps({node:d,path:$e(d),flags:a,seekable:!0,position:0,Ma:d.Ma,Lb:[],error:!1}),f.Ma.open&&f.Ma.open(f),b&&ie(d,l&511),!o.logReadFiles||a&1||s in ds||(ds[s]=1),f}function Ae(s){if(s.fd===null)throw new A(8);s.ob&&(s.ob=null);try{s.Ma.close&&s.Ma.close(s)}catch(a){throw a}finally{Ut[s.fd]=null}s.fd=null}function Ss(s,a,l){if(s.fd===null)throw new A(8);if(!s.seekable||!s.Ma.Va)throw new A(70);if(l!=0&&l!=1&&l!=2)throw new A(28);s.position=s.Ma.Va(s,a,l),s.Lb=[]}function xs(s,a,l,d,f){if(0>d||0>f)throw new A(28);if(s.fd===null)throw new A(8);if((s.flags&2097155)===1)throw new A(8);if(ot(s.node.mode))throw new A(31);if(!s.Ma.read)throw new A(28);var b=typeof f<"u";if(!b)f=s.position;else if(!s.seekable)throw new A(70);return a=s.Ma.read(s,a,l,d,f),b||(s.position+=a),a}function Ts(s,a,l,d,f){if(0>d||0>f)throw new A(28);if(s.fd===null)throw new A(8);if((s.flags&2097155)===0)throw new A(8);if(ot(s.node.mode))throw new A(31);if(!s.Ma.write)throw new A(28);s.seekable&&s.flags&1024&&Ss(s,0,2);var b=typeof f<"u";if(!b)f=s.position;else if(!s.seekable)throw new A(70);return a=s.Ma.write(s,a,l,d,f,void 0),b||(s.position+=a),a}function ia(s){var a,l=Ht(s,l||0);s=Qt(s).size;var d=new Uint8Array(s);return xs(l,d,0,s,0),a=d,Ae(l),a}function Tt(s,a,l){s=xe("/dev/"+s);var d=rs(!!a,!!l);Tt.yb??(Tt.yb=64);var f=Tt.yb++<<8|0;Me(f,{open(b){b.seekable=!1},close(){var b;(b=l==null?void 0:l.buffer)!=null&&b.length&&l(10)},read(b,w,I,V){for(var B=0,et=0;et<V;et++){try{var lt=a()}catch{throw new A(29)}if(lt===void 0&&B===0)throw new A(6);if(lt==null)break;B++,w[I+et]=lt}return B&&(b.node.atime=Date.now()),B},write(b,w,I,V){for(var B=0;B<V;B++)try{l(w[I+B])}catch{throw new A(29)}return V&&(b.node.mtime=b.node.ctime=Date.now()),B}}),ne(s,d,f)}var Z={};function Dt(s,a,l){if(a.charAt(0)==="/")return a;if(s=s===-100?"/":rt(s).path,a.length==0){if(!l)throw new A(44);return s}return s+"/"+a}function re(s,a){W[s>>2]=a.dev,W[s+4>>2]=a.mode,X[s+8>>2]=a.nlink,W[s+12>>2]=a.uid,W[s+16>>2]=a.gid,W[s+20>>2]=a.rdev,H[s+24>>3]=BigInt(a.size),W[s+32>>2]=4096,W[s+36>>2]=a.blocks;var l=a.atime.getTime(),d=a.mtime.getTime(),f=a.ctime.getTime();return H[s+40>>3]=BigInt(Math.floor(l/1e3)),X[s+48>>2]=l%1e3*1e6,H[s+56>>3]=BigInt(Math.floor(d/1e3)),X[s+64>>2]=d%1e3*1e6,H[s+72>>3]=BigInt(Math.floor(f/1e3)),X[s+80>>2]=f%1e3*1e6,H[s+88>>3]=BigInt(a.ino),0}var oe=void 0,le=()=>{var s=W[+oe>>2];return oe+=4,s},De=0,ra=[0,31,60,91,121,152,182,213,244,274,305,335],oa=[0,31,59,90,120,151,181,212,243,273,304,334],Xt={},Cs=s=>{var a;J=s,we||0<De||((a=o.onExit)==null||a.call(o,s),K=!0),S(s,new ve(s))},la=s=>{if(!K)try{if(s(),!(we||0<De))try{J=s=J,Cs(s)}catch(a){a instanceof ve||a=="unwind"||S(1,a)}}catch(a){a instanceof ve||a=="unwind"||S(1,a)}},Ne={},$s=()=>{if(!Re){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:x||"./this.program"},a;for(a in Ne)Ne[a]===void 0?delete s[a]:s[a]=Ne[a];var l=[];for(a in s)l.push(`${a}=${s[a]}`);Re=l}return Re},Re,Oe=s=>{var a=Kt(s)+1,l=$t(a);return yt(s,R,l,a),l},ca=(s,a,l,d)=>{var f={string:B=>{var et=0;return B!=null&&B!==0&&(et=Oe(B)),et},array:B=>{var et=$t(B.length);return L.set(B,et),et}};s=o["_"+s];var b=[],w=0;if(d)for(var I=0;I<d.length;I++){var V=f[l[I]];V?(w===0&&(w=Zt()),b[I]=V(d[I])):b[I]=d[I]}return l=s(...b),l=(function(B){return w!==0&&Jt(w),a==="string"?B?tt(R,B):"":a==="boolean"?!!B:B})(l)},ce=0,de=(s,a)=>(a=a==1?$t(s.length):Fe(s.length),s.subarray||s.slice||(s=new Uint8Array(s)),R.set(s,a),a),Nt,Ie=[],vt,Ct=s=>{Nt.delete(vt.get(s)),vt.set(s,null),Ie.push(s)},Yt=(s,a)=>{if(!Nt){Nt=new WeakMap;var l=vt.length;if(Nt)for(var d=0;d<0+l;d++){var f=vt.get(d);f&&Nt.set(f,d)}}if(l=Nt.get(s)||0)return l;if(Ie.length)l=Ie.pop();else{try{vt.grow(1)}catch(V){throw V instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":V}l=vt.length-1}try{vt.set(l,s)}catch(V){if(!(V instanceof TypeError))throw V;if(typeof WebAssembly.Function=="function"){var b=WebAssembly.Function;d={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:a[0]=="v"?[]:[d[a[0]]]};for(var w=1;w<a.length;++w)f.parameters.push(d[a[w]]);a=new b(f,s)}else{d=[1],f=a.slice(0,1),a=a.slice(1),w={i:127,p:127,j:126,f:125,d:124,e:111},d.push(96);var I=a.length;128>I?d.push(I):d.push(I%128|128,I>>7);for(b of a)d.push(w[b]);f=="v"?d.push(0):d.push(1,w[f]),a=[0,97,115,109,1,0,0,0,1],b=d.length,128>b?a.push(b):a.push(b%128|128,b>>7),a.push(...d),a.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),a=new WebAssembly.Module(new Uint8Array(a)),a=new WebAssembly.Instance(a,{e:{f:s}}).exports.f}vt.set(l,a)}return Nt.set(s,l),l};xt=Array(4096),gs(z,"/"),gt("/tmp"),gt("/home"),gt("/home/web_user"),(function(){gt("/dev"),Me(259,{read:()=>0,write:(d,f,b,w)=>w,Va:()=>0}),ne("/dev/null",259),is(1280,Ys),is(1536,Js),ne("/dev/tty",1280),ne("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,l=()=>(a===0&&(ss(s),a=s.byteLength),s[--a]);Tt("random",l),Tt("urandom",l),gt("/dev/shm"),gt("/dev/shm/tmp")})(),(function(){gt("/proc");var s=gt("/proc/self");gt("/proc/self/fd"),gs({Xa(){var a=us(s,"fd",16895,73);return a.Ma={Va:z.Ma.Va},a.La={lookup(l,d){l=+d;var f=rt(l);return l={parent:null,Xa:{zb:"fake"},La:{readlink:()=>f.path},id:l+1},l.parent=l},readdir(){return Array.from(Ut.entries()).filter(([,l])=>l).map(([l])=>l.toString())}},a}},"/proc/self/fd")})(),z.vb=new A(44),z.vb.stack="<generic error, no stack>";var da={a:(s,a,l,d)=>qt(`Assertion failed: ${s?tt(R,s):""}, at: `+[a?a?tt(R,a):"":"unknown filename",l,d?d?tt(R,d):"":"unknown function"]),i:function(s,a){try{return s=s?tt(R,s):"",ie(s,a),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},L:function(s,a,l){try{if(a=a?tt(R,a):"",a=Dt(s,a),l&-8)return-28;var d=dt(a,{$a:!0}).node;return d?(s="",l&4&&(s+="r"),l&2&&(s+="w"),l&1&&(s+="x"),s&&zt(d,s)?-2:0):-44}catch(f){if(typeof Z>"u"||f.name!=="ErrnoError")throw f;return-f.Pa}},j:function(s,a){try{var l=rt(s);return vs(l,l.node,a,!1),0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},h:function(s){try{var a=rt(s);return ke(a,a.node,{timestamp:Date.now(),Fb:!1}),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},b:function(s,a,l){oe=l;try{var d=rt(s);switch(a){case 0:var f=le();if(0>f)break;for(;Ut[f];)f++;return sa(d,f).fd;case 1:case 2:return 0;case 3:return d.flags;case 4:return f=le(),d.flags|=f,0;case 12:return f=le(),at[f+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},g:function(s,a){try{var l=rt(s),d=l.node,f=l.Ma.Ta;s=f?l:d,f??(f=d.La.Ta),se(f);var b=f(s);return re(a,b)}catch(w){if(typeof Z>"u"||w.name!=="ErrnoError")throw w;return-w.Pa}},H:function(s,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{if(isNaN(a))return 61;var l=rt(s);if(0>a||(l.flags&2097155)===0)throw new A(28);return ws(l,l.node,a),0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},G:function(s,a){try{if(a===0)return-28;var l=Kt("/")+1;return a<l?-68:(yt("/",R,s,a),l)}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},K:function(s,a){try{return s=s?tt(R,s):"",re(a,Qt(s,!0))}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},C:function(s,a,l){try{return a=a?tt(R,a):"",a=Dt(s,a),gt(a,l),0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},J:function(s,a,l,d){try{a=a?tt(R,a):"";var f=d&256;return a=Dt(s,a,d&4096),re(l,f?Qt(a,!0):Qt(a))}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},x:function(s,a,l,d){oe=d;try{a=a?tt(R,a):"",a=Dt(s,a);var f=d?le():0;return Ht(a,l,f).fd}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},v:function(s,a,l,d){try{if(a=a?tt(R,a):"",a=Dt(s,a),0>=d)return-28;var f=dt(a).node;if(!f)throw new A(44);if(!f.La.readlink)throw new A(28);var b=f.La.readlink(f),w=Math.min(d,Kt(b)),I=L[l+w];return yt(b,R,l,d+1),L[l+w]=I,w}catch(V){if(typeof Z>"u"||V.name!=="ErrnoError")throw V;return-V.Pa}},u:function(s){try{return s=s?tt(R,s):"",bs(s),0}catch(a){if(typeof Z>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},f:function(s,a){try{return s=s?tt(R,s):"",re(a,Qt(s))}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},r:function(s,a,l){try{return a=a?tt(R,a):"",a=Dt(s,a),l===0?ys(a):l===512?bs(a):qt("Invalid flags passed to unlinkat"),0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},q:function(s,a,l){try{a=a?tt(R,a):"",a=Dt(s,a,!0);var d=Date.now(),f,b;if(l){var w=X[l>>2]+4294967296*W[l+4>>2],I=W[l+8>>2];I==1073741823?f=d:I==1073741822?f=null:f=1e3*w+I/1e6,l+=16,w=X[l>>2]+4294967296*W[l+4>>2],I=W[l+8>>2],I==1073741823?b=d:I==1073741822?b=null:b=1e3*w+I/1e6}else b=f=d;if((b??f)!==null){s=f;var V=dt(a,{$a:!0}).node;se(V.La.Ua)(V,{atime:s,mtime:b})}return 0}catch(B){if(typeof Z>"u"||B.name!=="ErrnoError")throw B;return-B.Pa}},m:()=>qt(""),l:()=>{we=!1,De=0},A:function(s,a){s=-9007199254740992>s||9007199254740992<s?NaN:Number(s),s=new Date(1e3*s),W[a>>2]=s.getSeconds(),W[a+4>>2]=s.getMinutes(),W[a+8>>2]=s.getHours(),W[a+12>>2]=s.getDate(),W[a+16>>2]=s.getMonth(),W[a+20>>2]=s.getFullYear()-1900,W[a+24>>2]=s.getDay();var l=s.getFullYear();W[a+28>>2]=(l%4!==0||l%100===0&&l%400!==0?oa:ra)[s.getMonth()]+s.getDate()-1|0,W[a+36>>2]=-(60*s.getTimezoneOffset()),l=new Date(s.getFullYear(),6,1).getTimezoneOffset();var d=new Date(s.getFullYear(),0,1).getTimezoneOffset();W[a+32>>2]=(l!=d&&s.getTimezoneOffset()==Math.min(d,l))|0},y:function(s,a,l,d,f,b,w){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var I=rt(d);if((a&2)!==0&&(l&2)===0&&(I.flags&2097155)!==2)throw new A(2);if((I.flags&2097155)===1)throw new A(2);if(!I.Ma.ib)throw new A(43);if(!s)throw new A(28);var V=I.Ma.ib(I,s,f,a,l),B=V.Kb;return W[b>>2]=V.Ab,X[w>>2]=B,0}catch(et){if(typeof Z>"u"||et.name!=="ErrnoError")throw et;return-et.Pa}},z:function(s,a,l,d,f,b){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b);try{var w=rt(f);if(l&2){if(l=b,(w.node.mode&61440)!==32768)throw new A(43);if(!(d&2)){var I=R.slice(s,s+a);w.Ma.jb&&w.Ma.jb(w,I,l,a,d)}}}catch(V){if(typeof Z>"u"||V.name!=="ErrnoError")throw V;return-V.Pa}},n:(s,a)=>{if(Xt[s]&&(clearTimeout(Xt[s].id),delete Xt[s]),!a)return 0;var l=setTimeout(()=>{delete Xt[s],la(()=>Es(s,performance.now()))},a);return Xt[s]={id:l,Xb:a},0},B:(s,a,l,d)=>{var f=new Date().getFullYear(),b=new Date(f,0,1).getTimezoneOffset();f=new Date(f,6,1).getTimezoneOffset(),X[s>>2]=60*Math.max(b,f),W[a>>2]=+(b!=f),a=w=>{var I=Math.abs(w);return`UTC${0<=w?"-":"+"}${String(Math.floor(I/60)).padStart(2,"0")}${String(I%60).padStart(2,"0")}`},s=a(b),a=a(f),f<b?(yt(s,R,l,17),yt(a,R,d,17)):(yt(s,R,d,17),yt(a,R,l,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:s=>{var a=R.length;if(s>>>=0,2147483648<s)return!1;for(var l=1;4>=l;l*=2){var d=a*(1+.2/l);d=Math.min(d,s+100663296);t:{d=(Math.min(2147483648,65536*Math.ceil(Math.max(s,d)/65536))-j.buffer.byteLength+65535)/65536|0;try{j.grow(d),it();var f=1;break t}catch{}f=void 0}if(f)return!0}return!1},E:(s,a)=>{var l=0;return $s().forEach((d,f)=>{var b=a+l;for(f=X[s+4*f>>2]=b,b=0;b<d.length;++b)L[f++]=d.charCodeAt(b);L[f]=0,l+=d.length+1}),0},F:(s,a)=>{var l=$s();X[s>>2]=l.length;var d=0;return l.forEach(f=>d+=f.length+1),X[a>>2]=d,0},e:function(s){try{var a=rt(s);return Ae(a),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return l.Pa}},p:function(s,a){try{var l=rt(s);return L[a]=l.tty?2:ot(l.mode)?3:(l.mode&61440)===40960?7:4,at[a+2>>1]=0,H[a+8>>3]=BigInt(0),H[a+16>>3]=BigInt(0),0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return d.Pa}},w:function(s,a,l,d){try{t:{var f=rt(s);s=a;for(var b,w=a=0;w<l;w++){var I=X[s>>2],V=X[s+4>>2];s+=8;var B=xs(f,L,I,V,b);if(0>B){var et=-1;break t}if(a+=B,B<V)break;typeof b<"u"&&(b+=B)}et=a}return X[d>>2]=et,0}catch(lt){if(typeof Z>"u"||lt.name!=="ErrnoError")throw lt;return lt.Pa}},D:function(s,a,l,d){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{if(isNaN(a))return 61;var f=rt(s);return Ss(f,a,l),H[d>>3]=BigInt(f.position),f.ob&&a===0&&l===0&&(f.ob=null),0}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return b.Pa}},I:function(s){var l;try{var a=rt(s);return(l=a.Ma)!=null&&l.fsync?a.Ma.fsync(a):0}catch(d){if(typeof Z>"u"||d.name!=="ErrnoError")throw d;return d.Pa}},t:function(s,a,l,d){try{t:{var f=rt(s);s=a;for(var b,w=a=0;w<l;w++){var I=X[s>>2],V=X[s+4>>2];s+=8;var B=Ts(f,L,I,V,b);if(0>B){var et=-1;break t}if(a+=B,B<V)break;typeof b<"u"&&(b+=B)}et=a}return X[d>>2]=et,0}catch(lt){if(typeof Z>"u"||lt.name!=="ErrnoError")throw lt;return lt.Pa}},k:Cs},F;(async function(){var l;function s(d){var f;return F=d.exports,j=F.M,it(),vt=F.O,pt--,(f=o.monitorRunDependencies)==null||f.call(o,pt),pt==0&&Lt&&(d=Lt,Lt=null,d()),F}pt++,(l=o.monitorRunDependencies)==null||l.call(o,pt);var a={a:da};return o.instantiateWasm?new Promise(d=>{o.instantiateWasm(a,(f,b)=>{s(f),d(f.exports)})}):(ye??(ye=o.locateFile?o.locateFile("sql-wasm.wasm",v):v+"sql-wasm.wasm"),s((await Gs(a)).instance))})(),o._sqlite3_free=s=>(o._sqlite3_free=F.P)(s),o._sqlite3_value_text=s=>(o._sqlite3_value_text=F.Q)(s),o._sqlite3_prepare_v2=(s,a,l,d,f)=>(o._sqlite3_prepare_v2=F.R)(s,a,l,d,f),o._sqlite3_step=s=>(o._sqlite3_step=F.S)(s),o._sqlite3_reset=s=>(o._sqlite3_reset=F.T)(s),o._sqlite3_exec=(s,a,l,d,f)=>(o._sqlite3_exec=F.U)(s,a,l,d,f),o._sqlite3_finalize=s=>(o._sqlite3_finalize=F.V)(s),o._sqlite3_column_name=(s,a)=>(o._sqlite3_column_name=F.W)(s,a),o._sqlite3_column_text=(s,a)=>(o._sqlite3_column_text=F.X)(s,a),o._sqlite3_column_type=(s,a)=>(o._sqlite3_column_type=F.Y)(s,a),o._sqlite3_errmsg=s=>(o._sqlite3_errmsg=F.Z)(s),o._sqlite3_clear_bindings=s=>(o._sqlite3_clear_bindings=F._)(s),o._sqlite3_value_blob=s=>(o._sqlite3_value_blob=F.$)(s),o._sqlite3_value_bytes=s=>(o._sqlite3_value_bytes=F.aa)(s),o._sqlite3_value_double=s=>(o._sqlite3_value_double=F.ba)(s),o._sqlite3_value_int=s=>(o._sqlite3_value_int=F.ca)(s),o._sqlite3_value_type=s=>(o._sqlite3_value_type=F.da)(s),o._sqlite3_result_blob=(s,a,l,d)=>(o._sqlite3_result_blob=F.ea)(s,a,l,d),o._sqlite3_result_double=(s,a)=>(o._sqlite3_result_double=F.fa)(s,a),o._sqlite3_result_error=(s,a,l)=>(o._sqlite3_result_error=F.ga)(s,a,l),o._sqlite3_result_int=(s,a)=>(o._sqlite3_result_int=F.ha)(s,a),o._sqlite3_result_int64=(s,a)=>(o._sqlite3_result_int64=F.ia)(s,a),o._sqlite3_result_null=s=>(o._sqlite3_result_null=F.ja)(s),o._sqlite3_result_text=(s,a,l,d)=>(o._sqlite3_result_text=F.ka)(s,a,l,d),o._sqlite3_aggregate_context=(s,a)=>(o._sqlite3_aggregate_context=F.la)(s,a),o._sqlite3_column_count=s=>(o._sqlite3_column_count=F.ma)(s),o._sqlite3_data_count=s=>(o._sqlite3_data_count=F.na)(s),o._sqlite3_column_blob=(s,a)=>(o._sqlite3_column_blob=F.oa)(s,a),o._sqlite3_column_bytes=(s,a)=>(o._sqlite3_column_bytes=F.pa)(s,a),o._sqlite3_column_double=(s,a)=>(o._sqlite3_column_double=F.qa)(s,a),o._sqlite3_bind_blob=(s,a,l,d,f)=>(o._sqlite3_bind_blob=F.ra)(s,a,l,d,f),o._sqlite3_bind_double=(s,a,l)=>(o._sqlite3_bind_double=F.sa)(s,a,l),o._sqlite3_bind_int=(s,a,l)=>(o._sqlite3_bind_int=F.ta)(s,a,l),o._sqlite3_bind_text=(s,a,l,d,f)=>(o._sqlite3_bind_text=F.ua)(s,a,l,d,f),o._sqlite3_bind_parameter_index=(s,a)=>(o._sqlite3_bind_parameter_index=F.va)(s,a),o._sqlite3_sql=s=>(o._sqlite3_sql=F.wa)(s),o._sqlite3_normalized_sql=s=>(o._sqlite3_normalized_sql=F.xa)(s),o._sqlite3_changes=s=>(o._sqlite3_changes=F.ya)(s),o._sqlite3_close_v2=s=>(o._sqlite3_close_v2=F.za)(s),o._sqlite3_create_function_v2=(s,a,l,d,f,b,w,I,V)=>(o._sqlite3_create_function_v2=F.Aa)(s,a,l,d,f,b,w,I,V),o._sqlite3_update_hook=(s,a,l)=>(o._sqlite3_update_hook=F.Ba)(s,a,l),o._sqlite3_open=(s,a)=>(o._sqlite3_open=F.Ca)(s,a);var Fe=o._malloc=s=>(Fe=o._malloc=F.Da)(s),ue=o._free=s=>(ue=o._free=F.Ea)(s);o._RegisterExtensionFunctions=s=>(o._RegisterExtensionFunctions=F.Fa)(s);var _s=(s,a)=>(_s=F.Ga)(s,a),Es=(s,a)=>(Es=F.Ha)(s,a),Jt=s=>(Jt=F.Ia)(s),$t=s=>($t=F.Ja)(s),Zt=()=>(Zt=F.Ka)();o.stackSave=()=>Zt(),o.stackRestore=s=>Jt(s),o.stackAlloc=s=>$t(s),o.cwrap=(s,a,l,d)=>{var f=!l||l.every(b=>b==="number"||b==="boolean");return a!=="string"&&f&&!d?o["_"+s]:(...b)=>ca(s,a,l,b)},o.addFunction=Yt,o.removeFunction=Ct,o.UTF8ToString=Se,o.ALLOC_NORMAL=ce,o.allocate=de,o.allocateUTF8OnStack=Oe;function Pe(){function s(){var f;if(o.calledRun=!0,!K){if(!o.noFSInit&&!ls){var a,l;ls=!0,d??(d=o.stdin),a??(a=o.stdout),l??(l=o.stderr),d?Tt("stdin",d):Le("/dev/tty","/dev/stdin"),a?Tt("stdout",null,a):Le("/dev/tty","/dev/stdout"),l?Tt("stderr",null,l):Le("/dev/tty1","/dev/stderr"),Ht("/dev/stdin",0),Ht("/dev/stdout",1),Ht("/dev/stderr",1)}if(F.N(),cs=!1,(f=o.onRuntimeInitialized)==null||f.call(o),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var d=o.postRun.shift();Ye.unshift(d)}Xe(Ye)}}if(0<pt)Lt=Pe;else{if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)Ws();Xe(Je),0<pt?Lt=Pe:o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),s()},1)):s()}}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return Pe(),h}),e)};k.exports=n,k.exports.default=n})(qe)),qe.exports}var Wa=Ga();const Ka=za(Wa),te=100,Ve=0,Qa="https://sql.js.org/dist/",fe={berdl_tables:{configId:"berdl_tables",configPath:"/config/berdl-tables.json",version:"1.0.0",description:"BERDL tables configuration"},genome_data_tables:{configId:"genome_data_tables",configPath:"/config/genome-data-tables.json",version:"1.0.0",description:"Genome data tables configuration"}},Ot={"/data/berdl_tables.db":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"},"/data/berdl_tables_ecoli_562_61143.db":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/0":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/1":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"}},Ue={},Ge={debug:0,info:1,warn:2,error:3};function Xa(){var t;const k=(t=Ue==null?void 0:Ue.VITE_LOG_LEVEL)==null?void 0:t.toLowerCase();return k&&k in Ge?k:"warn"}const Ya=Xa();function me(k){return Ge[k]>=Ge[Ya]}function _t(k,t){return`[${new Date().toISOString()}] [${k}] ${t}`}const Q={debug(k,t){me("debug")&&(t!==void 0?console.info(_t("DEBUG",k),t):console.info(_t("DEBUG",k)))},info(k,t){me("info")&&(t!==void 0?console.info(_t("INFO",k),t):console.info(_t("INFO",k)))},warn(k,t){me("warn")&&(t!==void 0?console.warn(_t("WARN",k),t):console.warn(_t("WARN",k)))},error(k,t){me("error")&&(t!==void 0?console.error(_t("ERROR",k),t):console.error(_t("ERROR",k)))}},ht=class ht{constructor(){T(this,"db",null);T(this,"currentDbPath",null);T(this,"sqlPromise",null)}static getInstance(){return ht.instance||(ht.instance=new ht),ht.instance}static isLocalDb(t){return t in Ot||t.startsWith("local/")}static getConfigDefinition(t){return fe[t]||null}static getDatabaseMapping(t){return Ot[t]||null}static getConfigPath(t){const e=Ot[t];if(!e){if(t.startsWith("/data/")||t.startsWith("./data/")){const i=t.startsWith("./")?t.substring(2):t,r=Ot[i];if(r){const u=fe[r.configId];return r.configPath||(u==null?void 0:u.configPath)||null}}return null}const n=fe[e.configId];return n?e.configPath||n.configPath:null}static getDatabasePath(t){const e=Ot[t];return e?e.dbPath:t.startsWith("/data/")||t.startsWith("./data/")?t.startsWith("./")?t.substring(2):t:t.startsWith("local/")?`/data/${t.replace("local/","")}.db`:null}static getAllConfigDefinitions(){return{...fe}}static getAllDatabaseMappings(){return{...Ot}}static getDatabasesForConfig(t){return Object.values(Ot).filter(e=>e.configId===t)}async initSql(){return this.sqlPromise||(this.sqlPromise=Ka({locateFile:t=>`${Qa}${t}`})),this.sqlPromise}async loadDatabase(t){if(this.db&&this.currentDbPath===t)return;this.db&&(this.db.close(),this.db=null);const e=await this.initSql(),n=await fetch(t);if(!n.ok)throw new Error(`Failed to load database: ${n.status} ${n.statusText}`);const i=await n.arrayBuffer();this.db=new e.Database(new Uint8Array(i)),this.currentDbPath=t}async loadDatabaseFromBuffer(t,e="uploaded.db"){this.db&&(this.db.close(),this.db=null);const n=await this.initSql();this.db=new n.Database(new Uint8Array(t)),this.currentDbPath=e}async listTables(t){let e=null,n=null;if(e=ht.getDatabasePath(t),n=ht.getConfigPath(t),!e&&t.startsWith("local/")){const r=t.replace("local/","");e=`/data/${r}.db`,n=ht.getConfigPath(`/data/${r}.db`)||`/config/${r}.json`}if(!e)throw new Error(`Unknown local database: ${t}`);if(await this.loadDatabase(e),!this.db)throw new Error("Database not loaded");let i={};if(n)try{const r=await fetch(n);r.ok&&(i=await r.json())}catch(r){Q.warn("Failed to load config",r)}return this.listTablesFromDb(e,i)}async listTablesFromDb(t,e={}){var r;if(!e||Object.keys(e).length===0){const u=ht.getConfigPath(t);if(u)try{const h=await fetch(u);h.ok&&(e=await h.json())}catch(h){console.warn("Failed to load config:",h)}}if(await this.loadDatabase(t),!this.db)throw new Error("Database not loaded");const n=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),i=[];if(n.length>0&&n[0].values)for(const u of n[0].values){const h=u[0],c=this.db.exec(`SELECT COUNT(*) FROM "${h}"`),o=c.length>0?c[0].values[0][0]:0,p=this.db.exec(`PRAGMA table_info("${h}")`),m=p.length>0?p[0].values.length:0,y=(r=e.tables)==null?void 0:r[h];i.push({name:h,displayName:(y==null?void 0:y.displayName)||h,row_count:o,column_count:m,description:y==null?void 0:y.description})}return{tables:i,type:"berdl_tables",object_type:"KBaseFBA.GenomeDataLakeTables-2.0"}}async getTableData(t,e){let n=null;if(n=ht.getDatabasePath(t),!n&&t.startsWith("local/")&&(this.currentDbPath?n=this.currentDbPath:n=`/data/${t.replace("local/","")}.db`),!n)throw new Error(`Unknown local database: ${t}`);if(await this.loadDatabase(n),!this.db)throw new Error("Database not loaded");const i=e.table_name,r=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'");if(!(r.length>0?r[0].values.map(H=>H[0]):[]).includes(i))throw new Error(`Table "${i}" not found in database`);const h=e.limit||te,c=e.offset||0;let o="*";if(e.columns&&e.columns.length>0){const H=this.db.exec(`PRAGMA table_info("${i}")`),st=H.length>0?H[0].values.map(it=>it[1]):[],nt=e.columns.filter(it=>st.includes(it));if(nt.length===0&&e.columns.length>0)throw new Error(`None of the requested columns exist in table "${i}"`);o=nt.map(it=>`"${it}"`).join(", ")}if(e.aggregations&&e.aggregations.length>0)return this.getAggregatedData(e);const p=[],m=[],y=this.db.exec(`PRAGMA table_info("${i}")`),E={};if(y.length>0)for(const H of y[0].values){const st=H[1],nt=(H[2]||"TEXT").toUpperCase();E[st]=nt}if(e.filters&&e.filters.length>0){const H=this.buildAdvancedFiltersWithTypes(e.filters,m,E);p.push(...H)}if(e.search_value&&e.search_value.trim()){const H=this.db.exec(`PRAGMA table_info("${i}")`);if(H.length>0){const st=H[0].values.map(it=>`CAST("${it[1]}" AS TEXT) LIKE ?`);p.push(`(${st.join(" OR ")})`);const nt=`%${e.search_value}%`;for(let it=0;it<H[0].values.length;it++)m.push(nt)}}if(e.col_filter){const H=new Set((e.filters||[]).map(st=>st.column));for(const[st,nt]of Object.entries(e.col_filter))!H.has(st)&&nt!==void 0&&nt!==null&&nt!==""&&(p.push(`CAST("${st}" AS TEXT) LIKE ?`),m.push(`%${nt}%`))}const x=p.length>0?`WHERE ${p.join(" AND ")}`:"";let S="";if(e.sort_column){const H=e.sort_order||"ASC";S=`ORDER BY "${e.sort_column}" ${H}`}const v=`SELECT COUNT(*) FROM "${i}" ${x}`,$=this.db.prepare(v);m.length>0&&$.bind(m),$.step();const M=$.get()[0];$.free();const N=`SELECT ${o} FROM "${i}" ${x} ${S} LIMIT ? OFFSET ?`,G=[...m,h,c],D=this.db.prepare(N);D.bind(G);const q=[],j=[];for(;D.step();){const H=D.get();if(q.length===0){const st=D.getColumnNames();q.push(...st)}j.push(H)}D.free();const K=this.db.exec(`PRAGMA table_info("${i}")`),J=[];if(K.length>0)for(const H of K[0].values){const st=H[1],nt=H[2]||"TEXT",it=H[3]===1,pt=H[4],Lt=H[5]===1;J.push({name:st,type:nt,notnull:it,pk:Lt,dflt_value:pt}),q.length===0&&q.push(st)}const L=e.columns,R=L&&L.length>0?J.filter(H=>L.includes(H.name)):J,at=p.length>0?`WHERE ${p.join(" AND ")}`:"",W=e.sort_column?`ORDER BY "${e.sort_column}" ${e.sort_order||"ASC"}`:"",St={query_type:"select",sql:`SELECT ${o} FROM "${i}" ${at} ${W} LIMIT ? OFFSET ?`,filters_applied:p.length,has_search:!!e.search_value,has_sort:!!e.sort_column,has_group_by:!1,has_aggregations:!1};return{headers:q,data:j,total_count:M,column_types:R,column_schema:R,query_metadata:St,limit:h,offset:c,table_name:i}}buildAdvancedFiltersWithTypes(t,e,n){const i=[];for(const r of t){const{column:u,operator:h,value:c,value2:o}=r,p=n[u]||"TEXT",m=p.includes("INT")||p.includes("REAL")||p.includes("NUMERIC");let y=c,E=o;if(m&&(h==="eq"||h==="ne"||h==="gt"||h==="gte"||h==="lt"||h==="lte"||h==="between")){if(typeof c=="string"){const S=parseFloat(c);!isNaN(S)&&isFinite(S)&&(y=p.includes("INT")?Math.floor(S):S)}else typeof c=="number"&&(y=p.includes("INT")?Math.floor(c):c);if(o!==void 0)if(typeof o=="string"){const S=parseFloat(o);!isNaN(S)&&isFinite(S)&&(E=p.includes("INT")?Math.floor(S):S)}else typeof o=="number"&&(E=p.includes("INT")?Math.floor(o):o)}let x="";switch(h){case"eq":x=`"${u}" = ?`,e.push(y);break;case"ne":x=`"${u}" != ?`,e.push(y);break;case"gt":x=`"${u}" > ?`,e.push(y);break;case"gte":x=`"${u}" >= ?`,e.push(y);break;case"lt":x=`"${u}" < ?`,e.push(y);break;case"lte":x=`"${u}" <= ?`,e.push(y);break;case"like":x=`"${u}" LIKE ?`,e.push(`%${c}%`);break;case"ilike":x=`LOWER("${u}") LIKE LOWER(?)`,e.push(`%${c}%`);break;case"in":if(Array.isArray(c)&&c.length>0){const S=c.map(()=>"?").join(",");x=`"${u}" IN (${S})`,e.push(...c)}break;case"not_in":if(Array.isArray(c)&&c.length>0){const S=c.map(()=>"?").join(",");x=`"${u}" NOT IN (${S})`,e.push(...c)}break;case"between":E!==void 0&&(x=`"${u}" BETWEEN ? AND ?`,e.push(y,E));break;case"is_null":x=`"${u}" IS NULL`;break;case"is_not_null":x=`"${u}" IS NOT NULL`;break;case"regex":x=`"${u}" LIKE ?`,e.push(`%${c}%`);break}x&&i.push(x)}return i}async getAggregatedData(t){if(!this.db)throw new Error("Database not loaded");const e=t.table_name,n=[];t.group_by&&t.group_by.length>0&&n.push(...t.group_by.map(L=>`"${L}"`));for(const L of t.aggregations||[]){let R="";switch(L.function){case"count":R=`COUNT(${L.column==="*"?"*":`"${L.column}"`})`;break;case"sum":R=`SUM("${L.column}")`;break;case"avg":R=`AVG("${L.column}")`;break;case"min":R=`MIN("${L.column}")`;break;case"max":R=`MAX("${L.column}")`;break;case"stddev":R=`(AVG("${L.column}" * "${L.column}") - AVG("${L.column}") * AVG("${L.column}"))`;break;case"variance":R=`(AVG("${L.column}" * "${L.column}") - AVG("${L.column}") * AVG("${L.column}"))`;break;case"distinct_count":R=`COUNT(DISTINCT "${L.column}")`;break}const at=L.alias||`${L.function}_${L.column}`;n.push(`${R} AS "${at}"`)}const i=n.join(", "),r=[],u=[],h=this.db.exec(`PRAGMA table_info("${e}")`),c={};if(h.length>0)for(const L of h[0].values){const R=L[1],at=(L[2]||"TEXT").toUpperCase();c[R]=at}if(t.filters&&t.filters.length>0){const L=this.buildAdvancedFiltersWithTypes(t.filters,u,c);r.push(...L)}const o=r.length>0?`WHERE ${r.join(" AND ")}`:"",p=t.group_by&&t.group_by.length>0?`GROUP BY ${t.group_by.map(L=>`"${L}"`).join(", ")}`:"";let m="";if(t.sort_column){const L=t.sort_order||"ASC";m=`ORDER BY "${t.sort_column}" ${L}`}const y=`SELECT ${i} FROM "${e}" ${o} ${p} ${m} LIMIT ? OFFSET ?`,E=[...u,t.limit||te,t.offset||Ve],x=this.db.prepare(y);x.bind(E);const S=[],v=[];for(;x.step();){const L=x.get();S.length===0&&S.push(...x.getColumnNames()),v.push(L)}x.free();const $=`SELECT COUNT(*) as count FROM (SELECT ${i} FROM "${e}" ${o} ${p})`,M=this.db.prepare($);u.length>0&&M.bind(u),M.step();const N=M.get()[0];M.free();const G=[];if(t.group_by&&t.group_by.length>0){const L=this.db.exec(`PRAGMA table_info("${e}")`);if(L.length>0)for(const R of L[0].values){const at=R[1];t.group_by.includes(at)&&G.push({name:at,type:R[2]||"TEXT",notnull:R[3]===1,pk:R[5]===1,dflt_value:R[4]})}}t.aggregations&&t.aggregations.forEach(L=>{G.push({name:L.alias||`${L.function}_${L.column}`,type:L.function==="count"||L.function==="distinct_count"?"INTEGER":"REAL",notnull:!1,pk:!1,dflt_value:null})});const D=r.length>0?`WHERE ${r.join(" AND ")}`:"",q=t.group_by&&t.group_by.length>0?`GROUP BY ${t.group_by.map(L=>`"${L}"`).join(", ")}`:"",j=t.sort_column?`ORDER BY "${t.sort_column}" ${t.sort_order||"ASC"}`:"",J={query_type:"aggregate",sql:`SELECT ${i} FROM "${e}" ${D} ${q} ${j} LIMIT ? OFFSET ?`,filters_applied:r.length,has_search:!1,has_sort:!!t.sort_column,has_group_by:!!(t.group_by&&t.group_by.length>0),has_aggregations:!!(t.aggregations&&t.aggregations.length>0)};return{headers:S,data:v,total_count:N,column_types:G.length>0?G:void 0,column_schema:G.length>0?G:void 0,query_metadata:J,limit:t.limit||te,offset:t.offset||0,table_name:e}}async getTableSchema(t){if(!this.db)throw new Error("Database not loaded");const e=this.db.exec(`PRAGMA table_info("${t}")`);return e.length===0||!e[0].values?[]:e[0].values.map(n=>({name:n[1],type:n[2]||"TEXT",notnull:n[3]===1,pk:n[5]===1}))}async getAllSchemas(){if(!this.db)throw new Error("Database not loaded");const t=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),e={};if(t.length>0&&t[0].values)for(const n of t[0].values){const i=n[0];e[i]=await this.getTableSchema(i)}return e}close(){this.db&&(this.db.close(),this.db=null,this.currentDbPath=null)}};T(ht,"instance",null);let kt=ht;const Bt=Object.freeze(Object.defineProperty({__proto__:null,LocalDbClient:kt},Symbol.toStringTag,{value:"Module"})),ze={};class qs{constructor(t={}){T(this,"baseUrl");T(this,"token");T(this,"environment");T(this,"customHeaders");T(this,"cache");T(this,"cacheTTL");T(this,"localDb");this.environment=t.environment||"appdev",t.apiConfig?(this.baseUrl=t.apiConfig.url,this.customHeaders=t.apiConfig.headers||{}):(this.baseUrl=t.baseUrl||this.getDefaultUrl(this.environment),this.customHeaders=t.headers||{}),this.token=t.token||null,this.cache=new Map,this.cacheTTL=3e5,this.localDb=kt.getInstance()}async getTableSchema(t,e){if(kt.isLocalDb(t))return await this.localDb.getTableSchema(e);try{const n=await this.request(`/schema/${t}/tables/${e}`,"GET",void 0,!0);if(n&&Array.isArray(n.columns))return n.columns;if(Array.isArray(n))return n}catch(n){console.warn("[ApiClient] Remote schema fetch failed, falling back to local if available",n)}return kt.isLocalDb(t)?this.localDb.getTableSchema(e):[]}getDefaultUrl(t){const e=(ze==null?void 0:ze.VITE_API_URL)||typeof window<"u"&&window.__API_URL__;if(e)return e;const n={appdev:"https://appdev.kbase.us/services/berdl_table_scanner",prod:"https://kbase.us/services/berdl_table_scanner",local:"http://127.0.0.1:8000"};return n[t]||n.appdev}getHeaders(){const t={"Content-Type":"application/json",Accept:"application/json",...this.customHeaders};return this.token&&(t.Authorization=this.token),t}getCacheKey(t,e){return`${t}:${JSON.stringify(e||{})}`}getFromCache(t){const e=this.cache.get(t);return e&&Date.now()-e.timestamp<this.cacheTTL?e.data:null}setCache(t,e){this.cache.set(t,{data:e,timestamp:Date.now()})}clearCache(){this.cache.clear()}setToken(t){this.token=t,this.clearCache()}updateConfig(t){this.baseUrl=t.url,this.customHeaders=t.headers||{},this.clearCache()}setEnvironment(t){this.environment=t,this.baseUrl=this.getDefaultUrl(t),this.clearCache()}async request(t,e,n,i=!1){const r=this.getCacheKey(t,n);if(i&&e==="GET"){const m=this.getFromCache(r);if(m)return m}if(i&&e==="POST"){const m=this.getFromCache(r);if(m)return m}const u=t.startsWith("http")?t:`${this.baseUrl}${t}`,h={method:e,headers:this.getHeaders()};let c=u;if(n)if(e==="GET"){const m=new URL(u);Object.entries(n).forEach(([y,E])=>{E!=null&&m.searchParams.set(y,String(E))}),c=m.toString()}else h.body=JSON.stringify(n);const o=await fetch(c,h);if(!o.ok){let m=`HTTP ${o.status}`;try{const y=await o.json();m=y.detail||y.message||m}catch{m=`${m}: ${o.statusText}`}throw new Error(m)}const p=await o.json();return i&&this.setCache(r,p),p}async listTables(t){if(kt.isLocalDb(t)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&t.startsWith("local/"))try{const n=t.replace("local/","");return this.request(`${this.baseUrl}/object/${n}/tables`,"GET",void 0,!0)}catch(n){return console.warn("[ApiClient] Remote TableScanner API failed, falling back to client-side:",n),this.localDb.listTables(t)}return this.localDb.listTables(t)}return this.request(`/object/${t}/tables`,"GET",void 0,!0)}async getTableData(t){if(kt.isLocalDb(t.berdl_table_id)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&t.berdl_table_id.startsWith("local/"))try{const i=t.berdl_table_id.replace("local/",""),r={...t,berdl_table_id:`local/${i}`,limit:t.limit||te,offset:t.offset||Ve};return this.request(`${this.baseUrl}/table-data`,"POST",r,!1)}catch(i){return console.warn("[ApiClient] Remote TableScanner API failed, falling back to client-side:",i),this.localDb.getTableData(t.berdl_table_id,t)}return this.localDb.getTableData(t.berdl_table_id,t)}const e={...t,limit:t.limit||te,offset:t.offset||Ve,kb_env:this.environment};return this.request("/table-data","POST",e,!1)}async getSchema(t){try{return await this.request(`/schema/${t}/tables`,"GET",void 0,!0)}catch{return null}}}class Hs{constructor(){T(this,"registry");T(this,"schemaMatchCache",new Map);T(this,"defaultConfigCache",null);this.registry=Gt.getInstance()}async resolve(t,e={}){const n=this.findStaticConfig(t,e.objectType);if(n)return{config:n,source:"static",sourceDetail:`static:${n.id}`,fromCache:!0};if(e.schema&&e.schema.tables.length>0){const r=await this.findSchemaMatch(e.schema);if(r)return{config:r.config,source:"schema_match",sourceDetail:`schema_match:${r.configId} (score: ${r.score.toFixed(2)})`,fromCache:!1,warning:`No pattern match found. Matched by schema similarity (${(r.score*100).toFixed(0)}% match).`}}const i=await this.loadDefaultConfig();return i?{config:i,source:"default",sourceDetail:"default_config",fromCache:!1,warning:`No configuration found for "${t}". Using default configuration. Consider adding a mapping in index.json.`}:(Q.warn(`[ConfigResolver] No config found for ${t}, using minimal fallback`),{config:this.createDefaultConfig(t),source:"default",sourceDetail:"minimal_fallback",fromCache:!1,warning:`No configuration found for "${t}". Database will be rendered with basic settings.`})}async resolveTable(t,e,n={}){var r;return((r=(await this.resolve(t,n)).config.tables)==null?void 0:r[e])??null}async resolveAndRegister(t,e={}){const n=await this.resolve(t,e);return n.config?(n.config.id||(n.config.id=this.generateConfigId(t)),this.registry.registerDataType(n.config),Q.debug(`[ConfigResolver] Registered ${n.config.id} from ${n.source}`),n.config):null}hasStaticConfig(t,e){return this.findStaticConfig(t,e)!==null}async getResolutionHints(t){const e=this.hasStaticConfig(t);return{hasStaticConfig:e,recommendedSource:e?"static":"default"}}findStaticConfig(t,e){var i,r;const n=this.registry.getAppConfig();if(!(n!=null&&n.dataTypes))return null;for(const[u,h]of Object.entries(n.dataTypes))if((i=h.matches)!=null&&i.some(c=>this.matchPattern(t,c))){const c=this.registry.getDataType(u);if(c)return c}if(e){for(const[u,h]of Object.entries(n.dataTypes))if((r=h.matches)!=null&&r.some(c=>this.matchPattern(e,c))){const c=this.registry.getDataType(u);if(c)return c}}return null}matchPattern(t,e){if(e.includes("*")){const n=e.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${n}$`).test(t)}return t===e}createDefaultConfig(t){return{id:this.generateConfigId(t),name:`Auto-generated: ${t}`,version:"1.0.0",description:"Minimal configuration generated from source reference",tables:{}}}generateConfigId(t){return`auto_${t.replace(/[^a-zA-Z0-9]/g,"_")}`}async findSchemaMatch(t){const e=this.getSchemaCacheKey(t),n=this.schemaMatchCache.get(e);if(n&&Date.now()-n.timestamp<3e5){const c=this.registry.getDataType(n.configId);if(c)return{config:c,configId:n.configId,score:n.score}}const i=this.registry.getAppConfig();if(!(i!=null&&i.dataTypes))return null;let r=null;const u=new Set(t.tables.map(c=>c.toLowerCase())),h=new Map;for(const[c,o]of Object.entries(t.columns))h.set(c.toLowerCase(),new Set(o.map(p=>p.toLowerCase())));for(const[c,o]of Object.entries(i.dataTypes)){const p=o.schemaMatch;if(!(p!=null&&p.enabled))continue;const m=this.registry.getDataType(c);if(!(m!=null&&m.tables))continue;const y=p.requiredTables||[],E=p.requiredColumns||{},x=p.minMatchScore||.6;let S=0,v=0;for(const M of y)if(v++,u.has(M.toLowerCase())){S+=1;const N=E[M]||[];if(N.length>0){const G=h.get(M.toLowerCase());if(G){const D=N.filter(q=>G.has(q.toLowerCase())).length;S+=D/N.length*.5}}}if(v===0)continue;const $=S/v;$>=x&&(!r||$>r.score)&&(r={config:m,configId:c,score:$})}return r&&this.schemaMatchCache.set(e,{configId:r.configId,score:r.score,timestamp:Date.now()}),r}getSchemaCacheKey(t){const e=t.tables.sort().join(","),n=Object.entries(t.columns).sort(([i],[r])=>i.localeCompare(r)).map(([i,r])=>`${i}:${r.sort().join(",")}`).join("|");return`${e}|${n}`}async loadDefaultConfig(){var t;if(this.defaultConfigCache)return this.defaultConfigCache;try{const e=this.registry.getAppConfig(),n=((t=e==null?void 0:e.defaultConfig)==null?void 0:t.configUrl)||"/config/default-config.json",i=await fetch(n);if(i.ok){const r=await i.json();return this.defaultConfigCache=r,Q.info("[ConfigResolver] Loaded default config"),r}}catch(e){Q.warn("[ConfigResolver] Failed to load default config",e)}return null}}let He=null;function ge(){return He||(He=new Hs),He}const Ja=Object.freeze(Object.defineProperty({__proto__:null,ConfigResolver:Hs,getConfigResolver:ge},Symbol.toStringTag,{value:"Module"})),Be={pageSize:50,theme:"light",density:"default",showRowNumbers:!0,locale:"en-US",dateFormat:"YYYY-MM-DD",numberFormat:{decimals:2,thousandsSeparator:",",decimalSeparator:"."}},Vt={pageSize:50,density:"default",showRowNumbers:!0,enableSelection:!0,enableExport:!0,enableColumnReorder:!1,enableColumnResize:!0,defaultSortColumn:"",defaultSortOrder:"asc"},pe={visible:!0,sortable:!0,filterable:!0,searchable:!0},Za={number:"right",integer:"right",float:"right",percentage:"right",currency:"right",filesize:"right",duration:"right",boolean:"center",date:"center",datetime:"center",timestamp:"center"},Et=class Et{constructor(){T(this,"appConfig",null);T(this,"dataTypes",new Map);T(this,"loadedUrls",new Set);T(this,"apiConfigs",new Map);T(this,"defaultApiId",null);T(this,"matchMap",new Map);T(this,"globalSettings",{...Be})}static getInstance(){return Et.instance||(Et.instance=new Et),Et.instance}static reset(){Et.instance=null}async initialize(t){if(this.appConfig=t,t.defaults&&(this.globalSettings={...Be,...t.defaults,numberFormat:{...Be.numberFormat,...t.defaults.numberFormat}}),t.apis)if(Object.values(t.apis).forEach(n=>{this.apiConfigs.set(n.id,n)}),t.apis.default)this.defaultApiId="default";else{const n=Object.keys(t.apis)[0];n&&(this.defaultApiId=n)}const e=[];for(const[n,i]of Object.entries(t.dataTypes))i.matches&&i.matches.forEach(r=>this.matchMap.set(r,n)),i.autoLoad!==!1&&e.push(this.loadDataType(n,i));await Promise.all(e)}async loadDataType(t,e){if(e.config){this.registerDataType(e.config);return}if(e.configUrl&&!this.loadedUrls.has(e.configUrl))try{const n=await fetch(e.configUrl);if(!n.ok){Q.warn(`Failed to load config from ${e.configUrl}: ${n.status}`);return}const i=await n.json();this.registerDataType(i),this.loadedUrls.add(e.configUrl)}catch(n){Q.error(`Error loading data type config from ${e.configUrl}`,n)}}registerDataType(t){if(!t.id){Q.error("DataTypeConfig must have an id");return}t.version||(Q.warn(`DataTypeConfig ${t.id} missing version, defaulting to 1.0.0`),t.version="1.0.0"),this.dataTypes.set(t.id,t),Q.debug(`Registered data type: ${t.id} v${t.version}`)}unregisterDataType(t){return this.dataTypes.delete(t)}getDataType(t){return this.dataTypes.get(t)}hasDataType(t){return this.dataTypes.has(t)}getAllDataTypes(){return Array.from(this.dataTypes.values())}getDataTypeIds(){return Array.from(this.dataTypes.keys())}getTableSchema(t,e){const n=this.dataTypes.get(t);if(n)return n.tables[e]}getColumnSchema(t,e,n){const i=this.getTableSchema(t,e);if(i)return i.columns.find(r=>r.column===n)}getTableNames(t){const e=this.dataTypes.get(t);return e?Object.keys(e.tables):[]}getResolvedTableConfig(t,e){var c,o,p,m,y,E,x,S,v,$,M;const n=this.dataTypes.get(t);if(!n)return null;const i=n.tables[e];if(!i)return null;const r={...Vt,pageSize:((c=n.defaults)==null?void 0:c.pageSize)??Vt.pageSize,density:((o=n.defaults)==null?void 0:o.density)??Vt.density,showRowNumbers:((p=n.defaults)==null?void 0:p.showRowNumbers)??Vt.showRowNumbers,enableSelection:((m=n.defaults)==null?void 0:m.enableSelection)??Vt.enableSelection,enableExport:((y=n.defaults)==null?void 0:y.enableExport)??Vt.enableExport,...i.settings},u=[...n.sharedCategories||[],...i.categories||[]],h=i.columns.map(N=>this.resolveColumnConfig(N));return{name:e,displayName:i.displayName||e,settings:r,categories:u,columns:h,virtualColumns:i.virtualColumns||[],rowConfig:{selectable:((E=i.rowConfig)==null?void 0:E.selectable)??!0,clickable:((x=i.rowConfig)==null?void 0:x.clickable)??!1,clickAction:((S=i.rowConfig)==null?void 0:S.clickAction)??"",heightMode:((v=i.rowConfig)==null?void 0:v.heightMode)??"auto",height:(($=i.rowConfig)==null?void 0:$.height)??"auto",conditionalStyles:((M=i.rowConfig)==null?void 0:M.conditionalStyles)??[]}}}resolveColumnConfig(t){const e=t.dataType||"string",n=Za[e]||"left";return{column:t.column,displayName:t.displayName||t.column.replace(/_/g," "),dataType:e,visible:t.visible??pe.visible,sortable:t.sortable??pe.sortable,filterable:t.filterable??pe.filterable,searchable:t.searchable??pe.searchable,copyable:t.copyable??e==="id",width:t.width||"auto",align:t.align||n,categories:t.categories||[],transform:t.transform}}getGlobalSettings(){return{...this.globalSettings}}getAppConfig(){return this.appConfig}getApiUrl(){var t,e;return((t=this.appConfig)==null?void 0:t.app.apiUrl)||this.defaultApiId&&((e=this.apiConfigs.get(this.defaultApiId))==null?void 0:e.url)||null}getApi(t){return t?this.apiConfigs.get(t):this.defaultApiId?this.apiConfigs.get(this.defaultApiId):void 0}getApis(){return Array.from(this.apiConfigs.values())}getDefaultApiId(){return this.defaultApiId}getAppName(){var t;return((t=this.appConfig)==null?void 0:t.app.name)||"DataTables Viewer"}detectDataType(t){const e=t.dataType||t.type||t.objectType||t.object_type;if(!e)return null;if(this.hasDataType(e))return e;if(this.matchMap.has(e))return this.matchMap.get(e)??null;const n=e.toLowerCase().replace(/[^a-z0-9]/g,"_");if(this.hasDataType(n))return n;const i=this.getDataTypeIds()[0];return i?(Q.warn(`Unknown data type "${e}", falling back to "${i}"`),i):null}static fromLegacyConfig(t){var n,i,r;const e={};if(t.tables)for(const[u,h]of Object.entries(t.tables))e[u]={displayName:h.name||u,categories:h.categories||[],columns:(h.columns||[]).map(c=>({column:c.column,displayName:c.displayName,dataType:c.dataType||"string",visible:c.visible,sortable:c.sortable,filterable:c.filterable,width:c.width,categories:c.categories,transform:c.transform})),settings:h.settings};return{id:"legacy",name:t.name||"Legacy Config",version:"1.0.0",description:t.description,defaults:{pageSize:(n=t.defaultSettings)==null?void 0:n.pageSize,density:(i=t.defaultSettings)==null?void 0:i.density,showRowNumbers:(r=t.defaultSettings)==null?void 0:r.showRowNumbers},tables:e}}async resolveAndRegister(t,e){const i=await ge().resolve(t,e);return i.config?(i.config.id||(i.config.id=`auto_${t.replace(/[^a-zA-Z0-9]/g,"_")}`),this.registerDataType(i.config),Q.debug(`[DataTypeRegistry] Registered ${i.config.id} from ${i.source}`),i.config):null}isRemoteConfigEnabled(){return!1}getConfigApiSettings(){return null}setAuthToken(t){}async resolveConfig(t,e){return ge().resolve(t,e)}async hasConfigFor(t,e){var i;const n=this.getAppConfig();if(n!=null&&n.dataTypes){for(const[r,u]of Object.entries(n.dataTypes))if((i=u.matches)!=null&&i.some(h=>this.matchPattern(t,h)))return{hasConfig:!0,source:"static"}}return{hasConfig:!1,source:"none"}}matchPattern(t,e){if(e.includes("*")){const n=e.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${n}$`).test(t)}return t===e}};T(Et,"instance",null);let Gt=Et;class Us{constructor(t){T(this,"registry");T(this,"legacyConfig",null);T(this,"currentDataTypeId",null);T(this,"isLegacyMode",!1);this.registry=Gt.getInstance(),t&&(this.isNewConfigFormat(t)?this.initializeFromAppConfig(t):this.initializeFromLegacyConfig(t))}isNewConfigFormat(t){var e;return t&&(t.dataTypes||((e=t.app)==null?void 0:e.name))}initializeFromAppConfig(t){this.isLegacyMode=!1,Object.entries(t.dataTypes||{}).forEach(([e,n])=>{n.config&&(this.registry.registerDataType(n.config),this.currentDataTypeId||(this.currentDataTypeId=e))})}initializeFromLegacyConfig(t){this.isLegacyMode=!0,this.legacyConfig=t;const e=Gt.fromLegacyConfig(t);this.registry.registerDataType(e),this.currentDataTypeId="legacy"}async initializeAsync(t){if(t)try{const e=await fetch(t);if(!e.ok){console.warn(`Failed to load config from ${t}`);return}const n=await e.json();if(this.isNewConfigFormat(n)){await this.registry.initialize(n);const i=this.registry.getDataTypeIds();i.length>0&&(this.currentDataTypeId=i[0])}else this.initializeFromLegacyConfig(n)}catch(e){console.error("Error loading configuration:",e)}}setCurrentDataType(t){if(this.registry.hasDataType(t))return this.currentDataTypeId=t,!0;const e=this.registry.detectDataType({dataType:t});return e?(this.currentDataTypeId=e,!0):(Q.warn(`Data type "${t}" not found in registry`),!1)}getCurrentDataTypeId(){return this.currentDataTypeId}getCurrentDataType(){if(this.currentDataTypeId)return this.registry.getDataType(this.currentDataTypeId)}detectDataType(t){const e=this.registry.detectDataType(t);return e&&(this.currentDataTypeId=e),e}getTableConfig(t){var e,n;if(this.currentDataTypeId){const i=this.registry.getResolvedTableConfig(this.currentDataTypeId,t);if(i)return this.convertResolvedToLegacy(i)}if((n=(e=this.legacyConfig)==null?void 0:e.tables)!=null&&n[t]){const i=this.legacyConfig.tables[t];return{name:i.name||t,categories:i.categories||[],columns:i.columns||[],settings:{...this.legacyConfig.defaultSettings,...i.settings||{}}}}return{name:t,categories:[],columns:[],settings:this.getGlobalSettings()}}getTableSchema(t){if(this.currentDataTypeId)return this.registry.getTableSchema(this.currentDataTypeId,t)}getResolvedTableConfig(t){return this.currentDataTypeId?this.registry.getResolvedTableConfig(this.currentDataTypeId,t):null}hasTableConfig(t){var e;return this.currentDataTypeId&&this.registry.getTableSchema(this.currentDataTypeId,t)?!0:!!((e=this.legacyConfig)!=null&&e.tables&&Object.prototype.hasOwnProperty.call(this.legacyConfig.tables,t))}getTableNames(){var t;return this.currentDataTypeId?this.registry.getTableNames(this.currentDataTypeId):(t=this.legacyConfig)!=null&&t.tables?Object.keys(this.legacyConfig.tables):[]}getAppName(){var t;return this.registry.getAppName()||((t=this.legacyConfig)==null?void 0:t.name)||"DataTables Viewer"}getApi(t){return this.registry.getApi(t)}getApis(){return this.registry.getApis()}getDefaultApiId(){return this.registry.getDefaultApiId()}getApiUrl(){var t;return this.registry.getApiUrl()||((t=this.legacyConfig)==null?void 0:t.apiUrl)||null}getEnvironment(){var e;const t=this.registry.getAppConfig();return(t==null?void 0:t.app.environment)||((e=this.legacyConfig)==null?void 0:e.environment)||"local"}getGlobalSettings(){var n;const t=this.registry.getGlobalSettings(),e=((n=this.legacyConfig)==null?void 0:n.defaultSettings)||{};return{...t,...e}}convertResolvedToLegacy(t){return{name:t.displayName,categories:t.categories.map(e=>({id:e.id,name:e.name,icon:e.icon,color:e.color,description:e.description,defaultVisible:e.defaultVisible})),columns:t.columns.map(e=>({column:e.column,displayName:e.displayName,description:e.description,width:e.width,visible:e.visible,sortable:e.sortable,filterable:e.filterable,categories:e.categories,transform:Array.isArray(e.transform)?{type:"chain",options:{transforms:e.transform}}:e.transform})),settings:{pageSize:t.settings.pageSize,density:t.settings.density,showRowNumbers:t.settings.showRowNumbers,enableSelection:t.settings.enableSelection,enableExport:t.settings.enableExport}}}getRegistry(){return this.registry}isLegacy(){return this.isLegacyMode}async resolveConfig(t,e){const i=await ge().resolve(t,e);return i.config&&(this.registry.hasDataType(i.config.id)||this.registry.registerDataType(i.config),this.currentDataTypeId=i.config.id),i}isRemoteEnabled(){return!1}setAuthToken(t){}}const zs={berdlTableId:null,activeTableName:null,availableTables:[],headers:[],columns:[],visibleColumns:new Set,data:[],totalCount:0,filteredCount:0,currentPage:0,pageSize:50,sortColumn:null,sortDirection:"asc",sortOrder:"asc",columnFilters:{},advancedFilters:void 0,aggregations:void 0,groupBy:void 0,searchQuery:"",searchValue:"",selectedRows:new Set,loading:!1,error:null,theme:"light",density:"normal",showRowNumbers:!0,queryCached:!1,queryTime:void 0};class tn{constructor(t={}){T(this,"state");T(this,"listeners");this.state={...zs,...t},this.listeners=new Set}getState(){return{...this.state}}update(t){t.sortDirection&&!t.sortOrder?t.sortOrder=t.sortDirection:t.sortOrder&&!t.sortDirection&&(t.sortDirection=t.sortOrder),t.searchQuery!==void 0&&t.searchValue===void 0?t.searchValue=t.searchQuery:t.searchValue!==void 0&&t.searchQuery===void 0&&(t.searchQuery=t.searchValue),this.state={...this.state,...t},this.notify()}reset(){this.state={...zs},this.notify()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t(this.state))}}class en{constructor(t){T(this,"categories");T(this,"columnsByCategory");T(this,"initialVisibleCategories");T(this,"uncategorizedColumns");this.categories=new Map,this.columnsByCategory=new Map,this.initialVisibleCategories=new Set,this.uncategorizedColumns=new Set,this.initialize(t)}initialize(t){(t.categories||[]).forEach(n=>{this.categories.set(n.id,n),this.columnsByCategory.set(n.id,new Set),n.defaultVisible!==!1&&this.initialVisibleCategories.add(n.id)}),t.columns&&this.setColumns(t.columns)}setColumns(t){this.uncategorizedColumns.clear(),this.categories.forEach((e,n)=>{var i;return(i=this.columnsByCategory.get(n))==null?void 0:i.clear()}),t.forEach(e=>{const n=e.column;let i=!1;e.categories&&Array.isArray(e.categories)&&e.categories.length>0&&e.categories.forEach(r=>{var u;this.categories.has(r)&&((u=this.columnsByCategory.get(r))==null||u.add(n),i=!0)}),i||this.uncategorizedColumns.add(n)})}getInitialVisibleColumns(){const t=new Set;return this.initialVisibleCategories.forEach(e=>{const n=this.columnsByCategory.get(e);n&&n.forEach(i=>t.add(i))}),this.uncategorizedColumns.forEach(e=>t.add(e)),t}getColumnsForCategory(t){return this.columnsByCategory.get(t)||new Set}calculateVisibilityChange(t,e){const n=this.columnsByCategory.get(t);if(!n||n.size===0)return new Set(e);const i=new Set(e),r=Array.from(n);return r.every(h=>e.has(h))?r.forEach(h=>i.delete(h)):r.forEach(h=>i.add(h)),i}getAllCategories(t){return Array.from(this.categories.values()).map(e=>{const n=this.columnsByCategory.get(e.id),i=(n==null?void 0:n.size)||0,r=i>0&&Array.from(n||[]).every(u=>t.has(u));return{...e,visible:r,columnCount:i}})}getColumnsByCategory(){const t=new Map;return this.columnsByCategory.forEach((e,n)=>{t.set(n,Array.from(e))}),t}getUncategorizedColumns(){return Array.from(this.uncategorizedColumns)}}class Qe{constructor(t){T(this,"container");T(this,"id");T(this,"dom",{});this.container=t.container,this.id=t.id||`cmp-${Math.random().toString(36).substr(2,9)}`}mount(){this.render(),this.bindEvents()}destroy(){this.container.innerHTML="",this.dom={}}cacheDom(t){this.dom={};for(const[e,n]of Object.entries(t)){const i=this.container.querySelector(n);i&&(this.dom[e]=i)}}}class sn extends Qe{constructor(e){super(e);T(this,"configManager");T(this,"stateManager");T(this,"categoryManager",null);T(this,"options");T(this,"expandedCategories",new Set);this.configManager=e.configManager,this.stateManager=e.stateManager,this.options=e,this.stateManager.subscribe(n=>{this.dom.loadBtn&&(this.dom.loadBtn.innerHTML=n.loading?'<span class="ts-spinner"></span> Loading...':'<i class="bi bi-lightning-charge-fill"></i> Load Data',this.dom.loadBtn.disabled=n.loading),this.updateLoadingState(n),!n.loading&&n.availableTables.length>0&&n.data.length>0&&n.activeTableName&&setTimeout(()=>{this.dom.sourceBody&&this.dom.sourceBody.style.display!=="none"&&(this.dom.sourceBody.style.display="none",this.dom.sourceArrow.classList.add("collapsed"))},500),n.activeTableName&&n.availableTables.length>0&&this.updateTableInfo(n.activeTableName),n.columns.length>0&&this.dom.controlList&&this.renderControlList(),this.renderFilterChips(),this.updateAggregationsDisplay(n)})}get onLoadData(){return this.options.onLoadData}updateAggregationsDisplay(e){var r,u;if(!this.dom.aggregationsSection||!this.dom.aggregationsInfo)return;const n=e.aggregations&&e.aggregations.length>0,i=e.groupBy&&e.groupBy.length>0;if(n||i){this.dom.aggregationsSection.style.display="block";const h=((r=e.aggregations)==null?void 0:r.map(o=>`${o.function.toUpperCase()}(${o.column})`).join(", "))||"None",c=((u=e.groupBy)==null?void 0:u.join(", "))||"None";this.dom.aggregationsInfo.innerHTML=`
                <div style="margin-bottom:4px"><strong>Functions:</strong> ${h}</div>
                <div><strong>Group By:</strong> ${c}</div>
            `}else this.dom.aggregationsSection.style.display="none"}setCategoryManager(e){this.categoryManager=e,this.renderControlList(),this.expandColumnsSection()}expandColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="block")}collapseColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="none")}render(){const e=this.configManager.getAppName()||"DataTables Viewer";this.container.innerHTML=`
            <header class="ts-sidebar-header">
                <div class="ts-brand">
                    <div class="ts-brand-icon"><i class="bi bi-grid-3x3-gap-fill"></i></div>
                    <span class="ts-brand-name">${e}</span>
                </div>
            </header>

            <div class="ts-sidebar-body">
                <!-- Connection -->
                <section class="ts-section" id="ts-source-section" style="padding: 0 4px;">
                    <div class="ts-section-header collapsible" id="ts-source-head">
                        <span class="ts-section-title">Data Source</span>
                        <div style="display:flex; align-items:center; gap:8px">
                            <i class="bi bi-chevron-down ts-section-arrow" id="ts-source-arrow"></i>
                            <i class="bi bi-database-fill-gear ts-text-muted"></i>
                        </div>
                    </div>
                    <div id="ts-source-body">
                        <div class="ts-field">
                            <label class="ts-label">Auth Token <span style="color:red">*</span></label>
                            <input type="password" class="ts-input" id="ts-token" placeholder="Enter KBase token...">
                        </div>
                        <div class="ts-field">
                            <label class="ts-label">Object ID / UPA</label>
                            <input type="text" class="ts-input" id="ts-berdl" 
                                placeholder="e.g., 76990/7/2" value="76990/7/2">
                        </div>
                        <button class="ts-btn-primary" id="ts-load" style="height: 34px; width: 100%;">
                            <i class="bi bi-lightning-charge-fill"></i> Load Data
                        </button>
                        <div style="margin-top: 12px; display: flex; align-items: center; gap: 8px;">
                            <div style="height: 1px; background: var(--c-border-subtle); flex: 1;"></div>
                            <span style="font-size: 11px; color: var(--c-text-muted); text-transform: uppercase;">OR</span>
                            <div style="height: 1px; background: var(--c-border-subtle); flex: 1;"></div>
                        </div>
                        <div class="ts-field" style="margin-top: 12px;">
                            <label class="ts-label">Local DB path / URL</label>
                            <input type="text" class="ts-input" id="ts-local-db-path"
                                placeholder="e.g. /data/my.db">
                        </div>
                        <button class="ts-btn-secondary" id="ts-load-local-db" style="height: 34px; width: 100%; margin-top: 8px;">
                            <i class="bi bi-folder2-open"></i> Load Local DB
                        </button>
                        <div id="ts-loading-indicator" style="display:none;margin-top:12px;padding:12px;background:var(--c-bg-surface);border-radius:var(--radius-sm);border:1px solid var(--c-border-subtle)">
                            <div style="display:flex;align-items:center;gap:10px;color:var(--c-text-secondary);font-size:13px">
                                <span class="ts-spinner" style="width:16px;height:16px"></span>
                                <span id="ts-loading-text">Loading data...</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table Selection -->
                <section class="ts-section" id="ts-nav-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Table</span>
                    </div>
                    <select class="ts-select" id="ts-table-select"></select>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
                        <button class="ts-btn-secondary" id="ts-view-schema">
                            <i class="bi bi-file-earmark-code"></i> Schema
                        </button>
                        <button class="ts-btn-secondary" id="ts-view-stats">
                            <i class="bi bi-graph-up"></i> Stats
                        </button>
                    </div>
                </section>

                <!-- Data Control (Unified Categories & Columns) -->
                <section class="ts-section" id="ts-control-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Data Control</span>
                        <div class="ts-section-actions">
                            <button class="ts-section-action" id="ts-control-expand-all">Expand All</button>
                            <button class="ts-section-action" id="ts-control-show-all">Show All</button>
                        </div>
                    </div>
                    <div class="ts-control-list" id="ts-control-list"></div>
                </section>

                <!-- Active Filters -->
                <section class="ts-section" id="ts-filters-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Filters</span>
                        <div style="display:flex;gap:4px">
                            <button class="ts-section-action" id="ts-advanced-filters" title="Advanced Filters">
                                <i class="bi bi-funnel-fill"></i> Advanced
                            </button>
                            <button class="ts-section-action" id="ts-clear-filters">Clear All</button>
                        </div>
                    </div>
                    <div class="ts-filter-chips" id="ts-filter-chips"></div>
                </section>
                
                <!-- Aggregations -->
                <section class="ts-section" id="ts-aggregations-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Aggregations</span>
                        <button class="ts-section-action" id="ts-aggregations-btn">
                            <i class="bi bi-calculator"></i> Configure
                        </button>
                    </div>
                    <div id="ts-aggregations-info" style="padding:8px;font-size:12px;color:var(--c-text-muted)">
                        No aggregations configured
                    </div>
                </section>
            </div>

            <footer class="ts-sidebar-footer">
                <div class="ts-btn-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="ts-btn-secondary" id="ts-export">
                        <i class="bi bi-download"></i> Export
                    </button>
                    <button class="ts-btn-secondary" id="ts-reset">
                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                    </button>
                </div>
            </footer>
        `,this.cacheDom({token:"#ts-token",berdl:"#ts-berdl",loadBtn:"#ts-load",sourceHead:"#ts-source-head",sourceBody:"#ts-source-body",sourceArrow:"#ts-source-arrow",loadingIndicator:"#ts-loading-indicator",loadingText:"#ts-loading-text",navSection:"#ts-nav-section",tableSelect:"#ts-table-select",viewSchema:"#ts-view-schema",viewStats:"#ts-view-stats",controlSection:"#ts-control-section",controlList:"#ts-control-list",controlExpandAll:"#ts-control-expand-all",controlShowAll:"#ts-control-show-all",filtersSection:"#ts-filters-section",filterChips:"#ts-filter-chips",clearFilters:"#ts-clear-filters",advancedFilters:"#ts-advanced-filters",aggregationsSection:"#ts-aggregations-section",aggregationsBtn:"#ts-aggregations-btn",aggregationsInfo:"#ts-aggregations-info",export:"#ts-export",reset:"#ts-reset",localDbPath:"#ts-local-db-path",loadLocalDb:"#ts-load-local-db"})}bindEvents(){var n,i,r,u,h,c,o,p,m,y,E;(n=this.dom.loadBtn)==null||n.addEventListener("click",()=>{this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.options.onLoadData()}),(i=this.dom.sourceHead)==null||i.addEventListener("click",()=>{const x=this.dom.sourceBody.style.display==="none";this.dom.sourceBody.style.display=x?"block":"none",this.dom.sourceArrow.classList.toggle("collapsed",!x)}),(r=this.dom.berdl)==null||r.addEventListener("keypress",x=>{x.key==="Enter"&&this.dom.loadBtn.click()});const e=()=>{var $,M;const x=((M=($=this.dom.localDbPath)==null?void 0:$.value)==null?void 0:M.trim())||"";if(!x||!this.options.onLoadDbPath)return;const v=(x.split("?")[0].split("#")[0].split("/").pop()||x).replace(/\.(db|sqlite)$/i,"");this.dom.berdl&&v&&(this.dom.berdl.value=`local/${v}`),this.options.onLoadDbPath(x)};(u=this.dom.loadLocalDb)==null||u.addEventListener("click",e),(h=this.dom.localDbPath)==null||h.addEventListener("keypress",x=>{x.key==="Enter"&&e()}),(c=this.dom.tableSelect)==null||c.addEventListener("change",x=>{this.options.onTableChange(x.target.value)}),(o=this.dom.export)==null||o.addEventListener("click",()=>this.options.onExport()),(p=this.dom.reset)==null||p.addEventListener("click",()=>this.options.onReset()),(m=this.dom.controlList)==null||m.addEventListener("click",x=>{const S=x.target;if(S.closest(".ts-switch")){const v=S.closest(".ts-cat-group"),$=v==null?void 0:v.dataset.cat;if($&&this.categoryManager){const M=this.stateManager.getState().visibleColumns,N=this.categoryManager.calculateVisibilityChange($,M);this.stateManager.update({visibleColumns:N})}return}if(S.closest(".ts-cat-head")){const v=S.closest(".ts-cat-group"),$=v==null?void 0:v.dataset.cat;$&&(this.expandedCategories.has($)?this.expandedCategories.delete($):this.expandedCategories.add($),v==null||v.classList.toggle("expanded"));return}if(S.matches('input[type="checkbox"]')){const v=S.dataset.col;if(v){const $=this.stateManager.getState();S.checked?$.visibleColumns.add(v):$.visibleColumns.delete(v),this.stateManager.update({visibleColumns:$.visibleColumns})}}}),(y=this.dom.controlExpandAll)==null||y.addEventListener("click",()=>{const x=this.dom.controlList.querySelectorAll(".ts-cat-group"),S=Array.from(x).some(v=>!v.classList.contains("expanded"));x.forEach(v=>{const $=v.dataset.cat;S?(v.classList.add("expanded"),$&&this.expandedCategories.add($)):(v.classList.remove("expanded"),$&&this.expandedCategories.delete($))}),this.dom.controlExpandAll.textContent=S?"Collapse All":"Expand All"}),(E=this.dom.controlShowAll)==null||E.addEventListener("click",()=>{this.toggleAllColumns()}),this.dom.viewSchema&&this.dom.viewSchema.addEventListener("click",()=>{const x=this.stateManager.getState();if(x.activeTableName)this.options.onShowSchema(x.activeTableName);else{const S=this.dom.tableSelect;S!=null&&S.value&&this.options.onShowSchema(S.value)}}),this.dom.viewStats&&this.dom.viewStats.addEventListener("click",()=>{const x=this.stateManager.getState();if(x.activeTableName)this.options.onShowStats(x.activeTableName);else{const S=this.dom.tableSelect;S!=null&&S.value&&this.options.onShowStats(S.value)}}),this.dom.clearFilters&&this.dom.clearFilters.addEventListener("click",()=>{this.stateManager.update({columnFilters:{},advancedFilters:void 0,currentPage:0})}),this.dom.advancedFilters&&this.dom.advancedFilters.addEventListener("click",()=>{this.showAdvancedFilterPanel()}),this.dom.aggregationsBtn&&this.dom.aggregationsBtn.addEventListener("click",()=>{this.showAggregationsPanel()})}showAdvancedFilterPanel(){const e=this.stateManager.getState(),n=e.columns.map(r=>({column:r.column,displayName:r.displayName||r.column,type:r.dataType||"TEXT"})),i=document.createElement("div");i.className="ts-modal-overlay show",i.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Advanced Filters</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body" id="ts-advanced-filter-container"></div>
            </div>
        `,document.body.appendChild(i),wt(async()=>{const{AdvancedFilterPanel:r}=await import("./AdvancedFilterPanel-BXyU1ZCK.js");return{AdvancedFilterPanel:r}},[]).then(({AdvancedFilterPanel:r})=>{var c;const u=i.querySelector("#ts-advanced-filter-container");if(!u)return;const h=new r({container:u,columns:n,onApply:o=>{this.stateManager.update({advancedFilters:o,currentPage:0}),document.body.removeChild(i),this.options.onLoadData()},onCancel:()=>{document.body.removeChild(i)}});e.advancedFilters&&h.setFilters(e.advancedFilters),(c=i.querySelector(".ts-modal-close"))==null||c.addEventListener("click",()=>{document.body.removeChild(i)}),h.mount()})}showAggregationsPanel(){var o,p,m,y;const e=this.stateManager.getState(),n=e.columns.map(E=>({column:E.column,displayName:E.displayName||E.column,type:E.dataType||"TEXT"})),i=document.createElement("div");i.className="ts-modal-overlay show",i.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Configure Aggregations</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body">
                    <div style="margin-bottom:16px">
                        <label style="display:block;margin-bottom:8px;font-weight:500">Group By Columns</label>
                        <select multiple class="ts-select" id="ts-group-by" style="min-height:100px">
                            ${n.map(E=>`<option value="${E.column}">${E.displayName||E.column}</option>`).join("")}
                        </select>
                        <small style="color:var(--c-text-muted)">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                    <div id="ts-aggregations-list"></div>
                    <button class="ts-btn-secondary" id="ts-add-aggregation" style="margin-top:12px">
                        <i class="bi bi-plus"></i> Add Aggregation
                    </button>
                </div>
                <div class="ts-modal-footer">
                    <button class="ts-btn-secondary" id="ts-agg-cancel">Cancel</button>
                    <button class="ts-btn-primary" id="ts-agg-apply">Apply</button>
                </div>
            </div>
        `,document.body.appendChild(i);const r=e.aggregations||[],u=e.groupBy||[],h=()=>{const E=i.querySelector("#ts-aggregations-list");if(E){if(r.length===0){E.innerHTML='<p style="color:var(--c-text-muted);font-size:13px">No aggregations. Click "Add Aggregation" to create one.</p>';return}E.innerHTML=r.map((x,S)=>`
                <div class="ts-agg-item" style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;margin-bottom:8px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm)">
                    <select class="ts-select" data-agg-col="${S}">
                        ${n.map(v=>`<option value="${v.column}" ${x.column===v.column?"selected":""}>${v.displayName||v.column}</option>`).join("")}
                    </select>
                    <select class="ts-select" data-agg-func="${S}">
                        <option value="count" ${x.function==="count"?"selected":""}>Count</option>
                        <option value="sum" ${x.function==="sum"?"selected":""}>Sum</option>
                        <option value="avg" ${x.function==="avg"?"selected":""}>Average</option>
                        <option value="min" ${x.function==="min"?"selected":""}>Min</option>
                        <option value="max" ${x.function==="max"?"selected":""}>Max</option>
                        <option value="stddev" ${x.function==="stddev"?"selected":""}>StdDev</option>
                        <option value="variance" ${x.function==="variance"?"selected":""}>Variance</option>
                        <option value="distinct_count" ${x.function==="distinct_count"?"selected":""}>Distinct Count</option>
                    </select>
                    <button class="ts-btn-secondary" data-agg-remove="${S}" style="padding:8px">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `).join(""),E.querySelectorAll("[data-agg-col]").forEach(x=>{x.addEventListener("change",S=>{const v=parseInt(S.target.dataset.aggCol||"0");r[v].column=S.target.value})}),E.querySelectorAll("[data-agg-func]").forEach(x=>{x.addEventListener("change",S=>{const v=parseInt(S.target.dataset.aggFunc||"0");r[v].function=S.target.value})}),E.querySelectorAll("[data-agg-remove]").forEach(x=>{x.addEventListener("click",S=>{const v=parseInt(S.target.dataset.aggRemove||"0");r.splice(v,1),h()})})}};(o=i.querySelector("#ts-add-aggregation"))==null||o.addEventListener("click",()=>{var E;r.push({column:((E=n[0])==null?void 0:E.column)||"",function:"count"}),h()}),(p=i.querySelector("#ts-agg-apply"))==null||p.addEventListener("click",()=>{const E=i.querySelector("#ts-group-by"),x=Array.from(E.selectedOptions).map(S=>S.value);this.stateManager.update({aggregations:r.length>0?r:void 0,groupBy:x.length>0?x:void 0,currentPage:0}),document.body.removeChild(i),this.options.onLoadData&&this.options.onLoadData()}),(m=i.querySelector("#ts-agg-cancel"))==null||m.addEventListener("click",()=>{document.body.removeChild(i)}),(y=i.querySelector(".ts-modal-close"))==null||y.addEventListener("click",()=>{document.body.removeChild(i)}),h();const c=i.querySelector("#ts-group-by");u&&Array.from(c.options).forEach(E=>{E.selected=u.includes(E.value)})}updateTables(e){this.dom.navSection&&(e.length>0?(this.dom.navSection.style.display="block",this.dom.tableSelect.innerHTML="",e.forEach(n=>{const i=document.createElement("option");i.value=n.name;const r=n.row_count??n.count,u=typeof r=="number"?r.toLocaleString():"?";i.textContent=`${n.displayName||n.name} (${u} rows)`,this.dom.tableSelect.appendChild(i)})):this.dom.navSection.style.display="none")}updateTableInfo(e){this.dom.tableSelect&&this.dom.tableSelect.value!==e&&(this.dom.tableSelect.value=e)}renderControlList(){if(!this.dom.controlList)return;this.dom.controlSection.style.display="block";const e=this.stateManager.getState(),n=this.categoryManager?this.categoryManager.getAllCategories(e.visibleColumns):[],i=this.categoryManager?this.categoryManager.getColumnsByCategory():new Map,r=this.categoryManager?this.categoryManager.getUncategorizedColumns():e.columns.map(c=>c.column);let u="";n.forEach(c=>{const o=i.get(c.id)||[];o.length!==0&&(u+=this.renderCategoryGroup(c,o,e))}),r.length>0&&(u+=this.renderCategoryGroup({id:"other",name:"Other Attributes",icon:"bi-three-dots",color:"#64748b",visible:!0},r,e,!0)),this.dom.controlList.innerHTML=u;const h=e.columns.every(c=>e.visibleColumns.has(c.column));this.dom.controlShowAll&&(this.dom.controlShowAll.textContent=h?"Hide All":"Show All")}renderCategoryGroup(e,n,i,r=!1){const u=i.columns.reduce((c,o)=>(c[o.column]=o,c),{});return`
            <div class="ts-cat-group ${this.expandedCategories.has(e.id)?"expanded":""}" data-cat="${e.id}">
                <div class="ts-cat-head">
                    <div class="ts-cat-info">
                        <i class="bi bi-chevron-down ts-cat-arrow"></i>
                        <i class="${e.icon||"bi bi-folder-fill"}" style="color:${e.color||"var(--c-accent)"}"></i>
                        <span class="ts-cat-name">${e.name}</span>
                        <span class="ts-cat-count">${n.length}</span>
                    </div>
                    ${r?"":`<div class="ts-switch ${e.visible?"on":""}"></div>`}
                </div>
                <div class="ts-cat-cols">
                    ${n.map(c=>{const o=u[c]||{displayName:c};return`
                            <label class="ts-col-item">
                                <input type="checkbox" data-col="${c}" ${i.visibleColumns.has(c)?"checked":""}>
                                <span>${o.displayName||c}</span>
                            </label>
                        `}).join("")}
                </div>
            </div>
        `}renderFilterChips(){const e=this.stateManager.getState(),n=e.columnFilters,i=e.advancedFilters,r=Object.keys(n).length>0||i&&i.length>0;if(this.dom.filtersSection&&(this.dom.filtersSection.style.display=r?"block":"none"),!this.dom.filterChips)return;const u=[],h=new Set((i||[]).map(c=>c.column));Object.entries(n).forEach(([c,o])=>{h.has(c)||u.push(`
                    <div class="ts-chip">
                        <span class="ts-chip-label">${c}:</span>
                        <span class="ts-chip-value">${o}</span>
                        <button class="ts-chip-clear" data-col="${c}"><i class="bi bi-x"></i></button>
                    </div>
                `)}),i&&i.length>0&&i.forEach((c,o)=>{const p=this.getOperatorLabel(c.operator),m=c.operator==="between"?`${c.value} - ${c.value2}`:c.operator==="in"||c.operator==="not_in"?Array.isArray(c.value)?c.value.join(", "):String(c.value):c.operator==="is_null"||c.operator==="is_not_null"?"":String(c.value||"");u.push(`
                    <div class="ts-chip ts-chip-advanced">
                        <span class="ts-chip-label">${c.column} ${p}:</span>
                        <span class="ts-chip-value">${m}</span>
                        <button class="ts-chip-clear" data-adv-filter="${o}"><i class="bi bi-x"></i></button>
                    </div>
                `)}),this.dom.filterChips.innerHTML=u.join(""),this.dom.filterChips.querySelectorAll(".ts-chip-clear").forEach(c=>{c.addEventListener("click",o=>{var y;const p=o.currentTarget.dataset.col,m=o.currentTarget.dataset.advFilter;if(p){const E={...this.stateManager.getState().columnFilters};delete E[p],this.stateManager.update({columnFilters:E,currentPage:0})}else if(m!==void 0){const E=this.stateManager.getState(),x=(y=E.advancedFilters)==null?void 0:y[parseInt(m)],S=[...E.advancedFilters||[]];S.splice(parseInt(m),1);const v={...E.columnFilters};x!=null&&x.column&&delete v[x.column],this.stateManager.update({columnFilters:v,advancedFilters:S.length>0?S:void 0,currentPage:0})}})})}getOperatorLabel(e){return{eq:"=",ne:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"contains",ilike:"contains (i)",in:"in",not_in:"not in",between:"between",is_null:"is null",is_not_null:"is not null",regex:"regex"}[e]||e}toggleAllColumns(){const e=this.stateManager.getState(),n=e.columns.every(r=>e.visibleColumns.has(r.column)),i=new Set(e.visibleColumns);e.columns.forEach(r=>{n?i.delete(r.column):i.add(r.column)}),this.stateManager.update({visibleColumns:i}),this.renderControlList()}getToken(){var e;return((e=this.dom.token)==null?void 0:e.value)||""}getBerdlId(){var e;return((e=this.dom.berdl)==null?void 0:e.value)||""}renderCategories(){this.renderControlList()}renderColumnList(){this.renderControlList()}updateLoadingState(e){if(!this.dom.loadingIndicator||!this.dom.loadingText)return;e.loading&&e.availableTables.length===0?(this.dom.loadingIndicator.style.display="block",this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.dom.loadingText.textContent="Fetching tables..."):this.dom.loadingIndicator.style.display="none"}}class an extends Qe{constructor(e){super(e);T(this,"options");T(this,"searchTimer");this.options=e}render(){this.container.innerHTML=`
            <div class="ts-search-box">
                <div class="ts-search-input-wrap">
                    <input type="text" id="ts-search" class="ts-search" 
                        placeholder="Highlight matches (doesn't filter rows)..." 
                        aria-label="Highlight matches in table (does not filter rows)">
                    <button class="ts-search-clear" id="ts-search-clear" aria-label="Clear search">
                        <i class="bi bi-x-lg"></i>
                    </button>
                    <i class="bi bi-search ts-search-icon"></i>
                </div>
                <div class="ts-search-nav">
                    <button class="ts-search-nav-btn" id="ts-search-prev" title="Previous match (Shift+Enter)" aria-label="Previous match">
                        <i class="bi bi-chevron-up"></i>
                    </button>
                    <span class="ts-search-nav-info" id="ts-search-info">0/0</span>
                    <button class="ts-search-nav-btn" id="ts-search-next" title="Next match (Enter)" aria-label="Next match">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div class="ts-spacer" style="flex:1"></div>
            <div class="ts-toolbar-actions">
                <button class="ts-tb-btn" id="ts-refresh" title="Refresh Data">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="ts-tb-icon" id="ts-settings-btn" title="Settings">
                    <i class="bi bi-gear-fill"></i>
                </button>
            </div>
        `,this.cacheDom({search:"#ts-search",searchClear:"#ts-search-clear",searchPrev:"#ts-search-prev",searchNext:"#ts-search-next",searchInfo:"#ts-search-info",refresh:"#ts-refresh",settings:"#ts-settings-btn"})}bindEvents(){var e,n,i,r,u,h;(e=this.dom.search)==null||e.addEventListener("input",()=>{clearTimeout(this.searchTimer);const c=this.dom.search.value;this.updateSearchNav(),this.searchTimer=setTimeout(()=>{this.options.onSearch(c),setTimeout(()=>this.updateSearchNav(),350)},300)}),(n=this.dom.search)==null||n.addEventListener("keydown",c=>{var o,p,m,y;c.key==="Enter"&&!c.shiftKey?(c.preventDefault(),(p=(o=this.options).onSearchNext)==null||p.call(o),this.updateSearchNav()):c.key==="Enter"&&c.shiftKey&&(c.preventDefault(),(y=(m=this.options).onSearchPrev)==null||y.call(m),this.updateSearchNav())}),(i=this.dom.searchClear)==null||i.addEventListener("click",()=>{this.dom.search.value="",this.options.onSearch(""),this.updateSearchNav(),this.dom.search.focus()}),(r=this.dom.searchPrev)==null||r.addEventListener("click",()=>{var c,o;(o=(c=this.options).onSearchPrev)==null||o.call(c),this.updateSearchNav()}),(u=this.dom.searchNext)==null||u.addEventListener("click",()=>{var c,o;(o=(c=this.options).onSearchNext)==null||o.call(c),this.updateSearchNav()}),(h=this.dom.refresh)==null||h.addEventListener("click",()=>this.options.onRefresh()),setTimeout(()=>this.updateSearchNav(),100)}updateSearchNav(){var r;const e=this.dom.search,n=((r=e==null?void 0:e.value)==null?void 0:r.trim())||"",i=this.container.querySelector(".ts-search-nav");if(i){if(n)i.style.opacity="1",i.style.pointerEvents="auto";else{i.style.opacity="0",i.style.pointerEvents="none";return}if(this.options.getSearchMatchInfo){const u=this.options.getSearchMatchInfo();this.dom.searchInfo&&(u.total>0?(this.dom.searchInfo.textContent=`${u.current}/${u.total}`,this.dom.searchPrev.disabled=!1,this.dom.searchNext.disabled=!1):(this.dom.searchInfo.textContent="0/0",this.dom.searchPrev.disabled=!0,this.dom.searchNext.disabled=!0))}}}getSettingsButton(){return this.dom.settings}setSearch(e){this.dom.search&&(this.dom.search.value=e)}focusSearch(){this.dom.search&&(this.dom.search.focus(),this.dom.search.select())}}const C=class C{static escapeHtml(t){if(t==null)return"";const e=document.createElement("div");return e.textContent=String(t),e.innerHTML}static apply(t,e,n){if(!e)return t!=null?C.escapeHtml(String(t)):"";if(Array.isArray(e))return C.chain(t,{transforms:e},n);const i=e;if(i.condition&&!C.evaluateCondition(i.condition,t,n))return i.fallback?typeof i.fallback=="string"?C.escapeHtml(i.fallback):C.apply(t,i.fallback,n):t!=null?C.escapeHtml(String(t)):"";const r=e.type;if(typeof C[r]=="function")return C[r](t,e.options||{},n);if(C.customTransformers.has(r)){const u=C.customTransformers.get(r);if(u)return u(t,e.options||{},n)}return Q.warn(`Unknown transformer type: "${r}"`),t!=null?C.escapeHtml(String(t)):""}static evaluateCondition(t,e,n){const i=t.column?n[t.column]:e,r=t.value;switch(t.operator){case"eq":return i===r;case"neq":return i!==r;case"gt":return Number(i)>Number(r);case"gte":return Number(i)>=Number(r);case"lt":return Number(i)<Number(r);case"lte":return Number(i)<=Number(r);case"contains":return String(i).includes(String(r));case"startsWith":return String(i).startsWith(String(r));case"endsWith":return String(i).endsWith(String(r));case"regex":return new RegExp(String(r)).test(String(i));case"isEmpty":return i==null||i==="";case"isNotEmpty":return i!=null&&i!=="";default:return!0}}static chain(t,e,n){if(!e.transforms||!Array.isArray(e.transforms))return C.escapeHtml(String(t??""));let i=t;for(const r of e.transforms){if(e.transforms.indexOf(r)===e.transforms.length-1)return C.apply(i,r,n);i=C.apply(i,r,n)}return C.escapeHtml(String(i??""))}static number(t,e,n){if(t==null||t==="")return"";const i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.decimals??2,u=e.locale||"en-US",h=e.prefix||"",c=e.suffix||"";let o;return e.notation==="scientific"?o=i.toExponential(r):e.notation==="compact"?o=new Intl.NumberFormat(u,{notation:"compact",maximumFractionDigits:r}).format(i):e.notation==="engineering"?o=i.toExponential(r):o=new Intl.NumberFormat(u,{minimumFractionDigits:e.minDecimals??0,maximumFractionDigits:r}).format(i),`<span class="ts-number">${C.escapeHtml(h)}${o}${C.escapeHtml(c)}</span>`}static percentage(t,e,n){if(t==null||t==="")return"";let i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));e.scale100!==!1&&i>=0&&i<=1&&(i*=100);const r=e.decimals??1,u=i.toFixed(r);if(e.showBar){const h=Math.min(100,Math.max(0,i)),c=e.color||"#6366f1";return`
                <div class="ts-percentage">
                    <div class="ts-percentage-bar" style="width:${h}%;background:${c}"></div>
                    <span class="ts-percentage-value">${u}%</span>
                </div>
            `}return`<span class="ts-number">${u}%</span>`}static currency(t,e,n){if(t==null||t==="")return"";const i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.locale||"en-US",u=e.currency||"USD";return`<span class="ts-currency">${new Intl.NumberFormat(r,{style:"currency",currency:u,minimumFractionDigits:e.decimals??2,maximumFractionDigits:e.decimals??2}).format(i)}</span>`}static filesize(t,e,n){if(t==null||t==="")return"";const i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.binary!==!1,u=r?["B","KiB","MiB","GiB","TiB","PiB"]:["B","KB","MB","GB","TB","PB"],h=r?1024:1e3;let c=i,o=0;for(;c>=h&&o<u.length-1;)c/=h,o++;const p=e.decimals??(o===0?0:2);return`<span class="ts-filesize">${c.toFixed(p)} ${u[o]}</span>`}static duration(t,e,n){if(t==null||t==="")return"";let i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.format||"short";if(r==="clock"){const c=Math.floor(i/3600),o=Math.floor(i%3600/60),p=Math.floor(i%60);return c>0?`<span class="ts-duration">${c}:${String(o).padStart(2,"0")}:${String(p).padStart(2,"0")}</span>`:`<span class="ts-duration">${o}:${String(p).padStart(2,"0")}</span>`}const u=[{name:r==="long"?"day":"d",seconds:86400},{name:r==="long"?"hour":"h",seconds:3600},{name:r==="long"?"minute":"m",seconds:60},{name:r==="long"?"second":"s",seconds:1}],h=[];for(const c of u)if(i>=c.seconds){const o=Math.floor(i/c.seconds);i%=c.seconds,r==="long"?h.push(`${o} ${c.name}${o!==1?"s":""}`):h.push(`${o}${c.name}`)}return`<span class="ts-duration">${h.join(r==="long"?", ":" ")||"0s"}</span>`}static date(t,e,n){if(t==null||t==="")return"";const i=new Date(t);if(isNaN(i.getTime()))return C.escapeHtml(String(t));const r=e.locale||"en-US";return e.relative?`<span class="ts-date" title="${i.toISOString()}">${C.relativeTime(i)}</span>`:`<span class="ts-date">${new Intl.DateTimeFormat(r,{dateStyle:e.dateStyle||"medium"}).format(i)}</span>`}static datetime(t,e,n){if(t==null||t==="")return"";const i=new Date(t);if(isNaN(i.getTime()))return C.escapeHtml(String(t));const r=e.locale||"en-US",u=e.timezone||void 0;return`<span class="ts-datetime">${new Intl.DateTimeFormat(r,{dateStyle:e.dateStyle||"medium",timeStyle:e.timeStyle||"short",timeZone:u}).format(i)}</span>`}static relativeTime(t){const n=new Date().getTime()-t.getTime(),i=Math.abs(n/1e3),r=n<0,u=[[31536e3,"year"],[2592e3,"month"],[86400,"day"],[3600,"hour"],[60,"minute"],[1,"second"]];for(const[h,c]of u)if(i>=h){const o=Math.floor(i/h),p=o!==1?"s":"";return r?`in ${o} ${c}${p}`:`${o} ${c}${p} ago`}return"just now"}static boolean(t,e,n){const i=t===!0||t==="true"||t===1||t==="1";if(e.trueIcon||e.falseIcon){const h=i?e.trueIcon||"bi-check-circle-fill":e.falseIcon||"bi-x-circle",c=i?e.trueColor||"#22c55e":e.falseColor||"#ef4444";return`<i class="${h}" style="color:${c};font-size:1.1em"></i>`}const r=i?e.trueText||"Yes":e.falseText||"No";return`<span class="ts-boolean" style="color:${i?e.trueColor||"#22c55e":e.falseColor||"#94a3b8"}">${C.escapeHtml(r)}</span>`}static heatmap(t,e,n){if(t==null||t==="")return"";const i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.min??-4,u=e.max??4,h=e.colorScale||"diverging",c=(i-r)/(u-r),o=Math.max(0,Math.min(1,c));let p,m;if(h==="diverging"){let x,S,v;if(o<.5){const $=o*2;x=Math.round(59+196*$),S=Math.round(130+125*$),v=Math.round(246+9*$),m=$<.5?"#fff":"#1e293b"}else{const $=(o-.5)*2;x=Math.round(255+-16*$),S=Math.round(255+-187*$),v=Math.round(255+-187*$),m=$>.5?"#fff":"#1e293b"}p=`rgb(${x}, ${S}, ${v})`}else if(h==="sequential"){const x=Math.round(236+-228*o),S=Math.round(254+-109*o),v=Math.round(255+-77*o);p=`rgb(${x}, ${S}, ${v})`,m=o>.5?"#fff":"#1e293b"}else p="transparent",m="inherit";const y=e.decimals??2,E=e.showValue!==!1?i.toFixed(y):"";return`<span class="ts-heatmap" style="background:${p};color:${m}">${E}</span>`}static progress(t,e,n){if(t==null||t==="")return"";const i=Number(t);if(isNaN(i))return C.escapeHtml(String(t));const r=e.max??100,u=Math.min(100,Math.max(0,i/r*100)),h=e.color||"#6366f1",c=e.showValue!==!1;return`
            <div class="ts-progress">
                <div class="ts-progress-bar" style="width:${u}%;background:${h}"></div>
                ${c?`<span class="ts-progress-value">${i}${e.suffix||""}</span>`:""}
            </div>
        `}static link(t,e,n={}){if(t==null||t==="")return"";const i=String(t),r=encodeURIComponent(i);let u=e.urlTemplate.replace(/\{value\}/g,r);n&&Object.keys(n).length>0&&Object.keys(n).forEach(m=>{const y=`{${m}}`;u.includes(y)&&(u=u.replace(new RegExp(y.replace(/[{}]/g,"\\$&"),"g"),encodeURIComponent(String(n[m]||""))))});let h=i;e.labelTemplate&&(h=e.labelTemplate.replace(/\{value\}/g,i),n&&Object.keys(n).length>0&&Object.keys(n).forEach(m=>{h=h.replace(new RegExp(`\\{${m}\\}`,"g"),String(n[m]||""))}));const c=e.target||"_blank",o=c==="_blank"?' rel="noopener noreferrer"':"",p=e.icon?`<i class="${e.icon}"></i> `:"";return`<a href="${u}" target="${c}"${o} class="ts-cell-link">${p}${C.escapeHtml(h)}</a>`}static replace(t,e){if(t==null||t==="")return"";const n=String(t),i=e.pattern||e.find,r=e.replaceWith||e.replace||"";if(!i)return n;if(e.isRegex)try{const u=e.flags||"g",h=new RegExp(i,u);return n.replace(h,r)}catch(u){return Q.error("Invalid regex in replace transformer",u),n}return n.split(i).join(r)}static merge(t,e,n){if(!n||!e.columns||!Array.isArray(e.columns))return"";const i=e.skipEmpty!==!1;if(e.template){let h=e.template;return e.columns.forEach(c=>{const o=n[c],p=`{${c}}`;i&&(o==null||o==="")?(h=h.replace(new RegExp(`\\s*\\(${p}\\)`,"g"),""),h=h.replace(new RegExp(`${p}\\s*[|,;:]\\s*`,"g"),""),h=h.replace(new RegExp(`\\s*[|,;:]\\s*${p}`,"g"),""),h=h.replace(p,"")):h=h.replace(p,String(o||""))}),C.escapeHtml(h.trim())}const r=e.separator||" | ",u=e.columns.map(h=>n[h]).filter(h=>!i||h!=null&&h!=="").map(h=>String(h));return C.escapeHtml(u.join(r))}static badge(t,e,n){if(t==null||t==="")return"";const i=String(t);let h=(e.colorMap||{})[i]||e.color||e.defaultColor;if(!h){const p=["#6366f1","#ef4444","#10b981","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316"];let m=0;for(let y=0;y<i.length;y++)m=i.charCodeAt(y)+((m<<5)-m);h=p[Math.abs(m)%p.length]}const c=e.variant||"default";let o;return c==="subtle"?o=`background:${h}15;color:${h};border:none`:c==="outline"?o=`background:transparent;color:${h};border:1px solid ${h}`:o=`background:${h}20;color:${h};border:1px solid ${h}40`,`<span class="ts-badge" style="${o}">${C.escapeHtml(i)}</span>`}static array(t,e,n){if(t==null)return"";let i;if(Array.isArray(t))i=t;else if(typeof t=="string"){const o=e.separator||",";i=t.split(o).map(p=>p.trim()).filter(Boolean)}else return C.escapeHtml(String(t));const r=e.limit||5,u=i.slice(0,r),h=i.length-r,c=u.map(o=>C.badge(o,{color:e.color||"#6366f1",variant:"subtle"},n)).join(" ");return h>0?`${c} <span class="ts-badge-more">+${h}</span>`:c}static sequence(t,e){if(!t)return"";let n=String(t);if(e.chunkSize&&e.chunkSize>0){const c=new RegExp(`.{1,${e.chunkSize}}`,"g"),o=n.match(c);o&&(n=o.join(" "))}const i=e.maxLength||30,r=n,u=e.showCopyButton!==!1;n.length>i&&(n=n.substring(0,i)+"...");const h=u?`<button class="ts-copy-btn" data-id="${C.escapeHtml(r)}" title="Copy sequence"><i class="bi bi-clipboard"></i></button>`:"";return`<span class="ts-sequence" title="${C.escapeHtml(r)}">${C.escapeHtml(n)}${h}</span>`}static truncate(t,e){if(!t)return"";const n=String(t),i=e.length||50,r=e.ellipsis??"...";if(n.length<=i)return C.escapeHtml(n);const u=n.substring(0,i)+r;return`<span title="${C.escapeHtml(n)}">${C.escapeHtml(u)}</span>`}static preLoadOntology(t,e="custom"){const n=Date.now();Object.entries(t).forEach(([i,r])=>{const u=`${e}:${i}`;C.ontologyCache.set(u,{name:r,timestamp:n})})}static ontology(t,e,n){if(t==null||t==="")return"";const i=e.delimiter;if(i&&typeof t=="string"&&t.includes(i)){const r=t.split(i).map(u=>u.trim()).filter(Boolean);return r.length===0?"":`<div class="ts-ontology-list" style="display:flex;flex-wrap:wrap;gap:4px">
                ${r.map(u=>C.renderSingleOntologyTerm(u,e)).join("")}
            </div>`}return C.renderSingleOntologyTerm(String(t).trim(),e)}static renderSingleOntologyTerm(t,e){const n=`${e.ontologyType||"custom"}:${t}`,i=C.ontologyCache.get(n);return i&&Date.now()-i.timestamp<C.cacheTimeout?C.formatOntologyTerm(t,i.name,e):(C.lookupOntologyTerm(t,e,n),C.formatOntologyTerm(t,null,e))}static lookup(t,e,n){if(t==null||t==="")return"";const i=String(t);if(e.map&&typeof e.map=="object"){const r=e.map[i];if(r!==void 0)return C.escapeHtml(String(r))}if(e.apiUrl){const r=`lookup:${e.apiUrl}:${i}`,u=C.lookupCache.get(r);return u&&Date.now()-u.timestamp<C.cacheTimeout?C.escapeHtml(u.value):(C.performAsyncLookup(i,e,r),C.escapeHtml(i)+' <span class="ts-loading-indicator">...</span>')}return e.fallback?C.escapeHtml(e.fallback):C.escapeHtml(i)}static formatOntologyTerm(t,e,n){const i=n.showId!==!1,r=C.escapeHtml(t),u=n.style||"default";let h="#";n.urlTemplate&&(h=n.urlTemplate.replace(/\{value\}/g,encodeURIComponent(t))),e&&n.urlTemplate&&n.urlTemplate.includes("{name}")&&(h=h.replace(/\{name\}/g,encodeURIComponent(e)));const c=n.urlTemplate?"a":"span",o=n.urlTemplate?` href="${h}" target="_blank" rel="noopener noreferrer"`:"";if(u==="badge")return e?`<${c}${o} class="ts-badge ts-ontology-badge" data-term="${r}" style="text-decoration:none">${C.escapeHtml(e)}</${c}>`:`<${c}${o} class="ts-badge ts-ontology-badge ts-loading-term" data-term="${r}" style="text-decoration:none">${r}</${c}>`;if(e){const p=C.escapeHtml(e);return i?`<${c}${o} class="ts-ontology" data-term="${r}">${p} <span class="ts-ontology-id">(${r})</span></${c}>`:`<${c}${o} class="ts-ontology" data-term="${r}">${p}</${c}>`}return`<${c}${o} class="ts-ontology ts-loading-term" data-term="${r}">${r}</${c}>`}static async lookupOntologyTerm(t,e,n){try{let i=null;if(e.map&&e.map[t])i=e.map[t];else switch(e.ontologyType){case"GO":i=await C.lookupGO(t);break;case"KEGG":i=t;break;case"EC":i=t;break;case"custom":e.lookupEndpoint&&(i=await C.lookupCustom(t,e.lookupEndpoint));break}i&&(C.ontologyCache.set(n,{name:i,timestamp:Date.now()}),C.updateOntologyElements(t,i,e))}catch(i){Q.warn(`Ontology lookup failed for ${t}`,i)}}static updateOntologyElements(t,e,n){document.querySelectorAll(`.ts-ontology[data-term="${t}"], .ts-ontology-badge[data-term="${t}"]`).forEach(r=>{r.classList.remove("ts-loading-term");const u=n.showId!==!1;r.classList.contains("ts-ontology-badge")?r.textContent=e:u?r.innerHTML=`${C.escapeHtml(e)} <span class="ts-ontology-id">(${C.escapeHtml(t)})</span>`:r.textContent=e})}static async lookupGO(t){var i,r;const e=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${t}`,{headers:{Accept:"application/json"}});return e.ok&&((r=(i=(await e.json()).results)==null?void 0:i[0])==null?void 0:r.name)||null}static async lookupCustom(t,e){const n=e.replace("{value}",encodeURIComponent(t)),i=await fetch(n);if(!i.ok)return null;const r=await i.json();return r.name||r.label||r.term||null}static async performAsyncLookup(t,e,n){try{const i=e.apiUrl.replace("{value}",encodeURIComponent(t)),r=await fetch(i);if(r.ok){const u=await r.json(),h=e.valuePath?u[e.valuePath]:u.value||u.name||u;h&&C.lookupCache.set(n,{value:String(h),timestamp:Date.now()})}}catch(i){Q.error("Async lookup failed",i)}}static conditional(t,e,n){if(!e.conditions||!Array.isArray(e.conditions))return C.escapeHtml(String(t??""));for(const i of e.conditions)if(C.evaluateCondition(i.when,t,n)){if(i.transform)return C.apply(t,i.transform,n);if(i.value!==void 0)return C.escapeHtml(String(i.value))}return e.default?typeof e.default=="object"&&e.default.type?C.apply(t,e.default,n):C.escapeHtml(String(e.default)):C.escapeHtml(String(t??""))}static ontologyLookup(t,e,n){if(t==null||t==="")return"";let i;if(typeof t=="string"){const c=t.trim();if(c.startsWith("["))try{const o=JSON.parse(c);i=Array.isArray(o)?o.filter(Boolean).map(String):[c]}catch{i=[c]}else i=c.split(/[,;]/).map(o=>o.trim()).filter(Boolean)}else Array.isArray(t)?i=t.filter(Boolean).map(String):i=[String(t)];if(i.length===0)return"";const r=i.slice(0,e.limit||5).map(c=>C.renderOntologyLookupTerm(c,e)),u=i.length-(e.limit||5),h=u>0?`<span class="ts-ontology-more" title="${i.slice(e.limit||5).join(", ")}">+${u}</span>`:"";return`<div class="ts-ontology-lookup-list">${r.join("")}${h}</div>`}static renderOntologyLookupTerm(t,e){const n=e.idPattern||"(rxn\\d+|cpd\\d+)",i=t.match(new RegExp(n,"i")),r=i?i[1]:t,u=`ontolookup:${e.ontologyType||"custom"}:${r}`,h=C.ontologyCache.get(u),c=C.escapeHtml(t),o=e.showId!==!1,p=e.maxLength||50,m=e.style||"inline";let y="#";return e.urlTemplate&&(y=e.urlTemplate.replace(/\{id\}/g,encodeURIComponent(r))),h&&Date.now()-h.timestamp<C.cacheTimeout?C.formatOntologyLookupTerm(r,c,h.name,y,o,p,m):(C.lookupOntologyDescription(r,e,u),C.formatOntologyLookupTerm(r,c,null,y,o,p,m))}static formatOntologyLookupTerm(t,e,n,i,r,u,h){const c=C.escapeHtml(t),o=i!=="#",p=o?`href="${i}" target="_blank" rel="noopener noreferrer"`:"",m=o?"a":"span";if(h==="badge"){if(n){const y=n.length>u?n.substring(0,u)+"":n,E=`${e}: ${n}`;return`<${m} ${p} class="ts-badge ts-ontology-lookup-badge" data-term="${c}" title="${C.escapeHtml(E)}" style="text-decoration:none">
                    ${r?`<span class="ts-ontology-id">${c}</span>: `:""}
                    <span class="ts-ontology-name">${C.escapeHtml(y)}</span>
                </${m}>`}return`<${m} ${p} class="ts-badge ts-ontology-lookup-badge ts-loading-term" data-term="${c}" title="${e}" style="text-decoration:none">${c}</${m}>`}if(n){const y=n.length>u?n.substring(0,u)+"":n,E=`${e}: ${n}`;return`<${m} ${p} class="ts-ontology-lookup" data-term="${c}" title="${C.escapeHtml(E)}">
                ${r?`<span class="ts-ontology-id">${c}</span>: `:""}
                <span class="ts-ontology-name">${C.escapeHtml(y)}</span>
            </${m}>`}return`<${m} ${p} class="ts-ontology-lookup ts-loading-term" data-term="${c}" title="${e}">
            <span class="ts-ontology-id">${c}</span>
            <span class="ts-loading-indicator"></span>
        </${m}>`}static async lookupOntologyDescription(t,e,n){try{let i=null;switch(e.ontologyType||"custom"){case"modelseed_reactions":i=await C.lookupModelSeedReaction(t);break;case"modelseed_compounds":i=await C.lookupModelSeedCompound(t);break;case"go":i=await C.lookupGOTerm(t);break;case"kegg":i=await C.lookupKEGGOrtholog(t);break;case"pfam":i=await C.lookupPfamDomain(t);break;case"cog":i=await C.lookupCOG(t);break;case"ec":i=await C.lookupECNumber(t);break;case"so":i=await C.lookupSequenceOntology(t);break;case"uniref":i=await C.lookupUniRef(t);break;case"custom":if(e.apiUrl){const u=e.apiUrl.replace(/\{id\}/g,encodeURIComponent(t)),h=await fetch(u);if(h.ok){const c=await h.json();i=c.name||c.definition||c.equation||null}}break}i&&(C.ontologyCache.set(n,{name:i,timestamp:Date.now()}),C.updateOntologyLookupElements(t,i,e))}catch(i){Q.warn(`Ontology lookup failed for ${t}`,i)}}static async lookupModelSeedReaction(t){var e,n;try{const i=await fetch(`https://modelseed.org/solr/reactions/select?q=id:${t}&wt=json`);if(!i.ok)return null;const r=await i.json();if(((n=(e=r.response)==null?void 0:e.docs)==null?void 0:n.length)>0){const u=r.response.docs[0];return u.definition||u.name||u.equation||null}return null}catch{return null}}static async lookupModelSeedCompound(t){var e,n;try{const i=await fetch(`https://modelseed.org/solr/compounds/select?q=id:${t}&wt=json`);if(!i.ok)return null;const r=await i.json();if(((n=(e=r.response)==null?void 0:e.docs)==null?void 0:n.length)>0){const u=r.response.docs[0];return u.name||u.formula||null}return null}catch{return null}}static async lookupGOTerm(t){var e,n;try{const i=t.startsWith("GO:")?t:`GO:${t}`,r=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${encodeURIComponent(i)}`,{headers:{Accept:"application/json"}});if(!r.ok)return null;const u=await r.json();return(n=(e=u.results)==null?void 0:e[0])!=null&&n.name?u.results[0].name:null}catch{return null}}static async lookupKEGGOrtholog(t){try{const e=t.replace(/^KEGG:/i,"").replace(/^ko:/i,""),n=await fetch(`https://rest.kegg.jp/get/${e}`);if(!n.ok)return null;const i=await n.text(),r=i.match(/^DEFINITION\s+(.+?)(?:\n|$)/m);if(r)return r[1].trim();const u=i.match(/^NAME\s+(.+?)(?:\n|$)/m);return u?u[1].trim():null}catch{return null}}static async lookupPfamDomain(t){var e;try{const n=t.startsWith("PF")?t:`PF${t}`,i=await fetch(`https://www.ebi.ac.uk/interpro/api/entry/pfam/${n}`,{headers:{Accept:"application/json"}});return i.ok&&((e=(await i.json()).metadata)==null?void 0:e.name)||null}catch{return null}}static async lookupCOG(t){try{const e=t.replace(/^COG:/i,"").trim();return e.length===1&&/^[A-Z]$/i.test(e)?await C.lookupCOGCategory(e.toUpperCase()):/^COG\d+$/i.test(e)?await C.lookupCOGId(e.toUpperCase()):null}catch{return null}}static async lookupCOGCategory(t){var e,n;try{const i=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/?cat=${encodeURIComponent(t)}&format=json`);if(i.ok){const r=await i.json();if((n=(e=r.results)==null?void 0:e[0])!=null&&n.fun_cat_description)return r.results[0].fun_cat_description}return null}catch{return null}}static async lookupCOGId(t){try{const e=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/${encodeURIComponent(t)}/?format=json`);if(!e.ok)return null;const n=await e.json();return n.cog_name?n.cog_name:n.fun_cat_description?n.fun_cat_description:null}catch{return null}}static async lookupECNumber(t){try{const e=t.replace(/^EC:/i,"").trim(),n=await fetch(`https://rest.kegg.jp/get/ec:${e}`);if(!n.ok)return null;const r=(await n.text()).match(/^NAME\s+(.+?)(?:\n|$)/m);return r?r[1].split(";")[0].trim():null}catch{return null}}static async lookupSequenceOntology(t){var e,n,i,r,u,h,c,o;try{const m=(t.startsWith("SO:")?t:`SO:${t}`).replace(":","_"),y=await fetch(`https://www.ebi.ac.uk/ols4/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!y.ok){const x=await fetch(`https://www.ebi.ac.uk/ols/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!x.ok)return null;const S=await x.json();return(i=(n=(e=S._embedded)==null?void 0:e.terms)==null?void 0:n[0])!=null&&i.label?S._embedded.terms[0].label:null}const E=await y.json();return(h=(u=(r=E._embedded)==null?void 0:r.terms)==null?void 0:u[0])!=null&&h.label?E._embedded.terms[0].label:(o=(c=E.elements)==null?void 0:c[0])!=null&&o.label?E.elements[0].label:null}catch{return null}}static async lookupUniRef(t){var e,n,i,r,u;try{let h=t;const c=t.match(/UniRef\d+_(\w+)/i);c&&(h=c[1]);const o=await fetch(`https://rest.uniprot.org/uniprotkb/${h}.json`);if(!o.ok)return null;const m=(await o.json()).proteinDescription;return(n=(e=m==null?void 0:m.recommendedName)==null?void 0:e.fullName)!=null&&n.value?m.recommendedName.fullName.value:(u=(r=(i=m==null?void 0:m.submissionNames)==null?void 0:i[0])==null?void 0:r.fullName)!=null&&u.value?m.submissionNames[0].fullName.value:null}catch{return null}}static updateOntologyLookupElements(t,e,n){const i=n.maxLength||50,r=n.showId!==!1,u=e.length>i?e.substring(0,i)+"":e;document.querySelectorAll(`.ts-ontology-lookup[data-term="${t}"], .ts-ontology-lookup-badge[data-term="${t}"]`).forEach(c=>{c.classList.remove("ts-loading-term"),c.setAttribute("title",`${t}: ${e}`);const o=r?`<span class="ts-ontology-id">${C.escapeHtml(t)}</span>: `:"";c.innerHTML=`${o}<span class="ts-ontology-name">${C.escapeHtml(u)}</span>`})}static register(t,e){C.customTransformers.set(t,e),Q.info(`Registered custom transformer: ${t}`)}static unregister(t){return C.customTransformers.delete(t)}static getAvailableTransformers(){const t=["number","percentage","currency","filesize","duration","date","datetime","boolean","heatmap","progress","link","replace","merge","badge","array","sequence","truncate","ontology","ontologyLookup","lookup","chain","conditional"],e=Array.from(C.customTransformers.keys());return[...t,...e]}static custom(t,e,n){const i=C.customTransformers.get(e.functionName);if(!i)return t?String(t):"";try{return i(t,e.params||{},n)}catch(r){return console.error("Custom transformer error",r),t?String(t):""}}};T(C,"ontologyCache",new Map),T(C,"lookupCache",new Map),T(C,"cacheTimeout",36e5),T(C,"customTransformers",new Map);let Mt=C;class nn extends Qe{constructor(e){super(e);T(this,"stateManager");T(this,"options");T(this,"tooltip",null);T(this,"focusedFilterCol",null);T(this,"selectionStart",null);T(this,"selectionEnd",null);T(this,"filterDebounceTimer",null);T(this,"searchMatches",[]);T(this,"currentMatchIndex",-1);T(this,"selection",new Set);this.stateManager=e.stateManager,this.options=e,this.stateManager.subscribe(()=>{this.render()})}render(){const e=this.stateManager.getState();if(e.columns.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-inbox-fill"></i></div>
                    <h3 class="ts-empty-title">No Data Loaded</h3>
                    <p class="text-muted">Select a data source from the sidebar to begin.</p>
                </div>`;return}const n=e.columns.filter(h=>e.visibleColumns.has(h.column));if(n.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-layout-three-columns"></i></div>
                    <h3 class="ts-empty-title">All Columns Hidden</h3>
                    <p class="text-muted">Enable columns in the sidebar to view data.</p>
                </div>`;return}const i=e.searchValue?e.searchValue.trim().toLowerCase():"";let r='<table class="ts-table"><thead><tr>';const u=e.data.length>0&&e.data.every((h,c)=>this.selection.has(c));if(r+=`<th class="ts-col-select ts-col-fixed"><input type="checkbox" id="ts-select-all" ${u?"checked":""}></th>`,e.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed">#</th>'),n.forEach((h,c)=>{const p=c===0&&!e.showRowNumbers?"ts-col-fixed":"",m=h.sortable?"sortable":"",y=e.sortColumn===h.column?e.sortOrder==="asc"?' <i class="bi bi-sort-up"></i>':' <i class="bi bi-sort-down"></i>':"",E=h.width&&h.width!=="auto"?`width:${h.width}`:"min-width:80px";r+=`<th class="${p} ${m}" data-col="${h.column}" style="${E}">${h.displayName||h.column}${y}</th>`}),r+='</tr><tr class="ts-filter-row">',r+='<th class="ts-col-select ts-col-fixed" style="width:48px"></th>',e.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed" style="width:60px"></th>'),n.forEach((h,c)=>{const p=c===0&&!e.showRowNumbers?"ts-col-fixed":"",m=e.columnFilters[h.column]||"",y=h.width&&h.width!=="auto"?`width:${h.width}`:"min-width:80px",E=this.options.getColumnType?this.options.getColumnType(h.column):"TEXT",x=["INTEGER","REAL","NUMERIC"].includes(E.toUpperCase()),S=x?"e.g., <500, >=100, =50":"Filter...",v=x?"Supports: <, <=, >, >=, =, !=, between, or just number":"Text search, =value, !=value, in(list), between";r+=`<th class="${p}" style="${y}">`,h.filterable!==!1?r+=`<div class="ts-filter-wrap"><input class="ts-filter-input ${m?"has-value":""}" data-col="${h.column}" data-type="${E}" value="${Mt.escapeHtml(m)}" placeholder="${S}" title="${v}"><button class="ts-filter-clear" data-col="${h.column}"><i class="bi bi-x"></i></button></div>`:r+='<div style="height:28px"></div>',r+="</th>"}),r+="</tr></thead><tbody>",e.data.length===0){const h=n.length+(e.showRowNumbers?1:0);r+=`<tr><td colspan="${h}" style="text-align:center;padding:32px;color:var(--text-muted)"><i class="bi bi-search" style="font-size:20px;opacity:.3;display:block;margin-bottom:6px"></i>No matching records</td></tr>`}else{const h=e.currentPage*e.pageSize+1;e.data.forEach((c,o)=>{const p=this.isRowSelected(o),m=h+o;r+=`<tr class="${p?"selected":""}" data-idx="${o}">`,r+=`<td class="ts-col-select ts-col-fixed"><input type="checkbox" class="ts-row-checkbox" data-idx="${o}" ${p?"checked":""}></td>`,e.showRowNumbers&&(r+=`<td class="ts-col-num ts-col-fixed">${m}</td>`),n.forEach((y,E)=>{const S=E===0&&!e.showRowNumbers?"ts-col-fixed":"",v=c[y.column];let $="";const M=v!=null?String(v):"";if(y.transform)$=Mt.apply(v,y.transform,c);else if(y.column.includes("ID")||y.column==="ID"){const N=Mt.escapeHtml(M);$=`<span class="ts-copy-id"><span class="ts-mono">${N}</span><button class="ts-copy-btn" data-id="${N}"><i class="bi bi-clipboard"></i></button></span>`}else $=Mt.escapeHtml(M);i&&i.trim()&&($=this.highlightText($,i).content),r+=`<td class="${S}" data-row="${o}" data-col="${y.column}">${$}</td>`}),r+="</tr>"})}r+="</tbody></table>",this.container.innerHTML=r,e.searchValue&&e.searchValue.trim()?this.trackSearchMatches(e.searchValue.trim()):(this.searchMatches=[],this.currentMatchIndex=-1),this.bindEvents(),this.restoreFocus()}restoreFocus(){if(this.focusedFilterCol){const e=this.container.querySelector(`input.ts-filter-input[data-col="${this.focusedFilterCol}"]`);e&&(e.focus(),this.selectionStart!==null&&this.selectionEnd!==null&&e.setSelectionRange(this.selectionStart,this.selectionEnd))}}getSelection(){return this.selection}clearSelection(){this.selection.clear(),this.render()}selectAll(){this.stateManager.getState().data.forEach((n,i)=>this.selection.add(i)),this.render(),this.options.onRowSelect(-1,!0,!0)}clearFilterFocus(){this.focusedFilterCol=null,this.selectionStart=null,this.selectionEnd=null,this.filterDebounceTimer&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null)}isRowSelected(e){return this.selection.has(e)}bindEvents(){this.container.addEventListener("change",e=>{const n=e.target;if(n.id==="ts-select-all"){const i=this.stateManager.getState();n.checked?i.data.forEach((r,u)=>this.selection.add(u)):this.selection.clear(),this.render(),this.options.onRowSelect(-1,n.checked,!0);return}if(n.classList.contains("ts-row-checkbox")){const i=parseInt(n.dataset.idx||"-1");i>=0&&(n.checked?this.selection.add(i):this.selection.delete(i),this.render(),this.options.onRowSelect(i,n.checked));return}}),this.container.onclick=e=>{var h;const n=e.target,i=n.closest("th.sortable");if(i){const c=i.dataset.col;if(c){const o=this.stateManager.getState(),p=o.sortColumn===c&&o.sortOrder==="asc"?"desc":"asc";this.options.onSort(c,p)}return}const r=n.closest(".ts-filter-clear");if(r){const c=r.dataset.col;c&&this.options.onFilter(c,"");return}if(n.tagName!=="BUTTON"&&n.tagName!=="INPUT"&&!n.closest("a")&&!n.closest(".ts-copy-btn")){const c=n.closest("tr");if(c&&((h=c.parentElement)==null?void 0:h.tagName)==="TBODY"){const o=parseInt(c.dataset.idx||"-1");if(o>=0){const p=this.selection.has(o);p?this.selection.delete(o):this.selection.add(o),this.render(),this.options.onRowSelect(o,!p)}}}const u=n.closest(".ts-copy-btn");if(u){const c=u.dataset.id;c&&navigator.clipboard.writeText(c)}},this.container.oninput=e=>{const n=e.target;if(n.classList.contains("ts-filter-input")){const i=n.dataset.col;i&&(this.focusedFilterCol=i,this.selectionStart=n.selectionStart,this.selectionEnd=n.selectionEnd,this.filterDebounceTimer&&clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=setTimeout(()=>{this.options.onFilter(i,n.value)},300))}},this.container.onkeyup=e=>{const n=e.target;n.classList.contains("ts-filter-input")&&(this.selectionStart=n.selectionStart,this.selectionEnd=n.selectionEnd)},this.container.addEventListener("focusin",e=>{const n=e.target;n.classList.contains("ts-filter-input")?this.focusedFilterCol=n.dataset.col||null:this.focusedFilterCol=null}),this.container.onmouseover=e=>{var i;const n=e.target.closest("td");if(n&&n.scrollWidth>n.clientWidth){const r=(i=n.textContent)==null?void 0:i.trim();r&&this.showTooltip(e,r)}},this.container.onmouseout=e=>{e.target.closest("td")&&this.hideTooltip()}}showTooltip(e,n){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="ts-tooltip",this.tooltip.id="ts-tooltip",document.body.appendChild(this.tooltip)),this.tooltip.textContent=n,this.tooltip.classList.add("show"),this.tooltip.style.left=e.clientX+10+"px",this.tooltip.style.top=e.clientY+10+"px"}hideTooltip(){this.tooltip&&this.tooltip.classList.remove("show")}highlightText(e,n){if(!n||!n.trim())return{content:e,hasMatches:!1};const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${i})`,"gi"),u=document.createElement("div");u.innerHTML=e;const h=(u.textContent||u.innerText||"").toLowerCase();if(!h.includes(n.toLowerCase()))return{content:e,hasMatches:!1};if(!e.includes("<")||e===Mt.escapeHtml(h))return r.lastIndex=0,{content:e.replace(r,'<mark class="highlight">$1</mark>'),hasMatches:!0};const o=document.createTreeWalker(u,NodeFilter.SHOW_TEXT,null),p=[];let m;for(;m=o.nextNode();)if(m.textContent&&(r.lastIndex=0,r.test(m.textContent))){r.lastIndex=0;const y=m.textContent.replace(r,'<mark class="highlight">$1</mark>');p.push({node:m,replacement:y})}return p.forEach(({node:y,replacement:E})=>{const x=y.parentElement;if(x){const S=document.createElement("span");for(S.innerHTML=E;S.firstChild;)x.insertBefore(S.firstChild,y);x.removeChild(y)}}),{content:u.innerHTML,hasMatches:p.length>0}}trackSearchMatches(e){if(this.searchMatches=[],!e||!e.trim()){this.currentMatchIndex=-1;return}this.container.querySelectorAll("mark.highlight").forEach(i=>{const r=i.closest("td[data-row][data-col]");r&&this.searchMatches.push({element:i,row:parseInt(r.getAttribute("data-row")||"0"),col:0})}),this.searchMatches.length>0?(this.currentMatchIndex=0,this.highlightCurrentMatch()):this.currentMatchIndex=-1}navigateToNextMatch(){return this.searchMatches.length===0?!1:(this.currentMatchIndex=(this.currentMatchIndex+1)%this.searchMatches.length,this.highlightCurrentMatch(),!0)}navigateToPreviousMatch(){return this.searchMatches.length===0?!1:(this.currentMatchIndex=this.currentMatchIndex<=0?this.searchMatches.length-1:this.currentMatchIndex-1,this.highlightCurrentMatch(),!0)}highlightCurrentMatch(){if(this.container.querySelectorAll("mark.highlight").forEach(e=>{e.classList.remove("active")}),this.currentMatchIndex>=0&&this.currentMatchIndex<this.searchMatches.length){const e=this.searchMatches[this.currentMatchIndex];e.element.classList.add("active"),this.scrollToMatch(e.element)}}scrollToMatch(e){const n=e.closest("td");if(!n)return;const i=this.container.closest(".ts-grid");if(!i)return;const r=n.getBoundingClientRect(),u=i.getBoundingClientRect(),h=50;if(!(r.top>=u.top+h&&r.bottom<=u.bottom-h&&r.left>=u.left+h&&r.right<=u.right-h)){const o=i,p=n.offsetTop,m=n.offsetLeft,y=o.clientHeight,E=o.clientWidth,x=p-y/2+n.clientHeight/2,S=m-E/2+n.clientWidth/2;o.scrollTo({top:Math.max(0,x),left:Math.max(0,S),behavior:"smooth"})}}getSearchMatchInfo(){return{current:this.currentMatchIndex>=0?this.currentMatchIndex+1:0,total:this.searchMatches.length}}hasSearchMatches(){return this.searchMatches.length>0}}class rn{constructor(t){T(this,"configManager");T(this,"stateManager");T(this,"client");T(this,"createModal");T(this,"switchTable");T(this,"fetchData");T(this,"getSchemaForTable");T(this,"getConfigColumns");T(this,"getStateColumns");T(this,"searchTerm","");T(this,"searchResults",[]);T(this,"isSearchingData",!1);T(this,"modal",null);T(this,"schemaCache",{});T(this,"loadingTables",new Set);this.configManager=t.configManager,this.stateManager=t.stateManager,this.client=t.client,this.createModal=t.createModal,this.switchTable=t.switchTable.bind(t.switchTable),this.fetchData=t.fetchData.bind(t.fetchData),this.getSchemaForTable=t.getSchemaForTable,this.getConfigColumns=t.getConfigColumns,this.getStateColumns=t.getStateColumns}renderSchemaItem(t){const e=[];t.sortable&&e.push({l:"Sortable",bg:"#dbeafe",fg:"#1d4ed8"}),t.filterable&&e.push({l:"Filterable",bg:"#d1fae5",fg:"#059669"}),t.copyable&&e.push({l:"Copyable",bg:"#e2e8f0",fg:"#475569"}),t.pin&&e.push({l:"Pinned",bg:"#ede9fe",fg:"#7c3aed"}),t.pk&&e.push({l:"Primary",bg:"#fee2e2",fg:"#b91c1c"}),t.notnull&&e.push({l:"Not Null",bg:"#fef9c3",fg:"#92400e"});const n=e.map(r=>`<span style="font-size:10px;padding:3px 8px;border-radius:4px;background:${r.bg};color:${r.fg};margin-right:6px;font-weight:500">${r.l}</span>`).join(""),i=(t.type||t.dataType||"string").toString().toUpperCase();return`
            <div class="ts-schema-item">
                <div style="padding-top:4px;flex-shrink:0"><i class="bi bi-hash" style="color:var(--c-accent);font-size:16px"></i></div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:12px">
                        <span class="ts-schema-name">${t.displayName||t.column}</span>
                        <span class="ts-schema-type">${i}</span>
                    </div>
                    ${t.description?`<div class="ts-schema-desc">${t.description}</div>`:""}
                    <div style="display:flex;align-items:center;margin-top:8px;flex-wrap:wrap;gap:4px">
                        ${n}
                        <span style="font-size:11px;color:var(--c-text-muted);font-family:'JetBrains Mono',monospace;margin-left:auto">col: ${t.column}</span>
                    </div>
                </div>
            </div>
        `}async show(t){const e=this.stateManager.getState(),n=e.availableTables||[],i=t||null;this.searchTerm="",this.searchResults=[],this.isSearchingData=!1;const r=(v,$="")=>{const M=$.trim().length>0;return`
                <div class="glass-sidebar" style="width:260px;display:flex;flex-direction:column;height:100%">
                    <div style="padding:16px;border-bottom:1px solid var(--c-border-subtle)">
                        <h3 style="font-size:11px;text-transform:uppercase;color:var(--c-text-muted);font-weight:700;letter-spacing:0.08em;display:flex;align-items:center;gap:8px;margin-bottom:12px">
                            <i class="bi bi-database" style="font-size:14px"></i> Database Schema
                        </h3>
                        <div style="position:relative;margin-bottom:8px">
                            <input type="text" id="ts-db-search" placeholder="Search tables, columns, data..." 
                                value="${$}"
                                style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:100%;outline:none;color:var(--c-text-primary);box-sizing:border-box">
                            <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted);pointer-events:none"></i>
                            ${M?'<button id="ts-db-search-clear" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--c-text-muted);cursor:pointer;padding:2px;font-size:14px"><i class="bi bi-x"></i></button>':""}
                        </div>
                        ${M?`
                            <div style="display:flex;gap:4px;margin-top:4px">
                                <button id="ts-search-data-btn" class="ts-btn-secondary" style="flex:1;height:28px;font-size:11px;padding:0 8px;${this.isSearchingData?"opacity:0.6":""}" ${this.isSearchingData?"disabled":""}>
                                    <i class="bi bi-${this.isSearchingData?"hourglass-split":"search"}"></i> ${this.isSearchingData?"Searching...":"Search Data"}
                                </button>
                            </div>
                        `:""}
                    </div>
                    <div style="flex:1;overflow-y:auto;padding:12px">
                        ${M?`
                            <div style="margin-bottom:8px;padding:0 14px">
                                <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">
                                    ${this.searchResults.length>0?`Results (${this.searchResults.length})`:"No Results"}
                                </span>
                            </div>
                            ${this.searchResults.length>0?this.searchResults.map(N=>{const G=N.columns.length+(N.hasDataMatches?1:0);return`
                                    <div class="ts-nav-item ${v===N.table.name?"active":""}" 
                                         data-target="${N.table.name}" 
                                         data-search="${$}"
                                         style="cursor:pointer">
                                        <i class="bi bi-table"></i> 
                                        <div style="flex:1;min-width:0">
                                            <div style="font-weight:${v===N.table.name?"600":"500"}">${N.table.name}</div>
                                            <div style="font-size:10px;color:var(--c-text-muted);margin-top:2px">
                                                ${G} match${G!==1?"es":""}
                                                ${N.hasDataMatches?"  Has data matches":""}
                                            </div>
                                        </div>
                                    </div>
                                `}).join(""):`
                                <div style="padding:24px;text-align:center;color:var(--c-text-muted)">
                                    <i class="bi bi-search" style="font-size:24px;display:block;margin-bottom:8px;opacity:0.5"></i>
                                    <div style="font-size:12px">No matches found</div>
                                </div>
                            `}
                        `:`
                            <div class="ts-nav-item ${v?"":"active"}" data-target="__overview__">
                                <i class="bi bi-grid-1x2"></i> Overview
                            </div>
                            <div style="margin-top:12px;margin-bottom:8px;padding:0 14px">
                                <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">Tables (${n.length})</span>
                            </div>
                            ${n.map(N=>`
                                <div class="ts-nav-item ${v===N.name?"active":""}" data-target="${N.name}">
                                    <i class="bi bi-table"></i> 
                                    <span style="flex:1">${N.name}</span>
                                    <span style="font-size:11px;color:var(--c-text-muted)">${(N.row_count||0).toLocaleString()}</span>
                                </div>
                            `).join("")}
                        `}
                    </div>
                </div>
            `},u=()=>{const v=n.length,$=n.reduce((M,N)=>M+(N.row_count||0),0);return this.searchTerm&&this.searchResults.length>0?`
                    <div style="padding:40px;max-width:960px;margin:0 auto">
                        <div style="margin-bottom:32px">
                            <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">
                                Search Results for "${this.searchTerm}"
                            </h2>
                            <p style="color:var(--c-text-secondary);font-size:14px">Found ${this.searchResults.length} table${this.searchResults.length!==1?"s":""} with matches</p>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:16px">
                            ${this.searchResults.map(M=>{const N=M.columns.length+(M.hasDataMatches?1:0);return`
                                    <div class="ts-card-nav" data-target="${M.table.name}" data-search="${this.searchTerm}" style="cursor:pointer">
                                        <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px">
                                            <i class="bi bi-table"></i>
                                        </div>
                                        <div style="flex:1">
                                            <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.table.name}</div>
                                            <div style="font-size:12px;color:var(--c-text-muted);margin-top:4px">
                                                ${N} match${N!==1?"es":""}
                                                ${M.hasDataMatches?"  Data matches":""}
                                                ${M.columns.length>0?`  ${M.columns.length} column${M.columns.length!==1?"s":""}`:""}
                                            </div>
                                            ${M.columns.length>0?`
                                                <div style="margin-top:8px;font-size:11px;color:var(--c-text-muted);max-height:60px;overflow-y:auto">
                                                    ${M.columns.slice(0,3).map(G=>`
                                                        <div style="padding:2px 0"> ${G.displayName||G.column}</div>
                                                    `).join("")}
                                                    ${M.columns.length>3?`<div style="padding:2px 0;font-style:italic">+ ${M.columns.length-3} more</div>`:""}
                                                </div>
                                            `:""}
                                        </div>
                                        <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                                    </div>
                                `}).join("")}
                        </div>
                    </div>
                `:`
                <div style="padding:48px;max-width:900px;margin:0 auto">
                    <div style="text-align:center;margin-bottom:48px">
                        <div style="width:80px;height:80px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 20px;box-shadow:0 8px 24px var(--c-accent-glow)">
                            <i class="bi bi-database"></i>
                        </div>
                        <h2 style="font-size:28px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">Database Overview</h2>
                        <p style="color:var(--c-text-secondary);font-size:14px">${e.berdlTableId||"Connected Database"}</p>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:20px;margin-bottom:48px">
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Tables</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${v}</div>
                        </div>
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Records</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${$.toLocaleString()}</div>
                        </div>
                    </div>
                    <h3 style="font-size:12px;font-weight:700;margin-bottom:20px;color:var(--c-text-muted);text-transform:uppercase;letter-spacing:0.08em">Available Tables</h3>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px">
                        ${n.map(M=>`
                            <div class="ts-card-nav" data-target="${M.name}">
                                <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px"><i class="bi bi-table"></i></div>
                                <div style="flex:1">
                                    <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.name}</div>
                                    <div style="font-size:12px;color:var(--c-text-muted);margin-top:2px">${(M.row_count||0).toLocaleString()} records</div>
                                </div>
                                <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `},h=v=>{if(!v)return"STRING";const $=v.toUpperCase();return $.includes("INT")?"INTEGER":$.includes("REAL")||$.includes("DOUBLE")||$.includes("FLOAT")?"FLOAT":$.includes("CHAR")||$.includes("TEXT")||$.includes("CLOB")?"STRING":$.includes("BLOB")?"BLOB":$.includes("DATE")||$.includes("TIME")?"DATETIME":$},c=v=>{const $=this.configManager.getTableConfig(v),G=this.stateManager.getState().activeTableName===v?this.getStateColumns():[],D=this.schemaCache[v],q=D&&D.length>0?D:G.length>0?G:$.columns||[];if(D&&D.length>0)return D;const j=new Map(($.columns||[]).map(K=>[K.column,K]));return q.map(K=>{const J=K.column||K.name,L=j.get(J)||{},R=h(K.type||L.dataType||L.type);return{...L,...K,column:J,type:R,dataType:R}})},o=v=>{var j,K,J;const $=this.configManager.getTableConfig(v),M=e.activeTableName===v,N=c(v),G=this.loadingTables.has(v),D=($==null?void 0:$.name)||v,q=((j=$==null?void 0:$.settings)==null?void 0:j.description)||"No description available for this table.";return`
                <div style="padding:40px;max-width:960px;margin:0 auto">
                    <div style="margin-bottom:36px">
                        <div style="display:flex;align-items:flex-start;gap:20px">
                            <div style="width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;box-shadow:0 4px 16px var(--c-accent-glow)">
                                <i class="${((K=$==null?void 0:$.settings)==null?void 0:K.icon)||"bi bi-table"}"></i>
                            </div>
                            <div style="flex:1">
                                <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin:0 0 8px 0">${D}</h2>
                                <div style="font-size:14px;color:var(--c-text-secondary);line-height:1.6;margin-bottom:16px;max-width:600px">
                                    ${q}
                                </div>
                                <div style="display:flex;gap:20px;font-size:13px;color:var(--c-text-muted)">
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-layout-three-columns"></i> ${N.length} Columns</span>
                                    ${M?`<span style="display:flex;align-items:center;gap:6px"><i class="bi bi-list-ol"></i> ${(J=e.totalCount)==null?void 0:J.toLocaleString()} Records</span>`:""}
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-${M?'check-circle-fill" style="color:var(--success)':"circle"}"></i> ${M?"Currently Loaded":"Not Loaded"}</span>
                                </div>
                            </div>
                            <button id="ts-export-current" class="ts-btn-secondary" data-table="${v}" style="height:40px;padding:0 20px">
                                <i class="bi bi-download"></i> Export Schema
                            </button>
                        </div>
                    </div>
                    <div class="glass-panel" style="overflow:hidden">
                        <div style="padding:14px 20px;border-bottom:1px solid var(--c-border-subtle);display:flex;justify-content:space-between;align-items:center;background:rgba(248,250,252,0.3)">
                            <h4 style="margin:0;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);display:flex;align-items:center;gap:8px">
                                <i class="bi bi-list-columns-reverse"></i> Schema Definition
                            </h4>
                            <div style="display:flex;align-items:center;gap:8px">
                                <button id="ts-refresh-schema" data-table="${v}" class="ts-btn-secondary" style="height:28px;padding:0 10px;font-size:11px">
                                    <i class="bi bi-arrow-repeat"></i> Refresh schema
                                </button>
                                <div style="position:relative">
                                <input type="text" id="ts-schema-filter" placeholder="Search columns..." style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:220px;outline:none;color:var(--c-text-primary)">
                                <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted)"></i>
                            </div>
                            </div>
                        </div>
                        <div id="ts-schema-items-container" style="max-height:55vh;overflow-y:auto">
                            ${G?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-hourglass-split" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>Loading schema...</div>':N.length===0?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-info-circle" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>No schema information yet. Click "Refresh schema" to fetch live schema.</div>':N.map(L=>this.renderSchemaItem(L)).join("")}
                        </div>
                    </div>
                </div>
             `},p=async v=>{if(!(!v||this.schemaCache[v]||this.loadingTables.has(v))){this.loadingTables.add(v),m(v);try{const $=await this.getSchemaForTable(v),M=this.getConfigColumns(v),N=new Map(M.map(D=>[D.column,D])),G=$.map(D=>{const q=D.column||D.name,j=N.get(q)||{},K=h(D.type||j.dataType||j.type);return{...j,column:q,displayName:j.displayName||q,type:K,dataType:K,description:j.description,sortable:j.sortable!==!1,filterable:j.filterable!==!1,copyable:j.copyable,pin:j.pin,pk:D.pk,notnull:D.notnull}});this.schemaCache[v]=G.length>0?G:M.map(D=>({...D,column:D.column,type:h(D.dataType||D.type),dataType:h(D.dataType||D.type)}))}catch($){Q.warn(`[SchemaViewer] Failed to load schema for table ${v}`,$)}finally{this.loadingTables.delete(v),m(v)}}},m=(v,$=this.searchTerm)=>{var G,D;const M=(G=this.modal)==null?void 0:G.querySelector("#ts-schema-sidebar"),N=(D=this.modal)==null?void 0:D.querySelector("#ts-schema-main");M&&(M.innerHTML=r(v==="__overview__"?null:v,$)),N&&(N.innerHTML=v==="__overview__"?u():o(v),N.scrollTop=0),E()},y=async(v,$=!1)=>{var G;if(this.searchTerm=v.trim(),this.searchResults=[],!this.searchTerm){m("__overview__");return}const M=this.searchTerm.toLowerCase(),N=this.stateManager.getState();for(const D of n){const q=D.name.toLowerCase().includes(M),j=this.configManager.getTableConfig(D.name),L=(N.activeTableName===D.name?N.columns:j.columns||[]).filter(R=>{const at=(R.displayName||R.column||"").toLowerCase(),W=(R.column||"").toLowerCase(),X=(R.description||"").toLowerCase();return at.includes(M)||W.includes(M)||X.includes(M)});(q||L.length>0)&&this.searchResults.push({table:D,columns:L,hasDataMatches:!1})}if($&&N.berdlTableId){this.isSearchingData=!0;const D=(G=this.modal)==null?void 0:G.querySelector("#ts-schema-sidebar");D&&(D.innerHTML=r(null,this.searchTerm)),E();const q=n.map(async j=>{try{if((await this.client.getTableData({berdl_table_id:N.berdlTableId||"",table_name:j.name,limit:1,offset:0,search_value:this.searchTerm})).total_count>0){const J=this.searchResults.find(L=>L.table.name===j.name);J?J.hasDataMatches=!0:this.searchResults.push({table:j,columns:[],hasDataMatches:!0})}}catch(K){Q.warn(`Failed to search data in table ${j.name}`,K)}});await Promise.all(q),this.isSearchingData=!1}m("__overview__")},E=()=>{if(!this.modal)return;const v=this.modal.querySelector("#ts-db-search"),$=this.modal.querySelector("#ts-db-search-clear"),M=this.modal.querySelector("#ts-search-data-btn");if(v){let D=null;v.addEventListener("input",()=>{const q=v.value;this.searchTerm=q,D&&clearTimeout(D),D=setTimeout(()=>{y(q,!1)},300)}),v.addEventListener("keypress",q=>{q.key==="Enter"&&(q.preventDefault(),D&&clearTimeout(D),y(v.value,!1))})}$&&$.addEventListener("click",()=>{v&&(v.value=""),this.searchTerm="",this.searchResults=[],this.isSearchingData=!1,m("__overview__","")}),M&&M.addEventListener("click",async()=>{!this.searchTerm||this.isSearchingData||await y(this.searchTerm,!0)}),this.modal.querySelectorAll(".ts-nav-item, .ts-card-nav").forEach(D=>{D.addEventListener("click",()=>{var K;const q=D.dataset.target,j=D.dataset.search;if(q)if(q!=="__overview__"&&j){const J=(K=this.modal)==null?void 0:K.querySelector(".ts-modal-close");J&&J.click(),this.switchTable(q).then(()=>{this.stateManager.update({searchValue:j,currentPage:0}),this.fetchData()})}else m(q,j||this.searchTerm),p(q)})});const N=this.modal.querySelector("#ts-schema-filter"),G=this.modal.querySelector("#ts-schema-items-container");if(N&&G&&N.addEventListener("input",()=>{const D=N.value.toLowerCase();G.querySelectorAll(".ts-schema-item").forEach(q=>{const j=(q.textContent||"").toLowerCase();q.style.display=j.includes(D)?"flex":"none"})}),this.modal){const D=this.modal.querySelector("#ts-export-current");D==null||D.addEventListener("click",()=>{var St;const j=D.dataset.table;if(!j)return;const K=this.stateManager.getState(),J=this.configManager.getTableConfig(j),L=(St=this.schemaCache[j])!=null&&St.length?this.schemaCache[j]:K.activeTableName===j?K.columns:J.columns||[],R=JSON.stringify(J||{tableName:j,columns:L},null,2),at=new Blob([R],{type:"application/json"}),W=URL.createObjectURL(at),X=document.createElement("a");X.href=W,X.download=`${j}_schema.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(W)});const q=this.modal.querySelector("#ts-refresh-schema");q==null||q.addEventListener("click",()=>{const j=q.dataset.table;j&&(delete this.schemaCache[j],p(j))})}},x=`
            <div style="display:flex;height:100%;overflow:hidden">
                <div id="ts-schema-sidebar">${r(i||null)}</div>
                <div id="ts-schema-main" style="flex:1;overflow-y:auto;background:var(--c-bg-app-solid);position:relative">
                    ${i?o(i):u()}
                </div>
            </div>
        `;this.modal=this.createModal("Database Explorer",x);const S=this.modal.querySelector(".ts-modal-body");S&&(S.style.padding="0",S.style.height="calc(80vh - 60px)"),E(),t&&p(t)}}class on{constructor(t){T(this,"stateManager");T(this,"createModal");T(this,"showAlert");this.stateManager=t.stateManager,this.createModal=t.createModal,this.showAlert=t.showAlert}async show(t){const e=this.stateManager.getState();if(!e.berdlTableId||!t){this.showAlert("No table selected","warning");return}try{this.stateManager.update({loading:!0});const n=e.berdlTableId.replace("local/",""),r=await fetch(`http://localhost:3000/object/${n}/tables/${t}/stats`);if(!r.ok)throw new Error("Failed to load statistics");const u=await r.json(),h=`
                <div style="padding:24px;max-width:800px;overflow-y:auto;max-height:80vh">
                    <h2 style="margin-bottom:20px;font-size:18px;font-weight:600">
                        <i class="bi bi-graph-up"></i> Column Statistics: ${t}
                    </h2>
                    <div style="margin-bottom:16px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm);font-size:13px">
                        <strong>Total Rows:</strong> ${u.row_count.toLocaleString()}
                    </div>
                    <div style="display:grid;gap:12px">
                        ${u.columns.map(c=>`
                            <div style="padding:16px;background:var(--c-bg-surface);border:1px solid var(--c-border-subtle);border-radius:var(--radius-md)">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                    <h3 style="font-size:14px;font-weight:600">${c.column}</h3>
                                    <span style="font-size:11px;color:var(--c-text-muted);text-transform:uppercase">${c.type}</span>
                                </div>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px;font-size:12px">
                                    <div><strong>Nulls:</strong> ${c.null_count.toLocaleString()}</div>
                                    <div><strong>Distinct:</strong> ${c.distinct_count.toLocaleString()}</div>
                                    ${c.min!==void 0?`<div><strong>Min:</strong> ${c.min}</div>`:""}
                                    ${c.max!==void 0?`<div><strong>Max:</strong> ${c.max}</div>`:""}
                                    ${c.mean!==void 0?`<div><strong>Mean:</strong> ${c.mean.toFixed(2)}</div>`:""}
                                    ${c.median!==void 0?`<div><strong>Median:</strong> ${c.median}</div>`:""}
                                    ${c.stddev!==void 0?`<div><strong>StdDev:</strong> ${c.stddev.toFixed(2)}</div>`:""}
                                </div>
                                ${c.sample_values&&c.sample_values.length>0?`
                                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--c-border-subtle)">
                                        <div style="font-size:11px;color:var(--c-text-muted);margin-bottom:6px">Sample Values:</div>
                                        <div style="display:flex;flex-wrap:wrap;gap:4px">
                                            ${c.sample_values.slice(0,10).map(o=>`
                                                <span style="padding:2px 8px;background:var(--c-bg-surface-alt);border-radius:4px;font-size:11px;font-family:monospace">${String(o).substring(0,30)}</span>
                                            `).join("")}
                                        </div>
                                    </div>
                                `:""}
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;this.createModal(`Column Statistics: ${t}`,h)}catch(n){Q.error(`Failed to load statistics: ${n.message}`,n),this.showAlert(`Failed to load statistics: ${n.message}`,"danger")}finally{this.stateManager.update({loading:!1})}}}const Ft=class Ft{constructor(){T(this,"listeners",new Map);T(this,"wildcardListeners",new Set);T(this,"eventHistory",[]);T(this,"maxHistorySize",100);T(this,"debug",!1);typeof localStorage<"u"&&(this.debug=localStorage.getItem("DATATABLE_DEBUG")==="true")}static getInstance(){return Ft.instance||(Ft.instance=new Ft),Ft.instance}on(t,e){var i;this.listeners.has(t)||this.listeners.set(t,new Set);const n={callback:e,once:!1};return(i=this.listeners.get(t))==null||i.add(n),()=>{var r;(r=this.listeners.get(t))==null||r.delete(n)}}once(t,e){var i;this.listeners.has(t)||this.listeners.set(t,new Set);const n={callback:e,once:!0};return(i=this.listeners.get(t))==null||i.add(n),()=>{var r;(r=this.listeners.get(t))==null||r.delete(n)}}off(t,e){if(!e){this.listeners.delete(t);return}const n=this.listeners.get(t);if(n){for(const i of n)if(i.callback===e){n.delete(i);break}}}onAny(t){return this.wildcardListeners.add(t),()=>{this.wildcardListeners.delete(t)}}emit(t,e){this.debug&&Q.debug(`[EventBus] ${t}`,e),this.eventHistory.push({event:t,data:e,timestamp:Date.now()}),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift();const n=this.listeners.get(t);if(n){const i=[];for(const r of n)try{r.callback(e),r.once&&i.push(r)}catch(u){Q.error(`[EventBus] Error in listener for ${t}`,u)}for(const r of i)n.delete(r)}for(const i of this.wildcardListeners)try{i(t,e)}catch(r){Q.error("[EventBus] Error in wildcard listener",r)}if(this.listeners.has("*")){const i=this.listeners.get("*");if(i){const r={event:t,data:e};for(const u of i)u.callback(r)}}}getHistory(){return[...this.eventHistory]}clearHistory(){this.eventHistory=[]}setDebug(t){this.debug=t,typeof localStorage<"u"&&localStorage.setItem("DATATABLE_DEBUG",t?"true":"false")}listenerCount(t){var e;return((e=this.listeners.get(t))==null?void 0:e.size)??0}clear(t){t?this.listeners.delete(t):(this.listeners.clear(),this.wildcardListeners.clear())}};T(Ft,"instance");let We=Ft;const It=We.getInstance(),Pt=class Pt{constructor(){T(this,"defaults",{format:"csv",filename:"export",includeHeaders:!0,delimiter:",",lineEnding:"unix",jsonPretty:!1,chunkSize:1e3})}static getInstance(){return Pt.instance||(Pt.instance=new Pt),Pt.instance}async export(t,e){const n=Date.now(),i={...this.defaults,...e};It.emit("export:started",{format:i.format,rowCount:t.length});try{const r=i.columns||this.inferColumns(t);let u,h,c;switch(i.format){case"csv":u=this.toCSV(t,r,i),h="text/csv;charset=utf-8",c="csv";break;case"tsv":u=this.toCSV(t,r,{...i,delimiter:"	"}),h="text/tab-separated-values;charset=utf-8",c="tsv";break;case"json":u=this.toJSON(t,r,i),h="application/json;charset=utf-8",c="json";break;case"json-lines":u=this.toJSONLines(t,r,i),h="application/x-ndjson;charset=utf-8",c="jsonl";break;case"xlsx":console.warn("XLSX export not yet implemented, falling back to CSV"),u=this.toCSV(t,r,i),h="text/csv;charset=utf-8",c="csv";break;default:throw new Error(`Unsupported export format: ${i.format}`)}const o=`${i.filename}.${c}`;this.downloadFile(u,o,h);const p={success:!0,filename:o,format:i.format,rowCount:t.length,byteSize:new Blob([u]).size,duration:Date.now()-n};return It.emit("export:completed",p),p}catch(r){const u={success:!1,filename:i.filename,format:i.format,rowCount:0,byteSize:0,duration:Date.now()-n,error:r.message||String(r)};return It.emit("export:failed",{...u,error:u.error}),u}}async toClipboard(t,e){const n={format:"tsv",includeHeaders:!0,...e};try{const i=n.columns||this.inferColumns(t),r=this.toCSV(t,i,{...this.defaults,...n,delimiter:"	"});return await navigator.clipboard.writeText(r),It.emit("export:clipboard",{rowCount:t.length}),!0}catch(i){return console.error("Failed to copy to clipboard:",i),!1}}getExtension(t){return{csv:"csv",tsv:"tsv",json:"json","json-lines":"jsonl",xlsx:"xlsx"}[t]||"txt"}getMimeType(t){return{csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json","json-lines":"application/x-ndjson",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}[t]||"text/plain"}toCSV(t,e,n){const i=[],r=n.lineEnding==="windows"?`\r
`:`
`,u=n.delimiter;n.includeHeaders&&i.push(e.map(h=>this.escapeCSV(h.header,u)).join(u));for(let h=0;h<t.length;h++){const c=t[h],o=e.map(p=>{let m=c[p.key];return p.transform&&(m=p.transform(m,c)),this.escapeCSV(this.formatValue(m),u)});if(i.push(o.join(u)),n.chunkSize&&h>0&&h%n.chunkSize===0){const p=h/t.length*100;It.emit("export:progress",{progress:p,processed:h,total:t.length})}}return i.join(r)}toJSON(t,e,n){const i=t.map(r=>{const u={};return e.forEach(h=>{let c=r[h.key];h.transform&&(c=h.transform(c,r)),u[h.key]=c}),u});return n.jsonPretty?JSON.stringify(i,null,2):JSON.stringify(i)}toJSONLines(t,e,n){const i=n.lineEnding==="windows"?`\r
`:`
`;return t.map(r=>{const u={};return e.forEach(h=>{let c=r[h.key];h.transform&&(c=h.transform(c,r)),u[h.key]=c}),JSON.stringify(u)}).join(i)}inferColumns(t){if(t.length===0)return[];const e=new Set;return t.forEach(n=>{Object.keys(n).forEach(i=>e.add(i))}),Array.from(e).map(n=>({key:n,header:n.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}))}escapeCSV(t,e){return t.includes('"')||t.includes(e)||t.includes(`
`)||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t}formatValue(t){return t==null?"":typeof t=="object"?JSON.stringify(t):String(t)}downloadFile(t,e,n){const i=new Blob([t],{type:n}),r=URL.createObjectURL(i),u=document.createElement("a");u.href=r,u.download=e,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(r)}};T(Pt,"instance");let Ke=Pt;const ln=Ke.getInstance(),jt=class jt{constructor(){T(this,"shortcuts",new Map);T(this,"keyMap",new Map);T(this,"enabled",!0);this.bindGlobalHandler()}static getInstance(){return jt.instance||(jt.instance=new jt),jt.instance}register(t){const e=this.normalizeKeys(t.keys);this.keyMap.has(e)&&console.warn(`Shortcut conflict: ${t.keys} is already registered for ${this.keyMap.get(e)}`),this.shortcuts.set(t.id,{...t,enabled:t.enabled!==!1,preventDefault:t.preventDefault!==!1}),this.keyMap.set(e,t.id)}unregister(t){const e=this.shortcuts.get(t);if(e){const n=this.normalizeKeys(e.keys);this.keyMap.delete(n),this.shortcuts.delete(t)}}setEnabled(t,e){const n=this.shortcuts.get(t);n&&(n.enabled=e)}setGlobalEnabled(t){this.enabled=t}getShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(t){return this.getShortcuts().filter(e=>e.category===t)}showHelp(){It.emit("modal:opened",{type:"keyboard-help"});const t=this.renderHelpContent();document.dispatchEvent(new CustomEvent("keyboard-help",{detail:{content:t}}))}hideHelp(){It.emit("modal:closed",{type:"keyboard-help"})}bindGlobalHandler(){document.addEventListener("keydown",t=>{if(!this.enabled||this.isInputElement(t.target)&&t.key!=="Escape")return;const e=this.eventToNormalizedKey(t),n=this.keyMap.get(e);if(n){const i=this.shortcuts.get(n);if(i&&i.enabled){i.preventDefault&&t.preventDefault();try{i.handler(t)}catch(r){console.error(`Error in shortcut handler ${n}:`,r)}}}})}isInputElement(t){const e=t.tagName.toLowerCase();return e==="input"||e==="textarea"||e==="select"||t.contentEditable==="true"}normalizeKeys(t){const e=t.toLowerCase().split("+").map(r=>r.trim()),n=[];(e.includes("ctrl")||e.includes("control"))&&n.push("ctrl"),e.includes("alt")&&n.push("alt"),e.includes("shift")&&n.push("shift"),(e.includes("meta")||e.includes("cmd")||e.includes("command"))&&n.push("meta");const i=e.find(r=>!["ctrl","control","alt","shift","meta","cmd","command"].includes(r));return i&&n.push(i),n.join("+")}eventToNormalizedKey(t){const e=[];t.ctrlKey&&e.push("ctrl"),t.altKey&&e.push("alt"),t.shiftKey&&e.push("shift"),t.metaKey&&e.push("meta");let n=t.key.toLowerCase();return n===" "&&(n="space"),n==="arrowup"&&(n="up"),n==="arrowdown"&&(n="down"),n==="arrowleft"&&(n="left"),n==="arrowright"&&(n="right"),["control","alt","shift","meta"].includes(n)||e.push(n),e.join("+")}renderHelpContent(){const t={navigation:{title:"Navigation",icon:"bi-compass"},selection:{title:"Selection",icon:"bi-check2-square"},actions:{title:"Actions",icon:"bi-lightning"},filters:{title:"Filters",icon:"bi-funnel"},general:{title:"General",icon:"bi-gear"}};let e='<div class="keyboard-help">';for(const[n,i]of Object.entries(t)){const r=this.getShortcutsByCategory(n);if(r.length!==0){e+=`
                <div class="keyboard-help-category">
                    <h3><i class="${i.icon}"></i> ${i.title}</h3>
                    <div class="keyboard-help-list">
            `;for(const u of r){const h=this.formatKeysForDisplay(u.keys);e+=`
                    <div class="keyboard-help-item">
                        <span class="keyboard-help-desc">${u.description}</span>
                        <span class="keyboard-help-keys">${h}</span>
                    </div>
                `}e+="</div></div>"}}return e+="</div>",e}formatKeysForDisplay(t){return t.split("+").map(e=>`<kbd>${e.charAt(0).toUpperCase()+e.slice(1)}</kbd>`).join(" + ")}};T(jt,"instance");let be=jt;function cn(k){const t=be.getInstance();t.register({id:"help",keys:"?",description:"Show keyboard shortcuts",category:"general",handler:()=>t.showHelp()}),t.register({id:"close-modal",keys:"Escape",description:"Close modal / Clear selection",category:"general",handler:()=>{var n;const e=document.querySelector(".ts-modal-overlay.show");if(e){e.classList.remove("show");return}(n=k.onClearSelection)==null||n.call(k)}}),k.onSearch&&(t.register({id:"search",keys:"Ctrl+F",description:"Focus search box",category:"filters",handler:k.onSearch}),t.register({id:"search-alt",keys:"/",description:"Focus search box",category:"filters",handler:k.onSearch})),k.onExport&&t.register({id:"export",keys:"Ctrl+E",description:"Export data",category:"actions",handler:k.onExport}),k.onRefresh&&t.register({id:"refresh",keys:"Ctrl+R",description:"Refresh data",category:"actions",handler:k.onRefresh,preventDefault:!0}),k.onReset&&t.register({id:"reset",keys:"Ctrl+Shift+R",description:"Reset all filters",category:"actions",handler:k.onReset,preventDefault:!0}),k.onShowSchema&&t.register({id:"schema",keys:"Ctrl+I",description:"Show database schema",category:"actions",handler:k.onShowSchema}),k.onSelectAll&&t.register({id:"select-all",keys:"Ctrl+A",description:"Select all rows",category:"selection",handler:k.onSelectAll}),k.onClearSelection&&t.register({id:"clear-selection",keys:"Ctrl+D",description:"Clear selection",category:"selection",handler:k.onClearSelection}),k.onNextPage&&t.register({id:"next-page",keys:"Ctrl+Right",description:"Next page",category:"navigation",handler:k.onNextPage}),k.onPrevPage&&t.register({id:"prev-page",keys:"Ctrl+Left",description:"Previous page",category:"navigation",handler:k.onPrevPage}),k.onFirstPage&&t.register({id:"first-page",keys:"Ctrl+Home",description:"First page",category:"navigation",handler:k.onFirstPage}),k.onLastPage&&t.register({id:"last-page",keys:"Ctrl+End",description:"Last page",category:"navigation",handler:k.onLastPage}),k.onToggleTheme&&t.register({id:"toggle-theme",keys:"Ctrl+Shift+T",description:"Toggle dark/light theme",category:"general",handler:k.onToggleTheme})}be.getInstance();class dn{constructor(t){T(this,"container");T(this,"configUrl");T(this,"configManager");T(this,"registry");T(this,"client");T(this,"stateManager");T(this,"categoryManager",null);T(this,"sidebar");T(this,"toolbar");T(this,"grid");T(this,"schemaViewer");T(this,"statsViewer");T(this,"theme","light");T(this,"density","normal");T(this,"dom",{});T(this,"columnSchemas",{});if(!t.container)throw new Error("Container required");this.container=t.container,this.configUrl=t.configUrl||null,this.client=t.client||new qs,this.registry=Gt.getInstance(),this.stateManager=new tn,this.stateManager.subscribe(this.onStateChange.bind(this));const e=localStorage.getItem("ts-theme"),n=localStorage.getItem("ts-density");e&&(this.theme=e),n&&(this.density=n)}async init(){try{await this.loadConfiguration();const t=this.configManager.getEnvironment(),e=this.configManager.getApis(),i=this.configManager.getDefaultApiId()||(e.length>0?e[0].id:null);if(i){const u=this.configManager.getApi(i);u&&this.client.updateConfig(u)}else{const u=this.configManager.getApiUrl();u?this.client=new qs({environment:t,baseUrl:u}):this.client.setEnvironment(t)}const r=this.configManager.getGlobalSettings();this.stateManager.update({pageSize:r.pageSize||50,showRowNumbers:r.showRowNumbers!==!1}),this.loadStateFromUrl(),this.renderLayout(),this.initComponents()}catch(t){this.container.innerHTML=`<div class="ts-alert ts-alert-danger"><i class="bi bi-x-circle-fill"></i> ${t.message}</div>`}}renderLayout(){this.container.innerHTML=`
            <div class="ts-app" data-theme="${this.theme}" data-density="${this.density}">
                <aside class="ts-sidebar" id="ts-sidebar-container"></aside>
                <main class="ts-main">
                    <header class="ts-toolbar" id="ts-toolbar-container"></header>
                    <div id="ts-alert"></div>

                    <div class="ts-grid-header" id="ts-grid-header" style="display:none">
                        <div class="ts-grid-header-content">
                            <div class="ts-db-info">
                                <i class="bi bi-database"></i>
                                <span id="ts-db-name">Database</span>
                            </div>
                            <div class="ts-table-info">
                                <i class="bi bi-table"></i>
                                <span id="ts-active-table-name">Table</span>
                            </div>
                        </div>
                    </div>
                    <div class="ts-grid-wrapper" style="position:relative">
                        <div class="ts-loading-overlay" id="ts-loading-overlay" style="display:none">
                            <div class="ts-loading-spinner-wrapper">
                                <span class="ts-spinner" style="width:32px;height:32px"></span>
                                <span class="ts-loading-text" style="margin-top:12px;font-size:13px;color:var(--c-text-secondary)">Loading...</span>
                            </div>
                        </div>
                        <div class="ts-grid" id="ts-grid-container"></div>
                    </div>
                    <footer class="ts-footer">
                        <div class="ts-status" id="ts-status">Ready</div>
                        <div class="ts-table-name" id="ts-table-name"></div>
                        <div class="ts-pager" id="ts-pager"></div>
                    </footer>
                </main>
                
                <div class="ts-settings-popup" id="ts-settings-popup" style="top: 70px; right: 24px; bottom: auto;">
                    <div class="ts-settings-header">Settings</div>
                     <div class="ts-settings-body">
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-moon-stars"></i> Theme</div>
                            <div class="ts-switch ${this.theme==="dark"?"on":""}" id="ts-theme-toggle"></div>
                        </div>
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-arrows-angle-expand"></i> Density</div>
                            <div class="ts-density-options">
                                <button class="ts-density-opt ${this.density==="compact"?"active":""}" data-density="compact" title="Compact"><i class="bi bi-list"></i></button>
                                <button class="ts-density-opt ${this.density==="normal"?"active":""}" data-density="normal" title="Normal"><i class="bi bi-list-ul"></i></button>
                                <button class="ts-density-opt ${this.density==="comfortable"?"active":""}" data-density="comfortable" title="Comfortable"><i class="bi bi-card-heading"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,this.dom.status=this.container.querySelector("#ts-status"),this.dom.pager=this.container.querySelector("#ts-pager"),this.dom.alert=this.container.querySelector("#ts-alert"),this.dom.tableName=this.container.querySelector("#ts-table-name"),this.dom.loadingOverlay=this.container.querySelector("#ts-loading-overlay")}initComponents(){this.sidebar=new sn({container:this.container.querySelector("#ts-sidebar-container"),configManager:this.configManager,stateManager:this.stateManager,onApiChange:r=>this.switchApi(r),onLoadData:()=>this.handleLoadData(),onTableChange:r=>this.switchTable(r),onExport:()=>this.exportCsv(),onReset:()=>this.reset(),onShowSchema:r=>this.showDatabaseSchema(r),onShowStats:r=>this.showColumnStatistics(r),onLoadDbPath:r=>this.loadDatabaseFromPath(r)}),this.sidebar.mount(),this.toolbar=new an({container:this.container.querySelector("#ts-toolbar-container"),onSearch:r=>{const u=r?r.trim():"";this.stateManager.update({searchValue:u})},onRefresh:()=>this.softRefresh(),onSearchNext:()=>{this.grid&&(this.grid.navigateToNextMatch(),this.toolbar.updateSearchNav())},onSearchPrev:()=>{this.grid&&(this.grid.navigateToPreviousMatch(),this.toolbar.updateSearchNav())},getSearchMatchInfo:()=>this.grid?this.grid.getSearchMatchInfo():{current:0,total:0}}),this.toolbar.mount(),this.initKeyboardShortcuts();const t=this.toolbar.getSettingsButton();t&&t.addEventListener("click",r=>{r.stopPropagation();const u=this.container.querySelector("#ts-settings-popup");u==null||u.classList.toggle("show")});const e=this.container.querySelector("#ts-theme-toggle"),n=this.container.querySelectorAll(".ts-density-opt"),i=this.container.querySelector(".ts-app");e==null||e.addEventListener("click",()=>{this.toggleTheme(),e.classList.toggle("on",this.theme==="dark")}),n.forEach(r=>{r.addEventListener("click",()=>{this.density=r.dataset.density,i==null||i.setAttribute("data-density",this.density),n.forEach(u=>u.classList.remove("active")),r.classList.add("active"),localStorage.setItem("ts-density",this.density)})}),this.grid=new nn({container:this.container.querySelector("#ts-grid-container"),stateManager:this.stateManager,onSort:(r,u)=>{this.stateManager.update({sortColumn:r,sortOrder:u,currentPage:0}),this.fetchData()},onFilter:async(r,u)=>{const h=this.stateManager.getState();if(!h.activeTableName)return;const{parseFilterInput:c,normalizeColumnType:o}=await wt(async()=>{const{parseFilterInput:y,normalizeColumnType:E}=await import("./filter-parser-HXU3E1Qm.js");return{parseFilterInput:y,normalizeColumnType:E}},[]),p=o(this.getColumnType(h.activeTableName,r)),m=c(u,p);if(m&&u.trim()){const y=h.advancedFilters||[],E=y.findIndex(S=>S.column===r);E>=0?y[E]={column:r,operator:m.operator,value:m.value,value2:m.value2}:y.push({column:r,operator:m.operator,value:m.value,value2:m.value2});const x={...h.columnFilters};x[r]=u,this.stateManager.update({columnFilters:x,advancedFilters:y.length>0?y:void 0,currentPage:0}),this.sidebar.renderFilterChips()}else{const y={...h.columnFilters};delete y[r];const E=(h.advancedFilters||[]).filter(x=>x.column!==r);this.stateManager.update({columnFilters:y,advancedFilters:E.length>0?E:void 0,currentPage:0}),this.sidebar.renderFilterChips()}this.fetchData()},getColumnType:r=>{const u=this.stateManager.getState();return u.activeTableName?this.getColumnType(u.activeTableName,r):"TEXT"},onRowSelect:()=>this.updateSelectionStatus()}),this.grid.mount(),this.schemaViewer=new rn({configManager:this.configManager,stateManager:this.stateManager,client:this.client,createModal:this.createModal.bind(this),switchTable:this.switchTable.bind(this),fetchData:this.fetchData.bind(this),getSchemaForTable:async r=>(await this.loadTableSchema(r),this.getSchemaColumns(r)),getConfigColumns:r=>{const u=this.configManager.getTableConfig(r);return(u==null?void 0:u.columns)||[]},getStateColumns:()=>this.stateManager.getState().columns}),this.statsViewer=new on({stateManager:this.stateManager,createModal:this.createModal.bind(this),showAlert:this.showAlert.bind(this)})}handleLoadData(){const t=this.stateManager.getState();if(!t.berdlTableId||t.availableTables.length===0){this.loadObject();return}this.fetchData()}initKeyboardShortcuts(){cn({onSearch:()=>this.toolbar.focusSearch(),onExport:()=>this.exportCsv(),onRefresh:()=>this.softRefresh(),onReset:()=>this.reset(),onSelectAll:()=>this.grid.selectAll(),onClearSelection:()=>this.grid.clearSelection(),onToggleTheme:()=>this.toggleTheme(),onShowSchema:()=>{const t=this.stateManager.getState();t.activeTableName&&this.showDatabaseSchema(t.activeTableName)},onNextPage:()=>this.nextPage(),onPrevPage:()=>this.prevPage(),onFirstPage:()=>this.goToPage(0),onLastPage:()=>{const t=this.stateManager.getState(),e=Math.ceil(t.totalCount/t.pageSize);this.goToPage(e-1)}})}async loadObject(){const t=this.sidebar.getToken(),e=this.sidebar.getBerdlId();if(!e||e.trim()===""){this.showAlert("Object ID or database name is required","danger");return}const n=e.trim();if(n==="test/test/test")this.switchApi("test_data");else{this.switchApi("default");const{LocalDbClient:i}=await wt(async()=>{const{LocalDbClient:u}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:u}},void 0);if(!i.isLocalDb(n)&&!t){this.showAlert("Auth token required for remote databases","danger");return}}this.client.setToken(t||""),this.stateManager.update({berdlTableId:n,loading:!0,error:null});try{let i,r="",u=!1;try{i=await this.client.listTables(n)}catch(S){r=S.message||"Failed to load database";const{LocalDbClient:v}=await wt(async()=>{const{LocalDbClient:M}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:M}},void 0),$=v.isLocalDb(n);if(!$&&n.startsWith("local/")){const M=n.replace("local/","");try{await this.loadDatabaseFromFile(M);return}catch(N){u=!0,r=`Remote API failed: ${S.message}. Local file also failed: ${N.message}`}}else if($){const M=n.replace("local/","");try{await this.loadDatabaseFromFile(M);return}catch(N){u=!0,r=`Failed to load local database: ${N.message}`}}throw new Error(r)}if(!i)throw new Error("No response from server");const h=i.tables||[];if(h.length===0){const S=`No tables found in database "${n}". The database may be empty or inaccessible.`;this.showAlert(S,"warning"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1}),this.sidebar.updateTables([]);return}let c=this.extractSchemaInfo(i,h);if(Object.keys(c.columns).length===0){const S=await this.fetchSchemaInfo(n);S&&(c=S)}const{getConfigResolver:o}=await wt(async()=>{const{getConfigResolver:S}=await Promise.resolve().then(()=>Ja);return{getConfigResolver:S}},void 0),m=await o().resolve(n,{objectType:i.object_type||i.type,schema:c.tables.length>0?c:void 0});if(m.warning&&this.showAlert(m.warning,"warning"),m.config)this.registry.registerDataType(m.config),this.configManager.setCurrentDataType(m.config.id);else{const S=this.registry.detectDataType(i);S&&this.configManager.setCurrentDataType(S)}this.stateManager.update({availableTables:h}),this.sidebar.updateTables(h);const y=this._initialTable,E=y&&h.find(S=>S.name===y)?y:h[0].name,x=u?`Loaded database "${n}" (using fallback method)`:`Loaded database "${n}" - ${h.length} table${h.length!==1?"s":""} found`;this.showAlert(x,"success"),await this.switchTable(E)}catch(i){let r=i.message||"Failed to load database";r.includes("404")||r.includes("Not Found")?r=`Database or object "${n}" not found. Please check the ID and try again.`:r.includes("401")||r.includes("Unauthorized")?r="Authentication failed. Please check your token and try again.":r.includes("403")||r.includes("Forbidden")?r=`Access denied to database "${n}". Please check your permissions.`:r.includes("Network")||r.includes("fetch")?r="Network error: Unable to connect to database service. Please check your connection and try again.":r.includes("Failed to load database")||(r=`Failed to load database "${n}": ${r}`),this.showAlert(r,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:r}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async switchTable(t){this.stateManager.update({activeTableName:t});const e=this.configManager.getTableConfig(t);this.categoryManager=new en(e),this.sidebar.setCategoryManager(this.categoryManager),this.sidebar.updateTableInfo(t),this.stateManager.update({currentPage:0,sortColumn:null,columnFilters:{},searchValue:"",data:[],headers:[],columns:[]}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.loadTableDependencies(t).then(()=>{const n=this.stateManager.getState();n.activeTableName===t&&this.stateManager.update({data:[...n.data]})}),await this.fetchData()}async loadTableDependencies(t){var i;const n=this.configManager.getTableConfig(t).columns||[];for(const r of n){if(!r.transform)continue;const u=Array.isArray(r.transform)?r.transform:[r.transform];for(const h of u)if(h.type==="ontology"&&((i=h.options)!=null&&i.lookupTable)){const c=h.options.lookupTable,o=h.options.lookupKey||"id",p=h.options.lookupValue||"name";try{const m=this.stateManager.getState();if(!m.berdlTableId)continue;const y=await this.client.getTableData({berdl_table_id:m.berdlTableId,table_name:c,limit:1e4,offset:0}),E={},x=y.headers,S=x.indexOf(o),v=x.indexOf(p);S!==-1&&v!==-1&&(y.data.forEach($=>{const M=String($[S]),N=String($[v]);E[M]=N}),Mt.preLoadOntology(E,h.options.ontologyType||"custom"))}catch(m){console.warn(`Failed to load dependency table ${c}`,m)}}}}async fetchData(){var e;const t=this.stateManager.getState();if(!(!t.activeTableName||!t.berdlTableId)){this.stateManager.update({loading:!0});try{const n={},i=new Set(((e=t.advancedFilters)==null?void 0:e.map(c=>c.column))||[]);for(const[c,o]of Object.entries(t.columnFilters))!i.has(c)&&o!==void 0&&o!==null&&o!==""&&(n[c]=o);const r=await this.client.getTableData({berdl_table_id:t.berdlTableId,table_name:t.activeTableName,limit:t.pageSize,offset:t.currentPage*t.pageSize,sort_column:t.sortColumn||void 0,sort_order:t.sortOrder==="asc"?"ASC":"DESC",col_filter:Object.keys(n).length>0?n:void 0,filters:t.advancedFilters,aggregations:t.aggregations,group_by:t.groupBy});this.processColumns(r.headers,t.activeTableName);const u=t.activeTableName;r.column_schema&&r.column_schema.length>0&&u?(this.columnSchemas[u]||(this.columnSchemas[u]={}),(r.column_schema||[]).forEach(o=>{this.columnSchemas[u][o.name]={type:o.type,notnull:o.notnull,pk:o.pk}})):t.activeTableName&&await this.loadTableSchema(t.activeTableName);let h=(r.data||[]).map(c=>{const o={};return r.headers.forEach((p,m)=>{o[p]=c[m]}),o});t.sortColumn&&h.length>0&&(h=this.sortWithNullsLast(h,t.sortColumn,t.sortOrder||"asc")),this.stateManager.update({headers:r.headers,data:h,totalCount:r.total_count||0,queryCached:r.cached||!1,queryTime:r.execution_time_ms}),this.toolbar&&this.grid&&requestAnimationFrame(()=>{setTimeout(()=>{this.toolbar.updateSearchNav()},50)})}catch{this.showAlert("Failed to copy to clipboard","danger")}finally{this.stateManager.update({loading:!1})}}}processColumns(t,e){const i=this.configManager.getTableConfig(e).columns||[],r=[],u=new Set;i.forEach(c=>{r.push({...c,visible:c.visible!==!1,sortable:c.sortable!==!1,filterable:c.filterable!==!1,width:c.width||"auto",categories:c.categories||[]}),u.add(c.column)});const h=c=>{const o=c.toLowerCase(),p=[];return(o.match(/^(id|name|display_name|label)$/)||o.endsWith("_id")||o.endsWith("_name")||o.includes("locus")||o.includes("symbol")||o.includes("alias")||o.includes("contig"))&&p.push("core"),(o.includes("function")||o.includes("product")||o.includes("annotation")||o.includes("subsystem")||o.includes("class")||o.includes("reaction")||o.includes("ec")||o.includes("cog")||o.includes("pfam")||o.includes("tigrfam")||o.includes("go")||o.includes("kegg")||o.includes("note")||o.includes("inference")||o.includes("type"))&&p.push("functional"),(o.includes("uniprot")||o.includes("xref")||o.includes("reference")||o.includes("link")||o.includes("url")||o.includes("dbxref"))&&p.push("external"),(o.includes("sequence")||o.includes("start")||o.includes("stop")||o.includes("length")||o.includes("strand")||o.includes("protein_length")||o.includes("molecular_weight")||o.includes("isoelectric"))&&p.push("sequence"),(o.match(/^(deleted|row_hash|last_synced|created_at|updated_at|sync_.*)$/)||o.includes("hash")||o.includes("sync"))&&p.push("metadata"),(o.match(/^(error|status|report|message|valid|significance)$/)||o.includes("error")||o.includes("valid"))&&p.push("status"),p.length===0&&(o.match(/^[a-z_]*id$/i)||o.endsWith("_id")?p.push("core"):p.push("functional")),p};if(t.forEach(c=>{u.has(c)||r.push({column:c,displayName:c.replace(/_/g," "),visible:!0,sortable:!0,filterable:!0,width:"auto",categories:h(c)})}),this.stateManager.update({columns:r}),this.categoryManager){this.categoryManager.setColumns(r);const c=this.stateManager.getState();if(c.visibleColumns.size===0)this.stateManager.update({visibleColumns:this.categoryManager.getInitialVisibleColumns()});else{const o=new Set(c.visibleColumns),p=new Set(r.map(m=>m.column));o.forEach(m=>{p.has(m)||o.delete(m)}),this.stateManager.update({visibleColumns:o})}}}async loadTableSchema(t){if(!(!t||this.columnSchemas[t]))try{const e=this.stateManager.getState();if(!e.berdlTableId)return;let n=[];try{n=await this.client.getTableSchema(e.berdlTableId,t)}catch(i){Q.warn("[TableRenderer] Failed to load schema from ApiClient",i)}n.length>0&&(this.columnSchemas[t]={},n.forEach(i=>{this.columnSchemas[t][i.name]={type:i.type,notnull:!!i.notnull,pk:!!i.pk}}))}catch(e){Q.warn("[TableRenderer] Error loading schema:",e)}}getColumnType(t,e){var n,i;return((i=(n=this.columnSchemas[t])==null?void 0:n[e])==null?void 0:i.type)||"TEXT"}getSchemaColumns(t){const e=this.columnSchemas[t];return e?Object.entries(e).map(([n,i])=>({column:n,type:i.type,notnull:i.notnull,pk:i.pk})):[]}switchApi(t){const e=this.configManager.getApi(t);e&&(this.client.updateConfig(e),this.reset())}softRefresh(){this.fetchData()}reset(){this.grid.clearFilterFocus(),this.stateManager.update({sortColumn:null,sortOrder:"asc",searchValue:"",columnFilters:{},currentPage:0}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.sidebar.renderFilterChips(),this.fetchData()}nextPage(){const t=this.stateManager.getState(),e=Math.ceil(t.totalCount/t.pageSize);t.currentPage<e-1&&this.goToPage(t.currentPage+1)}prevPage(){const t=this.stateManager.getState();t.currentPage>0&&this.goToPage(t.currentPage-1)}goToPage(t){t>=0&&(this.stateManager.update({currentPage:t}),this.fetchData())}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",localStorage.setItem("ts-theme",this.theme);const t=this.container.querySelector(".ts-app");t&&t.setAttribute("data-theme",this.theme)}async exportCsv(){const t=this.stateManager.getState();if(t.data.length===0)return;const e=this.grid.getSelection(),i=e.size>0?t.data.filter((r,u)=>e.has(u)):t.data;await ln.export(i,{format:"csv",filename:`export_${t.activeTableName||"data"}_${new Date().toISOString().split("T")[0]}`,columns:t.columns.filter(r=>t.visibleColumns.has(r.column)).map(r=>({key:r.column,header:r.displayName||r.column})),includeHeaders:!0})}onStateChange(t){this.updateStatusBar(t),this.updatePagination(t),this.updateLoadingOverlay(t),this.syncStateToUrl(),t.error&&this.showAlert(t.error,"danger"),this.toolbar&&this.grid&&setTimeout(()=>{this.toolbar.updateSearchNav()},100)}updateLoadingOverlay(t){if(!this.dom.loadingOverlay)return;t.loading&&t.availableTables.length>0?this.dom.loadingOverlay.style.display="flex":this.dom.loadingOverlay.style.display="none"}updateStatusBar(t){var h,c;if(!this.dom.status)return;let e="";const n=[];if(t.queryCached&&n.push(" Cached"),t.queryTime!==void 0&&n.push(`${t.queryTime}ms`),t.totalCount>0){const o=t.currentPage*t.pageSize+1,p=Math.min((t.currentPage+1)*t.pageSize,t.totalCount),m=Math.ceil(t.totalCount/t.pageSize);e=`<div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-size:13px;font-weight:600;color:var(--c-text-primary)">Rows: <strong>${o.toLocaleString()}</strong>  <strong>${p.toLocaleString()}</strong> of <strong>${t.totalCount.toLocaleString()}</strong></div>
                <div style="font-size:11px;color:var(--c-text-muted);display:flex;gap:8px;align-items:center">
                    <span>Page ${t.currentPage+1} of ${m||1}</span>
                    ${n.length>0?`<span style="display:flex;align-items:center;gap:4px">${n.join("  ")}</span>`:""}
                </div>
            </div>`;const y=((c=(h=this.grid)==null?void 0:h.getSelection())==null?void 0:c.size)||0;y>0&&(e+=`<div style="margin-top:4px;font-size:11px"><span class="ts-selection-info">${y} row${y!==1?"s":""} selected</span></div>`)}else e='<div style="font-size:13px">Ready</div>';this.dom.status.innerHTML=e,this.dom.tableName&&(t.activeTableName?this.dom.tableName.innerHTML=`<span style="color:var(--c-text-muted);font-size:13px;font-weight:500">${t.activeTableName}</span>`:this.dom.tableName.innerHTML="");const i=this.container.querySelector("#ts-grid-header"),r=this.container.querySelector("#ts-db-name"),u=this.container.querySelector("#ts-active-table-name");i&&r&&u&&(t.activeTableName&&t.berdlTableId?(i.style.display="block",r.textContent=t.berdlTableId,u.textContent=t.activeTableName):i.style.display="none")}updateSelectionStatus(){const t=this.stateManager.getState();this.updateStatusBar(t)}updatePagination(t){if(!this.dom.pager)return;const e=Math.ceil(t.totalCount/t.pageSize),n=t.currentPage;this.dom.pager.innerHTML=`
            <button class="ts-page-btn" data-page="${n-1}" ${n<=0?"disabled":""}><i class="bi bi-chevron-left"></i></button>
            <span class="ts-page-info">${n+1} / ${e||1}</span>
            <button class="ts-page-btn" data-page="${n+1}" ${n>=e-1?"disabled":""}><i class="bi bi-chevron-right"></i></button>
        `,this.dom.pager.querySelectorAll(".ts-page-btn").forEach(i=>{i.addEventListener("click",()=>{const r=parseInt(i.dataset.page||"0");r>=0&&r<e&&this.goToPage(r)})})}syncStateToUrl(){const t=this.stateManager.getState(),e=new URLSearchParams;t.activeTableName&&e.set("table",t.activeTableName),t.sortColumn&&e.set("sort",`${t.sortColumn}:${t.sortOrder}`),t.currentPage>0&&e.set("page",String(t.currentPage+1));const n=e.toString()?`?${e.toString()}`:window.location.pathname;window.history.replaceState({},"",n)}loadStateFromUrl(){const e=new URLSearchParams(window.location.search).get("table");e&&(this._initialTable=e)}async loadConfiguration(){const t="/config/index.json";try{const n=await fetch(t);if(n.ok){const i=await n.json();if(i.dataTypes){await this.registry.initialize(i),this.configManager=new Us(i);return}}}catch{}let e={};if(this.configUrl)try{const n=await fetch(this.configUrl);n.ok&&(e=await n.json())}catch{}!Object.keys(e).length&&window.DEFAULT_CONFIG&&(e=window.DEFAULT_CONFIG),this.configManager=new Us(e)}showAlert(t,e){if(this.dom.alert){const i=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),u=e==="danger"?8e3:t.length>100?6e3:4e3;this.dom.alert.innerHTML=`<div class="ts-alert ts-alert-${e}">${i}</div>`,setTimeout(()=>{this.dom.alert&&(this.dom.alert.innerHTML="")},u)}}showDatabaseSchema(t){this.schemaViewer.show(t)}isValueEmpty(t){if(t==null)return!0;if(typeof t=="string"){const e=t.trim();if(e===""||e.length===0||e.toLowerCase()==="null"||e.toLowerCase()==="undefined"||e==="-")return!0}return!!(Array.isArray(t)&&t.length===0||typeof t=="number"&&isNaN(t)||typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0)}sortWithNullsLast(t,e,n){return!t||t.length===0||!e||!t.some(r=>e in r)?t:[...t].sort((r,u)=>{const h=r==null?void 0:r[e],c=u==null?void 0:u[e],o=this.isValueEmpty(h),p=this.isValueEmpty(c);if(o&&p)return 0;if(o)return 1;if(p)return-1;let m=0;if(typeof h==="number"&&typeof c==="number"){if(isNaN(h)&&isNaN(c))return 0;if(isNaN(h))return 1;if(isNaN(c))return-1;m=h-c}else if(h instanceof Date&&c instanceof Date)m=h.getTime()-c.getTime();else{const x=String(h??"").trim().toLowerCase(),S=String(c??"").trim().toLowerCase();x<S?m=-1:x>S?m=1:m=0}return n==="desc"?-m:m})}async loadDatabaseFromFile(t){try{if(this.stateManager.update({loading:!0,error:null}),!t||t.trim()==="")throw new Error("Database filename is required");const e=t.trim(),n=`/data/${e}.db`,i=`/config/${e}.json`;let r=null;try{const y=await fetch(i);y.ok&&(r=await y.json(),this.registry.registerDataType(r),this.configManager.setCurrentDataType(r.id||e))}catch{console.warn(`No config file found at ${i}, using default settings`)}const{LocalDbClient:u}=await wt(async()=>{const{LocalDbClient:y}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:y}},void 0),h=u.getInstance(),c=`local/${e}`;try{await h.loadDatabase(n)}catch(y){throw y.message.includes("404")||y.message.includes("Failed to load database")?new Error(`Database file not found: ${n}. Please ensure the file exists in the /data/ directory.`):new Error(`Failed to load database file: ${y.message}`)}let o;try{o=await h.listTablesFromDb(n,r)}catch(y){throw new Error(`Failed to read database structure: ${y.message}`)}const p=o.tables||[];if(p.length===0)throw new Error(`Database "${e}" contains no tables. The database may be empty or corrupted.`);this.stateManager.update({availableTables:p,berdlTableId:c}),this.sidebar.updateTables(p);const m=p[0].name;await this.switchTable(m),this.showAlert(`Successfully loaded database "${e}" - ${p.length} table${p.length!==1?"s":""} found`,"success")}catch(e){let n=e.message||"Failed to load database";throw n.includes("not found")||n.includes("404")?n=`Database file not found: "${t}". Please check that the file exists at /data/${t}.db`:n.includes("No tables found")?n=`Database "${t}" contains no tables. The database may be empty or corrupted.`:n.includes("Failed to load")||(n=`Failed to load database "${t}": ${n}`),this.showAlert(n,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:n}),this.sidebar.updateTables([]),e}finally{this.stateManager.update({loading:!1})}}async loadDatabaseFromPath(t){try{this.stateManager.update({loading:!0,error:null});const e=(t||"").trim();if(!e)throw new Error("Database path is required");if(e.toLowerCase().startsWith("file://"))throw new Error("file:// paths are not supported in the browser. In dev use an absolute path (Vite /@fs), or host the DB under /data/ in production.");const i=e.split("#")[0].split("?")[0],u=(i.split("/").pop()||"database").trim().replace(/\.(db|sqlite)$/i,"")||"database",h=/^https?:\/\//i.test(e);let c=e;!h&&!c.startsWith("/")&&(c=`/${c}`);let o=null;try{const{LocalDbClient:S}=await wt(async()=>{const{LocalDbClient:N}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:N}},void 0),v=[e,i,c,c.replace(/^\/@fs/,"")];let $=null;for(const N of v)if($=S.getConfigPath(N),$)break;$||($=`/config/${u}.json`);const M=await fetch($);M.ok&&(o=await M.json(),this.registry.registerDataType(o),this.configManager.setCurrentDataType(o.id||u))}catch{}const{LocalDbClient:p}=await wt(async()=>{const{LocalDbClient:S}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:S}},void 0),m=p.getInstance();await m.loadDatabase(c);const E=(await m.listTablesFromDb(c,o||{})).tables||[];if(E.length===0)throw new Error(`Database "${u}" contains no tables. The database may be empty or corrupted.`);const x=`local/${u}`;this.stateManager.update({availableTables:E,berdlTableId:x}),this.sidebar.updateTables(E),await this.switchTable(E[0].name),this.showAlert(`Successfully loaded database "${u}" - ${E.length} table${E.length!==1?"s":""} found`,"success")}catch(e){const n=(e==null?void 0:e.message)||"Failed to load database";this.showAlert(n,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:n}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async loadDatabaseFromFileObject(t){try{if(this.stateManager.update({loading:!0,error:null}),!t.name.endsWith(".db")&&!t.name.endsWith(".sqlite")){this.showAlert("Please select a valid SQLite database file (.db or .sqlite)","warning"),this.stateManager.update({loading:!1});return}const e=await t.arrayBuffer(),{LocalDbClient:n}=await wt(async()=>{const{LocalDbClient:c}=await Promise.resolve().then(()=>Bt);return{LocalDbClient:c}},void 0),i=n.getInstance();await i.loadDatabaseFromBuffer(e,t.name);const r=`local/${t.name.replace(/\.(db|sqlite)$/,"")}`;let u;try{u=await i.listTablesFromDb(t.name)}catch(c){throw new Error(`Failed to read database structure: ${c.message}`)}const h=u.tables||[];this.stateManager.update({berdlTableId:r,availableTables:h,activeTableName:null,loading:!1}),this.sidebar.updateTables(h),h.length>0?(await this.switchTable(h[0].name),this.showAlert(`Loaded local file: ${t.name}`,"success")):this.showAlert("Database loaded but contains no tables.","warning")}catch(e){Q.error("Failed to load uploaded database",e),this.showAlert(`Failed to load file: ${e.message}`,"danger"),this.stateManager.update({loading:!1})}}async showColumnStatistics(t){await this.statsViewer.show(t)}extractSchemaInfo(t,e){const n=e.map(r=>r.name||r),i={};if(t.schemas&&typeof t.schemas=="object")for(const[r,u]of Object.entries(t.schemas))u&&typeof u=="object"&&(i[r]=Object.keys(u));if(Object.keys(i).length===0)for(const r of e){const u=r.name||r;r.columns&&Array.isArray(r.columns)?i[u]=r.columns.map(h=>typeof h=="string"?h:h.name||h.column):r.column_names&&Array.isArray(r.column_names)?i[u]=r.column_names:r.schema&&typeof r.schema=="object"&&(i[u]=Object.keys(r.schema))}return{tables:n,columns:i}}async fetchSchemaInfo(t){try{const e=await this.client.getSchema(t);if(e){const n=Object.keys(e),i={};for(const[r,u]of Object.entries(e))u&&typeof u=="object"&&(i[r]=Object.keys(u));return{tables:n,columns:i}}}catch{}return null}createModal(t,e){var u;const n=document.querySelector(".ts-modal-overlay");n&&n.remove();const i=document.createElement("div");i.className="ts-modal-overlay",i.innerHTML=`
            <div class="ts-modal">
                <div class="ts-modal-header">
                    <span class="ts-modal-title">${t}</span>
                    <button class="ts-modal-close"><i class="bi bi-x-lg"></i></button>
                </div>
                <div class="ts-modal-body">${e}</div>
            </div>
        `,document.body.appendChild(i),requestAnimationFrame(()=>i.classList.add("show"));const r=()=>{i.classList.remove("show"),setTimeout(()=>i.remove(),200)};return(u=i.querySelector(".ts-modal-close"))==null||u.addEventListener("click",r),i.addEventListener("click",h=>{h.target===i&&r()}),i}}document.addEventListener("DOMContentLoaded",async()=>{const k=document.querySelector("#app");if(k){const e=new URLSearchParams(window.location.search).get("db"),n=new dn({container:k,configUrl:"genome-data.config.json"});if(await n.init(),e)try{await n.loadDatabaseFromFile(e)}catch(i){Q.error("Failed to load database from URL parameter",i),k.innerHTML=`
                    <div class="ts-alert ts-alert-danger">
                        <i class="bi bi-x-circle-fill"></i> 
                        Failed to load database: ${i.message}
                        <br><br>
                        <small>Usage: ?db=filename (without .db extension)</small>
                        <br>
                        <small>Database file should be at: /data/${e}.db</small>
                    </div>
                `}}else Q.error("App container #app not found")});export{Qe as C};
