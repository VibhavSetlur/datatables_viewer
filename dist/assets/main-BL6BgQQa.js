var Rn=Object.defineProperty;var On=(k,e,t)=>e in k?Rn(k,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[e]=t;var T=(k,e,t)=>On(k,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const Pn="modulepreload",Fn=function(k){return"/"+k},Ds={},je=function(e,t,a){let i=Promise.resolve();if(t&&t.length>0){let d=function(l){return Promise.all(l.map(y=>Promise.resolve(y).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=d(t.map(l=>{if(l=Fn(l),l in Ds)return;Ds[l]=!0;const y=l.endsWith(".css"),m=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":Pn,y||(b.as="script"),b.crossOrigin="",b.href=l,h&&b.setAttribute("nonce",h),document.head.appendChild(b),y)return new Promise((S,$)=>{b.addEventListener("load",S),b.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return i.then(d=>{for(const u of d||[])u.status==="rejected"&&r(u.reason);return e().catch(r)})};function In(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}function jn(k){if(Object.prototype.hasOwnProperty.call(k,"__esModule"))return k;var e=k.default;if(typeof e=="function"){var t=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(k).forEach(function(a){var i=Object.getOwnPropertyDescriptor(k,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:function(){return k[a]}})}),t}var Pt={exports:{}};const zn={},qn=Object.freeze(Object.defineProperty({__proto__:null,default:zn},Symbol.toStringTag,{value:"Module"})),Ns=jn(qn);var Rs;function Un(){return Rs||(Rs=1,(function(k,e){var t=void 0,a=function(i){return t||(t=new Promise(function(r,d){var u=typeof i<"u"?i:{},h=u.onAbort;u.onAbort=function(s){d(new Error(s)),h&&h(s)},u.postRun=u.postRun||[],u.postRun.push(function(){r(u)}),k=void 0;var l;l||(l=typeof u<"u"?u:{});var y=typeof window=="object",m=typeof WorkerGlobalScope<"u",b=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";l.onRuntimeInitialized=function(){function s(g,x){switch(typeof x){case"boolean":Dn(g,x?1:0);break;case"number":An(g,x);break;case"string":Ln(g,x,-1,-1);break;case"object":if(x===null)ks(g);else if(x.length!=null){var L=ot(x,rt);Mn(g,L,x.length,-1),lt(L)}else ct(g,"Wrong API use : tried to return a value of an unknown type ("+x+").",-1);break;default:ks(g)}}function n(g,x){for(var L=[],I=0;I<g;I+=1){var j=fe(x+4*I,"i32"),V=Tn(j);if(V===1||V===2)j=kn(j);else if(V===3)j=_n(j);else if(V===4){V=j,j=Cn(V),V=En(V);for(var ce=new Uint8Array(j),oe=0;oe<j;oe+=1)ce[oe]=A[V+oe];j=ce}else j=null;L.push(j)}return L}function o(g,x){this.Qa=g,this.db=x,this.Oa=1,this.lb=[]}function c(g,x){if(this.db=x,x=Ge(g)+1,this.eb=Nt(x),this.eb===null)throw Error("Unable to allocate memory for the SQL string");ge(g,O,this.eb,x),this.kb=this.eb,this.Za=this.pb=null}function f(g){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),g!=null){var x=this.filename,L="/",I=x;if(L&&(L=typeof L=="string"?L:xt(L),I=x?yt(L+"/"+x):L),x=ts(!0,!0),I=Zs(I,x),g){if(typeof g=="string"){L=Array(g.length);for(var j=0,V=g.length;j<V;++j)L[j]=g.charCodeAt(j);g=L}st(I,x|146),L=Fe(I,577),ys(L,g,0,g.length,0),Et(L),st(I,x)}}this.handleError(D(this.filename,p)),this.db=fe(p,"i32"),Ls(this.db),this.fb={},this.Sa={}}var p=ve(4),v=l.cwrap,D=v("sqlite3_open","number",["string","number"]),U=v("sqlite3_close_v2","number",["number"]),q=v("sqlite3_exec","number",["number","string","number","number","number"]),Z=v("sqlite3_changes","number",["number"]),ie=v("sqlite3_prepare_v2","number",["number","string","number","number","number"]),$s=v("sqlite3_sql","string",["number"]),on=v("sqlite3_normalized_sql","string",["number"]),Ts=v("sqlite3_prepare_v2","number",["number","number","number","number","number"]),ln=v("sqlite3_bind_text","number",["number","number","number","number","number"]),Cs=v("sqlite3_bind_blob","number",["number","number","number","number","number"]),cn=v("sqlite3_bind_double","number",["number","number","number"]),dn=v("sqlite3_bind_int","number",["number","number","number"]),un=v("sqlite3_bind_parameter_index","number",["number","string"]),hn=v("sqlite3_step","number",["number"]),fn=v("sqlite3_errmsg","string",["number"]),gn=v("sqlite3_column_count","number",["number"]),pn=v("sqlite3_data_count","number",["number"]),mn=v("sqlite3_column_double","number",["number","number"]),_s=v("sqlite3_column_text","string",["number","number"]),bn=v("sqlite3_column_blob","number",["number","number"]),yn=v("sqlite3_column_bytes","number",["number","number"]),vn=v("sqlite3_column_type","number",["number","number"]),wn=v("sqlite3_column_name","string",["number","number"]),xn=v("sqlite3_reset","number",["number"]),Sn=v("sqlite3_clear_bindings","number",["number"]),$n=v("sqlite3_finalize","number",["number"]),Es=v("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),Tn=v("sqlite3_value_type","number",["number"]),Cn=v("sqlite3_value_bytes","number",["number"]),_n=v("sqlite3_value_text","string",["number"]),En=v("sqlite3_value_blob","number",["number"]),kn=v("sqlite3_value_double","number",["number"]),An=v("sqlite3_result_double","",["number","number"]),ks=v("sqlite3_result_null","",["number"]),Ln=v("sqlite3_result_text","",["number","string","number","number"]),Mn=v("sqlite3_result_blob","",["number","number","number","number"]),Dn=v("sqlite3_result_int","",["number","number"]),ct=v("sqlite3_result_error","",["number","string","number"]),As=v("sqlite3_aggregate_context","number",["number","number"]),Ls=v("RegisterExtensionFunctions","number",["number"]),Ms=v("sqlite3_update_hook","number",["number","number","number"]);o.prototype.bind=function(g){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(g)?this.Cb(g):g!=null&&typeof g=="object"?this.Db(g):!0},o.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var g=hn(this.Qa);switch(g){case 100:return!0;case 101:return!1;default:throw this.db.handleError(g)}},o.prototype.wb=function(g){return g==null&&(g=this.Oa,this.Oa+=1),mn(this.Qa,g)},o.prototype.Gb=function(g){if(g==null&&(g=this.Oa,this.Oa+=1),g=_s(this.Qa,g),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(g)},o.prototype.Hb=function(g){return g==null&&(g=this.Oa,this.Oa+=1),_s(this.Qa,g)},o.prototype.getBlob=function(g){g==null&&(g=this.Oa,this.Oa+=1);var x=yn(this.Qa,g);g=bn(this.Qa,g);for(var L=new Uint8Array(x),I=0;I<x;I+=1)L[I]=A[g+I];return L},o.prototype.get=function(g,x){x=x||{},g!=null&&this.bind(g)&&this.step(),g=[];for(var L=pn(this.Qa),I=0;I<L;I+=1)switch(vn(this.Qa,I)){case 1:var j=x.useBigInt?this.Gb(I):this.wb(I);g.push(j);break;case 2:g.push(this.wb(I));break;case 3:g.push(this.Hb(I));break;case 4:g.push(this.getBlob(I));break;default:g.push(null)}return g},o.prototype.getColumnNames=function(){for(var g=[],x=gn(this.Qa),L=0;L<x;L+=1)g.push(wn(this.Qa,L));return g},o.prototype.getAsObject=function(g,x){g=this.get(g,x),x=this.getColumnNames();for(var L={},I=0;I<x.length;I+=1)L[x[I]]=g[I];return L},o.prototype.getSQL=function(){return $s(this.Qa)},o.prototype.getNormalizedSQL=function(){return on(this.Qa)},o.prototype.run=function(g){return g!=null&&this.bind(g),this.step(),this.reset()},o.prototype.sb=function(g,x){x==null&&(x=this.Oa,this.Oa+=1),g=Jt(g);var L=ot(g,rt);this.lb.push(L),this.db.handleError(ln(this.Qa,x,L,g.length-1,0))},o.prototype.Bb=function(g,x){x==null&&(x=this.Oa,this.Oa+=1);var L=ot(g,rt);this.lb.push(L),this.db.handleError(Cs(this.Qa,x,L,g.length,0))},o.prototype.rb=function(g,x){x==null&&(x=this.Oa,this.Oa+=1),this.db.handleError((g===(g|0)?dn:cn)(this.Qa,x,g))},o.prototype.Eb=function(g){g==null&&(g=this.Oa,this.Oa+=1),Cs(this.Qa,g,0,0,0)},o.prototype.tb=function(g,x){switch(x==null&&(x=this.Oa,this.Oa+=1),typeof g){case"string":this.sb(g,x);return;case"number":this.rb(g,x);return;case"bigint":this.sb(g.toString(),x);return;case"boolean":this.rb(g+0,x);return;case"object":if(g===null){this.Eb(x);return}if(g.length!=null){this.Bb(g,x);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+g+")."},o.prototype.Db=function(g){var x=this;return Object.keys(g).forEach(function(L){var I=un(x.Qa,L);I!==0&&x.tb(g[L],I)}),!0},o.prototype.Cb=function(g){for(var x=0;x<g.length;x+=1)this.tb(g[x],x+1);return!0},o.prototype.reset=function(){return this.freemem(),Sn(this.Qa)===0&&xn(this.Qa)===0},o.prototype.freemem=function(){for(var g;(g=this.lb.pop())!==void 0;)lt(g)},o.prototype.free=function(){this.freemem();var g=$n(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,g},c.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var g=Xe(),x=ve(4);Be(p),Be(x);try{this.db.handleError(Ts(this.db.db,this.kb,-1,p,x)),this.kb=fe(x,"i32");var L=fe(p,"i32");return L===0?(this.mb(),{done:!0}):(this.Za=new o(L,this.db),this.db.fb[L]=this.Za,{value:this.Za,done:!1})}catch(I){throw this.pb=bt(this.kb),this.mb(),I}finally{Qe(g)}},c.prototype.mb=function(){lt(this.eb),this.eb=null},c.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:bt(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(c.prototype[Symbol.iterator]=function(){return this}),f.prototype.run=function(g,x){if(!this.db)throw"Database closed";if(x){g=this.prepare(g,x);try{g.step()}finally{g.free()}}else this.handleError(q(this.db,g,0,0,p));return this},f.prototype.exec=function(g,x,L){if(!this.db)throw"Database closed";var I=Xe(),j=null;try{var V=Mt(g),ce=ve(4);for(g=[];fe(V,"i8")!==0;){Be(p),Be(ce),this.handleError(Ts(this.db,V,-1,p,ce));var oe=fe(p,"i32");if(V=fe(ce,"i32"),oe!==0){var ae=null;for(j=new o(oe,this),x!=null&&j.bind(x);j.step();)ae===null&&(ae={columns:j.getColumnNames(),values:[]},g.push(ae)),ae.values.push(j.get(null,L));j.free()}}return g}catch(de){throw j&&j.free(),de}finally{Qe(I)}},f.prototype.each=function(g,x,L,I,j){typeof x=="function"&&(I=L,L=x,x=void 0),g=this.prepare(g,x);try{for(;g.step();)L(g.getAsObject(null,j))}finally{g.free()}if(typeof I=="function")return I()},f.prototype.prepare=function(g,x){if(Be(p),this.handleError(ie(this.db,g,-1,p,0)),g=fe(p,"i32"),g===0)throw"Nothing to prepare";var L=new o(g,this);return x!=null&&L.bind(x),this.fb[g]=L},f.prototype.iterateStatements=function(g){return new c(g,this)},f.prototype.export=function(){Object.values(this.fb).forEach(function(x){x.free()}),Object.values(this.Sa).forEach(ye),this.Sa={},this.handleError(U(this.db));var g=en(this.filename);return this.handleError(D(this.filename,p)),this.db=fe(p,"i32"),Ls(this.db),g},f.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(g){g.free()}),Object.values(this.Sa).forEach(ye),this.Sa={},this.Ya&&(ye(this.Ya),this.Ya=void 0),this.handleError(U(this.db)),fs("/"+this.filename),this.db=null)},f.prototype.handleError=function(g){if(g===0)return null;throw g=fn(this.db),Error(g)},f.prototype.getRowsModified=function(){return Z(this.db)},f.prototype.create_function=function(g,x){Object.prototype.hasOwnProperty.call(this.Sa,g)&&(ye(this.Sa[g]),delete this.Sa[g]);var L=Ke(function(I,j,V){j=n(j,V);try{var ce=x.apply(null,j)}catch(oe){ct(I,oe,-1);return}s(I,ce)},"viii");return this.Sa[g]=L,this.handleError(Es(this.db,g,x.length,1,0,L,0,0,0)),this},f.prototype.create_aggregate=function(g,x){var L=x.init||function(){return null},I=x.finalize||function(ae){return ae},j=x.step;if(!j)throw"An aggregate function must have a step function in "+g;var V={};Object.hasOwnProperty.call(this.Sa,g)&&(ye(this.Sa[g]),delete this.Sa[g]),x=g+"__finalize",Object.hasOwnProperty.call(this.Sa,x)&&(ye(this.Sa[x]),delete this.Sa[x]);var ce=Ke(function(ae,de,Ot){var Ce=As(ae,1);Object.hasOwnProperty.call(V,Ce)||(V[Ce]=L()),de=n(de,Ot),de=[V[Ce]].concat(de);try{V[Ce]=j.apply(null,de)}catch(Nn){delete V[Ce],ct(ae,Nn,-1)}},"viii"),oe=Ke(function(ae){var de=As(ae,1);try{var Ot=I(V[de])}catch(Ce){delete V[de],ct(ae,Ce,-1);return}s(ae,Ot),delete V[de]},"vi");return this.Sa[g]=ce,this.Sa[x]=oe,this.handleError(Es(this.db,g,j.length-1,1,0,0,ce,oe,0)),this},f.prototype.updateHook=function(g){this.Ya&&(Ms(this.db,0,0),ye(this.Ya),this.Ya=void 0),g&&(this.Ya=Ke(function(x,L,I,j,V){switch(L){case 18:x="insert";break;case 23:x="update";break;case 9:x="delete";break;default:throw"unknown operationCode in updateHook callback: "+L}if(I=I?J(O,I):"",j=j?J(O,j):"",V>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";g(x,I,j,Number(V))},"viiiij"),Ms(this.db,this.Ya,0))},l.Database=f};var S={...l},$="./this.program",_=(s,n)=>{throw n},E="",R,M;if(b){var P=Ns;E=__dirname+"/",M=s=>(s=Ne(s)?new URL(s):s,P.readFileSync(s)),R=async s=>(s=Ne(s)?new URL(s):s,P.readFileSync(s,void 0)),!l.thisProgram&&1<process.argv.length&&($=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),k.exports=l,_=(s,n)=>{throw process.exitCode=s,n}}else(y||m)&&(m?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),E=E.startsWith("blob:")?"":E.slice(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),m&&(M=s=>{var n=new XMLHttpRequest;return n.open("GET",s,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),R=async s=>{if(Ne(s))return new Promise((o,c)=>{var f=new XMLHttpRequest;f.open("GET",s,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?o(f.response):c(f.status)},f.onerror=c,f.send(null)});var n=await fetch(s,{credentials:"same-origin"});if(n.ok)return n.arrayBuffer();throw Error(n.status+" : "+n.url)});var W=l.print||console.log.bind(console),K=l.printErr||console.error.bind(console);Object.assign(l,S),S=null,l.thisProgram&&($=l.thisProgram);var H=l.wasmBinary,B,X=!1,ee,A,O,Y,F,G,he,te,De,Ne=s=>s.startsWith("file://");function Bt(){var s=B.buffer;l.HEAP8=A=new Int8Array(s),l.HEAP16=Y=new Int16Array(s),l.HEAPU8=O=new Uint8Array(s),l.HEAPU16=new Uint16Array(s),l.HEAP32=F=new Int32Array(s),l.HEAPU32=G=new Uint32Array(s),l.HEAPF32=he=new Float32Array(s),l.HEAPF64=De=new Float64Array(s),l.HEAP64=te=new BigInt64Array(s),l.HEAPU64=new BigUint64Array(s)}var xe=0,He=null;function Re(s){var n;throw(n=l.onAbort)==null||n.call(l,s),s="Aborted("+s+")",K(s),X=!0,new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info.")}var gt;async function js(s){if(!H)try{var n=await R(s);return new Uint8Array(n)}catch{}if(s==gt&&H)s=new Uint8Array(H);else if(M)s=M(s);else throw"both async and sync fetching of the wasm failed";return s}async function zs(s,n){try{var o=await js(s);return await WebAssembly.instantiate(o,n)}catch(c){K(`failed to asynchronously prepare wasm: ${c}`),Re(c)}}async function qs(s){var n=gt;if(!H&&typeof WebAssembly.instantiateStreaming=="function"&&!Ne(n)&&!b)try{var o=fetch(n,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(o,s)}catch(c){K(`wasm streaming compile failed: ${c}`),K("falling back to ArrayBuffer instantiation")}return zs(n,s)}class pt{constructor(n){T(this,"name","ExitStatus");this.message=`Program terminated with exit(${n})`,this.status=n}}var Gt=s=>{for(;0<s.length;)s.shift()(l)},Wt=[],Vt=[],Us=()=>{var s=l.preRun.shift();Vt.unshift(s)};function fe(s,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return A[s];case"i8":return A[s];case"i16":return Y[s>>1];case"i32":return F[s>>2];case"i64":return te[s>>3];case"float":return he[s>>2];case"double":return De[s>>3];case"*":return G[s>>2];default:Re(`invalid type for getValue: ${n}`)}}var mt=l.noExitRuntime||!0;function Be(s){var n="i32";switch(n.endsWith("*")&&(n="*"),n){case"i1":A[s]=0;break;case"i8":A[s]=0;break;case"i16":Y[s>>1]=0;break;case"i32":F[s>>2]=0;break;case"i64":te[s>>3]=BigInt(0);break;case"float":he[s>>2]=0;break;case"double":De[s>>3]=0;break;case"*":G[s>>2]=0;break;default:Re(`invalid type for setValue: ${n}`)}}var Kt=typeof TextDecoder<"u"?new TextDecoder:void 0,J=(s,n=0,o=NaN)=>{var c=n+o;for(o=n;s[o]&&!(o>=c);)++o;if(16<o-n&&s.buffer&&Kt)return Kt.decode(s.subarray(n,o));for(c="";n<o;){var f=s[n++];if(f&128){var p=s[n++]&63;if((f&224)==192)c+=String.fromCharCode((f&31)<<6|p);else{var v=s[n++]&63;f=(f&240)==224?(f&15)<<12|p<<6|v:(f&7)<<18|p<<12|v<<6|s[n++]&63,65536>f?c+=String.fromCharCode(f):(f-=65536,c+=String.fromCharCode(55296|f>>10,56320|f&1023))}}else c+=String.fromCharCode(f)}return c},bt=(s,n)=>s?J(O,s,n):"",Qt=(s,n)=>{for(var o=0,c=s.length-1;0<=c;c--){var f=s[c];f==="."?s.splice(c,1):f===".."?(s.splice(c,1),o++):o&&(s.splice(c,1),o--)}if(n)for(;o;o--)s.unshift("..");return s},yt=s=>{var n=s.charAt(0)==="/",o=s.slice(-1)==="/";return(s=Qt(s.split("/").filter(c=>!!c),!n).join("/"))||n||(s="."),s&&o&&(s+="/"),(n?"/":"")+s},Xt=s=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=n[0],n=n[1],!s&&!n?".":(n&&(n=n.slice(0,-1)),s+n)},Je=s=>s&&s.match(/([^\/]+|\/)\/*$/)[1],Hs=()=>{if(b){var s=Ns;return n=>s.randomFillSync(n)}return n=>crypto.getRandomValues(n)},Yt=s=>{(Yt=Hs())(s)},Bs=(...s)=>{for(var n="",o=!1,c=s.length-1;-1<=c&&!o;c--){if(o=0<=c?s[c]:"/",typeof o!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!o)return"";n=o+"/"+n,o=o.charAt(0)==="/"}return n=Qt(n.split("/").filter(f=>!!f),!o).join("/"),(o?"/":"")+n||"."},vt=[],Ge=s=>{for(var n=0,o=0;o<s.length;++o){var c=s.charCodeAt(o);127>=c?n++:2047>=c?n+=2:55296<=c&&57343>=c?(n+=4,++o):n+=3}return n},ge=(s,n,o,c)=>{if(!(0<c))return 0;var f=o;c=o+c-1;for(var p=0;p<s.length;++p){var v=s.charCodeAt(p);if(55296<=v&&57343>=v){var D=s.charCodeAt(++p);v=65536+((v&1023)<<10)|D&1023}if(127>=v){if(o>=c)break;n[o++]=v}else{if(2047>=v){if(o+1>=c)break;n[o++]=192|v>>6}else{if(65535>=v){if(o+2>=c)break;n[o++]=224|v>>12}else{if(o+3>=c)break;n[o++]=240|v>>18,n[o++]=128|v>>12&63}n[o++]=128|v>>6&63}n[o++]=128|v&63}}return n[o]=0,o-f},Jt=(s,n)=>{var o=Array(Ge(s)+1);return s=ge(s,o,0,o.length),n&&(o.length=s),o},Zt=[];function es(s,n){Zt[s]={input:[],output:[],cb:n},Ct(s,Gs)}var Gs={open(s){var n=Zt[s.node.rdev];if(!n)throw new C(43);s.tty=n,s.seekable=!1},close(s){s.tty.cb.fsync(s.tty)},fsync(s){s.tty.cb.fsync(s.tty)},read(s,n,o,c){if(!s.tty||!s.tty.cb.xb)throw new C(60);for(var f=0,p=0;p<c;p++){try{var v=s.tty.cb.xb(s.tty)}catch{throw new C(29)}if(v===void 0&&f===0)throw new C(6);if(v==null)break;f++,n[o+p]=v}return f&&(s.node.atime=Date.now()),f},write(s,n,o,c){if(!s.tty||!s.tty.cb.qb)throw new C(60);try{for(var f=0;f<c;f++)s.tty.cb.qb(s.tty,n[o+f])}catch{throw new C(29)}return c&&(s.node.mtime=s.node.ctime=Date.now()),f}},Ws={xb(){e:{if(!vt.length){var s=null;if(b){var n=Buffer.alloc(256),o=0,c=process.stdin.fd;try{o=P.readSync(c,n,0,256)}catch(f){if(f.toString().includes("EOF"))o=0;else throw f}0<o&&(s=n.slice(0,o).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(s=window.prompt("Input: "),s!==null&&(s+=`
`));if(!s){s=null;break e}vt=Jt(s,!0)}s=vt.shift()}return s},qb(s,n){n===null||n===10?(W(J(s.output)),s.output=[]):n!=0&&s.output.push(n)},fsync(s){var n;0<((n=s.output)==null?void 0:n.length)&&(W(J(s.output)),s.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},Vs={qb(s,n){n===null||n===10?(K(J(s.output)),s.output=[]):n!=0&&s.output.push(n)},fsync(s){var n;0<((n=s.output)==null?void 0:n.length)&&(K(J(s.output)),s.output=[])}},z={Wa:null,Xa(){return z.createNode(null,"/",16895,0)},createNode(s,n,o,c){if((o&61440)===24576||(o&61440)===4096)throw new C(63);return z.Wa||(z.Wa={dir:{node:{Ta:z.La.Ta,Ua:z.La.Ua,lookup:z.La.lookup,hb:z.La.hb,rename:z.La.rename,unlink:z.La.unlink,rmdir:z.La.rmdir,readdir:z.La.readdir,symlink:z.La.symlink},stream:{Va:z.Ma.Va}},file:{node:{Ta:z.La.Ta,Ua:z.La.Ua},stream:{Va:z.Ma.Va,read:z.Ma.read,write:z.Ma.write,ib:z.Ma.ib,jb:z.Ma.jb}},link:{node:{Ta:z.La.Ta,Ua:z.La.Ua,readlink:z.La.readlink},stream:{}},ub:{node:{Ta:z.La.Ta,Ua:z.La.Ua},stream:Js}}),o=rs(s,n,o,c),ne(o.mode)?(o.La=z.Wa.dir.node,o.Ma=z.Wa.dir.stream,o.Na={}):(o.mode&61440)===32768?(o.La=z.Wa.file.node,o.Ma=z.Wa.file.stream,o.Ra=0,o.Na=null):(o.mode&61440)===40960?(o.La=z.Wa.link.node,o.Ma=z.Wa.link.stream):(o.mode&61440)===8192&&(o.La=z.Wa.ub.node,o.Ma=z.Wa.ub.stream),o.atime=o.mtime=o.ctime=Date.now(),s&&(s.Na[n]=o,s.atime=s.mtime=s.ctime=o.atime),o},Sb(s){return s.Na?s.Na.subarray?s.Na.subarray(0,s.Ra):new Uint8Array(s.Na):new Uint8Array(0)},La:{Ta(s){var n={};return n.dev=(s.mode&61440)===8192?s.id:1,n.ino=s.id,n.mode=s.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=s.rdev,ne(s.mode)?n.size=4096:(s.mode&61440)===32768?n.size=s.Ra:(s.mode&61440)===40960?n.size=s.link.length:n.size=0,n.atime=new Date(s.atime),n.mtime=new Date(s.mtime),n.ctime=new Date(s.ctime),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},Ua(s,n){for(var o of["mode","atime","mtime","ctime"])n[o]!=null&&(s[o]=n[o]);n.size!==void 0&&(n=n.size,s.Ra!=n&&(n==0?(s.Na=null,s.Ra=0):(o=s.Na,s.Na=new Uint8Array(n),o&&s.Na.set(o.subarray(0,Math.min(n,s.Ra))),s.Ra=n)))},lookup(){throw z.vb},hb(s,n,o,c){return z.createNode(s,n,o,c)},rename(s,n,o){try{var c=Se(n,o)}catch{}if(c){if(ne(s.mode))for(var f in c.Na)throw new C(55);$t(c)}delete s.parent.Na[s.name],n.Na[o]=s,s.name=o,n.ctime=n.mtime=s.parent.ctime=s.parent.mtime=Date.now()},unlink(s,n){delete s.Na[n],s.ctime=s.mtime=Date.now()},rmdir(s,n){var o=Se(s,n),c;for(c in o.Na)throw new C(55);delete s.Na[n],s.ctime=s.mtime=Date.now()},readdir(s){return[".","..",...Object.keys(s.Na)]},symlink(s,n,o){return s=z.createNode(s,n,41471,0),s.link=o,s},readlink(s){if((s.mode&61440)!==40960)throw new C(28);return s.link}},Ma:{read(s,n,o,c,f){var p=s.node.Na;if(f>=s.node.Ra)return 0;if(s=Math.min(s.node.Ra-f,c),8<s&&p.subarray)n.set(p.subarray(f,f+s),o);else for(c=0;c<s;c++)n[o+c]=p[f+c];return s},write(s,n,o,c,f,p){if(n.buffer===A.buffer&&(p=!1),!c)return 0;if(s=s.node,s.mtime=s.ctime=Date.now(),n.subarray&&(!s.Na||s.Na.subarray)){if(p)return s.Na=n.subarray(o,o+c),s.Ra=c;if(s.Ra===0&&f===0)return s.Na=n.slice(o,o+c),s.Ra=c;if(f+c<=s.Ra)return s.Na.set(n.subarray(o,o+c),f),c}p=f+c;var v=s.Na?s.Na.length:0;if(v>=p||(p=Math.max(p,v*(1048576>v?2:1.125)>>>0),v!=0&&(p=Math.max(p,256)),v=s.Na,s.Na=new Uint8Array(p),0<s.Ra&&s.Na.set(v.subarray(0,s.Ra),0)),s.Na.subarray&&n.subarray)s.Na.set(n.subarray(o,o+c),f);else for(p=0;p<c;p++)s.Na[f+p]=n[o+p];return s.Ra=Math.max(s.Ra,f+c),c},Va(s,n,o){if(o===1?n+=s.position:o===2&&(s.node.mode&61440)===32768&&(n+=s.node.Ra),0>n)throw new C(28);return n},ib(s,n,o,c,f){if((s.node.mode&61440)!==32768)throw new C(43);if(s=s.node.Na,f&2||!s||s.buffer!==A.buffer){f=!0,c=65536*Math.ceil(n/65536);var p=xs(65536,c);if(p&&O.fill(0,p,p+c),c=p,!c)throw new C(48);s&&((0<o||o+n<s.length)&&(s.subarray?s=s.subarray(o,o+n):s=Array.prototype.slice.call(s,o,o+n)),A.set(s,c))}else f=!1,c=s.byteOffset;return{Kb:c,Ab:f}},jb(s,n,o,c){return z.Ma.write(s,n,0,c,o,!1),0}}},ts=(s,n)=>{var o=0;return s&&(o|=365),n&&(o|=146),o},wt=null,ss={},Oe=[],Ks=1,me=null,ns=!1,is=!0,as={},C=class{constructor(s){T(this,"name","ErrnoError");this.Pa=s}},Qs=class{constructor(){T(this,"gb",{});T(this,"node",null)}get flags(){return this.gb.flags}set flags(s){this.gb.flags=s}get position(){return this.gb.position}set position(s){this.gb.position=s}},Xs=class{constructor(s,n,o,c){T(this,"La",{});T(this,"Ma",{});T(this,"ab",null);s||(s=this),this.parent=s,this.Xa=s.Xa,this.id=Ks++,this.name=n,this.mode=o,this.rdev=c,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(s){s?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(s){s?this.mode|=146:this.mode&=-147}};function re(s,n={}){if(!s)throw new C(44);n.nb??(n.nb=!0),s.charAt(0)==="/"||(s="//"+s);var o=0;e:for(;40>o;o++){s=s.split("/").filter(D=>!!D);for(var c=wt,f="/",p=0;p<s.length;p++){var v=p===s.length-1;if(v&&n.parent)break;if(s[p]!==".")if(s[p]==="..")f=Xt(f),c=c.parent;else{f=yt(f+"/"+s[p]);try{c=Se(c,s[p])}catch(D){if((D==null?void 0:D.Pa)===44&&v&&n.Jb)return{path:f};throw D}if(!c.ab||v&&!n.nb||(c=c.ab.root),(c.mode&61440)===40960&&(!v||n.$a)){if(!c.La.readlink)throw new C(52);c=c.La.readlink(c),c.charAt(0)==="/"||(c=Xt(f)+"/"+c),s=c+"/"+s.slice(p+1).join("/");continue e}}}return{path:f,node:c}}throw new C(32)}function xt(s){for(var n;;){if(s===s.parent)return s=s.Xa.zb,n?s[s.length-1]!=="/"?`${s}/${n}`:s+n:s;n=n?`${s.name}/${n}`:s.name,s=s.parent}}function St(s,n){for(var o=0,c=0;c<n.length;c++)o=(o<<5)-o+n.charCodeAt(c)|0;return(s+o>>>0)%me.length}function $t(s){var n=St(s.parent.id,s.name);if(me[n]===s)me[n]=s.bb;else for(n=me[n];n;){if(n.bb===s){n.bb=s.bb;break}n=n.bb}}function Se(s,n){var o=ne(s.mode)?(o=Pe(s,"x"))?o:s.La.lookup?0:2:54;if(o)throw new C(o);for(o=me[St(s.id,n)];o;o=o.bb){var c=o.name;if(o.parent.id===s.id&&c===n)return o}return s.La.lookup(s,n)}function rs(s,n,o,c){return s=new Xs(s,n,o,c),n=St(s.parent.id,s.name),s.bb=me[n],me[n]=s}function ne(s){return(s&61440)===16384}function os(s){var n=["r","w","rw"][s&3];return s&512&&(n+="w"),n}function Pe(s,n){if(is)return 0;if(!n.includes("r")||s.mode&292){if(n.includes("w")&&!(s.mode&146)||n.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function ls(s,n){if(!ne(s.mode))return 54;try{return Se(s,n),20}catch{}return Pe(s,"wx")}function cs(s,n,o){try{var c=Se(s,n)}catch(f){return f.Pa}if(s=Pe(s,"wx"))return s;if(o){if(!ne(c.mode))return 54;if(c===c.parent||xt(c)==="/")return 10}else if(ne(c.mode))return 31;return 0}function Ze(s){if(!s)throw new C(63);return s}function se(s){if(s=Oe[s],!s)throw new C(8);return s}function ds(s,n=-1){if(s=Object.assign(new Qs,s),n==-1)e:{for(n=0;4096>=n;n++)if(!Oe[n])break e;throw new C(33)}return s.fd=n,Oe[n]=s}function Ys(s,n=-1){var o,c;return s=ds(s,n),(c=(o=s.Ma)==null?void 0:o.Rb)==null||c.call(o,s),s}function Tt(s,n,o){var c=s==null?void 0:s.Ma.Ua;s=c?s:n,c??(c=n.La.Ua),Ze(c),c(s,o)}var Js={open(s){var n,o;s.Ma=ss[s.node.rdev].Ma,(o=(n=s.Ma).open)==null||o.call(n,s)},Va(){throw new C(70)}};function Ct(s,n){ss[s]={Ma:n}}function us(s,n){var o=n==="/";if(o&&wt)throw new C(10);if(!o&&n){var c=re(n,{nb:!1});if(n=c.path,c=c.node,c.ab)throw new C(10);if(!ne(c.mode))throw new C(54)}n={type:s,Wb:{},zb:n,Ib:[]},s=s.Xa(n),s.Xa=n,n.root=s,o?wt=s:c&&(c.ab=n,c.Xa&&c.Xa.Ib.push(n))}function et(s,n,o){var c=re(s,{parent:!0}).node;if(s=Je(s),!s)throw new C(28);if(s==="."||s==="..")throw new C(20);var f=ls(c,s);if(f)throw new C(f);if(!c.La.hb)throw new C(63);return c.La.hb(c,s,n,o)}function Zs(s,n=438){return et(s,n&4095|32768,0)}function ue(s,n=511){return et(s,n&1023|16384,0)}function tt(s,n,o){typeof o>"u"&&(o=n,n=438),et(s,n|8192,o)}function _t(s,n){if(!Bs(s))throw new C(44);var o=re(n,{parent:!0}).node;if(!o)throw new C(44);n=Je(n);var c=ls(o,n);if(c)throw new C(c);if(!o.La.symlink)throw new C(63);o.La.symlink(o,n,s)}function hs(s){var n=re(s,{parent:!0}).node;s=Je(s);var o=Se(n,s),c=cs(n,s,!0);if(c)throw new C(c);if(!n.La.rmdir)throw new C(63);if(o.ab)throw new C(10);n.La.rmdir(n,s),$t(o)}function fs(s){var n=re(s,{parent:!0}).node;if(!n)throw new C(44);s=Je(s);var o=Se(n,s),c=cs(n,s,!1);if(c)throw new C(c);if(!n.La.unlink)throw new C(63);if(o.ab)throw new C(10);n.La.unlink(n,s),$t(o)}function We(s,n){return s=re(s,{$a:!n}).node,Ze(s.La.Ta)(s)}function gs(s,n,o,c){Tt(s,n,{mode:o&4095|n.mode&-4096,ctime:Date.now(),Fb:c})}function st(s,n){s=typeof s=="string"?re(s,{$a:!0}).node:s,gs(null,s,n)}function ps(s,n,o){if(ne(n.mode))throw new C(31);if((n.mode&61440)!==32768)throw new C(28);var c=Pe(n,"w");if(c)throw new C(c);Tt(s,n,{size:o,timestamp:Date.now()})}function Fe(s,n,o=438){if(s==="")throw new C(44);if(typeof n=="string"){var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[n];if(typeof c>"u")throw Error(`Unknown file open mode: ${n}`);n=c}if(o=n&64?o&4095|32768:0,typeof s=="object")c=s;else{var f=s.endsWith("/");s=re(s,{$a:!(n&131072),Jb:!0}),c=s.node,s=s.path}var p=!1;if(n&64)if(c){if(n&128)throw new C(20)}else{if(f)throw new C(31);c=et(s,o|511,0),p=!0}if(!c)throw new C(44);if((c.mode&61440)===8192&&(n&=-513),n&65536&&!ne(c.mode))throw new C(54);if(!p&&(f=c?(c.mode&61440)===40960?32:ne(c.mode)&&(os(n)!=="r"||n&576)?31:Pe(c,os(n)):44))throw new C(f);return n&512&&!p&&(f=c,f=typeof f=="string"?re(f,{$a:!0}).node:f,ps(null,f,0)),n&=-131713,f=ds({node:c,path:xt(c),flags:n,seekable:!0,position:0,Ma:c.Ma,Lb:[],error:!1}),f.Ma.open&&f.Ma.open(f),p&&st(c,o&511),!l.logReadFiles||n&1||s in as||(as[s]=1),f}function Et(s){if(s.fd===null)throw new C(8);s.ob&&(s.ob=null);try{s.Ma.close&&s.Ma.close(s)}catch(n){throw n}finally{Oe[s.fd]=null}s.fd=null}function ms(s,n,o){if(s.fd===null)throw new C(8);if(!s.seekable||!s.Ma.Va)throw new C(70);if(o!=0&&o!=1&&o!=2)throw new C(28);s.position=s.Ma.Va(s,n,o),s.Lb=[]}function bs(s,n,o,c,f){if(0>c||0>f)throw new C(28);if(s.fd===null)throw new C(8);if((s.flags&2097155)===1)throw new C(8);if(ne(s.node.mode))throw new C(31);if(!s.Ma.read)throw new C(28);var p=typeof f<"u";if(!p)f=s.position;else if(!s.seekable)throw new C(70);return n=s.Ma.read(s,n,o,c,f),p||(s.position+=n),n}function ys(s,n,o,c,f){if(0>c||0>f)throw new C(28);if(s.fd===null)throw new C(8);if((s.flags&2097155)===0)throw new C(8);if(ne(s.node.mode))throw new C(31);if(!s.Ma.write)throw new C(28);s.seekable&&s.flags&1024&&ms(s,0,2);var p=typeof f<"u";if(!p)f=s.position;else if(!s.seekable)throw new C(70);return n=s.Ma.write(s,n,o,c,f,void 0),p||(s.position+=n),n}function en(s){var n,o=Fe(s,o||0);s=We(s).size;var c=new Uint8Array(s);return bs(o,c,0,s,0),n=c,Et(o),n}function be(s,n,o){s=yt("/dev/"+s);var c=ts(!!n,!!o);be.yb??(be.yb=64);var f=be.yb++<<8|0;Ct(f,{open(p){p.seekable=!1},close(){var p;(p=o==null?void 0:o.buffer)!=null&&p.length&&o(10)},read(p,v,D,U){for(var q=0,Z=0;Z<U;Z++){try{var ie=n()}catch{throw new C(29)}if(ie===void 0&&q===0)throw new C(6);if(ie==null)break;q++,v[D+Z]=ie}return q&&(p.node.atime=Date.now()),q},write(p,v,D,U){for(var q=0;q<U;q++)try{o(v[D+q])}catch{throw new C(29)}return U&&(p.node.mtime=p.node.ctime=Date.now()),q}}),tt(s,c,f)}var Q={};function $e(s,n,o){if(n.charAt(0)==="/")return n;if(s=s===-100?"/":se(s).path,n.length==0){if(!o)throw new C(44);return s}return s+"/"+n}function nt(s,n){F[s>>2]=n.dev,F[s+4>>2]=n.mode,G[s+8>>2]=n.nlink,F[s+12>>2]=n.uid,F[s+16>>2]=n.gid,F[s+20>>2]=n.rdev,te[s+24>>3]=BigInt(n.size),F[s+32>>2]=4096,F[s+36>>2]=n.blocks;var o=n.atime.getTime(),c=n.mtime.getTime(),f=n.ctime.getTime();return te[s+40>>3]=BigInt(Math.floor(o/1e3)),G[s+48>>2]=o%1e3*1e6,te[s+56>>3]=BigInt(Math.floor(c/1e3)),G[s+64>>2]=c%1e3*1e6,te[s+72>>3]=BigInt(Math.floor(f/1e3)),G[s+80>>2]=f%1e3*1e6,te[s+88>>3]=BigInt(n.ino),0}var it=void 0,at=()=>{var s=F[+it>>2];return it+=4,s},kt=0,tn=[0,31,60,91,121,152,182,213,244,274,305,335],sn=[0,31,59,90,120,151,181,212,243,273,304,334],Ve={},vs=s=>{var n;ee=s,mt||0<kt||((n=l.onExit)==null||n.call(l,s),X=!0),_(s,new pt(s))},nn=s=>{if(!X)try{if(s(),!(mt||0<kt))try{ee=s=ee,vs(s)}catch(n){n instanceof pt||n=="unwind"||_(1,n)}}catch(n){n instanceof pt||n=="unwind"||_(1,n)}},At={},ws=()=>{if(!Lt){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:$||"./this.program"},n;for(n in At)At[n]===void 0?delete s[n]:s[n]=At[n];var o=[];for(n in s)o.push(`${n}=${s[n]}`);Lt=o}return Lt},Lt,Mt=s=>{var n=Ge(s)+1,o=ve(n);return ge(s,O,o,n),o},an=(s,n,o,c)=>{var f={string:q=>{var Z=0;return q!=null&&q!==0&&(Z=Mt(q)),Z},array:q=>{var Z=ve(q.length);return A.set(q,Z),Z}};s=l["_"+s];var p=[],v=0;if(c)for(var D=0;D<c.length;D++){var U=f[o[D]];U?(v===0&&(v=Xe()),p[D]=U(c[D])):p[D]=c[D]}return o=s(...p),o=(function(q){return v!==0&&Qe(v),n==="string"?q?J(O,q):"":n==="boolean"?!!q:q})(o)},rt=0,ot=(s,n)=>(n=n==1?ve(s.length):Nt(s.length),s.subarray||s.slice||(s=new Uint8Array(s)),O.set(s,n),n),Te,Dt=[],pe,ye=s=>{Te.delete(pe.get(s)),pe.set(s,null),Dt.push(s)},Ke=(s,n)=>{if(!Te){Te=new WeakMap;var o=pe.length;if(Te)for(var c=0;c<0+o;c++){var f=pe.get(c);f&&Te.set(f,c)}}if(o=Te.get(s)||0)return o;if(Dt.length)o=Dt.pop();else{try{pe.grow(1)}catch(U){throw U instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":U}o=pe.length-1}try{pe.set(o,s)}catch(U){if(!(U instanceof TypeError))throw U;if(typeof WebAssembly.Function=="function"){var p=WebAssembly.Function;c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:n[0]=="v"?[]:[c[n[0]]]};for(var v=1;v<n.length;++v)f.parameters.push(c[n[v]]);n=new p(f,s)}else{c=[1],f=n.slice(0,1),n=n.slice(1),v={i:127,p:127,j:126,f:125,d:124,e:111},c.push(96);var D=n.length;128>D?c.push(D):c.push(D%128|128,D>>7);for(p of n)c.push(v[p]);f=="v"?c.push(0):c.push(1,v[f]),n=[0,97,115,109,1,0,0,0,1],p=c.length,128>p?n.push(p):n.push(p%128|128,p>>7),n.push(...c),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),n=new WebAssembly.Module(new Uint8Array(n)),n=new WebAssembly.Instance(n,{e:{f:s}}).exports.f}pe.set(o,n)}return Te.set(s,o),o};me=Array(4096),us(z,"/"),ue("/tmp"),ue("/home"),ue("/home/web_user"),(function(){ue("/dev"),Ct(259,{read:()=>0,write:(c,f,p,v)=>v,Va:()=>0}),tt("/dev/null",259),es(1280,Ws),es(1536,Vs),tt("/dev/tty",1280),tt("/dev/tty1",1536);var s=new Uint8Array(1024),n=0,o=()=>(n===0&&(Yt(s),n=s.byteLength),s[--n]);be("random",o),be("urandom",o),ue("/dev/shm"),ue("/dev/shm/tmp")})(),(function(){ue("/proc");var s=ue("/proc/self");ue("/proc/self/fd"),us({Xa(){var n=rs(s,"fd",16895,73);return n.Ma={Va:z.Ma.Va},n.La={lookup(o,c){o=+c;var f=se(o);return o={parent:null,Xa:{zb:"fake"},La:{readlink:()=>f.path},id:o+1},o.parent=o},readdir(){return Array.from(Oe.entries()).filter(([,o])=>o).map(([o])=>o.toString())}},n}},"/proc/self/fd")})(),z.vb=new C(44),z.vb.stack="<generic error, no stack>";var rn={a:(s,n,o,c)=>Re(`Assertion failed: ${s?J(O,s):""}, at: `+[n?n?J(O,n):"":"unknown filename",o,c?c?J(O,c):"":"unknown function"]),i:function(s,n){try{return s=s?J(O,s):"",st(s,n),0}catch(o){if(typeof Q>"u"||o.name!=="ErrnoError")throw o;return-o.Pa}},L:function(s,n,o){try{if(n=n?J(O,n):"",n=$e(s,n),o&-8)return-28;var c=re(n,{$a:!0}).node;return c?(s="",o&4&&(s+="r"),o&2&&(s+="w"),o&1&&(s+="x"),s&&Pe(c,s)?-2:0):-44}catch(f){if(typeof Q>"u"||f.name!=="ErrnoError")throw f;return-f.Pa}},j:function(s,n){try{var o=se(s);return gs(o,o.node,n,!1),0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},h:function(s){try{var n=se(s);return Tt(n,n.node,{timestamp:Date.now(),Fb:!1}),0}catch(o){if(typeof Q>"u"||o.name!=="ErrnoError")throw o;return-o.Pa}},b:function(s,n,o){it=o;try{var c=se(s);switch(n){case 0:var f=at();if(0>f)break;for(;Oe[f];)f++;return Ys(c,f).fd;case 1:case 2:return 0;case 3:return c.flags;case 4:return f=at(),c.flags|=f,0;case 12:return f=at(),Y[f+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(p){if(typeof Q>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},g:function(s,n){try{var o=se(s),c=o.node,f=o.Ma.Ta;s=f?o:c,f??(f=c.La.Ta),Ze(f);var p=f(s);return nt(n,p)}catch(v){if(typeof Q>"u"||v.name!=="ErrnoError")throw v;return-v.Pa}},H:function(s,n){n=-9007199254740992>n||9007199254740992<n?NaN:Number(n);try{if(isNaN(n))return 61;var o=se(s);if(0>n||(o.flags&2097155)===0)throw new C(28);return ps(o,o.node,n),0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},G:function(s,n){try{if(n===0)return-28;var o=Ge("/")+1;return n<o?-68:(ge("/",O,s,n),o)}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},K:function(s,n){try{return s=s?J(O,s):"",nt(n,We(s,!0))}catch(o){if(typeof Q>"u"||o.name!=="ErrnoError")throw o;return-o.Pa}},C:function(s,n,o){try{return n=n?J(O,n):"",n=$e(s,n),ue(n,o),0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},J:function(s,n,o,c){try{n=n?J(O,n):"";var f=c&256;return n=$e(s,n,c&4096),nt(o,f?We(n,!0):We(n))}catch(p){if(typeof Q>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},x:function(s,n,o,c){it=c;try{n=n?J(O,n):"",n=$e(s,n);var f=c?at():0;return Fe(n,o,f).fd}catch(p){if(typeof Q>"u"||p.name!=="ErrnoError")throw p;return-p.Pa}},v:function(s,n,o,c){try{if(n=n?J(O,n):"",n=$e(s,n),0>=c)return-28;var f=re(n).node;if(!f)throw new C(44);if(!f.La.readlink)throw new C(28);var p=f.La.readlink(f),v=Math.min(c,Ge(p)),D=A[o+v];return ge(p,O,o,c+1),A[o+v]=D,v}catch(U){if(typeof Q>"u"||U.name!=="ErrnoError")throw U;return-U.Pa}},u:function(s){try{return s=s?J(O,s):"",hs(s),0}catch(n){if(typeof Q>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},f:function(s,n){try{return s=s?J(O,s):"",nt(n,We(s))}catch(o){if(typeof Q>"u"||o.name!=="ErrnoError")throw o;return-o.Pa}},r:function(s,n,o){try{return n=n?J(O,n):"",n=$e(s,n),o===0?fs(n):o===512?hs(n):Re("Invalid flags passed to unlinkat"),0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},q:function(s,n,o){try{n=n?J(O,n):"",n=$e(s,n,!0);var c=Date.now(),f,p;if(o){var v=G[o>>2]+4294967296*F[o+4>>2],D=F[o+8>>2];D==1073741823?f=c:D==1073741822?f=null:f=1e3*v+D/1e6,o+=16,v=G[o>>2]+4294967296*F[o+4>>2],D=F[o+8>>2],D==1073741823?p=c:D==1073741822?p=null:p=1e3*v+D/1e6}else p=f=c;if((p??f)!==null){s=f;var U=re(n,{$a:!0}).node;Ze(U.La.Ua)(U,{atime:s,mtime:p})}return 0}catch(q){if(typeof Q>"u"||q.name!=="ErrnoError")throw q;return-q.Pa}},m:()=>Re(""),l:()=>{mt=!1,kt=0},A:function(s,n){s=-9007199254740992>s||9007199254740992<s?NaN:Number(s),s=new Date(1e3*s),F[n>>2]=s.getSeconds(),F[n+4>>2]=s.getMinutes(),F[n+8>>2]=s.getHours(),F[n+12>>2]=s.getDate(),F[n+16>>2]=s.getMonth(),F[n+20>>2]=s.getFullYear()-1900,F[n+24>>2]=s.getDay();var o=s.getFullYear();F[n+28>>2]=(o%4!==0||o%100===0&&o%400!==0?sn:tn)[s.getMonth()]+s.getDate()-1|0,F[n+36>>2]=-(60*s.getTimezoneOffset()),o=new Date(s.getFullYear(),6,1).getTimezoneOffset();var c=new Date(s.getFullYear(),0,1).getTimezoneOffset();F[n+32>>2]=(o!=c&&s.getTimezoneOffset()==Math.min(c,o))|0},y:function(s,n,o,c,f,p,v){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var D=se(c);if((n&2)!==0&&(o&2)===0&&(D.flags&2097155)!==2)throw new C(2);if((D.flags&2097155)===1)throw new C(2);if(!D.Ma.ib)throw new C(43);if(!s)throw new C(28);var U=D.Ma.ib(D,s,f,n,o),q=U.Kb;return F[p>>2]=U.Ab,G[v>>2]=q,0}catch(Z){if(typeof Q>"u"||Z.name!=="ErrnoError")throw Z;return-Z.Pa}},z:function(s,n,o,c,f,p){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p);try{var v=se(f);if(o&2){if(o=p,(v.node.mode&61440)!==32768)throw new C(43);if(!(c&2)){var D=O.slice(s,s+n);v.Ma.jb&&v.Ma.jb(v,D,o,n,c)}}}catch(U){if(typeof Q>"u"||U.name!=="ErrnoError")throw U;return-U.Pa}},n:(s,n)=>{if(Ve[s]&&(clearTimeout(Ve[s].id),delete Ve[s]),!n)return 0;var o=setTimeout(()=>{delete Ve[s],nn(()=>Ss(s,performance.now()))},n);return Ve[s]={id:o,Xb:n},0},B:(s,n,o,c)=>{var f=new Date().getFullYear(),p=new Date(f,0,1).getTimezoneOffset();f=new Date(f,6,1).getTimezoneOffset(),G[s>>2]=60*Math.max(p,f),F[n>>2]=+(p!=f),n=v=>{var D=Math.abs(v);return`UTC${0<=v?"-":"+"}${String(Math.floor(D/60)).padStart(2,"0")}${String(D%60).padStart(2,"0")}`},s=n(p),n=n(f),f<p?(ge(s,O,o,17),ge(n,O,c,17)):(ge(s,O,c,17),ge(n,O,o,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:s=>{var n=O.length;if(s>>>=0,2147483648<s)return!1;for(var o=1;4>=o;o*=2){var c=n*(1+.2/o);c=Math.min(c,s+100663296);e:{c=(Math.min(2147483648,65536*Math.ceil(Math.max(s,c)/65536))-B.buffer.byteLength+65535)/65536|0;try{B.grow(c),Bt();var f=1;break e}catch{}f=void 0}if(f)return!0}return!1},E:(s,n)=>{var o=0;return ws().forEach((c,f)=>{var p=n+o;for(f=G[s+4*f>>2]=p,p=0;p<c.length;++p)A[f++]=c.charCodeAt(p);A[f]=0,o+=c.length+1}),0},F:(s,n)=>{var o=ws();G[s>>2]=o.length;var c=0;return o.forEach(f=>c+=f.length+1),G[n>>2]=c,0},e:function(s){try{var n=se(s);return Et(n),0}catch(o){if(typeof Q>"u"||o.name!=="ErrnoError")throw o;return o.Pa}},p:function(s,n){try{var o=se(s);return A[n]=o.tty?2:ne(o.mode)?3:(o.mode&61440)===40960?7:4,Y[n+2>>1]=0,te[n+8>>3]=BigInt(0),te[n+16>>3]=BigInt(0),0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},w:function(s,n,o,c){try{e:{var f=se(s);s=n;for(var p,v=n=0;v<o;v++){var D=G[s>>2],U=G[s+4>>2];s+=8;var q=bs(f,A,D,U,p);if(0>q){var Z=-1;break e}if(n+=q,q<U)break;typeof p<"u"&&(p+=q)}Z=n}return G[c>>2]=Z,0}catch(ie){if(typeof Q>"u"||ie.name!=="ErrnoError")throw ie;return ie.Pa}},D:function(s,n,o,c){n=-9007199254740992>n||9007199254740992<n?NaN:Number(n);try{if(isNaN(n))return 61;var f=se(s);return ms(f,n,o),te[c>>3]=BigInt(f.position),f.ob&&n===0&&o===0&&(f.ob=null),0}catch(p){if(typeof Q>"u"||p.name!=="ErrnoError")throw p;return p.Pa}},I:function(s){var o;try{var n=se(s);return(o=n.Ma)!=null&&o.fsync?n.Ma.fsync(n):0}catch(c){if(typeof Q>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},t:function(s,n,o,c){try{e:{var f=se(s);s=n;for(var p,v=n=0;v<o;v++){var D=G[s>>2],U=G[s+4>>2];s+=8;var q=ys(f,A,D,U,p);if(0>q){var Z=-1;break e}if(n+=q,q<U)break;typeof p<"u"&&(p+=q)}Z=n}return G[c>>2]=Z,0}catch(ie){if(typeof Q>"u"||ie.name!=="ErrnoError")throw ie;return ie.Pa}},k:vs},N;(async function(){var o;function s(c){var f;return N=c.exports,B=N.M,Bt(),pe=N.O,xe--,(f=l.monitorRunDependencies)==null||f.call(l,xe),xe==0&&He&&(c=He,He=null,c()),N}xe++,(o=l.monitorRunDependencies)==null||o.call(l,xe);var n={a:rn};return l.instantiateWasm?new Promise(c=>{l.instantiateWasm(n,(f,p)=>{s(f),c(f.exports)})}):(gt??(gt=l.locateFile?l.locateFile("sql-wasm.wasm",E):E+"sql-wasm.wasm"),s((await qs(n)).instance))})(),l._sqlite3_free=s=>(l._sqlite3_free=N.P)(s),l._sqlite3_value_text=s=>(l._sqlite3_value_text=N.Q)(s),l._sqlite3_prepare_v2=(s,n,o,c,f)=>(l._sqlite3_prepare_v2=N.R)(s,n,o,c,f),l._sqlite3_step=s=>(l._sqlite3_step=N.S)(s),l._sqlite3_reset=s=>(l._sqlite3_reset=N.T)(s),l._sqlite3_exec=(s,n,o,c,f)=>(l._sqlite3_exec=N.U)(s,n,o,c,f),l._sqlite3_finalize=s=>(l._sqlite3_finalize=N.V)(s),l._sqlite3_column_name=(s,n)=>(l._sqlite3_column_name=N.W)(s,n),l._sqlite3_column_text=(s,n)=>(l._sqlite3_column_text=N.X)(s,n),l._sqlite3_column_type=(s,n)=>(l._sqlite3_column_type=N.Y)(s,n),l._sqlite3_errmsg=s=>(l._sqlite3_errmsg=N.Z)(s),l._sqlite3_clear_bindings=s=>(l._sqlite3_clear_bindings=N._)(s),l._sqlite3_value_blob=s=>(l._sqlite3_value_blob=N.$)(s),l._sqlite3_value_bytes=s=>(l._sqlite3_value_bytes=N.aa)(s),l._sqlite3_value_double=s=>(l._sqlite3_value_double=N.ba)(s),l._sqlite3_value_int=s=>(l._sqlite3_value_int=N.ca)(s),l._sqlite3_value_type=s=>(l._sqlite3_value_type=N.da)(s),l._sqlite3_result_blob=(s,n,o,c)=>(l._sqlite3_result_blob=N.ea)(s,n,o,c),l._sqlite3_result_double=(s,n)=>(l._sqlite3_result_double=N.fa)(s,n),l._sqlite3_result_error=(s,n,o)=>(l._sqlite3_result_error=N.ga)(s,n,o),l._sqlite3_result_int=(s,n)=>(l._sqlite3_result_int=N.ha)(s,n),l._sqlite3_result_int64=(s,n)=>(l._sqlite3_result_int64=N.ia)(s,n),l._sqlite3_result_null=s=>(l._sqlite3_result_null=N.ja)(s),l._sqlite3_result_text=(s,n,o,c)=>(l._sqlite3_result_text=N.ka)(s,n,o,c),l._sqlite3_aggregate_context=(s,n)=>(l._sqlite3_aggregate_context=N.la)(s,n),l._sqlite3_column_count=s=>(l._sqlite3_column_count=N.ma)(s),l._sqlite3_data_count=s=>(l._sqlite3_data_count=N.na)(s),l._sqlite3_column_blob=(s,n)=>(l._sqlite3_column_blob=N.oa)(s,n),l._sqlite3_column_bytes=(s,n)=>(l._sqlite3_column_bytes=N.pa)(s,n),l._sqlite3_column_double=(s,n)=>(l._sqlite3_column_double=N.qa)(s,n),l._sqlite3_bind_blob=(s,n,o,c,f)=>(l._sqlite3_bind_blob=N.ra)(s,n,o,c,f),l._sqlite3_bind_double=(s,n,o)=>(l._sqlite3_bind_double=N.sa)(s,n,o),l._sqlite3_bind_int=(s,n,o)=>(l._sqlite3_bind_int=N.ta)(s,n,o),l._sqlite3_bind_text=(s,n,o,c,f)=>(l._sqlite3_bind_text=N.ua)(s,n,o,c,f),l._sqlite3_bind_parameter_index=(s,n)=>(l._sqlite3_bind_parameter_index=N.va)(s,n),l._sqlite3_sql=s=>(l._sqlite3_sql=N.wa)(s),l._sqlite3_normalized_sql=s=>(l._sqlite3_normalized_sql=N.xa)(s),l._sqlite3_changes=s=>(l._sqlite3_changes=N.ya)(s),l._sqlite3_close_v2=s=>(l._sqlite3_close_v2=N.za)(s),l._sqlite3_create_function_v2=(s,n,o,c,f,p,v,D,U)=>(l._sqlite3_create_function_v2=N.Aa)(s,n,o,c,f,p,v,D,U),l._sqlite3_update_hook=(s,n,o)=>(l._sqlite3_update_hook=N.Ba)(s,n,o),l._sqlite3_open=(s,n)=>(l._sqlite3_open=N.Ca)(s,n);var Nt=l._malloc=s=>(Nt=l._malloc=N.Da)(s),lt=l._free=s=>(lt=l._free=N.Ea)(s);l._RegisterExtensionFunctions=s=>(l._RegisterExtensionFunctions=N.Fa)(s);var xs=(s,n)=>(xs=N.Ga)(s,n),Ss=(s,n)=>(Ss=N.Ha)(s,n),Qe=s=>(Qe=N.Ia)(s),ve=s=>(ve=N.Ja)(s),Xe=()=>(Xe=N.Ka)();l.stackSave=()=>Xe(),l.stackRestore=s=>Qe(s),l.stackAlloc=s=>ve(s),l.cwrap=(s,n,o,c)=>{var f=!o||o.every(p=>p==="number"||p==="boolean");return n!=="string"&&f&&!c?l["_"+s]:(...p)=>an(s,n,o,p)},l.addFunction=Ke,l.removeFunction=ye,l.UTF8ToString=bt,l.ALLOC_NORMAL=rt,l.allocate=ot,l.allocateUTF8OnStack=Mt;function Rt(){function s(){var f;if(l.calledRun=!0,!X){if(!l.noFSInit&&!ns){var n,o;ns=!0,c??(c=l.stdin),n??(n=l.stdout),o??(o=l.stderr),c?be("stdin",c):_t("/dev/tty","/dev/stdin"),n?be("stdout",null,n):_t("/dev/tty","/dev/stdout"),o?be("stderr",null,o):_t("/dev/tty1","/dev/stderr"),Fe("/dev/stdin",0),Fe("/dev/stdout",1),Fe("/dev/stderr",1)}if(N.N(),is=!1,(f=l.onRuntimeInitialized)==null||f.call(l),l.postRun)for(typeof l.postRun=="function"&&(l.postRun=[l.postRun]);l.postRun.length;){var c=l.postRun.shift();Wt.unshift(c)}Gt(Wt)}}if(0<xe)He=Rt;else{if(l.preRun)for(typeof l.preRun=="function"&&(l.preRun=[l.preRun]);l.preRun.length;)Us();Gt(Vt),0<xe?He=Rt:l.setStatus?(l.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>l.setStatus(""),1),s()},1)):s()}}if(l.preInit)for(typeof l.preInit=="function"&&(l.preInit=[l.preInit]);0<l.preInit.length;)l.preInit.pop()();return Rt(),u}),t)};k.exports=a,k.exports.default=a})(Pt)),Pt.exports}var Hn=Un();const Bn=In(Hn),dt={berdl_tables:{configId:"berdl_tables",configPath:"/config/berdl-tables.json",version:"1.0.0",description:"BERDL tables configuration"},genome_data_tables:{configId:"genome_data_tables",configPath:"/config/genome-data-tables.json",version:"1.0.0",description:"Genome data tables configuration"}},_e={"/data/berdl_tables.db":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"},"/data/berdl_tables_ecoli_562_61143.db":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/0":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/1":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"}},le=class le{constructor(){T(this,"db",null);T(this,"currentDbPath",null);T(this,"sqlPromise",null)}static getInstance(){return le.instance||(le.instance=new le),le.instance}static isLocalDb(e){return e in _e||e.startsWith("local/")}static getConfigDefinition(e){return dt[e]||null}static getDatabaseMapping(e){return _e[e]||null}static getConfigPath(e){const t=_e[e];if(!t){if(e.startsWith("/data/")||e.startsWith("./data/")){const i=e.startsWith("./")?e.substring(2):e,r=_e[i];if(r){const d=dt[r.configId];return r.configPath||(d==null?void 0:d.configPath)||null}}return null}const a=dt[t.configId];return a?t.configPath||a.configPath:null}static getDatabasePath(e){const t=_e[e];return t?t.dbPath:e.startsWith("/data/")||e.startsWith("./data/")?e.startsWith("./")?e.substring(2):e:e.startsWith("local/")?`/data/${e.replace("local/","")}.db`:null}static getAllConfigDefinitions(){return{...dt}}static getAllDatabaseMappings(){return{..._e}}static getDatabasesForConfig(e){return Object.values(_e).filter(t=>t.configId===e)}async initSql(){return this.sqlPromise||(this.sqlPromise=Bn({locateFile:e=>`https://sql.js.org/dist/${e}`})),this.sqlPromise}async loadDatabase(e){if(this.db&&this.currentDbPath===e)return;this.db&&(this.db.close(),this.db=null);const t=await this.initSql(),a=await fetch(e);if(!a.ok)throw new Error(`Failed to load database: ${a.status} ${a.statusText}`);const i=await a.arrayBuffer();this.db=new t.Database(new Uint8Array(i)),this.currentDbPath=e}async listTables(e){let t=null,a=null;if(t=le.getDatabasePath(e),a=le.getConfigPath(e),!t&&e.startsWith("local/")){const r=e.replace("local/","");t=`/data/${r}.db`,a=le.getConfigPath(`/data/${r}.db`)||`/config/${r}.json`}if(!t)throw new Error(`Unknown local database: ${e}`);if(await this.loadDatabase(t),!this.db)throw new Error("Database not loaded");let i={};if(a)try{const r=await fetch(a);r.ok&&(i=await r.json())}catch(r){console.warn("Failed to load config:",r)}return this.listTablesFromDb(t,i)}async listTablesFromDb(e,t={}){var r;if(!t||Object.keys(t).length===0){const d=le.getConfigPath(e);if(d)try{const u=await fetch(d);u.ok&&(t=await u.json())}catch(u){console.warn("Failed to load config:",u)}}if(await this.loadDatabase(e),!this.db)throw new Error("Database not loaded");const a=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),i=[];if(a.length>0&&a[0].values)for(const d of a[0].values){const u=d[0],h=this.db.exec(`SELECT COUNT(*) FROM "${u}"`),l=h.length>0?h[0].values[0][0]:0,y=this.db.exec(`PRAGMA table_info("${u}")`),m=y.length>0?y[0].values.length:0,b=(r=t.tables)==null?void 0:r[u];i.push({name:u,displayName:(b==null?void 0:b.displayName)||u,row_count:l,column_count:m,description:b==null?void 0:b.description})}return{tables:i,type:"berdl_tables",object_type:"KBaseFBA.GenomeDataLakeTables-2.0"}}async getTableData(e,t){let a=null;if(a=le.getDatabasePath(e),!a&&e.startsWith("local/")&&(this.currentDbPath?a=this.currentDbPath:a=`/data/${e.replace("local/","")}.db`),!a)throw new Error(`Unknown local database: ${e}`);if(await this.loadDatabase(a),!this.db)throw new Error("Database not loaded");const i=t.table_name,r=t.limit||100,d=t.offset||0;let u="*";if(t.columns&&t.columns.length>0&&(u=t.columns.map(F=>`"${F}"`).join(", ")),t.aggregations&&t.aggregations.length>0)return this.getAggregatedData(t);const h=[],l=[],y=this.db.exec(`PRAGMA table_info("${i}")`),m={};if(y.length>0)for(const F of y[0].values){const G=F[1],he=(F[2]||"TEXT").toUpperCase();m[G]=he}if(t.filters&&t.filters.length>0){const F=this.buildAdvancedFiltersWithTypes(t.filters,l,m);h.push(...F)}if(t.search_value&&t.search_value.trim()){const F=this.db.exec(`PRAGMA table_info("${i}")`);if(F.length>0){const G=F[0].values.map(te=>`CAST("${te[1]}" AS TEXT) LIKE ?`);h.push(`(${G.join(" OR ")})`);const he=`%${t.search_value}%`;for(let te=0;te<F[0].values.length;te++)l.push(he)}}if(t.col_filter)for(const[F,G]of Object.entries(t.col_filter))G!=null&&G!==""&&(h.push(`CAST("${F}" AS TEXT) LIKE ?`),l.push(`%${G}%`));const b=h.length>0?`WHERE ${h.join(" AND ")}`:"";let S="";if(t.sort_column){const F=t.sort_order||"ASC";S=`ORDER BY "${t.sort_column}" ${F}`}const $=`SELECT COUNT(*) FROM "${i}" ${b}`,_=this.db.prepare($);l.length>0&&_.bind(l),_.step();const E=_.get()[0];_.free();const R=`SELECT ${u} FROM "${i}" ${b} ${S} LIMIT ? OFFSET ?`,M=[...l,r,d],P=this.db.prepare(R);P.bind(M);const W=[],K=[];for(;P.step();){const F=P.get();if(W.length===0){const G=P.getColumnNames();W.push(...G)}K.push(F)}P.free();const H=this.db.exec(`PRAGMA table_info("${i}")`),B=[];if(H.length>0)for(const F of H[0].values){const G=F[1],he=F[2]||"TEXT",te=F[3]===1,De=F[4],Ne=F[5]===1;B.push({name:G,type:he,notnull:te,pk:Ne,dflt_value:De}),W.length===0&&W.push(G)}const X=t.columns&&t.columns.length>0?B.filter(F=>t.columns.includes(F.name)):B,ee=h.length>0?`WHERE ${h.join(" AND ")}`:"",A=t.sort_column?`ORDER BY "${t.sort_column}" ${t.sort_order||"ASC"}`:"",Y={query_type:"select",sql:`SELECT ${u} FROM "${i}" ${ee} ${A} LIMIT ? OFFSET ?`,filters_applied:h.length,has_search:!!t.search_value,has_sort:!!t.sort_column,has_group_by:!1,has_aggregations:!1};return{headers:W,data:K,total_count:E,column_types:X,column_schema:X,query_metadata:Y,limit:r,offset:d,table_name:i}}buildAdvancedFiltersWithTypes(e,t,a){const i=[];for(const r of e){const{column:d,operator:u,value:h,value2:l}=r,y=a[d]||"TEXT",m=y.includes("INT")||y.includes("REAL")||y.includes("NUMERIC");let b=h,S=l;if(m&&(u==="eq"||u==="ne"||u==="gt"||u==="gte"||u==="lt"||u==="lte"||u==="between")){if(typeof h=="string"){const _=parseFloat(h);!isNaN(_)&&isFinite(_)&&(b=y.includes("INT")?Math.floor(_):_)}else typeof h=="number"&&(b=y.includes("INT")?Math.floor(h):h);if(l!==void 0)if(typeof l=="string"){const _=parseFloat(l);!isNaN(_)&&isFinite(_)&&(S=y.includes("INT")?Math.floor(_):_)}else typeof l=="number"&&(S=y.includes("INT")?Math.floor(l):l)}let $="";switch(u){case"eq":$=`"${d}" = ?`,t.push(b);break;case"ne":$=`"${d}" != ?`,t.push(b);break;case"gt":$=`"${d}" > ?`,t.push(b);break;case"gte":$=`"${d}" >= ?`,t.push(b);break;case"lt":$=`"${d}" < ?`,t.push(b);break;case"lte":$=`"${d}" <= ?`,t.push(b);break;case"like":$=`"${d}" LIKE ?`,t.push(`%${h}%`);break;case"ilike":$=`LOWER("${d}") LIKE LOWER(?)`,t.push(`%${h}%`);break;case"in":if(Array.isArray(h)&&h.length>0){const _=h.map(()=>"?").join(",");$=`"${d}" IN (${_})`,t.push(...h)}break;case"not_in":if(Array.isArray(h)&&h.length>0){const _=h.map(()=>"?").join(",");$=`"${d}" NOT IN (${_})`,t.push(...h)}break;case"between":S!==void 0&&($=`"${d}" BETWEEN ? AND ?`,t.push(b,S));break;case"is_null":$=`"${d}" IS NULL`;break;case"is_not_null":$=`"${d}" IS NOT NULL`;break;case"regex":$=`"${d}" LIKE ?`,t.push(`%${h}%`);break}$&&i.push($)}return i}async getAggregatedData(e){if(!this.db)throw new Error("Database not loaded");const t=e.table_name,a=[];e.group_by&&e.group_by.length>0&&a.push(...e.group_by.map(A=>`"${A}"`));for(const A of e.aggregations||[]){let O="";switch(A.function){case"count":O=`COUNT(${A.column==="*"?"*":`"${A.column}"`})`;break;case"sum":O=`SUM("${A.column}")`;break;case"avg":O=`AVG("${A.column}")`;break;case"min":O=`MIN("${A.column}")`;break;case"max":O=`MAX("${A.column}")`;break;case"stddev":O=`(AVG("${A.column}" * "${A.column}") - AVG("${A.column}") * AVG("${A.column}"))`;break;case"variance":O=`(AVG("${A.column}" * "${A.column}") - AVG("${A.column}") * AVG("${A.column}"))`;break;case"distinct_count":O=`COUNT(DISTINCT "${A.column}")`;break}const Y=A.alias||`${A.function}_${A.column}`;a.push(`${O} AS "${Y}"`)}const i=a.join(", "),r=[],d=[],u=this.db.exec(`PRAGMA table_info("${t}")`),h={};if(u.length>0)for(const A of u[0].values){const O=A[1],Y=(A[2]||"TEXT").toUpperCase();h[O]=Y}if(e.filters&&e.filters.length>0){const A=this.buildAdvancedFiltersWithTypes(e.filters,d,h);r.push(...A)}const l=r.length>0?`WHERE ${r.join(" AND ")}`:"",y=e.group_by&&e.group_by.length>0?`GROUP BY ${e.group_by.map(A=>`"${A}"`).join(", ")}`:"";let m="";if(e.sort_column){const A=e.sort_order||"ASC";m=`ORDER BY "${e.sort_column}" ${A}`}const b=`SELECT ${i} FROM "${t}" ${l} ${y} ${m} LIMIT ? OFFSET ?`,S=[...d,e.limit||100,e.offset||0],$=this.db.prepare(b);$.bind(S);const _=[],E=[];for(;$.step();){const A=$.get();_.length===0&&_.push(...$.getColumnNames()),E.push(A)}$.free();const R=`SELECT COUNT(*) as count FROM (SELECT ${i} FROM "${t}" ${l} ${y})`,M=this.db.prepare(R);d.length>0&&M.bind(d),M.step();const P=M.get()[0];M.free();const W=[];if(e.group_by&&e.group_by.length>0){const A=this.db.exec(`PRAGMA table_info("${t}")`);if(A.length>0)for(const O of A[0].values){const Y=O[1];e.group_by.includes(Y)&&W.push({name:Y,type:O[2]||"TEXT",notnull:O[3]===1,pk:O[5]===1,dflt_value:O[4]})}}e.aggregations&&e.aggregations.forEach(A=>{W.push({name:A.alias||`${A.function}_${A.column}`,type:A.function==="count"||A.function==="distinct_count"?"INTEGER":"REAL",notnull:!1,pk:!1,dflt_value:null})});const K=r.length>0?`WHERE ${r.join(" AND ")}`:"",H=e.group_by&&e.group_by.length>0?`GROUP BY ${e.group_by.map(A=>`"${A}"`).join(", ")}`:"",B=e.sort_column?`ORDER BY "${e.sort_column}" ${e.sort_order||"ASC"}`:"",ee={query_type:"aggregate",sql:`SELECT ${i} FROM "${t}" ${K} ${H} ${B} LIMIT ? OFFSET ?`,filters_applied:r.length,has_search:!1,has_sort:!!e.sort_column,has_group_by:!!(e.group_by&&e.group_by.length>0),has_aggregations:!!(e.aggregations&&e.aggregations.length>0)};return{headers:_,data:E,total_count:P,column_types:W.length>0?W:void 0,column_schema:W.length>0?W:void 0,query_metadata:ee,limit:e.limit||100,offset:e.offset||0,table_name:t}}async getTableSchema(e){if(!this.db)throw new Error("Database not loaded");const t=this.db.exec(`PRAGMA table_info("${e}")`);return t.length===0||!t[0].values?[]:t[0].values.map(a=>({name:a[1],type:a[2]||"TEXT",notnull:a[3]===1,pk:a[5]===1}))}async getAllSchemas(){if(!this.db)throw new Error("Database not loaded");const e=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),t={};if(e.length>0&&e[0].values)for(const a of e[0].values){const i=a[0];t[i]=await this.getTableSchema(i)}return t}close(){this.db&&(this.db.close(),this.db=null,this.currentDbPath=null)}};T(le,"instance",null);let qe=le;const ut=Object.freeze(Object.defineProperty({__proto__:null,LocalDbClient:qe},Symbol.toStringTag,{value:"Module"})),Ft={};class Os{constructor(e={}){T(this,"baseUrl");T(this,"token");T(this,"environment");T(this,"customHeaders");T(this,"cache");T(this,"cacheTTL");T(this,"localDb");this.environment=e.environment||"appdev",e.apiConfig?(this.baseUrl=e.apiConfig.url,this.customHeaders=e.apiConfig.headers||{}):(this.baseUrl=e.baseUrl||this.getDefaultUrl(this.environment),this.customHeaders=e.headers||{}),this.token=e.token||null,this.cache=new Map,this.cacheTTL=3e5,this.localDb=qe.getInstance()}getDefaultUrl(e){const t=(Ft==null?void 0:Ft.VITE_API_URL)||typeof window<"u"&&window.__API_URL__;if(t)return t;const a={appdev:"https://appdev.kbase.us/services/berdl_table_scanner",prod:"https://kbase.us/services/berdl_table_scanner",local:"http://127.0.0.1:8000"};return a[e]||a.appdev}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json",...this.customHeaders};return this.token&&(e.Authorization=this.token),e}getCacheKey(e,t){return`${e}:${JSON.stringify(t||{})}`}getFromCache(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTTL?t.data:null}setCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}setToken(e){this.token=e,this.clearCache()}updateConfig(e){this.baseUrl=e.url,this.customHeaders=e.headers||{},this.clearCache()}setEnvironment(e){this.environment=e,this.baseUrl=this.getDefaultUrl(e),this.clearCache()}async request(e,t,a,i=!1){const r=this.getCacheKey(e,a);if(i&&t==="GET"){const m=this.getFromCache(r);if(m)return m}if(i&&t==="POST"){const m=this.getFromCache(r);if(m)return m}const d=e.startsWith("http")?e:`${this.baseUrl}${e}`,u={method:t,headers:this.getHeaders()};let h=d;if(a)if(t==="GET"){const m=new URL(d);Object.entries(a).forEach(([b,S])=>{S!=null&&m.searchParams.set(b,String(S))}),h=m.toString()}else u.body=JSON.stringify(a);const l=await fetch(h,u);if(!l.ok){let m=`HTTP ${l.status}`;try{const b=await l.json();m=b.detail||b.message||m}catch{m=`${m}: ${l.statusText}`}throw new Error(m)}const y=await l.json();return i&&this.setCache(r,y),y}async listTables(e){if(qe.isLocalDb(e)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&e.startsWith("local/"))try{const a=e.replace("local/","");return this.request(`${this.baseUrl}/object/${a}/tables`,"GET",void 0,!0)}catch(a){return console.warn("[ApiClient] Remote TableScanner API failed, falling back to client-side:",a),this.localDb.listTables(e)}return this.localDb.listTables(e)}return this.request(`/object/${e}/tables`,"GET",void 0,!0)}async getTableData(e){if(qe.isLocalDb(e.berdl_table_id)){if(this.baseUrl&&!this.baseUrl.includes("localhost")&&!this.baseUrl.includes("127.0.0.1")&&e.berdl_table_id.startsWith("local/"))try{const i=e.berdl_table_id.replace("local/",""),r={...e,berdl_table_id:`local/${i}`,limit:e.limit||100,offset:e.offset||0};return this.request(`${this.baseUrl}/table-data`,"POST",r,!1)}catch(i){return console.warn("[ApiClient] Remote TableScanner API failed, falling back to client-side:",i),this.localDb.getTableData(e.berdl_table_id,e)}return this.localDb.getTableData(e.berdl_table_id,e)}const t={...e,limit:e.limit||100,offset:e.offset||0,kb_env:this.environment};return this.request("/table-data","POST",t,!1)}}const Gn={enabled:!0,baseUrl:"http://127.0.0.1:8000",timeout:1e4,cacheEnabled:!0,cacheTTL:3e5,fallbackToStatic:!0};class Is{constructor(e={}){T(this,"settings");T(this,"cache");T(this,"token",null);T(this,"pendingRequests",new Map);this.settings={...Gn,...e},this.cache=new Map}setToken(e){this.token=e,this.clearCache()}getToken(){return this.token}updateSettings(e){this.settings={...this.settings,...e}}getSettings(){return{...this.settings}}isEnabled(){return this.settings.enabled}async resolve(e,t={}){if(!this.settings.enabled)return console.debug("[RemoteConfigProvider] Provider disabled"),null;const a=this.getCacheKey(e,t.fingerprint);if(!t.forceRefresh&&this.settings.cacheEnabled){const i=this.getFromCache(a);if(i)return console.debug(`[RemoteConfigProvider] Cache hit for ${e}`),{config:i.config,source:`cached:${i.source}`}}try{const i=`resolve:${a}`;if(this.pendingRequests.has(i)){const u=await this.pendingRequests.get(i);return u?{config:u.config,source:u.source}:null}const r=this.fetchWithTimeout(`/config/resolve/${encodeURIComponent(e)}`,{fingerprint:t.fingerprint,object_type:t.objectType});this.pendingRequests.set(i,r);const d=await r;if(this.pendingRequests.delete(i),d&&d.config)return this.settings.cacheEnabled&&this.setCache(a,{config:d.config,source:d.source,timestamp:Date.now(),fingerprint:d.fingerprint}),console.log(`[RemoteConfigProvider] Resolved config for ${e} from ${d.source}`),{config:d.config,source:d.source}}catch(i){this.pendingRequests.delete(`resolve:${a}`),console.warn(`[RemoteConfigProvider] Failed to resolve config for ${e}:`,i)}return null}async getTableListWithConfig(e){if(!this.settings.enabled)return null;try{return await this.fetchWithTimeout(`/object/${encodeURIComponent(e)}/tables`)}catch(t){return console.warn(`[RemoteConfigProvider] Failed to get table list for ${e}:`,t),null}}async generateConfig(e,t={}){if(!this.settings.enabled)return null;try{const a=await this.fetchWithTimeout(`/object/${encodeURIComponent(e)}/config/generate`,{force_regenerate:t.forceRegenerate||!1,ai_provider:t.aiProvider||"auto"},"POST");if(a&&a.config)return console.log(`[RemoteConfigProvider] Generated config for ${e}: ${a.status}`),a}catch(a){console.warn(`[RemoteConfigProvider] Failed to generate config for ${e}:`,a)}return null}async getConfigById(e){if(!this.settings.enabled)return null;try{const t=await this.fetchWithTimeout(`/config/${e}`);return(t==null?void 0:t.config)??null}catch(t){return console.warn(`[RemoteConfigProvider] Failed to get config ${e}:`,t),null}}async getConfigByFingerprint(e){if(!this.settings.enabled)return null;try{return await this.fetchWithTimeout(`/config/generated/${e}`)??null}catch(t){return console.warn(`[RemoteConfigProvider] Failed to get config by fingerprint ${e}:`,t),null}}async checkHealth(){try{const e=await this.fetchWithTimeout("/",{},"GET");return(e==null?void 0:e.status)==="running"}catch{return!1}}clearCache(){this.cache.clear(),console.debug("[RemoteConfigProvider] Cache cleared")}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}getCacheKey(e,t){return t?`${e}:${t}`:e}getFromCache(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.settings.cacheTTL?t:(this.cache.delete(e),null)}setCache(e,t){this.cache.set(e,t);const a=100;this.cache.size>a&&Array.from(this.cache.keys()).slice(0,this.cache.size-a).forEach(r=>this.cache.delete(r))}async fetchWithTimeout(e,t,a="GET"){const i=new AbortController,r=setTimeout(()=>i.abort(),this.settings.timeout);try{let d=`${this.settings.baseUrl}${e}`;const u={method:a,headers:{"Content-Type":"application/json",Accept:"application/json"},signal:i.signal};if(this.token&&(u.headers.Authorization=this.token),t&&Object.keys(t).length>0)if(a==="GET"){const l=new URL(d);Object.entries(t).forEach(([y,m])=>{m!=null&&l.searchParams.set(y,String(m))}),d=l.toString()}else u.body=JSON.stringify(t);const h=await fetch(d,u);if(!h.ok){let l=`HTTP ${h.status}`;try{const y=await h.json();l=y.detail||y.message||l}catch{l=`${l}: ${h.statusText}`}throw new Error(l)}return await h.json()}finally{clearTimeout(r)}}}let Ye=null;function ze(){return Ye||(Ye=new Is),Ye}function Wn(k){return Ye=new Is(k),Ye}class Vn{constructor(){T(this,"registry");T(this,"remoteEnabled",!0);this.registry=Ue.getInstance()}setRemoteEnabled(e){this.remoteEnabled=e}isRemoteEnabled(){return this.remoteEnabled&&ze().isEnabled()}async resolve(e,t={}){const a=t.preferRemote??this.remoteEnabled,i=this.findStaticConfig(e,t.objectType);if(i)return{config:i,source:"static",sourceDetail:`static:${i.id}`,fromCache:!0};if(a&&this.isRemoteEnabled())try{const d=await ze().resolve(e,{fingerprint:t.fingerprint,objectType:t.objectType,forceRefresh:t.forceRefresh});if(d)return{config:d.config,source:"remote",sourceDetail:d.source,fromCache:d.source.startsWith("cached:")}}catch(r){console.warn("[ConfigResolver] Remote resolution failed:",r)}if(a&&this.isRemoteEnabled())try{const d=await ze().generateConfig(e,{forceRegenerate:t.forceRefresh});if(d&&d.config)return{config:d.config,source:"generated",sourceDetail:`generated:${d.config_source}`,fromCache:d.cache_hit}}catch(r){console.warn("[ConfigResolver] Config generation failed:",r)}return console.log(`[ConfigResolver] Using default config for ${e}`),{config:this.createDefaultConfig(e),source:"default",sourceDetail:"minimal_fallback",fromCache:!1}}async resolveTable(e,t,a={}){var r;return((r=(await this.resolve(e,a)).config.tables)==null?void 0:r[t])??null}async resolveAndRegister(e,t={}){const a=await this.resolve(e,t);return a.config?(a.config.id||(a.config.id=this.generateConfigId(e)),this.registry.registerDataType(a.config),console.log(`[ConfigResolver] Registered ${a.config.id} from ${a.source}`),a.config):null}hasStaticConfig(e,t){return this.findStaticConfig(e,t)!==null}async getResolutionHints(e){const t=this.hasStaticConfig(e);let a=!1,i=!1;if(this.isRemoteEnabled())try{const u=await ze().getTableListWithConfig(e);u&&(a=u.has_cached_config||u.has_builtin_config,i=!0)}catch{}let r="static";return a?r="remote":i&&!t&&(r="generate"),{hasRemoteConfig:a,hasStaticConfig:t,canGenerate:i,recommendedSource:r}}findStaticConfig(e,t){var i,r;const a=this.registry.getAppConfig();if(!(a!=null&&a.dataTypes))return null;for(const[d,u]of Object.entries(a.dataTypes))if((i=u.matches)!=null&&i.some(h=>this.matchPattern(e,h))){const h=this.registry.getDataType(d);if(h)return h}if(t){for(const[d,u]of Object.entries(a.dataTypes))if((r=u.matches)!=null&&r.some(h=>this.matchPattern(t,h))){const h=this.registry.getDataType(d);if(h)return h}}return null}matchPattern(e,t){if(t.includes("*")){const a=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${a}$`).test(e)}return e===t}createDefaultConfig(e){return{id:this.generateConfigId(e),name:`Auto-generated: ${e}`,version:"1.0.0",description:"Minimal configuration generated from source reference",tables:{}}}generateConfigId(e){return`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`}}let It=null;function zt(){return It||(It=new Vn),It}const jt={pageSize:50,theme:"light",density:"default",showRowNumbers:!0,locale:"en-US",dateFormat:"YYYY-MM-DD",numberFormat:{decimals:2,thousandsSeparator:",",decimalSeparator:"."}},Ie={pageSize:50,density:"default",showRowNumbers:!0,enableSelection:!0,enableExport:!0,enableColumnReorder:!1,enableColumnResize:!0,defaultSortColumn:"",defaultSortOrder:"asc"},ht={visible:!0,sortable:!0,filterable:!0,searchable:!0},Kn={number:"right",integer:"right",float:"right",percentage:"right",currency:"right",filesize:"right",duration:"right",boolean:"center",date:"center",datetime:"center",timestamp:"center"},we=class we{constructor(){T(this,"appConfig",null);T(this,"dataTypes",new Map);T(this,"loadedUrls",new Set);T(this,"apiConfigs",new Map);T(this,"defaultApiId",null);T(this,"matchMap",new Map);T(this,"globalSettings",{...jt});T(this,"remoteConfigEnabled",!1);T(this,"configApiSettings",null)}static getInstance(){return we.instance||(we.instance=new we),we.instance}static reset(){we.instance=null}async initialize(e){if(this.appConfig=e,e.defaults&&(this.globalSettings={...jt,...e.defaults,numberFormat:{...jt.numberFormat,...e.defaults.numberFormat}}),e.apis)if(Object.values(e.apis).forEach(a=>{this.apiConfigs.set(a.id,a)}),e.apis.default)this.defaultApiId="default";else{const a=Object.keys(e.apis)[0];a&&(this.defaultApiId=a)}const t=[];for(const[a,i]of Object.entries(e.dataTypes))i.matches&&i.matches.forEach(r=>this.matchMap.set(r,a)),i.autoLoad!==!1&&t.push(this.loadDataType(a,i));await Promise.all(t)}async loadDataType(e,t){if(t.config){this.registerDataType(t.config);return}if(t.configUrl&&!this.loadedUrls.has(t.configUrl))try{const a=await fetch(t.configUrl);if(!a.ok){console.warn(`Failed to load config from ${t.configUrl}: ${a.status}`);return}const i=await a.json();this.registerDataType(i),this.loadedUrls.add(t.configUrl)}catch(a){console.error(`Error loading data type config from ${t.configUrl}:`,a)}}registerDataType(e){if(!e.id){console.error("DataTypeConfig must have an id");return}e.version||(console.warn(`DataTypeConfig ${e.id} missing version, defaulting to 1.0.0`),e.version="1.0.0"),this.dataTypes.set(e.id,e),console.log(`Registered data type: ${e.id} v${e.version}`)}unregisterDataType(e){return this.dataTypes.delete(e)}getDataType(e){return this.dataTypes.get(e)}hasDataType(e){return this.dataTypes.has(e)}getAllDataTypes(){return Array.from(this.dataTypes.values())}getDataTypeIds(){return Array.from(this.dataTypes.keys())}getTableSchema(e,t){const a=this.dataTypes.get(e);if(a)return a.tables[t]}getColumnSchema(e,t,a){const i=this.getTableSchema(e,t);if(i)return i.columns.find(r=>r.column===a)}getTableNames(e){const t=this.dataTypes.get(e);return t?Object.keys(t.tables):[]}getResolvedTableConfig(e,t){var h,l,y,m,b,S,$,_,E,R,M;const a=this.dataTypes.get(e);if(!a)return null;const i=a.tables[t];if(!i)return null;const r={...Ie,pageSize:((h=a.defaults)==null?void 0:h.pageSize)??Ie.pageSize,density:((l=a.defaults)==null?void 0:l.density)??Ie.density,showRowNumbers:((y=a.defaults)==null?void 0:y.showRowNumbers)??Ie.showRowNumbers,enableSelection:((m=a.defaults)==null?void 0:m.enableSelection)??Ie.enableSelection,enableExport:((b=a.defaults)==null?void 0:b.enableExport)??Ie.enableExport,...i.settings},d=[...a.sharedCategories||[],...i.categories||[]],u=i.columns.map(P=>this.resolveColumnConfig(P));return{name:t,displayName:i.displayName||t,settings:r,categories:d,columns:u,virtualColumns:i.virtualColumns||[],rowConfig:{selectable:((S=i.rowConfig)==null?void 0:S.selectable)??!0,clickable:(($=i.rowConfig)==null?void 0:$.clickable)??!1,clickAction:((_=i.rowConfig)==null?void 0:_.clickAction)??"",heightMode:((E=i.rowConfig)==null?void 0:E.heightMode)??"auto",height:((R=i.rowConfig)==null?void 0:R.height)??"auto",conditionalStyles:((M=i.rowConfig)==null?void 0:M.conditionalStyles)??[]}}}resolveColumnConfig(e){const t=e.dataType||"string",a=Kn[t]||"left";return{column:e.column,displayName:e.displayName||e.column.replace(/_/g," "),dataType:t,visible:e.visible??ht.visible,sortable:e.sortable??ht.sortable,filterable:e.filterable??ht.filterable,searchable:e.searchable??ht.searchable,copyable:e.copyable??t==="id",width:e.width||"auto",align:e.align||a,categories:e.categories||[],transform:e.transform}}getGlobalSettings(){return{...this.globalSettings}}getAppConfig(){return this.appConfig}getApiUrl(){var e,t;return((e=this.appConfig)==null?void 0:e.app.apiUrl)||this.defaultApiId&&((t=this.apiConfigs.get(this.defaultApiId))==null?void 0:t.url)||null}getApi(e){return e?this.apiConfigs.get(e):this.defaultApiId?this.apiConfigs.get(this.defaultApiId):void 0}getApis(){return Array.from(this.apiConfigs.values())}getDefaultApiId(){return this.defaultApiId}getAppName(){var e;return((e=this.appConfig)==null?void 0:e.app.name)||"DataTables Viewer"}detectDataType(e){const t=e.dataType||e.type||e.objectType||e.object_type;if(!t)return null;if(this.hasDataType(t))return t;if(this.matchMap.has(t))return this.matchMap.get(t);const a=t.toLowerCase().replace(/[^a-z0-9]/g,"_");if(this.hasDataType(a))return a;const i=this.getDataTypeIds()[0];return i?(console.warn(`Unknown data type "${t}", falling back to "${i}"`),i):null}static fromLegacyConfig(e){var a,i,r;const t={};if(e.tables)for(const[d,u]of Object.entries(e.tables))t[d]={displayName:u.name||d,categories:u.categories||[],columns:(u.columns||[]).map(h=>({column:h.column,displayName:h.displayName,dataType:h.dataType||"string",visible:h.visible,sortable:h.sortable,filterable:h.filterable,width:h.width,categories:h.categories,transform:h.transform})),settings:u.settings};return{id:"legacy",name:e.name||"Legacy Config",version:"1.0.0",description:e.description,defaults:{pageSize:(a=e.defaultSettings)==null?void 0:a.pageSize,density:(i=e.defaultSettings)==null?void 0:i.density,showRowNumbers:(r=e.defaultSettings)==null?void 0:r.showRowNumbers},tables:t}}initializeRemoteConfig(e){var a;const t=(a=this.appConfig)==null?void 0:a.configApi;if(t!=null&&t.enabled||e!=null&&e.enabled){const i={...t,...e,enabled:!0};Wn(i),this.configApiSettings=i,this.remoteConfigEnabled=!0,console.log("[DataTypeRegistry] Remote config provider initialized")}}async resolveAndRegister(e,t){const i=await zt().resolve(e,{...t,preferRemote:this.remoteConfigEnabled});return i.config?(i.config.id||(i.config.id=`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`),this.registerDataType(i.config),console.log(`[DataTypeRegistry] Registered ${i.config.id} from ${i.source}`),i.config):null}isRemoteConfigEnabled(){return this.remoteConfigEnabled}getConfigApiSettings(){return this.configApiSettings}setAuthToken(e){this.remoteConfigEnabled&&ze().setToken(e)}async resolveConfig(e,t){return zt().resolve(e,{...t,preferRemote:this.remoteConfigEnabled})}async hasConfigFor(e,t){var i;const a=this.getAppConfig();if(a!=null&&a.dataTypes){for(const[r,d]of Object.entries(a.dataTypes))if((i=d.matches)!=null&&i.some(u=>this.matchPattern(e,u)))return{hasConfig:!0,source:"static"}}if(this.remoteConfigEnabled)try{const d=await ze().getTableListWithConfig(e);if(d!=null&&d.has_cached_config||d!=null&&d.has_builtin_config)return{hasConfig:!0,source:"remote"}}catch{}return{hasConfig:!1,source:"none"}}matchPattern(e,t){if(t.includes("*")){const a=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${a}$`).test(e)}return e===t}};T(we,"instance",null);let Ue=we;class Ps{constructor(e){T(this,"registry");T(this,"legacyConfig",null);T(this,"currentDataTypeId",null);T(this,"isLegacyMode",!1);this.registry=Ue.getInstance(),e&&(this.isNewConfigFormat(e)?this.initializeFromAppConfig(e):this.initializeFromLegacyConfig(e))}isNewConfigFormat(e){var t;return e&&(e.dataTypes||((t=e.app)==null?void 0:t.name))}initializeFromAppConfig(e){this.isLegacyMode=!1,Object.entries(e.dataTypes||{}).forEach(([t,a])=>{a.config&&(this.registry.registerDataType(a.config),this.currentDataTypeId||(this.currentDataTypeId=t))})}initializeFromLegacyConfig(e){this.isLegacyMode=!0,this.legacyConfig=e;const t=Ue.fromLegacyConfig(e);this.registry.registerDataType(t),this.currentDataTypeId="legacy"}async initializeAsync(e){if(e)try{const t=await fetch(e);if(!t.ok){console.warn(`Failed to load config from ${e}`);return}const a=await t.json();if(this.isNewConfigFormat(a)){await this.registry.initialize(a);const i=this.registry.getDataTypeIds();i.length>0&&(this.currentDataTypeId=i[0])}else this.initializeFromLegacyConfig(a)}catch(t){console.error("Error loading configuration:",t)}}setCurrentDataType(e){if(this.registry.hasDataType(e))return this.currentDataTypeId=e,!0;const t=this.registry.detectDataType({dataType:e});return t?(this.currentDataTypeId=t,!0):(console.warn(`Data type "${e}" not found in registry`),!1)}getCurrentDataTypeId(){return this.currentDataTypeId}getCurrentDataType(){if(this.currentDataTypeId)return this.registry.getDataType(this.currentDataTypeId)}detectDataType(e){const t=this.registry.detectDataType(e);return t&&(this.currentDataTypeId=t),t}getTableConfig(e){var t,a;if(this.currentDataTypeId){const i=this.registry.getResolvedTableConfig(this.currentDataTypeId,e);if(i)return this.convertResolvedToLegacy(i)}if((a=(t=this.legacyConfig)==null?void 0:t.tables)!=null&&a[e]){const i=this.legacyConfig.tables[e];return{name:i.name||e,categories:i.categories||[],columns:i.columns||[],settings:{...this.legacyConfig.defaultSettings,...i.settings||{}}}}return{name:e,categories:[],columns:[],settings:this.getGlobalSettings()}}getTableSchema(e){if(this.currentDataTypeId)return this.registry.getTableSchema(this.currentDataTypeId,e)}getResolvedTableConfig(e){return this.currentDataTypeId?this.registry.getResolvedTableConfig(this.currentDataTypeId,e):null}hasTableConfig(e){var t;return this.currentDataTypeId&&this.registry.getTableSchema(this.currentDataTypeId,e)?!0:!!((t=this.legacyConfig)!=null&&t.tables&&Object.prototype.hasOwnProperty.call(this.legacyConfig.tables,e))}getTableNames(){var e;return this.currentDataTypeId?this.registry.getTableNames(this.currentDataTypeId):(e=this.legacyConfig)!=null&&e.tables?Object.keys(this.legacyConfig.tables):[]}getAppName(){var e;return this.registry.getAppName()||((e=this.legacyConfig)==null?void 0:e.name)||"DataTables Viewer"}getApi(e){return this.registry.getApi(e)}getApis(){return this.registry.getApis()}getDefaultApiId(){return this.registry.getDefaultApiId()}getApiUrl(){var e;return this.registry.getApiUrl()||((e=this.legacyConfig)==null?void 0:e.apiUrl)||null}getEnvironment(){var t;const e=this.registry.getAppConfig();return(e==null?void 0:e.app.environment)||((t=this.legacyConfig)==null?void 0:t.environment)||"local"}getGlobalSettings(){var a;const e=this.registry.getGlobalSettings(),t=((a=this.legacyConfig)==null?void 0:a.defaultSettings)||{};return{...e,...t}}convertResolvedToLegacy(e){return{name:e.displayName,categories:e.categories.map(t=>({id:t.id,name:t.name,icon:t.icon,color:t.color,description:t.description,defaultVisible:t.defaultVisible})),columns:e.columns.map(t=>({column:t.column,displayName:t.displayName,description:t.description,width:t.width,visible:t.visible,sortable:t.sortable,filterable:t.filterable,categories:t.categories,transform:Array.isArray(t.transform)?{type:"chain",options:{transforms:t.transform}}:t.transform})),settings:{pageSize:e.settings.pageSize,density:e.settings.density,showRowNumbers:e.settings.showRowNumbers,enableSelection:e.settings.enableSelection,enableExport:e.settings.enableExport}}}getRegistry(){return this.registry}isLegacy(){return this.isLegacyMode}initializeRemoteConfig(){this.registry.initializeRemoteConfig()}async resolveConfig(e,t){const i=await zt().resolve(e,{...t,preferRemote:this.registry.isRemoteConfigEnabled()});return i.config&&(this.registry.hasDataType(i.config.id)||this.registry.registerDataType(i.config),this.currentDataTypeId=i.config.id),i}isRemoteEnabled(){return this.registry.isRemoteConfigEnabled()}setAuthToken(e){this.registry.setAuthToken(e)}}const Fs={berdlTableId:null,activeTableName:null,availableTables:[],headers:[],columns:[],visibleColumns:new Set,data:[],totalCount:0,filteredCount:0,currentPage:0,pageSize:50,sortColumn:null,sortDirection:"asc",sortOrder:"asc",columnFilters:{},advancedFilters:void 0,aggregations:void 0,groupBy:void 0,searchQuery:"",searchValue:"",selectedRows:new Set,loading:!1,error:null,theme:"light",density:"normal",showRowNumbers:!0,queryCached:!1,queryTime:void 0};class Qn{constructor(e={}){T(this,"state");T(this,"listeners");this.state={...Fs,...e},this.listeners=new Set}getState(){return{...this.state}}update(e){e.sortDirection&&!e.sortOrder?e.sortOrder=e.sortDirection:e.sortOrder&&!e.sortDirection&&(e.sortDirection=e.sortOrder),e.searchQuery!==void 0&&e.searchValue===void 0?e.searchValue=e.searchQuery:e.searchValue!==void 0&&e.searchQuery===void 0&&(e.searchQuery=e.searchValue),this.state={...this.state,...e},this.notify()}reset(){this.state={...Fs},this.notify()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}}class Xn{constructor(e){T(this,"categories");T(this,"columnsByCategory");T(this,"visibleCategories");T(this,"uncategorizedColumns");this.categories=new Map,this.columnsByCategory=new Map,this.visibleCategories=new Set,this.uncategorizedColumns=new Set,this.initialize(e)}initialize(e){(e.categories||[]).forEach(a=>{this.categories.set(a.id,{...a,visible:a.defaultVisible!==!1}),this.columnsByCategory.set(a.id,new Set),a.defaultVisible!==!1&&this.visibleCategories.add(a.id)}),e.columns&&this.setColumns(e.columns)}setColumns(e){this.uncategorizedColumns.clear(),this.categories.forEach((t,a)=>{var i;return(i=this.columnsByCategory.get(a))==null?void 0:i.clear()}),e.forEach(t=>{const a=t.column;let i=!1;t.categories&&Array.isArray(t.categories)&&t.categories.length>0&&t.categories.forEach(r=>{var d;this.categories.has(r)&&((d=this.columnsByCategory.get(r))==null||d.add(a),i=!0)}),i||this.uncategorizedColumns.add(a)})}getVisibleColumns(){const e=new Set;return this.visibleCategories.forEach(t=>{const a=this.columnsByCategory.get(t);a&&a.forEach(i=>e.add(i))}),this.uncategorizedColumns.forEach(t=>e.add(t)),e}getAllCategories(){return Array.from(this.categories.values()).map(e=>{var t;return{...e,visible:this.visibleCategories.has(e.id),columnCount:((t=this.columnsByCategory.get(e.id))==null?void 0:t.size)||0}})}getColumnsByCategory(){const e=new Map;return this.columnsByCategory.forEach((t,a)=>{e.set(a,Array.from(t))}),e}getUncategorizedColumns(){return Array.from(this.uncategorizedColumns)}toggleCategory(e){this.visibleCategories.has(e)?this.visibleCategories.delete(e):this.visibleCategories.add(e)}showAllCategories(){this.categories.forEach((e,t)=>{this.visibleCategories.add(t)})}}class Ht{constructor(e){T(this,"container");T(this,"id");T(this,"dom",{});this.container=e.container,this.id=e.id||`cmp-${Math.random().toString(36).substr(2,9)}`}mount(){this.render(),this.bindEvents()}destroy(){this.container.innerHTML="",this.dom={}}cacheDom(e){this.dom={};for(const[t,a]of Object.entries(e)){const i=this.container.querySelector(a);i&&(this.dom[t]=i)}}}class Yn extends Ht{constructor(t){super(t);T(this,"configManager");T(this,"stateManager");T(this,"categoryManager",null);T(this,"options");T(this,"expandedCategories",new Set);this.configManager=t.configManager,this.stateManager=t.stateManager,this.options=t,this.stateManager.subscribe(a=>{this.dom.loadBtn&&(this.dom.loadBtn.innerHTML=a.loading?'<span class="ts-spinner"></span> Loading...':'<i class="bi bi-lightning-charge-fill"></i> Load Data',this.dom.loadBtn.disabled=a.loading),this.updateLoadingState(a),!a.loading&&a.availableTables.length>0&&a.data.length>0&&a.activeTableName&&setTimeout(()=>{this.dom.sourceBody&&this.dom.sourceBody.style.display!=="none"&&(this.dom.sourceBody.style.display="none",this.dom.sourceArrow.classList.add("collapsed"))},500),a.activeTableName&&a.availableTables.length>0&&this.updateTableInfo(a.activeTableName),a.columns.length>0&&this.dom.controlList&&this.renderControlList(),this.renderFilterChips(),this.updateAggregationsDisplay(a)})}get onLoadData(){return this.options.onLoadData}updateAggregationsDisplay(t){var r,d;if(!this.dom.aggregationsSection||!this.dom.aggregationsInfo)return;const a=t.aggregations&&t.aggregations.length>0,i=t.groupBy&&t.groupBy.length>0;if(a||i){this.dom.aggregationsSection.style.display="block";const u=((r=t.aggregations)==null?void 0:r.map(l=>`${l.function.toUpperCase()}(${l.column})`).join(", "))||"None",h=((d=t.groupBy)==null?void 0:d.join(", "))||"None";this.dom.aggregationsInfo.innerHTML=`
                <div style="margin-bottom:4px"><strong>Functions:</strong> ${u}</div>
                <div><strong>Group By:</strong> ${h}</div>
            `}else this.dom.aggregationsSection.style.display="none"}setCategoryManager(t){this.categoryManager=t,this.renderControlList(),this.expandColumnsSection()}expandColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="block")}collapseColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="none")}render(){const t=this.configManager.getAppName()||"DataTables Viewer";this.container.innerHTML=`
            <header class="ts-sidebar-header">
                <div class="ts-brand">
                    <div class="ts-brand-icon"><i class="bi bi-grid-3x3-gap-fill"></i></div>
                    <span class="ts-brand-name">${t}</span>
                </div>
            </header>

            <div class="ts-sidebar-body">
                <!-- Connection -->
                <section class="ts-section" id="ts-source-section" style="padding: 0 4px;">
                    <div class="ts-section-header collapsible" id="ts-source-head">
                        <span class="ts-section-title">Data Source</span>
                        <div style="display:flex; align-items:center; gap:8px">
                            <i class="bi bi-chevron-down ts-section-arrow" id="ts-source-arrow"></i>
                            <i class="bi bi-database-fill-gear ts-text-muted"></i>
                        </div>
                    </div>
                    <div id="ts-source-body">
                        <div class="ts-field">
                            <label class="ts-label">Auth Token <span style="color:red">*</span></label>
                            <input type="password" class="ts-input" id="ts-token" placeholder="Enter KBase token...">
                        </div>
                        <div class="ts-field">
                            <label class="ts-label">Object ID / UPA</label>
                            <input type="text" class="ts-input" id="ts-berdl" 
                                placeholder="e.g., 76990/7/2" value="76990/7/2">
                        </div>
                        <button class="ts-btn-primary" id="ts-load" style="height: 34px;">
                            <i class="bi bi-lightning-charge-fill"></i> Load Data
                        </button>
                        <div id="ts-loading-indicator" style="display:none;margin-top:12px;padding:12px;background:var(--c-bg-surface);border-radius:var(--radius-sm);border:1px solid var(--c-border-subtle)">
                            <div style="display:flex;align-items:center;gap:10px;color:var(--c-text-secondary);font-size:13px">
                                <span class="ts-spinner" style="width:16px;height:16px"></span>
                                <span id="ts-loading-text">Loading data...</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table Selection -->
                <section class="ts-section" id="ts-nav-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Table</span>
                    </div>
                    <select class="ts-select" id="ts-table-select"></select>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
                        <button class="ts-btn-secondary" id="ts-view-schema">
                            <i class="bi bi-file-earmark-code"></i> Schema
                        </button>
                        <button class="ts-btn-secondary" id="ts-view-stats">
                            <i class="bi bi-graph-up"></i> Stats
                        </button>
                    </div>
                </section>

                <!-- Data Control (Unified Categories & Columns) -->
                <section class="ts-section" id="ts-control-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Data Control</span>
                        <div class="ts-section-actions">
                            <button class="ts-section-action" id="ts-control-expand-all">Expand All</button>
                            <button class="ts-section-action" id="ts-control-show-all">Show All</button>
                        </div>
                    </div>
                    <div class="ts-control-list" id="ts-control-list"></div>
                </section>

                <!-- Active Filters -->
                <section class="ts-section" id="ts-filters-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Filters</span>
                        <div style="display:flex;gap:4px">
                            <button class="ts-section-action" id="ts-advanced-filters" title="Advanced Filters">
                                <i class="bi bi-funnel-fill"></i> Advanced
                            </button>
                            <button class="ts-section-action" id="ts-clear-filters">Clear All</button>
                        </div>
                    </div>
                    <div class="ts-filter-chips" id="ts-filter-chips"></div>
                </section>
                
                <!-- Aggregations -->
                <section class="ts-section" id="ts-aggregations-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Aggregations</span>
                        <button class="ts-section-action" id="ts-aggregations-btn">
                            <i class="bi bi-calculator"></i> Configure
                        </button>
                    </div>
                    <div id="ts-aggregations-info" style="padding:8px;font-size:12px;color:var(--c-text-muted)">
                        No aggregations configured
                    </div>
                </section>
            </div>

            <footer class="ts-sidebar-footer">
                <div class="ts-btn-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="ts-btn-secondary" id="ts-export">
                        <i class="bi bi-download"></i> Export
                    </button>
                    <button class="ts-btn-secondary" id="ts-reset">
                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                    </button>
                </div>
            </footer>
        `,this.cacheDom({token:"#ts-token",berdl:"#ts-berdl",loadBtn:"#ts-load",sourceHead:"#ts-source-head",sourceBody:"#ts-source-body",sourceArrow:"#ts-source-arrow",loadingIndicator:"#ts-loading-indicator",loadingText:"#ts-loading-text",navSection:"#ts-nav-section",tableSelect:"#ts-table-select",viewSchema:"#ts-view-schema",viewStats:"#ts-view-stats",controlSection:"#ts-control-section",controlList:"#ts-control-list",controlExpandAll:"#ts-control-expand-all",controlShowAll:"#ts-control-show-all",filtersSection:"#ts-filters-section",filterChips:"#ts-filter-chips",clearFilters:"#ts-clear-filters",advancedFilters:"#ts-advanced-filters",aggregationsSection:"#ts-aggregations-section",aggregationsBtn:"#ts-aggregations-btn",aggregationsInfo:"#ts-aggregations-info",export:"#ts-export",reset:"#ts-reset"})}bindEvents(){var t,a,i,r,d,u,h,l,y;(t=this.dom.loadBtn)==null||t.addEventListener("click",()=>{this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.options.onLoadData()}),(a=this.dom.sourceHead)==null||a.addEventListener("click",()=>{const m=this.dom.sourceBody.style.display==="none";this.dom.sourceBody.style.display=m?"block":"none",this.dom.sourceArrow.classList.toggle("collapsed",!m)}),(i=this.dom.berdl)==null||i.addEventListener("keypress",m=>{m.key==="Enter"&&this.dom.loadBtn.click()}),(r=this.dom.tableSelect)==null||r.addEventListener("change",m=>{this.options.onTableChange(m.target.value)}),(d=this.dom.export)==null||d.addEventListener("click",()=>this.options.onExport()),(u=this.dom.reset)==null||u.addEventListener("click",()=>this.options.onReset()),(h=this.dom.controlList)==null||h.addEventListener("click",m=>{const b=m.target;if(b.closest(".ts-switch")){const S=b.closest(".ts-cat-group"),$=S==null?void 0:S.dataset.cat;$&&this.categoryManager&&(this.categoryManager.toggleCategory($),this.stateManager.update({visibleColumns:this.categoryManager.getVisibleColumns()}),this.renderControlList());return}if(b.closest(".ts-cat-head")){const S=b.closest(".ts-cat-group"),$=S==null?void 0:S.dataset.cat;$&&(this.expandedCategories.has($)?this.expandedCategories.delete($):this.expandedCategories.add($),S==null||S.classList.toggle("expanded"));return}if(b.matches('input[type="checkbox"]')){const S=b.dataset.col;if(S){const $=this.stateManager.getState();b.checked?$.visibleColumns.add(S):$.visibleColumns.delete(S),this.stateManager.update({visibleColumns:$.visibleColumns})}}}),(l=this.dom.controlExpandAll)==null||l.addEventListener("click",()=>{const m=this.dom.controlList.querySelectorAll(".ts-cat-group"),b=Array.from(m).some(S=>!S.classList.contains("expanded"));m.forEach(S=>{const $=S.dataset.cat;b?(S.classList.add("expanded"),$&&this.expandedCategories.add($)):(S.classList.remove("expanded"),$&&this.expandedCategories.delete($))}),this.dom.controlExpandAll.textContent=b?"Collapse All":"Expand All"}),(y=this.dom.controlShowAll)==null||y.addEventListener("click",()=>{this.toggleAllColumns()}),this.dom.viewSchema&&this.dom.viewSchema.addEventListener("click",()=>{const m=this.stateManager.getState();if(m.activeTableName)this.options.onShowSchema(m.activeTableName);else{const b=this.dom.tableSelect;b!=null&&b.value&&this.options.onShowSchema(b.value)}}),this.dom.viewStats&&this.dom.viewStats.addEventListener("click",()=>{const m=this.stateManager.getState();if(m.activeTableName)this.options.onShowStats(m.activeTableName);else{const b=this.dom.tableSelect;b!=null&&b.value&&this.options.onShowStats(b.value)}}),this.dom.clearFilters&&this.dom.clearFilters.addEventListener("click",()=>{this.stateManager.update({columnFilters:{},advancedFilters:void 0,currentPage:0})}),this.dom.advancedFilters&&this.dom.advancedFilters.addEventListener("click",()=>{this.showAdvancedFilterPanel()}),this.dom.aggregationsBtn&&this.dom.aggregationsBtn.addEventListener("click",()=>{this.showAggregationsPanel()})}showAdvancedFilterPanel(){const t=this.stateManager.getState(),a=t.columns.map(r=>({column:r.column,displayName:r.displayName||r.column,type:r.dataType||"TEXT"})),i=document.createElement("div");i.className="ts-modal-overlay show",i.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Advanced Filters</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body" id="ts-advanced-filter-container"></div>
            </div>
        `,document.body.appendChild(i),je(async()=>{const{AdvancedFilterPanel:r}=await import("./AdvancedFilterPanel-bpPBXLqe.js");return{AdvancedFilterPanel:r}},[]).then(({AdvancedFilterPanel:r})=>{var u;const d=new r({container:i.querySelector("#ts-advanced-filter-container"),columns:a,onApply:h=>{this.stateManager.update({advancedFilters:h,currentPage:0}),document.body.removeChild(i),this.options.onLoadData()},onCancel:()=>{document.body.removeChild(i)}});t.advancedFilters&&d.setFilters(t.advancedFilters),(u=i.querySelector(".ts-modal-close"))==null||u.addEventListener("click",()=>{document.body.removeChild(i)}),d.mount()})}showAggregationsPanel(){var l,y,m,b;const t=this.stateManager.getState(),a=t.columns.map(S=>({column:S.column,displayName:S.displayName||S.column,type:S.dataType||"TEXT"})),i=document.createElement("div");i.className="ts-modal-overlay show",i.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Configure Aggregations</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body">
                    <div style="margin-bottom:16px">
                        <label style="display:block;margin-bottom:8px;font-weight:500">Group By Columns</label>
                        <select multiple class="ts-select" id="ts-group-by" style="min-height:100px">
                            ${a.map(S=>`<option value="${S.column}">${S.displayName||S.column}</option>`).join("")}
                        </select>
                        <small style="color:var(--c-text-muted)">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                    <div id="ts-aggregations-list"></div>
                    <button class="ts-btn-secondary" id="ts-add-aggregation" style="margin-top:12px">
                        <i class="bi bi-plus"></i> Add Aggregation
                    </button>
                </div>
                <div class="ts-modal-footer">
                    <button class="ts-btn-secondary" id="ts-agg-cancel">Cancel</button>
                    <button class="ts-btn-primary" id="ts-agg-apply">Apply</button>
                </div>
            </div>
        `,document.body.appendChild(i);let r=t.aggregations||[],d=t.groupBy||[];const u=()=>{const S=i.querySelector("#ts-aggregations-list");if(S){if(r.length===0){S.innerHTML='<p style="color:var(--c-text-muted);font-size:13px">No aggregations. Click "Add Aggregation" to create one.</p>';return}S.innerHTML=r.map(($,_)=>`
                <div class="ts-agg-item" style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;margin-bottom:8px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm)">
                    <select class="ts-select" data-agg-col="${_}">
                        ${a.map(E=>`<option value="${E.column}" ${$.column===E.column?"selected":""}>${E.displayName||E.column}</option>`).join("")}
                    </select>
                    <select class="ts-select" data-agg-func="${_}">
                        <option value="count" ${$.function==="count"?"selected":""}>Count</option>
                        <option value="sum" ${$.function==="sum"?"selected":""}>Sum</option>
                        <option value="avg" ${$.function==="avg"?"selected":""}>Average</option>
                        <option value="min" ${$.function==="min"?"selected":""}>Min</option>
                        <option value="max" ${$.function==="max"?"selected":""}>Max</option>
                        <option value="stddev" ${$.function==="stddev"?"selected":""}>StdDev</option>
                        <option value="variance" ${$.function==="variance"?"selected":""}>Variance</option>
                        <option value="distinct_count" ${$.function==="distinct_count"?"selected":""}>Distinct Count</option>
                    </select>
                    <button class="ts-btn-secondary" data-agg-remove="${_}" style="padding:8px">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `).join(""),S.querySelectorAll("[data-agg-col]").forEach($=>{$.addEventListener("change",_=>{const E=parseInt(_.target.dataset.aggCol||"0");r[E].column=_.target.value})}),S.querySelectorAll("[data-agg-func]").forEach($=>{$.addEventListener("change",_=>{const E=parseInt(_.target.dataset.aggFunc||"0");r[E].function=_.target.value})}),S.querySelectorAll("[data-agg-remove]").forEach($=>{$.addEventListener("click",_=>{const E=parseInt(_.target.dataset.aggRemove||"0");r.splice(E,1),u()})})}};(l=i.querySelector("#ts-add-aggregation"))==null||l.addEventListener("click",()=>{var S;r.push({column:((S=a[0])==null?void 0:S.column)||"",function:"count"}),u()}),(y=i.querySelector("#ts-agg-apply"))==null||y.addEventListener("click",()=>{const S=i.querySelector("#ts-group-by"),$=Array.from(S.selectedOptions).map(_=>_.value);this.stateManager.update({aggregations:r.length>0?r:void 0,groupBy:$.length>0?$:void 0,currentPage:0}),document.body.removeChild(i),this.options.onLoadData&&this.options.onLoadData()}),(m=i.querySelector("#ts-agg-cancel"))==null||m.addEventListener("click",()=>{document.body.removeChild(i)}),(b=i.querySelector(".ts-modal-close"))==null||b.addEventListener("click",()=>{document.body.removeChild(i)}),u();const h=i.querySelector("#ts-group-by");d&&Array.from(h.options).forEach(S=>{S.selected=d.includes(S.value)})}updateTables(t){this.dom.navSection&&(t.length>0?(this.dom.navSection.style.display="block",this.dom.tableSelect.innerHTML="",t.forEach(a=>{const i=document.createElement("option");i.value=a.name;const r=a.row_count??a.count,d=typeof r=="number"?r.toLocaleString():"?";i.textContent=`${a.displayName||a.name} (${d} rows)`,this.dom.tableSelect.appendChild(i)})):this.dom.navSection.style.display="none")}updateTableInfo(t){this.dom.tableSelect&&this.dom.tableSelect.value!==t&&(this.dom.tableSelect.value=t)}renderControlList(){if(!this.dom.controlList)return;this.dom.controlSection.style.display="block";const t=this.stateManager.getState(),a=this.categoryManager?this.categoryManager.getAllCategories():[],i=this.categoryManager?this.categoryManager.getColumnsByCategory():new Map,r=this.categoryManager?this.categoryManager.getUncategorizedColumns():t.columns.map(h=>h.column);let d="";a.forEach(h=>{const l=i.get(h.id)||[];l.length!==0&&(d+=this.renderCategoryGroup(h,l,t))}),r.length>0&&(d+=this.renderCategoryGroup({id:"other",name:"Other Attributes",icon:"bi-three-dots",color:"#64748b",visible:!0},r,t,!0)),this.dom.controlList.innerHTML=d;const u=t.columns.every(h=>t.visibleColumns.has(h.column));this.dom.controlShowAll&&(this.dom.controlShowAll.textContent=u?"Hide All":"Show All")}renderCategoryGroup(t,a,i,r=!1){const d=i.columns.reduce((h,l)=>(h[l.column]=l,h),{});return`
            <div class="ts-cat-group ${this.expandedCategories.has(t.id)?"expanded":""}" data-cat="${t.id}">
                <div class="ts-cat-head">
                    <div class="ts-cat-info">
                        <i class="bi bi-chevron-down ts-cat-arrow"></i>
                        <i class="${t.icon||"bi bi-folder-fill"}" style="color:${t.color||"var(--c-accent)"}"></i>
                        <span class="ts-cat-name">${t.name}</span>
                        <span class="ts-cat-count">${a.length}</span>
                    </div>
                    ${r?"":`<div class="ts-switch ${t.visible?"on":""}"></div>`}
                </div>
                <div class="ts-cat-cols">
                    ${a.map(h=>{const l=d[h]||{displayName:h};return`
                            <label class="ts-col-item">
                                <input type="checkbox" data-col="${h}" ${i.visibleColumns.has(h)?"checked":""}>
                                <span>${l.displayName||h}</span>
                            </label>
                        `}).join("")}
                </div>
            </div>
        `}renderFilterChips(){const t=this.stateManager.getState(),a=t.columnFilters,i=t.advancedFilters,r=Object.keys(a).length>0||i&&i.length>0;if(this.dom.filtersSection&&(this.dom.filtersSection.style.display=r?"block":"none"),!this.dom.filterChips)return;const d=[];Object.entries(a).forEach(([u,h])=>{d.push(`
                <div class="ts-chip">
                    <span class="ts-chip-label">${u}:</span>
                    <span class="ts-chip-value">${h}</span>
                    <button class="ts-chip-clear" data-col="${u}"><i class="bi bi-x"></i></button>
                </div>
            `)}),i&&i.length>0&&i.forEach((u,h)=>{const l=this.getOperatorLabel(u.operator),y=u.operator==="between"?`${u.value} - ${u.value2}`:u.operator==="in"||u.operator==="not_in"?Array.isArray(u.value)?u.value.join(", "):String(u.value):u.operator==="is_null"||u.operator==="is_not_null"?"":String(u.value);d.push(`
                    <div class="ts-chip ts-chip-advanced">
                        <span class="ts-chip-label">${u.column} ${l}:</span>
                        <span class="ts-chip-value">${y}</span>
                        <button class="ts-chip-clear" data-adv-filter="${h}"><i class="bi bi-x"></i></button>
                    </div>
                `)}),this.dom.filterChips.innerHTML=d.join(""),this.dom.filterChips.querySelectorAll(".ts-chip-clear").forEach(u=>{u.addEventListener("click",h=>{const l=h.currentTarget.dataset.col,y=h.currentTarget.dataset.advFilter;if(l){const m={...this.stateManager.getState().columnFilters};delete m[l],this.stateManager.update({columnFilters:m,currentPage:0})}else if(y!==void 0){const b=[...this.stateManager.getState().advancedFilters||[]];b.splice(parseInt(y),1),this.stateManager.update({advancedFilters:b.length>0?b:void 0,currentPage:0})}})})}getOperatorLabel(t){return{eq:"=",ne:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"contains",ilike:"contains (i)",in:"in",not_in:"not in",between:"between",is_null:"is null",is_not_null:"is not null",regex:"regex"}[t]||t}toggleAllColumns(){const t=this.stateManager.getState(),a=t.columns.every(r=>t.visibleColumns.has(r.column)),i=new Set(t.visibleColumns);t.columns.forEach(r=>{a?i.delete(r.column):i.add(r.column)}),this.stateManager.update({visibleColumns:i}),this.renderControlList()}getToken(){var t;return((t=this.dom.token)==null?void 0:t.value)||""}getBerdlId(){var t;return((t=this.dom.berdl)==null?void 0:t.value)||""}renderCategories(){this.renderControlList()}renderColumnList(){this.renderControlList()}updateLoadingState(t){if(!this.dom.loadingIndicator||!this.dom.loadingText)return;t.loading&&t.availableTables.length===0?(this.dom.loadingIndicator.style.display="block",this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.dom.loadingText.textContent="Fetching tables..."):this.dom.loadingIndicator.style.display="none"}}class Jn extends Ht{constructor(t){super(t);T(this,"options");T(this,"searchTimer");this.options=t}render(){this.container.innerHTML=`
            <div class="ts-search-box">
                <input type="text" id="ts-search" class="ts-search" 
                    placeholder="Search data..." 
                    aria-label="Search all table columns">
                <button class="ts-search-clear" id="ts-search-clear" aria-label="Clear search">
                    <i class="bi bi-x-lg"></i>
                </button>
                <i class="bi bi-search ts-search-icon"></i>
            </div>
            <div class="ts-spacer" style="flex:1"></div>
            <div class="ts-toolbar-actions">
                <button class="ts-tb-btn" id="ts-refresh" title="Refresh Data">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="ts-tb-icon" id="ts-settings-btn" title="Settings">
                    <i class="bi bi-gear-fill"></i>
                </button>
            </div>
        `,this.cacheDom({search:"#ts-search",searchClear:"#ts-search-clear",refresh:"#ts-refresh",settings:"#ts-settings-btn"})}bindEvents(){var t,a,i;(t=this.dom.search)==null||t.addEventListener("input",()=>{clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{const r=this.dom.search.value;this.options.onSearch(r)},300)}),(a=this.dom.searchClear)==null||a.addEventListener("click",()=>{this.dom.search.value="",this.options.onSearch(""),this.dom.search.focus()}),(i=this.dom.refresh)==null||i.addEventListener("click",()=>this.options.onRefresh())}getSettingsButton(){return this.dom.settings}setSearch(t){this.dom.search&&(this.dom.search.value=t)}focusSearch(){this.dom.search&&(this.dom.search.focus(),this.dom.search.select())}}const w=class w{static escapeHtml(e){if(e==null)return"";const t=document.createElement("div");return t.textContent=String(e),t.innerHTML}static apply(e,t,a){if(!t)return e!=null?w.escapeHtml(String(e)):"";if(Array.isArray(t))return w.chain(e,{transforms:t},a);const i=t;if(i.condition&&!w.evaluateCondition(i.condition,e,a))return i.fallback?typeof i.fallback=="string"?w.escapeHtml(i.fallback):w.apply(e,i.fallback,a):e!=null?w.escapeHtml(String(e)):"";const r=t.type;return typeof w[r]=="function"?w[r](e,t.options||{},a):w.customTransformers.has(r)?w.customTransformers.get(r)(e,t.options||{},a):(console.warn(`Unknown transformer type: "${r}"`),e!=null?w.escapeHtml(String(e)):"")}static evaluateCondition(e,t,a){const i=e.column?a[e.column]:t,r=e.value;switch(e.operator){case"eq":return i===r;case"neq":return i!==r;case"gt":return Number(i)>Number(r);case"gte":return Number(i)>=Number(r);case"lt":return Number(i)<Number(r);case"lte":return Number(i)<=Number(r);case"contains":return String(i).includes(String(r));case"startsWith":return String(i).startsWith(String(r));case"endsWith":return String(i).endsWith(String(r));case"regex":return new RegExp(String(r)).test(String(i));case"isEmpty":return i==null||i==="";case"isNotEmpty":return i!=null&&i!=="";default:return!0}}static chain(e,t,a){if(!t.transforms||!Array.isArray(t.transforms))return w.escapeHtml(String(e??""));let i=e;for(const r of t.transforms){if(t.transforms.indexOf(r)===t.transforms.length-1)return w.apply(i,r,a);i=w.apply(i,r,a)}return w.escapeHtml(String(i??""))}static number(e,t,a){if(e==null||e==="")return"";const i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.decimals??2,d=t.locale||"en-US",u=t.prefix||"",h=t.suffix||"";let l;return t.notation==="scientific"?l=i.toExponential(r):t.notation==="compact"?l=new Intl.NumberFormat(d,{notation:"compact",maximumFractionDigits:r}).format(i):t.notation==="engineering"?l=i.toExponential(r):l=new Intl.NumberFormat(d,{minimumFractionDigits:t.minDecimals??0,maximumFractionDigits:r}).format(i),`<span class="ts-number">${w.escapeHtml(u)}${l}${w.escapeHtml(h)}</span>`}static percentage(e,t,a){if(e==null||e==="")return"";let i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));t.scale100!==!1&&i>=0&&i<=1&&(i*=100);const r=t.decimals??1,d=i.toFixed(r);if(t.showBar){const u=Math.min(100,Math.max(0,i)),h=t.color||"#6366f1";return`
                <div class="ts-percentage">
                    <div class="ts-percentage-bar" style="width:${u}%;background:${h}"></div>
                    <span class="ts-percentage-value">${d}%</span>
                </div>
            `}return`<span class="ts-number">${d}%</span>`}static currency(e,t,a){if(e==null||e==="")return"";const i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.locale||"en-US",d=t.currency||"USD";return`<span class="ts-currency">${new Intl.NumberFormat(r,{style:"currency",currency:d,minimumFractionDigits:t.decimals??2,maximumFractionDigits:t.decimals??2}).format(i)}</span>`}static filesize(e,t,a){if(e==null||e==="")return"";const i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.binary!==!1,d=r?["B","KiB","MiB","GiB","TiB","PiB"]:["B","KB","MB","GB","TB","PB"],u=r?1024:1e3;let h=i,l=0;for(;h>=u&&l<d.length-1;)h/=u,l++;const y=t.decimals??(l===0?0:2);return`<span class="ts-filesize">${h.toFixed(y)} ${d[l]}</span>`}static duration(e,t,a){if(e==null||e==="")return"";let i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.format||"short";if(r==="clock"){const h=Math.floor(i/3600),l=Math.floor(i%3600/60),y=Math.floor(i%60);return h>0?`<span class="ts-duration">${h}:${String(l).padStart(2,"0")}:${String(y).padStart(2,"0")}</span>`:`<span class="ts-duration">${l}:${String(y).padStart(2,"0")}</span>`}const d=[{name:r==="long"?"day":"d",seconds:86400},{name:r==="long"?"hour":"h",seconds:3600},{name:r==="long"?"minute":"m",seconds:60},{name:r==="long"?"second":"s",seconds:1}],u=[];for(const h of d)if(i>=h.seconds){const l=Math.floor(i/h.seconds);i%=h.seconds,r==="long"?u.push(`${l} ${h.name}${l!==1?"s":""}`):u.push(`${l}${h.name}`)}return`<span class="ts-duration">${u.join(r==="long"?", ":" ")||"0s"}</span>`}static date(e,t,a){if(e==null||e==="")return"";const i=new Date(e);if(isNaN(i.getTime()))return w.escapeHtml(String(e));const r=t.locale||"en-US";return t.relative?`<span class="ts-date" title="${i.toISOString()}">${w.relativeTime(i)}</span>`:`<span class="ts-date">${new Intl.DateTimeFormat(r,{dateStyle:t.dateStyle||"medium"}).format(i)}</span>`}static datetime(e,t,a){if(e==null||e==="")return"";const i=new Date(e);if(isNaN(i.getTime()))return w.escapeHtml(String(e));const r=t.locale||"en-US",d=t.timezone||void 0;return`<span class="ts-datetime">${new Intl.DateTimeFormat(r,{dateStyle:t.dateStyle||"medium",timeStyle:t.timeStyle||"short",timeZone:d}).format(i)}</span>`}static relativeTime(e){const a=new Date().getTime()-e.getTime(),i=Math.abs(a/1e3),r=a<0,d=[[31536e3,"year"],[2592e3,"month"],[86400,"day"],[3600,"hour"],[60,"minute"],[1,"second"]];for(const[u,h]of d)if(i>=u){const l=Math.floor(i/u),y=l!==1?"s":"";return r?`in ${l} ${h}${y}`:`${l} ${h}${y} ago`}return"just now"}static boolean(e,t,a){const i=e===!0||e==="true"||e===1||e==="1";if(t.trueIcon||t.falseIcon){const u=i?t.trueIcon||"bi-check-circle-fill":t.falseIcon||"bi-x-circle",h=i?t.trueColor||"#22c55e":t.falseColor||"#ef4444";return`<i class="${u}" style="color:${h};font-size:1.1em"></i>`}const r=i?t.trueText||"Yes":t.falseText||"No";return`<span class="ts-boolean" style="color:${i?t.trueColor||"#22c55e":t.falseColor||"#94a3b8"}">${w.escapeHtml(r)}</span>`}static heatmap(e,t,a){if(e==null||e==="")return"";const i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.min??-4,d=t.max??4,u=t.colorScale||"diverging",h=(i-r)/(d-r),l=Math.max(0,Math.min(1,h));let y,m;if(u==="diverging"){let $,_,E;if(l<.5){const R=l*2;$=Math.round(59+196*R),_=Math.round(130+125*R),E=Math.round(246+9*R),m=R<.5?"#fff":"#1e293b"}else{const R=(l-.5)*2;$=Math.round(255+-16*R),_=Math.round(255+-187*R),E=Math.round(255+-187*R),m=R>.5?"#fff":"#1e293b"}y=`rgb(${$}, ${_}, ${E})`}else if(u==="sequential"){const $=Math.round(236+-228*l),_=Math.round(254+-109*l),E=Math.round(255+-77*l);y=`rgb(${$}, ${_}, ${E})`,m=l>.5?"#fff":"#1e293b"}else y="transparent",m="inherit";const b=t.decimals??2,S=t.showValue!==!1?i.toFixed(b):"";return`<span class="ts-heatmap" style="background:${y};color:${m}">${S}</span>`}static progress(e,t,a){if(e==null||e==="")return"";const i=Number(e);if(isNaN(i))return w.escapeHtml(String(e));const r=t.max??100,d=Math.min(100,Math.max(0,i/r*100)),u=t.color||"#6366f1",h=t.showValue!==!1;return`
            <div class="ts-progress">
                <div class="ts-progress-bar" style="width:${d}%;background:${u}"></div>
                ${h?`<span class="ts-progress-value">${i}${t.suffix||""}</span>`:""}
            </div>
        `}static link(e,t,a={}){if(e==null||e==="")return"";const i=String(e),r=encodeURIComponent(i);let d=t.urlTemplate.replace(/\{value\}/g,r);a&&Object.keys(a).length>0&&Object.keys(a).forEach(m=>{const b=`{${m}}`;d.includes(b)&&(d=d.replace(new RegExp(b.replace(/[{}]/g,"\\$&"),"g"),encodeURIComponent(String(a[m]||""))))});let u=i;t.labelTemplate&&(u=t.labelTemplate.replace(/\{value\}/g,i),a&&Object.keys(a).length>0&&Object.keys(a).forEach(m=>{u=u.replace(new RegExp(`\\{${m}\\}`,"g"),String(a[m]||""))}));const h=t.target||"_blank",l=h==="_blank"?' rel="noopener noreferrer"':"",y=t.icon?`<i class="${t.icon}"></i> `:"";return`<a href="${d}" target="${h}"${l} class="ts-cell-link">${y}${w.escapeHtml(u)}</a>`}static replace(e,t){if(e==null||e==="")return"";const a=String(e),i=t.pattern||t.find,r=t.replaceWith||t.replace||"";if(!i)return a;if(t.isRegex)try{const d=t.flags||"g",u=new RegExp(i,d);return a.replace(u,r)}catch(d){return console.error("Invalid regex in replace transformer",d),a}return a.split(i).join(r)}static merge(e,t,a){if(!a||!t.columns||!Array.isArray(t.columns))return"";const i=t.skipEmpty!==!1;if(t.template){let u=t.template;return t.columns.forEach(h=>{const l=a[h],y=`{${h}}`;i&&(l==null||l==="")?(u=u.replace(new RegExp(`\\s*\\(${y}\\)`,"g"),""),u=u.replace(new RegExp(`${y}\\s*[|,;:]\\s*`,"g"),""),u=u.replace(new RegExp(`\\s*[|,;:]\\s*${y}`,"g"),""),u=u.replace(y,"")):u=u.replace(y,String(l||""))}),w.escapeHtml(u.trim())}const r=t.separator||" | ",d=t.columns.map(u=>a[u]).filter(u=>!i||u!=null&&u!=="").map(u=>String(u));return w.escapeHtml(d.join(r))}static badge(e,t,a){if(e==null||e==="")return"";const i=String(e);let u=(t.colorMap||{})[i]||t.color||t.defaultColor;if(!u){const y=["#6366f1","#ef4444","#10b981","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316"];let m=0;for(let b=0;b<i.length;b++)m=i.charCodeAt(b)+((m<<5)-m);u=y[Math.abs(m)%y.length]}const h=t.variant||"default";let l;return h==="subtle"?l=`background:${u}15;color:${u};border:none`:h==="outline"?l=`background:transparent;color:${u};border:1px solid ${u}`:l=`background:${u}20;color:${u};border:1px solid ${u}40`,`<span class="ts-badge" style="${l}">${w.escapeHtml(i)}</span>`}static array(e,t,a){if(e==null)return"";let i;if(Array.isArray(e))i=e;else if(typeof e=="string"){const l=t.separator||",";i=e.split(l).map(y=>y.trim()).filter(Boolean)}else return w.escapeHtml(String(e));const r=t.limit||5,d=i.slice(0,r),u=i.length-r,h=d.map(l=>w.badge(l,{color:t.color||"#6366f1",variant:"subtle"},a)).join(" ");return u>0?`${h} <span class="ts-badge-more">+${u}</span>`:h}static sequence(e,t){if(!e)return"";let a=String(e);if(t.chunkSize&&t.chunkSize>0){const h=new RegExp(`.{1,${t.chunkSize}}`,"g"),l=a.match(h);l&&(a=l.join(" "))}const i=t.maxLength||30,r=a,d=t.showCopyButton!==!1;a.length>i&&(a=a.substring(0,i)+"...");const u=d?`<button class="ts-copy-btn" data-id="${w.escapeHtml(r)}" title="Copy sequence"><i class="bi bi-clipboard"></i></button>`:"";return`<span class="ts-sequence" title="${w.escapeHtml(r)}">${w.escapeHtml(a)}${u}</span>`}static truncate(e,t){if(!e)return"";const a=String(e),i=t.length||50,r=t.ellipsis??"...";if(a.length<=i)return w.escapeHtml(a);const d=a.substring(0,i)+r;return`<span title="${w.escapeHtml(a)}">${w.escapeHtml(d)}</span>`}static preLoadOntology(e,t="custom"){const a=Date.now();Object.entries(e).forEach(([i,r])=>{const d=`${t}:${i}`;w.ontologyCache.set(d,{name:r,timestamp:a})})}static ontology(e,t,a){if(e==null||e==="")return"";const i=t.delimiter;if(i&&typeof e=="string"&&e.includes(i)){const r=e.split(i).map(d=>d.trim()).filter(Boolean);return r.length===0?"":`<div class="ts-ontology-list" style="display:flex;flex-wrap:wrap;gap:4px">
                ${r.map(d=>w.renderSingleOntologyTerm(d,t)).join("")}
            </div>`}return w.renderSingleOntologyTerm(String(e).trim(),t)}static renderSingleOntologyTerm(e,t){const a=`${t.ontologyType||"custom"}:${e}`,i=w.ontologyCache.get(a);return i&&Date.now()-i.timestamp<w.cacheTimeout?w.formatOntologyTerm(e,i.name,t):(w.lookupOntologyTerm(e,t,a),w.formatOntologyTerm(e,null,t))}static lookup(e,t,a){if(e==null||e==="")return"";const i=String(e);if(t.map&&typeof t.map=="object"){const r=t.map[i];if(r!==void 0)return w.escapeHtml(String(r))}if(t.apiUrl){const r=`lookup:${t.apiUrl}:${i}`,d=w.lookupCache.get(r);return d&&Date.now()-d.timestamp<w.cacheTimeout?w.escapeHtml(d.value):(w.performAsyncLookup(i,t,r),w.escapeHtml(i)+' <span class="ts-loading-indicator">...</span>')}return t.fallback?w.escapeHtml(t.fallback):w.escapeHtml(i)}static formatOntologyTerm(e,t,a){const i=a.showId!==!1,r=w.escapeHtml(e),d=a.style||"default";let u="#";a.urlTemplate&&(u=a.urlTemplate.replace(/\{value\}/g,encodeURIComponent(e))),t&&a.urlTemplate&&a.urlTemplate.includes("{name}")&&(u=u.replace(/\{name\}/g,encodeURIComponent(t)));const h=a.urlTemplate?"a":"span",l=a.urlTemplate?` href="${u}" target="_blank" rel="noopener noreferrer"`:"";if(d==="badge")return t?`<${h}${l} class="ts-badge ts-ontology-badge" data-term="${r}" style="text-decoration:none">${w.escapeHtml(t)}</${h}>`:`<${h}${l} class="ts-badge ts-ontology-badge ts-loading-term" data-term="${r}" style="text-decoration:none">${r}</${h}>`;if(t){const y=w.escapeHtml(t);return i?`<${h}${l} class="ts-ontology" data-term="${r}">${y} <span class="ts-ontology-id">(${r})</span></${h}>`:`<${h}${l} class="ts-ontology" data-term="${r}">${y}</${h}>`}return`<${h}${l} class="ts-ontology ts-loading-term" data-term="${r}">${r}</${h}>`}static async lookupOntologyTerm(e,t,a){try{let i=null;if(t.map&&t.map[e])i=t.map[e];else switch(t.ontologyType){case"GO":i=await w.lookupGO(e);break;case"KEGG":i=e;break;case"EC":i=e;break;case"custom":t.lookupEndpoint&&(i=await w.lookupCustom(e,t.lookupEndpoint));break}i&&(w.ontologyCache.set(a,{name:i,timestamp:Date.now()}),w.updateOntologyElements(e,i,t))}catch(i){console.warn(`Ontology lookup failed for ${e}`,i)}}static updateOntologyElements(e,t,a){document.querySelectorAll(`.ts-ontology[data-term="${e}"], .ts-ontology-badge[data-term="${e}"]`).forEach(r=>{r.classList.remove("ts-loading-term");const d=a.showId!==!1;r.classList.contains("ts-ontology-badge")?r.textContent=t:d?r.innerHTML=`${w.escapeHtml(t)} <span class="ts-ontology-id">(${w.escapeHtml(e)})</span>`:r.textContent=t})}static async lookupGO(e){var i,r;const t=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${e}`,{headers:{Accept:"application/json"}});return t.ok&&((r=(i=(await t.json()).results)==null?void 0:i[0])==null?void 0:r.name)||null}static async lookupCustom(e,t){const a=t.replace("{value}",encodeURIComponent(e)),i=await fetch(a);if(!i.ok)return null;const r=await i.json();return r.name||r.label||r.term||null}static async performAsyncLookup(e,t,a){try{const i=t.apiUrl.replace("{value}",encodeURIComponent(e)),r=await fetch(i);if(r.ok){const d=await r.json(),u=t.valuePath?d[t.valuePath]:d.value||d.name||d;u&&w.lookupCache.set(a,{value:String(u),timestamp:Date.now()})}}catch(i){console.error("Async lookup failed",i)}}static conditional(e,t,a){if(!t.conditions||!Array.isArray(t.conditions))return w.escapeHtml(String(e??""));for(const i of t.conditions)if(w.evaluateCondition(i.when,e,a)){if(i.transform)return w.apply(e,i.transform,a);if(i.value!==void 0)return w.escapeHtml(String(i.value))}return t.default?typeof t.default=="object"&&t.default.type?w.apply(e,t.default,a):w.escapeHtml(String(t.default)):w.escapeHtml(String(e??""))}static ontologyLookup(e,t,a){if(e==null||e==="")return"";let i;if(typeof e=="string"){const h=e.trim();if(h.startsWith("["))try{const l=JSON.parse(h);i=Array.isArray(l)?l.filter(Boolean).map(String):[h]}catch{i=[h]}else i=h.split(/[,;]/).map(l=>l.trim()).filter(Boolean)}else Array.isArray(e)?i=e.filter(Boolean).map(String):i=[String(e)];if(i.length===0)return"";const r=i.slice(0,t.limit||5).map(h=>w.renderOntologyLookupTerm(h,t)),d=i.length-(t.limit||5),u=d>0?`<span class="ts-ontology-more" title="${i.slice(t.limit||5).join(", ")}">+${d}</span>`:"";return`<div class="ts-ontology-lookup-list">${r.join("")}${u}</div>`}static renderOntologyLookupTerm(e,t){const a=t.idPattern||"(rxn\\d+|cpd\\d+)",i=e.match(new RegExp(a,"i")),r=i?i[1]:e,d=`ontolookup:${t.ontologyType||"custom"}:${r}`,u=w.ontologyCache.get(d),h=w.escapeHtml(e),l=t.showId!==!1,y=t.maxLength||50,m=t.style||"inline";let b="#";return t.urlTemplate&&(b=t.urlTemplate.replace(/\{id\}/g,encodeURIComponent(r))),u&&Date.now()-u.timestamp<w.cacheTimeout?w.formatOntologyLookupTerm(r,h,u.name,b,l,y,m):(w.lookupOntologyDescription(r,t,d),w.formatOntologyLookupTerm(r,h,null,b,l,y,m))}static formatOntologyLookupTerm(e,t,a,i,r,d,u){const h=w.escapeHtml(e),l=i!=="#",y=l?`href="${i}" target="_blank" rel="noopener noreferrer"`:"",m=l?"a":"span";if(u==="badge"){if(a){const b=a.length>d?a.substring(0,d)+"":a,S=`${t}: ${a}`;return`<${m} ${y} class="ts-badge ts-ontology-lookup-badge" data-term="${h}" title="${w.escapeHtml(S)}" style="text-decoration:none">
                    ${r?`<span class="ts-ontology-id">${h}</span>: `:""}
                    <span class="ts-ontology-name">${w.escapeHtml(b)}</span>
                </${m}>`}return`<${m} ${y} class="ts-badge ts-ontology-lookup-badge ts-loading-term" data-term="${h}" title="${t}" style="text-decoration:none">${h}</${m}>`}if(a){const b=a.length>d?a.substring(0,d)+"":a,S=`${t}: ${a}`;return`<${m} ${y} class="ts-ontology-lookup" data-term="${h}" title="${w.escapeHtml(S)}">
                ${r?`<span class="ts-ontology-id">${h}</span>: `:""}
                <span class="ts-ontology-name">${w.escapeHtml(b)}</span>
            </${m}>`}return`<${m} ${y} class="ts-ontology-lookup ts-loading-term" data-term="${h}" title="${t}">
            <span class="ts-ontology-id">${h}</span>
            <span class="ts-loading-indicator"></span>
        </${m}>`}static async lookupOntologyDescription(e,t,a){try{let i=null;switch(t.ontologyType||"custom"){case"modelseed_reactions":i=await w.lookupModelSeedReaction(e);break;case"modelseed_compounds":i=await w.lookupModelSeedCompound(e);break;case"go":i=await w.lookupGOTerm(e);break;case"kegg":i=await w.lookupKEGGOrtholog(e);break;case"pfam":i=await w.lookupPfamDomain(e);break;case"cog":i=await w.lookupCOG(e);break;case"ec":i=await w.lookupECNumber(e);break;case"so":i=await w.lookupSequenceOntology(e);break;case"uniref":i=await w.lookupUniRef(e);break;case"custom":if(t.apiUrl){const d=t.apiUrl.replace(/\{id\}/g,encodeURIComponent(e)),u=await fetch(d);if(u.ok){const h=await u.json();i=h.name||h.definition||h.equation||null}}break}i&&(w.ontologyCache.set(a,{name:i,timestamp:Date.now()}),w.updateOntologyLookupElements(e,i,t))}catch(i){console.warn(`Ontology lookup failed for ${e}`,i)}}static async lookupModelSeedReaction(e){var t,a;try{const i=await fetch(`https://modelseed.org/solr/reactions/select?q=id:${e}&wt=json`);if(!i.ok)return null;const r=await i.json();if(((a=(t=r.response)==null?void 0:t.docs)==null?void 0:a.length)>0){const d=r.response.docs[0];return d.definition||d.name||d.equation||null}return null}catch{return null}}static async lookupModelSeedCompound(e){var t,a;try{const i=await fetch(`https://modelseed.org/solr/compounds/select?q=id:${e}&wt=json`);if(!i.ok)return null;const r=await i.json();if(((a=(t=r.response)==null?void 0:t.docs)==null?void 0:a.length)>0){const d=r.response.docs[0];return d.name||d.formula||null}return null}catch{return null}}static async lookupGOTerm(e){var t,a;try{const i=e.startsWith("GO:")?e:`GO:${e}`,r=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${encodeURIComponent(i)}`,{headers:{Accept:"application/json"}});if(!r.ok)return null;const d=await r.json();return(a=(t=d.results)==null?void 0:t[0])!=null&&a.name?d.results[0].name:null}catch{return null}}static async lookupKEGGOrtholog(e){try{const t=e.replace(/^KEGG:/i,"").replace(/^ko:/i,""),a=await fetch(`https://rest.kegg.jp/get/${t}`);if(!a.ok)return null;const i=await a.text(),r=i.match(/^DEFINITION\s+(.+?)(?:\n|$)/m);if(r)return r[1].trim();const d=i.match(/^NAME\s+(.+?)(?:\n|$)/m);return d?d[1].trim():null}catch{return null}}static async lookupPfamDomain(e){var t;try{const a=e.startsWith("PF")?e:`PF${e}`,i=await fetch(`https://www.ebi.ac.uk/interpro/api/entry/pfam/${a}`,{headers:{Accept:"application/json"}});return i.ok&&((t=(await i.json()).metadata)==null?void 0:t.name)||null}catch{return null}}static async lookupCOG(e){try{const t=e.replace(/^COG:/i,"").trim();return t.length===1&&/^[A-Z]$/i.test(t)?await w.lookupCOGCategory(t.toUpperCase()):/^COG\d+$/i.test(t)?await w.lookupCOGId(t.toUpperCase()):null}catch{return null}}static async lookupCOGCategory(e){var t,a;try{const i=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/?cat=${encodeURIComponent(e)}&format=json`);if(i.ok){const r=await i.json();if((a=(t=r.results)==null?void 0:t[0])!=null&&a.fun_cat_description)return r.results[0].fun_cat_description}return null}catch{return null}}static async lookupCOGId(e){try{const t=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/${encodeURIComponent(e)}/?format=json`);if(!t.ok)return null;const a=await t.json();return a.cog_name?a.cog_name:a.fun_cat_description?a.fun_cat_description:null}catch{return null}}static async lookupECNumber(e){try{const t=e.replace(/^EC:/i,"").trim(),a=await fetch(`https://rest.kegg.jp/get/ec:${t}`);if(!a.ok)return null;const r=(await a.text()).match(/^NAME\s+(.+?)(?:\n|$)/m);return r?r[1].split(";")[0].trim():null}catch{return null}}static async lookupSequenceOntology(e){var t,a,i,r,d,u,h,l;try{const m=(e.startsWith("SO:")?e:`SO:${e}`).replace(":","_"),b=await fetch(`https://www.ebi.ac.uk/ols4/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!b.ok){const $=await fetch(`https://www.ebi.ac.uk/ols/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!$.ok)return null;const _=await $.json();return(i=(a=(t=_._embedded)==null?void 0:t.terms)==null?void 0:a[0])!=null&&i.label?_._embedded.terms[0].label:null}const S=await b.json();return(u=(d=(r=S._embedded)==null?void 0:r.terms)==null?void 0:d[0])!=null&&u.label?S._embedded.terms[0].label:(l=(h=S.elements)==null?void 0:h[0])!=null&&l.label?S.elements[0].label:null}catch{return null}}static async lookupUniRef(e){var t,a,i,r,d;try{let u=e;const h=e.match(/UniRef\d+_(\w+)/i);h&&(u=h[1]);const l=await fetch(`https://rest.uniprot.org/uniprotkb/${u}.json`);if(!l.ok)return null;const m=(await l.json()).proteinDescription;return(a=(t=m==null?void 0:m.recommendedName)==null?void 0:t.fullName)!=null&&a.value?m.recommendedName.fullName.value:(d=(r=(i=m==null?void 0:m.submissionNames)==null?void 0:i[0])==null?void 0:r.fullName)!=null&&d.value?m.submissionNames[0].fullName.value:null}catch{return null}}static updateOntologyLookupElements(e,t,a){const i=a.maxLength||50,r=a.showId!==!1,d=t.length>i?t.substring(0,i)+"":t;document.querySelectorAll(`.ts-ontology-lookup[data-term="${e}"], .ts-ontology-lookup-badge[data-term="${e}"]`).forEach(h=>{h.classList.remove("ts-loading-term"),h.setAttribute("title",`${e}: ${t}`);const l=r?`<span class="ts-ontology-id">${w.escapeHtml(e)}</span>: `:"";h.innerHTML=`${l}<span class="ts-ontology-name">${w.escapeHtml(d)}</span>`})}static register(e,t){w.customTransformers.set(e,t),console.log(`Registered custom transformer: ${e}`)}static unregister(e){return w.customTransformers.delete(e)}static getAvailableTransformers(){const e=["number","percentage","currency","filesize","duration","date","datetime","boolean","heatmap","progress","link","replace","merge","badge","array","sequence","truncate","ontology","ontologyLookup","lookup","chain","conditional"],t=Array.from(w.customTransformers.keys());return[...e,...t]}static custom(e,t,a){const i=w.customTransformers.get(t.functionName);if(!i)return e?String(e):"";try{return i(e,t.params||{},a)}catch(r){return console.error("Custom transformer error",r),e?String(e):""}}};T(w,"ontologyCache",new Map),T(w,"lookupCache",new Map),T(w,"cacheTimeout",36e5),T(w,"customTransformers",new Map);let Me=w;class Zn extends Ht{constructor(t){super(t);T(this,"stateManager");T(this,"options");T(this,"tooltip",null);T(this,"focusedFilterCol",null);T(this,"selectionStart",null);T(this,"selectionEnd",null);T(this,"filterDebounceTimer",null);T(this,"selection",new Set);this.stateManager=t.stateManager,this.options=t,this.stateManager.subscribe(()=>{this.render()})}render(){const t=this.stateManager.getState();if(t.columns.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-inbox-fill"></i></div>
                    <h3 class="ts-empty-title">No Data Loaded</h3>
                    <p class="text-muted">Select a data source from the sidebar to begin.</p>
                </div>`;return}const a=t.columns.filter(u=>t.visibleColumns.has(u.column));if(a.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-layout-three-columns"></i></div>
                    <h3 class="ts-empty-title">All Columns Hidden</h3>
                    <p class="text-muted">Enable columns in the sidebar to view data.</p>
                </div>`;return}const i=t.searchValue.toLowerCase();let r='<table class="ts-table"><thead><tr>';const d=t.data.length>0&&t.data.every((u,h)=>this.selection.has(h));if(r+=`<th class="ts-col-select ts-col-fixed"><input type="checkbox" id="ts-select-all" ${d?"checked":""}></th>`,t.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed">#</th>'),a.forEach((u,h)=>{const y=h===0&&!t.showRowNumbers?"ts-col-fixed":"",m=u.sortable?"sortable":"";let b=t.sortColumn===u.column?t.sortOrder==="asc"?' <i class="bi bi-sort-up"></i>':' <i class="bi bi-sort-down"></i>':"";const S=u.width&&u.width!=="auto"?`width:${u.width}`:"min-width:80px";r+=`<th class="${y} ${m}" data-col="${u.column}" style="${S}">${u.displayName||u.column}${b}</th>`}),r+='</tr><tr class="ts-filter-row">',r+='<th class="ts-col-select ts-col-fixed" style="width:48px"></th>',t.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed" style="width:60px"></th>'),a.forEach((u,h)=>{const y=h===0&&!t.showRowNumbers?"ts-col-fixed":"",m=t.columnFilters[u.column]||"",b=u.width&&u.width!=="auto"?`width:${u.width}`:"min-width:80px",S=this.options.getColumnType?this.options.getColumnType(u.column):"TEXT",$=["INTEGER","REAL","NUMERIC"].includes(S.toUpperCase()),_=$?"e.g., <500, >=100, =50":"Filter...",E=$?"Supports: <, <=, >, >=, =, !=, between, or just number":"Text search, =value, !=value, in(list), between";r+=`<th class="${y}" style="${b}">`,u.filterable!==!1?r+=`<div class="ts-filter-wrap"><input class="ts-filter-input ${m?"has-value":""}" data-col="${u.column}" data-type="${S}" value="${Me.escapeHtml(m)}" placeholder="${_}" title="${E}"><button class="ts-filter-clear" data-col="${u.column}"><i class="bi bi-x"></i></button></div>`:r+='<div style="height:28px"></div>',r+="</th>"}),r+="</tr></thead><tbody>",t.data.length===0){const u=a.length+(t.showRowNumbers?1:0);r+=`<tr><td colspan="${u}" style="text-align:center;padding:32px;color:var(--text-muted)"><i class="bi bi-search" style="font-size:20px;opacity:.3;display:block;margin-bottom:6px"></i>No matching records</td></tr>`}else{const u=t.currentPage*t.pageSize+1;t.data.forEach((h,l)=>{const y=this.isRowSelected(l),m=u+l;r+=`<tr class="${y?"selected":""}" data-idx="${l}">`,r+=`<td class="ts-col-select ts-col-fixed"><input type="checkbox" class="ts-row-checkbox" data-idx="${l}" ${y?"checked":""}></td>`,t.showRowNumbers&&(r+=`<td class="ts-col-num ts-col-fixed">${m}</td>`),a.forEach((b,S)=>{const _=S===0&&!t.showRowNumbers?"ts-col-fixed":"",E=h[b.column];let R="";if(b.transform)R=Me.apply(E,b.transform,h);else if(b.column.includes("ID")||b.column==="ID"){const M=Me.escapeHtml(E);R=`<span class="ts-copy-id"><span class="ts-mono">${M}</span><button class="ts-copy-btn" data-id="${M}"><i class="bi bi-clipboard"></i></button></span>`}else R=Me.escapeHtml(E);i&&(R=this.highlightText(R,i)),r+=`<td class="${_}">${R}</td>`}),r+="</tr>"})}r+="</tbody></table>",this.container.innerHTML=r,this.bindEvents(),this.restoreFocus()}restoreFocus(){if(this.focusedFilterCol){const t=this.container.querySelector(`input.ts-filter-input[data-col="${this.focusedFilterCol}"]`);t&&(t.focus(),this.selectionStart!==null&&this.selectionEnd!==null&&t.setSelectionRange(this.selectionStart,this.selectionEnd))}}getSelection(){return this.selection}clearSelection(){this.selection.clear(),this.render()}selectAll(){this.stateManager.getState().data.forEach((a,i)=>this.selection.add(i)),this.render(),this.options.onRowSelect(-1,!0,!0)}clearFilterFocus(){this.focusedFilterCol=null,this.selectionStart=null,this.selectionEnd=null,this.filterDebounceTimer&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null)}isRowSelected(t){return this.selection.has(t)}bindEvents(){this.container.addEventListener("change",t=>{const a=t.target;if(a.id==="ts-select-all"){const i=this.stateManager.getState();a.checked?i.data.forEach((r,d)=>this.selection.add(d)):this.selection.clear(),this.render(),this.options.onRowSelect(-1,a.checked,!0);return}if(a.classList.contains("ts-row-checkbox")){const i=parseInt(a.dataset.idx||"-1");i>=0&&(a.checked?this.selection.add(i):this.selection.delete(i),this.render(),this.options.onRowSelect(i,a.checked));return}}),this.container.onclick=t=>{var u;const a=t.target,i=a.closest("th.sortable");if(i){const h=i.dataset.col;if(h){const l=this.stateManager.getState(),y=l.sortColumn===h&&l.sortOrder==="asc"?"desc":"asc";this.options.onSort(h,y)}return}const r=a.closest(".ts-filter-clear");if(r){const h=r.dataset.col;h&&this.options.onFilter(h,"");return}if(a.tagName!=="BUTTON"&&a.tagName!=="INPUT"&&!a.closest("a")&&!a.closest(".ts-copy-btn")){const h=a.closest("tr");if(h&&((u=h.parentElement)==null?void 0:u.tagName)==="TBODY"){const l=parseInt(h.dataset.idx||"-1");if(l>=0){const y=this.selection.has(l);y?this.selection.delete(l):this.selection.add(l),this.render(),this.options.onRowSelect(l,!y)}}}const d=a.closest(".ts-copy-btn");if(d){const h=d.dataset.id;h&&navigator.clipboard.writeText(h)}},this.container.oninput=t=>{const a=t.target;if(a.classList.contains("ts-filter-input")){const i=a.dataset.col;i&&(this.focusedFilterCol=i,this.selectionStart=a.selectionStart,this.selectionEnd=a.selectionEnd,this.filterDebounceTimer&&clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=setTimeout(()=>{this.options.onFilter(i,a.value)},300))}},this.container.onkeyup=t=>{const a=t.target;a.classList.contains("ts-filter-input")&&(this.selectionStart=a.selectionStart,this.selectionEnd=a.selectionEnd)},this.container.addEventListener("focusin",t=>{const a=t.target;a.classList.contains("ts-filter-input")?this.focusedFilterCol=a.dataset.col||null:this.focusedFilterCol=null}),this.container.onmouseover=t=>{var i;const a=t.target.closest("td");if(a&&a.scrollWidth>a.clientWidth){const r=(i=a.textContent)==null?void 0:i.trim();r&&this.showTooltip(t,r)}},this.container.onmouseout=t=>{t.target.closest("td")&&this.hideTooltip()}}showTooltip(t,a){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="ts-tooltip",this.tooltip.id="ts-tooltip",document.body.appendChild(this.tooltip)),this.tooltip.textContent=a,this.tooltip.classList.add("show"),this.tooltip.style.left=t.clientX+10+"px",this.tooltip.style.top=t.clientY+10+"px"}hideTooltip(){this.tooltip&&this.tooltip.classList.remove("show")}highlightText(t,a){if(!a)return t;const i=new RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return t.replace(i,'<mark class="highlight">$1</mark>')}}const ke=class ke{constructor(){T(this,"listeners",new Map);T(this,"wildcardListeners",new Set);T(this,"eventHistory",[]);T(this,"maxHistorySize",100);T(this,"debug",!1);typeof localStorage<"u"&&(this.debug=localStorage.getItem("DATATABLE_DEBUG")==="true")}static getInstance(){return ke.instance||(ke.instance=new ke),ke.instance}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const a={callback:t,once:!1};return this.listeners.get(e).add(a),()=>{var i;(i=this.listeners.get(e))==null||i.delete(a)}}once(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const a={callback:t,once:!0};return this.listeners.get(e).add(a),()=>{var i;(i=this.listeners.get(e))==null||i.delete(a)}}off(e,t){if(!t){this.listeners.delete(e);return}const a=this.listeners.get(e);if(a){for(const i of a)if(i.callback===t){a.delete(i);break}}}onAny(e){return this.wildcardListeners.add(e),()=>{this.wildcardListeners.delete(e)}}emit(e,t){this.debug&&console.log(`[EventBus] ${e}`,t),this.eventHistory.push({event:e,data:t,timestamp:Date.now()}),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift();const a=this.listeners.get(e);if(a){const i=[];for(const r of a)try{r.callback(t),r.once&&i.push(r)}catch(d){console.error(`[EventBus] Error in listener for ${e}:`,d)}for(const r of i)a.delete(r)}for(const i of this.wildcardListeners)try{i(e,t)}catch(r){console.error("[EventBus] Error in wildcard listener:",r)}if(this.listeners.has("*")){const i=this.listeners.get("*");if(i){const r={event:e,data:t};for(const d of i)d.callback(r)}}}getHistory(){return[...this.eventHistory]}clearHistory(){this.eventHistory=[]}setDebug(e){this.debug=e,typeof localStorage<"u"&&localStorage.setItem("DATATABLE_DEBUG",e?"true":"false")}listenerCount(e){var t;return((t=this.listeners.get(e))==null?void 0:t.size)??0}clear(e){e?this.listeners.delete(e):(this.listeners.clear(),this.wildcardListeners.clear())}};T(ke,"instance");let qt=ke;const Ee=qt.getInstance(),Ae=class Ae{constructor(){T(this,"defaults",{format:"csv",filename:"export",includeHeaders:!0,delimiter:",",lineEnding:"unix",jsonPretty:!1,chunkSize:1e3})}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}async export(e,t){const a=Date.now(),i={...this.defaults,...t};Ee.emit("export:started",{format:i.format,rowCount:e.length});try{const r=i.columns||this.inferColumns(e);let d,u,h;switch(i.format){case"csv":d=this.toCSV(e,r,i),u="text/csv;charset=utf-8",h="csv";break;case"tsv":d=this.toCSV(e,r,{...i,delimiter:"	"}),u="text/tab-separated-values;charset=utf-8",h="tsv";break;case"json":d=this.toJSON(e,r,i),u="application/json;charset=utf-8",h="json";break;case"json-lines":d=this.toJSONLines(e,r,i),u="application/x-ndjson;charset=utf-8",h="jsonl";break;case"xlsx":console.warn("XLSX export not yet implemented, falling back to CSV"),d=this.toCSV(e,r,i),u="text/csv;charset=utf-8",h="csv";break;default:throw new Error(`Unsupported export format: ${i.format}`)}const l=`${i.filename}.${h}`;this.downloadFile(d,l,u);const y={success:!0,filename:l,format:i.format,rowCount:e.length,byteSize:new Blob([d]).size,duration:Date.now()-a};return Ee.emit("export:completed",y),y}catch(r){const d={success:!1,filename:i.filename,format:i.format,rowCount:0,byteSize:0,duration:Date.now()-a,error:r.message||String(r)};return Ee.emit("export:failed",{...d,error:d.error}),d}}async toClipboard(e,t){const a={format:"tsv",includeHeaders:!0,...t};try{const i=a.columns||this.inferColumns(e),r=this.toCSV(e,i,{...this.defaults,...a,delimiter:"	"});return await navigator.clipboard.writeText(r),Ee.emit("export:clipboard",{rowCount:e.length}),!0}catch(i){return console.error("Failed to copy to clipboard:",i),!1}}getExtension(e){return{csv:"csv",tsv:"tsv",json:"json","json-lines":"jsonl",xlsx:"xlsx"}[e]||"txt"}getMimeType(e){return{csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json","json-lines":"application/x-ndjson",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}[e]||"text/plain"}toCSV(e,t,a){const i=[],r=a.lineEnding==="windows"?`\r
`:`
`,d=a.delimiter;a.includeHeaders&&i.push(t.map(u=>this.escapeCSV(u.header,d)).join(d));for(let u=0;u<e.length;u++){const h=e[u],l=t.map(y=>{let m=h[y.key];return y.transform&&(m=y.transform(m,h)),this.escapeCSV(this.formatValue(m),d)});if(i.push(l.join(d)),a.chunkSize&&u>0&&u%a.chunkSize===0){const y=u/e.length*100;Ee.emit("export:progress",{progress:y,processed:u,total:e.length})}}return i.join(r)}toJSON(e,t,a){const i=e.map(r=>{const d={};return t.forEach(u=>{let h=r[u.key];u.transform&&(h=u.transform(h,r)),d[u.key]=h}),d});return a.jsonPretty?JSON.stringify(i,null,2):JSON.stringify(i)}toJSONLines(e,t,a){const i=a.lineEnding==="windows"?`\r
`:`
`;return e.map(r=>{const d={};return t.forEach(u=>{let h=r[u.key];u.transform&&(h=u.transform(h,r)),d[u.key]=h}),JSON.stringify(d)}).join(i)}inferColumns(e){if(e.length===0)return[];const t=new Set;return e.forEach(a=>{Object.keys(a).forEach(i=>t.add(i))}),Array.from(t).map(a=>({key:a,header:a.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}))}escapeCSV(e,t){return e.includes('"')||e.includes(t)||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}formatValue(e){return e==null?"":typeof e=="object"?JSON.stringify(e):String(e)}downloadFile(e,t,a){const i=new Blob([e],{type:a}),r=URL.createObjectURL(i),d=document.createElement("a");d.href=r,d.download=t,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(r)}};T(Ae,"instance");let Ut=Ae;const ei=Ut.getInstance(),Le=class Le{constructor(){T(this,"shortcuts",new Map);T(this,"keyMap",new Map);T(this,"enabled",!0);this.bindGlobalHandler()}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}register(e){const t=this.normalizeKeys(e.keys);this.keyMap.has(t)&&console.warn(`Shortcut conflict: ${e.keys} is already registered for ${this.keyMap.get(t)}`),this.shortcuts.set(e.id,{...e,enabled:e.enabled!==!1,preventDefault:e.preventDefault!==!1}),this.keyMap.set(t,e.id)}unregister(e){const t=this.shortcuts.get(e);if(t){const a=this.normalizeKeys(t.keys);this.keyMap.delete(a),this.shortcuts.delete(e)}}setEnabled(e,t){const a=this.shortcuts.get(e);a&&(a.enabled=t)}setGlobalEnabled(e){this.enabled=e}getShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(e){return this.getShortcuts().filter(t=>t.category===e)}showHelp(){Ee.emit("modal:opened",{type:"keyboard-help"});const e=this.renderHelpContent();document.dispatchEvent(new CustomEvent("keyboard-help",{detail:{content:e}}))}hideHelp(){Ee.emit("modal:closed",{type:"keyboard-help"})}bindGlobalHandler(){document.addEventListener("keydown",e=>{if(!this.enabled||this.isInputElement(e.target)&&e.key!=="Escape")return;const t=this.eventToNormalizedKey(e),a=this.keyMap.get(t);if(a){const i=this.shortcuts.get(a);if(i&&i.enabled){i.preventDefault&&e.preventDefault();try{i.handler(e)}catch(r){console.error(`Error in shortcut handler ${a}:`,r)}}}})}isInputElement(e){const t=e.tagName.toLowerCase();return t==="input"||t==="textarea"||t==="select"||e.contentEditable==="true"}normalizeKeys(e){const t=e.toLowerCase().split("+").map(r=>r.trim()),a=[];(t.includes("ctrl")||t.includes("control"))&&a.push("ctrl"),t.includes("alt")&&a.push("alt"),t.includes("shift")&&a.push("shift"),(t.includes("meta")||t.includes("cmd")||t.includes("command"))&&a.push("meta");const i=t.find(r=>!["ctrl","control","alt","shift","meta","cmd","command"].includes(r));return i&&a.push(i),a.join("+")}eventToNormalizedKey(e){const t=[];e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),e.metaKey&&t.push("meta");let a=e.key.toLowerCase();return a===" "&&(a="space"),a==="arrowup"&&(a="up"),a==="arrowdown"&&(a="down"),a==="arrowleft"&&(a="left"),a==="arrowright"&&(a="right"),["control","alt","shift","meta"].includes(a)||t.push(a),t.join("+")}renderHelpContent(){const e={navigation:{title:"Navigation",icon:"bi-compass"},selection:{title:"Selection",icon:"bi-check2-square"},actions:{title:"Actions",icon:"bi-lightning"},filters:{title:"Filters",icon:"bi-funnel"},general:{title:"General",icon:"bi-gear"}};let t='<div class="keyboard-help">';for(const[a,i]of Object.entries(e)){const r=this.getShortcutsByCategory(a);if(r.length!==0){t+=`
                <div class="keyboard-help-category">
                    <h3><i class="${i.icon}"></i> ${i.title}</h3>
                    <div class="keyboard-help-list">
            `;for(const d of r){const u=this.formatKeysForDisplay(d.keys);t+=`
                    <div class="keyboard-help-item">
                        <span class="keyboard-help-desc">${d.description}</span>
                        <span class="keyboard-help-keys">${u}</span>
                    </div>
                `}t+="</div></div>"}}return t+="</div>",t}formatKeysForDisplay(e){return e.split("+").map(t=>`<kbd>${t.charAt(0).toUpperCase()+t.slice(1)}</kbd>`).join(" + ")}};T(Le,"instance");let ft=Le;function ti(k){const e=ft.getInstance();e.register({id:"help",keys:"?",description:"Show keyboard shortcuts",category:"general",handler:()=>e.showHelp()}),e.register({id:"close-modal",keys:"Escape",description:"Close modal / Clear selection",category:"general",handler:()=>{var a;const t=document.querySelector(".ts-modal-overlay.show");if(t){t.classList.remove("show");return}(a=k.onClearSelection)==null||a.call(k)}}),k.onSearch&&(e.register({id:"search",keys:"Ctrl+F",description:"Focus search box",category:"filters",handler:k.onSearch}),e.register({id:"search-alt",keys:"/",description:"Focus search box",category:"filters",handler:k.onSearch})),k.onExport&&e.register({id:"export",keys:"Ctrl+E",description:"Export data",category:"actions",handler:k.onExport}),k.onRefresh&&e.register({id:"refresh",keys:"Ctrl+R",description:"Refresh data",category:"actions",handler:k.onRefresh,preventDefault:!0}),k.onReset&&e.register({id:"reset",keys:"Ctrl+Shift+R",description:"Reset all filters",category:"actions",handler:k.onReset,preventDefault:!0}),k.onShowSchema&&e.register({id:"schema",keys:"Ctrl+I",description:"Show database schema",category:"actions",handler:k.onShowSchema}),k.onSelectAll&&e.register({id:"select-all",keys:"Ctrl+A",description:"Select all rows",category:"selection",handler:k.onSelectAll}),k.onClearSelection&&e.register({id:"clear-selection",keys:"Ctrl+D",description:"Clear selection",category:"selection",handler:k.onClearSelection}),k.onNextPage&&e.register({id:"next-page",keys:"Ctrl+Right",description:"Next page",category:"navigation",handler:k.onNextPage}),k.onPrevPage&&e.register({id:"prev-page",keys:"Ctrl+Left",description:"Previous page",category:"navigation",handler:k.onPrevPage}),k.onFirstPage&&e.register({id:"first-page",keys:"Ctrl+Home",description:"First page",category:"navigation",handler:k.onFirstPage}),k.onLastPage&&e.register({id:"last-page",keys:"Ctrl+End",description:"Last page",category:"navigation",handler:k.onLastPage}),k.onToggleTheme&&e.register({id:"toggle-theme",keys:"Ctrl+Shift+T",description:"Toggle dark/light theme",category:"general",handler:k.onToggleTheme})}ft.getInstance();class si{constructor(e){T(this,"container");T(this,"configUrl");T(this,"configManager");T(this,"registry");T(this,"client");T(this,"stateManager");T(this,"categoryManager",null);T(this,"sidebar");T(this,"toolbar");T(this,"grid");T(this,"theme","light");T(this,"density","normal");T(this,"dom",{});T(this,"columnSchemas",{});if(!e.container)throw new Error("Container required");this.container=e.container,this.configUrl=e.configUrl||null,this.client=e.client||new Os,this.registry=Ue.getInstance(),this.stateManager=new Qn,this.stateManager.subscribe(this.onStateChange.bind(this));const t=localStorage.getItem("ts-theme"),a=localStorage.getItem("ts-density");t&&(this.theme=t),a&&(this.density=a)}async init(){try{await this.loadConfiguration();const e=this.configManager.getEnvironment(),t=this.configManager.getApis();let i=this.configManager.getDefaultApiId()||(t.length>0?t[0].id:null);if(i){const d=this.configManager.getApi(i);d&&this.client.updateConfig(d)}else{const d=this.configManager.getApiUrl();d?this.client=new Os({environment:e,baseUrl:d}):this.client.setEnvironment(e)}const r=this.configManager.getGlobalSettings();this.stateManager.update({pageSize:r.pageSize||50,showRowNumbers:r.showRowNumbers!==!1}),this.loadStateFromUrl(),this.renderLayout(),this.initComponents()}catch(e){this.container.innerHTML=`<div class="ts-alert ts-alert-danger"><i class="bi bi-x-circle-fill"></i> ${e.message}</div>`}}renderLayout(){this.container.innerHTML=`
            <div class="ts-app" data-theme="${this.theme}" data-density="${this.density}">
                <aside class="ts-sidebar" id="ts-sidebar-container"></aside>
                <main class="ts-main">
                    <header class="ts-toolbar" id="ts-toolbar-container"></header>
                    <div id="ts-alert"></div>
                    <div class="ts-performance-indicator" id="ts-performance" style="display:none">
                        <span class="ts-perf-cached" id="ts-perf-cached" style="display:none">
                            <i class="bi bi-lightning-charge-fill"></i> Cached
                        </span>
                        <span class="ts-perf-time" id="ts-perf-time" style="display:none"></span>
                    </div>
                    <div class="ts-grid-header" id="ts-grid-header" style="display:none">
                        <div class="ts-grid-header-content">
                            <div class="ts-db-info">
                                <i class="bi bi-database"></i>
                                <span id="ts-db-name">Database</span>
                            </div>
                            <div class="ts-table-info">
                                <i class="bi bi-table"></i>
                                <span id="ts-active-table-name">Table</span>
                            </div>
                        </div>
                    </div>
                    <div class="ts-grid-wrapper" style="position:relative">
                        <div class="ts-loading-overlay" id="ts-loading-overlay" style="display:none">
                            <div class="ts-loading-spinner-wrapper">
                                <span class="ts-spinner" style="width:32px;height:32px"></span>
                                <span class="ts-loading-text" style="margin-top:12px;font-size:13px;color:var(--c-text-secondary)">Loading...</span>
                            </div>
                        </div>
                        <div class="ts-grid" id="ts-grid-container"></div>
                    </div>
                    <footer class="ts-footer">
                        <div class="ts-status" id="ts-status">Ready</div>
                        <div class="ts-table-name" id="ts-table-name"></div>
                        <div class="ts-pager" id="ts-pager"></div>
                    </footer>
                </main>
                
                <div class="ts-settings-popup" id="ts-settings-popup" style="top: 70px; right: 24px; bottom: auto;">
                    <div class="ts-settings-header">Settings</div>
                     <div class="ts-settings-body">
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-moon-stars"></i> Theme</div>
                            <div class="ts-switch ${this.theme==="dark"?"on":""}" id="ts-theme-toggle"></div>
                        </div>
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-arrows-angle-expand"></i> Density</div>
                            <div class="ts-density-options">
                                <button class="ts-density-opt ${this.density==="compact"?"active":""}" data-density="compact" title="Compact"><i class="bi bi-list"></i></button>
                                <button class="ts-density-opt ${this.density==="normal"?"active":""}" data-density="normal" title="Normal"><i class="bi bi-list-ul"></i></button>
                                <button class="ts-density-opt ${this.density==="comfortable"?"active":""}" data-density="comfortable" title="Comfortable"><i class="bi bi-card-heading"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,this.dom.status=this.container.querySelector("#ts-status"),this.dom.pager=this.container.querySelector("#ts-pager"),this.dom.alert=this.container.querySelector("#ts-alert"),this.dom.tableName=this.container.querySelector("#ts-table-name"),this.dom.loadingOverlay=this.container.querySelector("#ts-loading-overlay"),this.dom.performance=this.container.querySelector("#ts-performance"),this.dom.perfCached=this.container.querySelector("#ts-perf-cached"),this.dom.perfTime=this.container.querySelector("#ts-perf-time")}initComponents(){this.sidebar=new Yn({container:this.container.querySelector("#ts-sidebar-container"),configManager:this.configManager,stateManager:this.stateManager,onApiChange:r=>this.switchApi(r),onLoadData:()=>this.loadObject(),onTableChange:r=>this.switchTable(r),onExport:()=>this.exportCsv(),onReset:()=>this.reset(),onShowSchema:r=>this.showDatabaseSchema(r),onShowStats:r=>this.showColumnStatistics(r)}),this.sidebar.mount(),this.toolbar=new Jn({container:this.container.querySelector("#ts-toolbar-container"),onSearch:r=>{this.stateManager.update({searchValue:r,currentPage:0}),this.fetchData()},onRefresh:()=>this.softRefresh()}),this.toolbar.mount(),this.initKeyboardShortcuts();const e=this.toolbar.getSettingsButton();e&&e.addEventListener("click",r=>{r.stopPropagation();const d=this.container.querySelector("#ts-settings-popup");d==null||d.classList.toggle("show")});const t=this.container.querySelector("#ts-theme-toggle"),a=this.container.querySelectorAll(".ts-density-opt"),i=this.container.querySelector(".ts-app");t==null||t.addEventListener("click",()=>{this.toggleTheme(),t.classList.toggle("on",this.theme==="dark")}),a.forEach(r=>{r.addEventListener("click",()=>{this.density=r.dataset.density,i==null||i.setAttribute("data-density",this.density),a.forEach(d=>d.classList.remove("active")),r.classList.add("active"),localStorage.setItem("ts-density",this.density)})}),this.grid=new Zn({container:this.container.querySelector("#ts-grid-container"),stateManager:this.stateManager,onSort:(r,d)=>{this.stateManager.update({sortColumn:r,sortOrder:d,currentPage:0}),this.fetchData()},onFilter:async(r,d)=>{const u=this.stateManager.getState();if(!u.activeTableName)return;const{parseFilterInput:h,normalizeColumnType:l}=await je(async()=>{const{parseFilterInput:b,normalizeColumnType:S}=await import("./filter-parser-HXU3E1Qm.js");return{parseFilterInput:b,normalizeColumnType:S}},[]),y=l(this.getColumnType(u.activeTableName,r)),m=h(d,y);if(m&&d.trim()){const b=u.advancedFilters||[],S=b.findIndex(_=>_.column===r);S>=0?b[S]={column:r,operator:m.operator,value:m.value,value2:m.value2}:b.push({column:r,operator:m.operator,value:m.value,value2:m.value2});const $={...u.columnFilters};$[r]=d,this.stateManager.update({columnFilters:$,advancedFilters:b.length>0?b:void 0,currentPage:0})}else{const b={...u.columnFilters};delete b[r];const S=(u.advancedFilters||[]).filter($=>$.column!==r);this.stateManager.update({columnFilters:b,advancedFilters:S.length>0?S:void 0,currentPage:0})}this.fetchData()},getColumnType:r=>{const d=this.stateManager.getState();return d.activeTableName?this.getColumnType(d.activeTableName,r):"TEXT"},onRowSelect:()=>this.updateSelectionStatus()}),this.grid.mount()}initKeyboardShortcuts(){ti({onSearch:()=>this.toolbar.focusSearch(),onExport:()=>this.exportCsv(),onRefresh:()=>this.softRefresh(),onReset:()=>this.reset(),onSelectAll:()=>this.grid.selectAll(),onClearSelection:()=>this.grid.clearSelection(),onToggleTheme:()=>this.toggleTheme(),onShowSchema:()=>{const e=this.stateManager.getState();e.activeTableName&&this.showDatabaseSchema(e.activeTableName)},onNextPage:()=>this.nextPage(),onPrevPage:()=>this.prevPage(),onFirstPage:()=>this.goToPage(0),onLastPage:()=>{const e=this.stateManager.getState(),t=Math.ceil(e.totalCount/e.pageSize);this.goToPage(t-1)}})}async loadObject(){const e=this.sidebar.getToken(),t=this.sidebar.getBerdlId();if(!t||t.trim()===""){this.showAlert("Object ID or database name is required","danger");return}const a=t.trim();if(a==="test/test/test")this.switchApi("test_data");else{this.switchApi("default");const{LocalDbClient:i}=await je(async()=>{const{LocalDbClient:d}=await Promise.resolve().then(()=>ut);return{LocalDbClient:d}},void 0);if(!i.isLocalDb(a)&&!e){this.showAlert("Auth token required for remote databases","danger");return}}this.client.setToken(e||""),this.stateManager.update({berdlTableId:a,loading:!0,error:null});try{let i,r="",d=!1;try{i=await this.client.listTables(a)}catch(b){r=b.message||"Failed to load database";const{LocalDbClient:S}=await je(async()=>{const{LocalDbClient:_}=await Promise.resolve().then(()=>ut);return{LocalDbClient:_}},void 0),$=S.isLocalDb(a);if(!$&&a.startsWith("local/")){const _=a.replace("local/","");try{await this.loadDatabaseFromFile(_);return}catch(E){d=!0,r=`Remote API failed: ${b.message}. Local file also failed: ${E.message}`}}else if($){const _=a.replace("local/","");try{await this.loadDatabaseFromFile(_);return}catch(E){d=!0,r=`Failed to load local database: ${E.message}`}}throw new Error(r)}if(!i)throw new Error("No response from server");const u=i.tables||[];if(u.length===0){const b=`No tables found in database "${a}". The database may be empty or inaccessible.`;this.showAlert(b,"warning"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1}),this.sidebar.updateTables([]);return}const h=this.registry.detectDataType(i);h&&this.configManager.setCurrentDataType(h),this.stateManager.update({availableTables:u}),this.sidebar.updateTables(u);const l=this._initialTable,y=l&&u.find(b=>b.name===l)?l:u[0].name,m=d?`Loaded database "${a}" (using fallback method)`:`Loaded database "${a}" - ${u.length} table${u.length!==1?"s":""} found`;this.showAlert(m,"success"),await this.switchTable(y)}catch(i){let r=i.message||"Failed to load database";r.includes("404")||r.includes("Not Found")?r=`Database or object "${a}" not found. Please check the ID and try again.`:r.includes("401")||r.includes("Unauthorized")?r="Authentication failed. Please check your token and try again.":r.includes("403")||r.includes("Forbidden")?r=`Access denied to database "${a}". Please check your permissions.`:r.includes("Network")||r.includes("fetch")?r="Network error: Unable to connect to database service. Please check your connection and try again.":r.includes("Failed to load database")||(r=`Failed to load database "${a}": ${r}`),this.showAlert(r,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:r}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async switchTable(e){this.stateManager.update({activeTableName:e});const t=this.configManager.getTableConfig(e);this.categoryManager=new Xn(t),this.categoryManager.showAllCategories(),this.sidebar.setCategoryManager(this.categoryManager),this.sidebar.updateTableInfo(e),this.stateManager.update({currentPage:0,sortColumn:null,columnFilters:{},searchValue:"",data:[],headers:[],columns:[]}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.loadTableDependencies(e).then(()=>{const a=this.stateManager.getState();a.activeTableName===e&&this.stateManager.update({data:[...a.data]})}),await this.fetchData()}async loadTableDependencies(e){var i;const a=this.configManager.getTableConfig(e).columns||[];for(const r of a){if(!r.transform)continue;const d=Array.isArray(r.transform)?r.transform:[r.transform];for(const u of d)if(u.type==="ontology"&&((i=u.options)!=null&&i.lookupTable)){const h=u.options.lookupTable,l=u.options.lookupKey||"id",y=u.options.lookupValue||"name";try{const m=this.stateManager.getState();if(!m.berdlTableId)continue;const b=await this.client.getTableData({berdl_table_id:m.berdlTableId,table_name:h,limit:1e4,offset:0}),S={},$=b.headers,_=$.indexOf(l),E=$.indexOf(y);_!==-1&&E!==-1&&(b.data.forEach(R=>{const M=String(R[_]),P=String(R[E]);S[M]=P}),Me.preLoadOntology(S,u.options.ontologyType||"custom"))}catch(m){console.warn(`Failed to load dependency table ${h}`,m)}}}}async fetchData(){const e=this.stateManager.getState();if(!(!e.activeTableName||!e.berdlTableId)){this.stateManager.update({loading:!0});try{const t=await this.client.getTableData({berdl_table_id:e.berdlTableId,table_name:e.activeTableName,limit:e.pageSize,offset:e.currentPage*e.pageSize,search_value:e.searchValue||void 0,sort_column:e.sortColumn||void 0,sort_order:e.sortOrder==="asc"?"ASC":"DESC",col_filter:Object.keys(e.columnFilters).length?e.columnFilters:void 0,filters:e.advancedFilters,aggregations:e.aggregations,group_by:e.groupBy});this.processColumns(t.headers,e.activeTableName),t.column_schema&&t.column_schema.length>0&&e.activeTableName?(this.columnSchemas[e.activeTableName]||(this.columnSchemas[e.activeTableName]={}),t.column_schema.forEach(i=>{this.columnSchemas[e.activeTableName][i.name]={type:i.type,notnull:i.notnull,pk:i.pk}})):e.activeTableName&&await this.loadTableSchema(e.activeTableName);let a=(t.data||[]).map(i=>{const r={};return t.headers.forEach((d,u)=>{r[d]=i[u]}),r});e.sortColumn&&a.length>0&&(a=this.sortWithNullsLast(a,e.sortColumn,e.sortOrder||"asc")),this.updatePerformanceIndicator(t.cached,t.execution_time_ms),this.stateManager.update({headers:t.headers,data:a,totalCount:t.total_count||0,queryCached:t.cached||!1,queryTime:t.execution_time_ms})}catch(t){this.showAlert(t.message,"danger")}finally{this.stateManager.update({loading:!1})}}}processColumns(e,t){const i=this.configManager.getTableConfig(t).columns||[],r=[],d=new Set;i.forEach(h=>{r.push({...h,visible:h.visible!==!1,sortable:h.sortable!==!1,filterable:h.filterable!==!1,width:h.width||"auto",categories:h.categories||[]}),d.add(h.column)});const u=h=>{const l=h.toLowerCase(),y=[];return(l.match(/^(id|name|display_name|label)$/)||l.endsWith("_id")||l.endsWith("_name")||l.includes("locus")||l.includes("symbol")||l.includes("alias")||l.includes("contig"))&&y.push("core"),(l.includes("function")||l.includes("product")||l.includes("annotation")||l.includes("subsystem")||l.includes("class")||l.includes("reaction")||l.includes("ec")||l.includes("cog")||l.includes("pfam")||l.includes("tigrfam")||l.includes("go")||l.includes("kegg")||l.includes("note")||l.includes("inference")||l.includes("type"))&&y.push("functional"),(l.includes("uniprot")||l.includes("xref")||l.includes("reference")||l.includes("link")||l.includes("url")||l.includes("dbxref"))&&y.push("external"),(l.includes("sequence")||l.includes("start")||l.includes("stop")||l.includes("length")||l.includes("strand")||l.includes("protein_length")||l.includes("molecular_weight")||l.includes("isoelectric"))&&y.push("sequence"),(l.match(/^(deleted|row_hash|last_synced|created_at|updated_at|sync_.*)$/)||l.includes("hash")||l.includes("sync"))&&y.push("metadata"),(l.match(/^(error|status|report|message|valid|significance)$/)||l.includes("error")||l.includes("valid"))&&y.push("status"),y.length===0&&(l.match(/^[a-z_]*id$/i)||l.endsWith("_id")?y.push("core"):y.push("functional")),y};e.forEach(h=>{d.has(h)||r.push({column:h,displayName:h.replace(/_/g," "),visible:!0,sortable:!0,filterable:!0,width:"auto",categories:u(h)})}),this.stateManager.update({columns:r}),this.categoryManager&&(this.categoryManager.setColumns(r),this.stateManager.update({visibleColumns:this.categoryManager.getVisibleColumns()}))}async loadTableSchema(e){if(!(!e||this.columnSchemas[e]))try{const t=this.stateManager.getState();if(!t.berdlTableId)return;let a=[];try{const i="3000";if((await fetch(`http://localhost:${i}/health`,{signal:AbortSignal.timeout(500)})).ok){const d=t.berdlTableId.replace("local/",""),u=await fetch(`http://localhost:${i}/schema/${d}/tables/${e}`);u.ok&&(a=(await u.json()).columns||[])}}catch{}if(a.length===0)try{const{LocalDbClient:i}=await je(async()=>{const{LocalDbClient:d}=await Promise.resolve().then(()=>ut);return{LocalDbClient:d}},void 0);a=await i.getInstance().getTableSchema(e)}catch(i){console.warn("[TableRenderer] Failed to load schema:",i)}a.length>0&&(this.columnSchemas[e]={},a.forEach(i=>{this.columnSchemas[e][i.name]={type:i.type,notnull:i.notnull,pk:i.pk}}))}catch(t){console.warn("[TableRenderer] Error loading schema:",t)}}getColumnType(e,t){var a,i;return((i=(a=this.columnSchemas[e])==null?void 0:a[t])==null?void 0:i.type)||"TEXT"}switchApi(e){const t=this.configManager.getApi(e);t&&(this.client.updateConfig(t),this.reset())}softRefresh(){this.fetchData()}reset(){this.grid.clearFilterFocus(),this.stateManager.update({sortColumn:null,sortOrder:"asc",searchValue:"",columnFilters:{},currentPage:0}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.sidebar.renderFilterChips(),this.fetchData()}nextPage(){const e=this.stateManager.getState(),t=Math.ceil(e.totalCount/e.pageSize);e.currentPage<t-1&&this.goToPage(e.currentPage+1)}prevPage(){const e=this.stateManager.getState();e.currentPage>0&&this.goToPage(e.currentPage-1)}goToPage(e){e>=0&&(this.stateManager.update({currentPage:e}),this.fetchData())}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",localStorage.setItem("ts-theme",this.theme);const e=this.container.querySelector(".ts-app");e&&e.setAttribute("data-theme",this.theme)}async exportCsv(){const e=this.stateManager.getState();if(e.data.length===0)return;const t=this.grid.getSelection(),i=t.size>0?e.data.filter((r,d)=>t.has(d)):e.data;await ei.export(i,{format:"csv",filename:`export_${e.activeTableName||"data"}_${new Date().toISOString().split("T")[0]}`,columns:e.columns.filter(r=>e.visibleColumns.has(r.column)).map(r=>({key:r.column,header:r.displayName||r.column})),includeHeaders:!0})}onStateChange(e){this.updateStatusBar(e),this.updatePagination(e),this.updateLoadingOverlay(e),this.syncStateToUrl(),e.error&&this.showAlert(e.error,"danger")}updateLoadingOverlay(e){if(!this.dom.loadingOverlay)return;e.loading&&e.availableTables.length>0?this.dom.loadingOverlay.style.display="flex":this.dom.loadingOverlay.style.display="none"}updateStatusBar(e){var u,h;if(!this.dom.status)return;let t="";const a=[];if(e.queryCached&&a.push(" Cached"),e.queryTime!==void 0&&a.push(`${e.queryTime}ms`),e.totalCount>0){const l=e.currentPage*e.pageSize+1,y=Math.min((e.currentPage+1)*e.pageSize,e.totalCount),m=Math.ceil(e.totalCount/e.pageSize);t=`<div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-size:13px;font-weight:600;color:var(--c-text-primary)">Rows: <strong>${l.toLocaleString()}</strong>  <strong>${y.toLocaleString()}</strong> of <strong>${e.totalCount.toLocaleString()}</strong></div>
                <div style="font-size:11px;color:var(--c-text-muted);display:flex;gap:8px;align-items:center">
                    <span>Page ${e.currentPage+1} of ${m||1}</span>
                    ${a.length>0?`<span style="display:flex;align-items:center;gap:4px">${a.join("  ")}</span>`:""}
                </div>
            </div>`;const b=((h=(u=this.grid)==null?void 0:u.getSelection())==null?void 0:h.size)||0;b>0&&(t+=`<div style="margin-top:4px;font-size:11px"><span class="ts-selection-info">${b} row${b!==1?"s":""} selected</span></div>`)}else t='<div style="font-size:13px">Ready</div>';this.dom.status.innerHTML=t,this.dom.tableName&&(e.activeTableName?this.dom.tableName.innerHTML=`<span style="color:var(--c-text-muted);font-size:13px;font-weight:500">${e.activeTableName}</span>`:this.dom.tableName.innerHTML="");const i=this.container.querySelector("#ts-grid-header"),r=this.container.querySelector("#ts-db-name"),d=this.container.querySelector("#ts-active-table-name");i&&r&&d&&(e.activeTableName&&e.berdlTableId?(i.style.display="block",r.textContent=e.berdlTableId,d.textContent=e.activeTableName):i.style.display="none")}updateSelectionStatus(){const e=this.stateManager.getState();this.updateStatusBar(e)}updatePagination(e){if(!this.dom.pager)return;const t=Math.ceil(e.totalCount/e.pageSize),a=e.currentPage;this.dom.pager.innerHTML=`
            <button class="ts-page-btn" data-page="${a-1}" ${a<=0?"disabled":""}><i class="bi bi-chevron-left"></i></button>
            <span class="ts-page-info">${a+1} / ${t||1}</span>
            <button class="ts-page-btn" data-page="${a+1}" ${a>=t-1?"disabled":""}><i class="bi bi-chevron-right"></i></button>
        `,this.dom.pager.querySelectorAll(".ts-page-btn").forEach(i=>{i.addEventListener("click",()=>{const r=parseInt(i.dataset.page||"0");r>=0&&r<t&&this.goToPage(r)})})}syncStateToUrl(){const e=this.stateManager.getState(),t=new URLSearchParams;e.activeTableName&&t.set("table",e.activeTableName),e.sortColumn&&t.set("sort",`${e.sortColumn}:${e.sortOrder}`),e.currentPage>0&&t.set("page",String(e.currentPage+1));const a=t.toString()?`?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",a)}loadStateFromUrl(){const t=new URLSearchParams(window.location.search).get("table");t&&(this._initialTable=t)}async loadConfiguration(){const e="/config/index.json";try{const a=await fetch(e);if(a.ok){const i=await a.json();if(i.dataTypes){await this.registry.initialize(i),this.configManager=new Ps(i);return}}}catch{}let t={};if(this.configUrl)try{const a=await fetch(this.configUrl);a.ok&&(t=await a.json())}catch{}!Object.keys(t).length&&window.DEFAULT_CONFIG&&(t=window.DEFAULT_CONFIG),this.configManager=new Ps(t)}showAlert(e,t){if(this.dom.alert){const i=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),d=t==="danger"?8e3:e.length>100?6e3:4e3;this.dom.alert.innerHTML=`<div class="ts-alert ts-alert-${t}">${i}</div>`,setTimeout(()=>{this.dom.alert&&(this.dom.alert.innerHTML="")},d)}}showDatabaseSchema(e){const t=this.stateManager.getState(),a=t.availableTables||[];let i="",r=[],d=!1;const u=(E,R="")=>{const M=R.trim().length>0;return`
            <div class="glass-sidebar" style="width:260px;display:flex;flex-direction:column;">
                <div style="padding:16px;border-bottom:1px solid var(--c-border-subtle)">
                    <h3 style="font-size:11px;text-transform:uppercase;color:var(--c-text-muted);font-weight:700;letter-spacing:0.08em;display:flex;align-items:center;gap:8px;margin-bottom:12px">
                        <i class="bi bi-database" style="font-size:14px"></i> Database Schema
                    </h3>
                    <div style="position:relative;margin-bottom:8px">
                        <input type="text" id="ts-db-search" placeholder="Search tables, columns, data..." 
                            value="${R}"
                            style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:100%;outline:none;color:var(--c-text-primary);box-sizing:border-box">
                        <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted);pointer-events:none"></i>
                        ${M?'<button id="ts-db-search-clear" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--c-text-muted);cursor:pointer;padding:2px;font-size:14px"><i class="bi bi-x"></i></button>':""}
                    </div>
                    ${M?`
                        <div style="display:flex;gap:4px;margin-top:4px">
                            <button id="ts-search-data-btn" class="ts-btn-secondary" style="flex:1;height:28px;font-size:11px;padding:0 8px;${d?"opacity:0.6":""}" ${d?"disabled":""}>
                                <i class="bi bi-${d?"hourglass-split":"search"}"></i> ${d?"Searching...":"Search Data"}
                            </button>
                        </div>
                    `:""}
                </div>
                <div style="flex:1;overflow-y:auto;padding:12px">
                    ${M?`
                        <div style="margin-bottom:8px;padding:0 14px">
                            <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">
                                ${r.length>0?`Results (${r.length})`:"No Results"}
                            </span>
                        </div>
                        ${r.length>0?r.map(P=>{const W=P.columns.length+(P.hasDataMatches?1:0);return`
                                <div class="ts-nav-item ${E===P.table.name?"active":""}" 
                                     data-target="${P.table.name}" 
                                     data-search="${R}"
                                     style="cursor:pointer">
                                    <i class="bi bi-table"></i> 
                                    <div style="flex:1;min-width:0">
                                        <div style="font-weight:${E===P.table.name?"600":"500"}">${P.table.name}</div>
                                        <div style="font-size:10px;color:var(--c-text-muted);margin-top:2px">
                                            ${W} match${W!==1?"es":""}
                                            ${P.hasDataMatches?"  Has data matches":""}
                                        </div>
                                    </div>
                                </div>
                            `}).join(""):`
                            <div style="padding:24px;text-align:center;color:var(--c-text-muted)">
                                <i class="bi bi-search" style="font-size:24px;display:block;margin-bottom:8px;opacity:0.5"></i>
                                <div style="font-size:12px">No matches found</div>
                            </div>
                        `}
                    `:`
                        <div class="ts-nav-item ${E?"":"active"}" data-target="__overview__">
                            <i class="bi bi-grid-1x2"></i> Overview
                        </div>
                        <div style="margin-top:12px;margin-bottom:8px;padding:0 14px">
                            <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">Tables (${a.length})</span>
                        </div>
                        ${a.map(P=>`
                            <div class="ts-nav-item ${E===P.name?"active":""}" data-target="${P.name}">
                                <i class="bi bi-table"></i> 
                                <span style="flex:1">${P.name}</span>
                                <span style="font-size:11px;color:var(--c-text-muted)">${(P.row_count||0).toLocaleString()}</span>
                            </div>
                        `).join("")}
                    `}
                </div>
            </div>
        `},h=()=>{const E=a.length,R=a.reduce((M,P)=>M+(P.row_count||0),0);return i&&r.length>0?`
                    <div style="padding:40px;max-width:960px;margin:0 auto">
                        <div style="margin-bottom:32px">
                            <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">
                                Search Results for "${i}"
                            </h2>
                            <p style="color:var(--c-text-secondary);font-size:14px">Found ${r.length} table${r.length!==1?"s":""} with matches</p>
                        </div>

                        <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:16px">
                            ${r.map(M=>{const P=M.columns.length+(M.hasDataMatches?1:0);return`
                                    <div class="ts-card-nav" data-target="${M.table.name}" data-search="${i}" style="cursor:pointer">
                                        <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px">
                                            <i class="bi bi-table"></i>
                                        </div>
                                        <div style="flex:1">
                                            <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.table.name}</div>
                                            <div style="font-size:12px;color:var(--c-text-muted);margin-top:4px">
                                                ${P} match${P!==1?"es":""}
                                                ${M.hasDataMatches?"  Data matches":""}
                                                ${M.columns.length>0?`  ${M.columns.length} column${M.columns.length!==1?"s":""}`:""}
                                            </div>
                                            ${M.columns.length>0?`
                                                <div style="margin-top:8px;font-size:11px;color:var(--c-text-muted);max-height:60px;overflow-y:auto">
                                                    ${M.columns.slice(0,3).map(W=>`
                                                        <div style="padding:2px 0"> ${W.displayName||W.column}</div>
                                                    `).join("")}
                                                    ${M.columns.length>3?`<div style="padding:2px 0;font-style:italic">+ ${M.columns.length-3} more</div>`:""}
                                                </div>
                                            `:""}
                                        </div>
                                        <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                                    </div>
                                `}).join("")}
                        </div>
                    </div>
                `:`
                <div style="padding:48px;max-width:900px;margin:0 auto">
                    <div style="text-align:center;margin-bottom:48px">
                        <div style="width:80px;height:80px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 20px;box-shadow:0 8px 24px var(--c-accent-glow)">
                            <i class="bi bi-database"></i>
                        </div>
                        <h2 style="font-size:28px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">Database Overview</h2>
                        <p style="color:var(--c-text-secondary);font-size:14px">${t.berdlTableId||"Connected Database"}</p>
                    </div>

                    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:20px;margin-bottom:48px">
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Tables</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${E}</div>
                        </div>
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Records</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${R.toLocaleString()}</div>
                        </div>
                    </div>

                    <h3 style="font-size:12px;font-weight:700;margin-bottom:20px;color:var(--c-text-muted);text-transform:uppercase;letter-spacing:0.08em">Available Tables</h3>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px">
                        ${a.map(M=>`
                            <div class="ts-card-nav" data-target="${M.name}">
                                <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px"><i class="bi bi-table"></i></div>
                                <div style="flex:1">
                                    <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.name}</div>
                                    <div style="font-size:12px;color:var(--c-text-muted);margin-top:2px">${(M.row_count||0).toLocaleString()} records</div>
                                </div>
                                <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `},l=E=>{var H,B,X;const R=this.configManager.getTableConfig(E),M=t.activeTableName===E,P=M?t.columns:R.columns||[],W=(R==null?void 0:R.name)||E,K=((H=R==null?void 0:R.settings)==null?void 0:H.description)||"No description available for this table.";return`
                <div style="padding:40px;max-width:960px;margin:0 auto">
                    <div style="margin-bottom:36px">
                        <div style="display:flex;align-items:flex-start;gap:20px">
                            <div style="width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;box-shadow:0 4px 16px var(--c-accent-glow)">
                                <i class="${((B=R==null?void 0:R.settings)==null?void 0:B.icon)||"bi bi-table"}"></i>
                            </div>
                            <div style="flex:1">
                                <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin:0 0 8px 0">${W}</h2>
                                <div style="font-size:14px;color:var(--c-text-secondary);line-height:1.6;margin-bottom:16px;max-width:600px">
                                    ${K}
                                </div>
                                <div style="display:flex;gap:20px;font-size:13px;color:var(--c-text-muted)">
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-layout-three-columns"></i> ${P.length} Columns</span>
                                    ${M?`<span style="display:flex;align-items:center;gap:6px"><i class="bi bi-list-ol"></i> ${(X=t.totalCount)==null?void 0:X.toLocaleString()} Records</span>`:""}
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-${M?'check-circle-fill" style="color:var(--success)':"circle"}"></i> ${M?"Currently Loaded":"Not Loaded"}</span>
                                </div>
                            </div>
                            <button id="ts-export-current" class="ts-btn-secondary" data-table="${E}" style="height:40px;padding:0 20px">
                                <i class="bi bi-download"></i> Export Schema
                            </button>
                        </div>
                    </div>

                    <div class="glass-panel" style="overflow:hidden">
                        <div style="padding:14px 20px;border-bottom:1px solid var(--c-border-subtle);display:flex;justify-content:space-between;align-items:center;background:rgba(248,250,252,0.3)">
                            <h4 style="margin:0;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);display:flex;align-items:center;gap:8px">
                                <i class="bi bi-list-columns-reverse"></i> Schema Definition
                            </h4>
                            <div style="position:relative">
                                <input type="text" id="ts-schema-filter" placeholder="Search columns..." style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:220px;outline:none;color:var(--c-text-primary)">
                                <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted)"></i>
                            </div>
                        </div>
                        <div id="ts-schema-items-container" style="max-height:55vh;overflow-y:auto">
                            ${P.length===0?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-info-circle" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>No column information available. Load this table to see details.</div>':P.map(ee=>this.renderSchemaItem(ee)).join("")}
                        </div>
                    </div>
                </div>
             `},y=`
            <div style="display:flex;height:100%;overflow:hidden">
                <div id="ts-schema-sidebar">${u(e||null)}</div>
                <div id="ts-schema-main" style="flex:1;overflow-y:auto;background:var(--c-bg-app-solid);position:relative">
                    ${e?l(e):h()}
                </div>
            </div>
        `,m=this.createModal("Database Explorer",y),b=m.querySelector(".ts-modal-body");b&&(b.style.padding="0",b.style.height="calc(80vh - 60px)");const S=(E,R=i)=>{const M=m.querySelector("#ts-schema-sidebar"),P=m.querySelector("#ts-schema-main");M&&(M.innerHTML=u(E==="__overview__"?null:E,R)),P&&(P.innerHTML=E==="__overview__"?h():l(E),P.scrollTop=0),_()},$=async(E,R=!1)=>{if(i=E.trim(),r=[],!i){S("__overview__");return}const M=i.toLowerCase();for(const P of a){const W=P.name.toLowerCase().includes(M),K=this.configManager.getTableConfig(P.name),X=(t.activeTableName===P.name?t.columns:K.columns||[]).filter(ee=>{const A=(ee.displayName||ee.column||"").toLowerCase(),O=(ee.column||"").toLowerCase(),Y=(ee.description||"").toLowerCase();return A.includes(M)||O.includes(M)||Y.includes(M)});(W||X.length>0)&&r.push({table:P,columns:X,hasDataMatches:!1})}if(R&&t.berdlTableId){d=!0;const P=m.querySelector("#ts-schema-sidebar");P&&(P.innerHTML=u(null,i)),_();const W=a.map(async K=>{try{if((await this.client.getTableData({berdl_table_id:t.berdlTableId,table_name:K.name,limit:1,offset:0,search_value:i})).total_count>0){const B=r.find(X=>X.table.name===K.name);B?B.hasDataMatches=!0:r.push({table:K,columns:[],hasDataMatches:!0})}}catch(H){console.warn(`Failed to search data in table ${K.name}`,H)}});await Promise.all(W),d=!1}S("__overview__")},_=()=>{const E=m.querySelector("#ts-db-search"),R=m.querySelector("#ts-db-search-clear"),M=m.querySelector("#ts-search-data-btn");if(E){let H=null;E.addEventListener("input",()=>{const B=E.value;i=B,H&&clearTimeout(H),H=setTimeout(()=>{$(B,!1)},300)}),E.addEventListener("keypress",B=>{B.key==="Enter"&&(B.preventDefault(),H&&clearTimeout(H),$(E.value,!1))})}R&&R.addEventListener("click",()=>{E&&(E.value=""),i="",r=[],d=!1,S("__overview__","")}),M&&M.addEventListener("click",async()=>{!i||d||await $(i,!0)}),m.querySelectorAll(".ts-nav-item, .ts-card-nav").forEach(H=>{H.addEventListener("click",()=>{const B=H.dataset.target,X=H.dataset.search;if(B)if(B!=="__overview__"&&X){const ee=m.querySelector(".ts-modal-close");ee&&ee.click(),this.switchTable(B).then(()=>{this.stateManager.update({searchValue:X,currentPage:0}),this.fetchData()})}else S(B,X||i)})});const P=m.querySelector("#ts-schema-filter"),W=m.querySelector("#ts-schema-items-container");P&&W&&P.addEventListener("input",()=>{const H=P.value.toLowerCase();W.querySelectorAll(".ts-schema-item").forEach(B=>{const X=(B.textContent||"").toLowerCase();B.style.display=X.includes(H)?"flex":"none"})});const K=m.querySelector("#ts-export-current");K==null||K.addEventListener("click",()=>{const H=K.dataset.table;if(!H)return;const B=this.configManager.getTableConfig(H),X=t.activeTableName===H?t.columns:B.columns||[],ee=JSON.stringify(B||{tableName:H,columns:X},null,2),A=new Blob([ee],{type:"application/json"}),O=URL.createObjectURL(A),Y=document.createElement("a");Y.href=O,Y.download=`${H}_schema.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)})};_()}renderSchemaItem(e){const t=[];e.sortable&&t.push({l:"Sortable",bg:"#dbeafe",fg:"#1d4ed8"}),e.filterable&&t.push({l:"Filterable",bg:"#d1fae5",fg:"#059669"}),e.copyable&&t.push({l:"Copyable",bg:"#e2e8f0",fg:"#475569"}),e.pin&&t.push({l:"Pinned",bg:"#ede9fe",fg:"#7c3aed"});const a=t.map(i=>`<span style="font-size:10px;padding:3px 8px;border-radius:4px;background:${i.bg};color:${i.fg};margin-right:6px;font-weight:500">${i.l}</span>`).join("");return`
            <div class="ts-schema-item">
                <div style="padding-top:4px;flex-shrink:0"><i class="bi bi-hash" style="color:var(--c-accent);font-size:16px"></i></div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:12px">
                        <span class="ts-schema-name">${e.displayName||e.column}</span>
                        <span class="ts-schema-type">${e.dataType||"string"}</span>
                    </div>
                    ${e.description?`<div class="ts-schema-desc">${e.description}</div>`:""}
                    <div style="display:flex;align-items:center;margin-top:8px;flex-wrap:wrap;gap:4px">
                        ${a}
                        <span style="font-size:11px;color:var(--c-text-muted);font-family:'JetBrains Mono',monospace;margin-left:auto">col: ${e.column}</span>
                    </div>
                </div>
            </div>
        `}isValueEmpty(e){if(e==null)return!0;if(typeof e=="string"){const t=e.trim();if(t===""||t.length===0||t.toLowerCase()==="null"||t.toLowerCase()==="undefined"||t==="-")return!0}return!!(Array.isArray(e)&&e.length===0||typeof e=="number"&&isNaN(e)||typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0)}sortWithNullsLast(e,t,a){return!e||e.length===0||!t||!e.some(r=>t in r)?e:[...e].sort((r,d)=>{const u=r==null?void 0:r[t],h=d==null?void 0:d[t],l=this.isValueEmpty(u),y=this.isValueEmpty(h);if(l&&y)return 0;if(l)return 1;if(y)return-1;let m=0;if(typeof u==="number"&&typeof h==="number"){if(isNaN(u)&&isNaN(h))return 0;if(isNaN(u))return 1;if(isNaN(h))return-1;m=u-h}else if(u instanceof Date&&h instanceof Date)m=u.getTime()-h.getTime();else{const $=String(u??"").trim().toLowerCase(),_=String(h??"").trim().toLowerCase();$<_?m=-1:$>_?m=1:m=0}return a==="desc"?-m:m})}async loadDatabaseFromFile(e){try{if(this.stateManager.update({loading:!0,error:null}),!e||e.trim()==="")throw new Error("Database filename is required");const t=e.trim(),a=`/data/${t}.db`,i=`/config/${t}.json`;let r=null;try{const b=await fetch(i);b.ok&&(r=await b.json(),this.registry.registerDataType(r),this.configManager.setCurrentDataType(r.id||t))}catch{console.warn(`No config file found at ${i}, using default settings`)}const{LocalDbClient:d}=await je(async()=>{const{LocalDbClient:b}=await Promise.resolve().then(()=>ut);return{LocalDbClient:b}},void 0),u=d.getInstance(),h=`local/${t}`;try{await u.loadDatabase(a)}catch(b){throw b.message.includes("404")||b.message.includes("Failed to load database")?new Error(`Database file not found: ${a}. Please ensure the file exists in the /data/ directory.`):new Error(`Failed to load database file: ${b.message}`)}let l;try{l=await u.listTablesFromDb(a,r)}catch(b){throw new Error(`Failed to read database structure: ${b.message}`)}const y=l.tables||[];if(y.length===0)throw new Error(`Database "${t}" contains no tables. The database may be empty or corrupted.`);this.stateManager.update({availableTables:y,berdlTableId:h}),this.sidebar.updateTables(y);const m=y[0].name;await this.switchTable(m),this.showAlert(`Successfully loaded database "${t}" - ${y.length} table${y.length!==1?"s":""} found`,"success")}catch(t){let a=t.message||"Failed to load database";throw a.includes("not found")||a.includes("404")?a=`Database file not found: "${e}". Please check that the file exists at /data/${e}.db`:a.includes("No tables found")?a=`Database "${e}" contains no tables. The database may be empty or corrupted.`:a.includes("Failed to load")||(a=`Failed to load database "${e}": ${a}`),this.showAlert(a,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:a}),this.sidebar.updateTables([]),t}finally{this.stateManager.update({loading:!1})}}updatePerformanceIndicator(e,t){if(!this.dom.performance)return;const a=e!==void 0||t!==void 0;this.dom.performance&&(this.dom.performance.style.display=a?"flex":"none"),this.dom.perfCached&&(this.dom.perfCached.style.display=e?"inline-flex":"none"),this.dom.perfTime&&t!==void 0?(this.dom.perfTime.textContent=`${t}ms`,this.dom.perfTime.style.display="inline-flex"):this.dom.perfTime&&(this.dom.perfTime.style.display="none")}async showColumnStatistics(e){const t=this.stateManager.getState();if(!t.berdlTableId||!e){this.showAlert("No table selected","warning");return}try{this.stateManager.update({loading:!0});const a=t.berdlTableId.replace("local/",""),r=await fetch(`http://localhost:3000/object/${a}/tables/${e}/stats`);if(!r.ok)throw new Error("Failed to load statistics");const d=await r.json(),u=`
                <div style="padding:24px;max-width:800px">
                    <h2 style="margin-bottom:20px;font-size:18px;font-weight:600">
                        <i class="bi bi-graph-up"></i> Column Statistics: ${e}
                    </h2>
                    <div style="margin-bottom:16px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm);font-size:13px">
                        <strong>Total Rows:</strong> ${d.row_count.toLocaleString()}
                    </div>
                    <div style="display:grid;gap:12px">
                        ${d.columns.map(h=>`
                            <div style="padding:16px;background:var(--c-bg-surface);border:1px solid var(--c-border-subtle);border-radius:var(--radius-md)">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                    <h3 style="font-size:14px;font-weight:600">${h.column}</h3>
                                    <span style="font-size:11px;color:var(--c-text-muted);text-transform:uppercase">${h.type}</span>
                                </div>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px;font-size:12px">
                                    <div><strong>Nulls:</strong> ${h.null_count.toLocaleString()}</div>
                                    <div><strong>Distinct:</strong> ${h.distinct_count.toLocaleString()}</div>
                                    ${h.min!==void 0?`<div><strong>Min:</strong> ${h.min}</div>`:""}
                                    ${h.max!==void 0?`<div><strong>Max:</strong> ${h.max}</div>`:""}
                                    ${h.mean!==void 0?`<div><strong>Mean:</strong> ${h.mean.toFixed(2)}</div>`:""}
                                    ${h.median!==void 0?`<div><strong>Median:</strong> ${h.median}</div>`:""}
                                    ${h.stddev!==void 0?`<div><strong>StdDev:</strong> ${h.stddev.toFixed(2)}</div>`:""}
                                </div>
                                ${h.sample_values&&h.sample_values.length>0?`
                                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--c-border-subtle)">
                                        <div style="font-size:11px;color:var(--c-text-muted);margin-bottom:6px">Sample Values:</div>
                                        <div style="display:flex;flex-wrap:gap:4px">
                                            ${h.sample_values.slice(0,10).map(l=>`
                                                <span style="padding:2px 8px;background:var(--c-bg-surface-alt);border-radius:4px;font-size:11px;font-family:monospace">${String(l).substring(0,30)}</span>
                                            `).join("")}
                                        </div>
                                    </div>
                                `:""}
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;this.createModal(`Column Statistics: ${e}`,u)}catch(a){this.showAlert(`Failed to load statistics: ${a.message}`,"danger")}finally{this.stateManager.update({loading:!1})}}createModal(e,t){var d;const a=document.querySelector(".ts-modal-overlay");a&&a.remove();const i=document.createElement("div");i.className="ts-modal-overlay",i.innerHTML=`
            <div class="ts-modal">
                <div class="ts-modal-header">
                    <span class="ts-modal-title">${e}</span>
                    <button class="ts-modal-close"><i class="bi bi-x-lg"></i></button>
                </div>
                <div class="ts-modal-body">${t}</div>
            </div>
        `,document.body.appendChild(i),requestAnimationFrame(()=>i.classList.add("show"));const r=()=>{i.classList.remove("show"),setTimeout(()=>i.remove(),200)};return(d=i.querySelector(".ts-modal-close"))==null||d.addEventListener("click",r),i.addEventListener("click",u=>{u.target===i&&r()}),i}}document.addEventListener("DOMContentLoaded",async()=>{const k=document.querySelector("#app");if(k){const t=new URLSearchParams(window.location.search).get("db"),a=new si({container:k,configUrl:"genome-data.config.json"});if(await a.init(),t)try{await a.loadDatabaseFromFile(t)}catch(i){console.error("Failed to load database from URL parameter:",i),k.innerHTML=`
                    <div class="ts-alert ts-alert-danger">
                        <i class="bi bi-x-circle-fill"></i> 
                        Failed to load database: ${i.message}
                        <br><br>
                        <small>Usage: ?db=filename (without .db extension)</small>
                        <br>
                        <small>Database file should be at: /data/${t}.db</small>
                    </div>
                `}window.tableRenderer=a}else console.error("App container #app not found")});export{Ht as C};
