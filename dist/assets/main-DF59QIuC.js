var Pa=Object.defineProperty;var ja=(k,e,t)=>e in k?Pa(k,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[e]=t;var $=(k,e,t)=>ja(k,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const qa="modulepreload",za=function(k){return"/"+k},Is={},we=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let d=function(o){return Promise.all(o.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),u=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));n=d(t.map(o=>{if(o=za(o),o in Is)return;Is[o]=!0;const g=o.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${m}`))return;const w=document.createElement("link");if(w.rel=g?"stylesheet":qa,g||(w.as="script"),w.crossOrigin="",w.href=o,u&&w.setAttribute("nonce",u),document.head.appendChild(w),g)return new Promise((T,y)=>{w.addEventListener("load",T),w.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return n.then(d=>{for(const h of d||[])h.status==="rejected"&&r(h.reason);return e().catch(r)})};function Ua(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}function Ha(k){if(Object.prototype.hasOwnProperty.call(k,"__esModule"))return k;var e=k.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(k).forEach(function(i){var n=Object.getOwnPropertyDescriptor(k,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return k[i]}})}),t}var qt={exports:{}};const Ba={},Va=Object.freeze(Object.defineProperty({__proto__:null,default:Ba},Symbol.toStringTag,{value:"Module"})),Fs=Ha(Va);var Ps;function Ga(){return Ps||(Ps=1,(function(k,e){var t=void 0,i=function(n){return t||(t=new Promise(function(r,d){var h=typeof n<"u"?n:{},u=h.onAbort;h.onAbort=function(s){d(new Error(s)),u&&u(s)},h.postRun=h.postRun||[],h.postRun.push(function(){r(h)}),k=void 0;var o;o||(o=typeof h<"u"?h:{});var g=typeof window=="object",m=typeof WorkerGlobalScope<"u",w=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";o.onRuntimeInitialized=function(){function s(p,_){switch(typeof _){case"boolean":Ia(p,_?1:0);break;case"number":Na(p,_);break;case"string":Ra(p,_,-1,-1);break;case"object":if(_===null)As(p);else if(_.length!=null){var O=ct(_,lt);Oa(p,O,_.length,-1),dt(O)}else ut(p,"Wrong API use : tried to return a value of an unknown type ("+_+").",-1);break;default:As(p)}}function a(p,_){for(var O=[],q=0;q<p;q+=1){var U=be(_+4*q,"i32"),Y=ka(U);if(Y===1||Y===2)U=Aa(U);else if(Y===3)U=La(U);else if(Y===4){Y=U,U=Ma(Y),Y=Da(Y);for(var fe=new Uint8Array(U),ue=0;ue<U;ue+=1)fe[ue]=L[Y+ue];U=fe}else U=null;O.push(U)}return O}function l(p,_){this.Qa=p,this.db=_,this.Oa=1,this.lb=[]}function c(p,_){if(this.db=_,_=Ke(p)+1,this.eb=Ft(_),this.eb===null)throw Error("Unable to allocate memory for the SQL string");ye(p,R,this.eb,_),this.kb=this.eb,this.Za=this.pb=null}function f(p){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),p!=null){var _=this.filename,O="/",q=_;if(O&&(O=typeof O=="string"?O:Ct(O),q=_?St(O+"/"+_):O),_=is(!0,!0),q=na(q,_),p){if(typeof p=="string"){O=Array(p.length);for(var U=0,Y=p.length;U<Y;++U)O[U]=p.charCodeAt(U);p=O}nt(q,_|146),O=He(q,577),Ss(O,p,0,p.length,0),Dt(O),nt(q,_)}}this.handleError(F(this.filename,b)),this.db=be(b,"i32"),Rs(this.db),this.fb={},this.Sa={}}var b=Ce(4),S=o.cwrap,F=S("sqlite3_open","number",["string","number"]),G=S("sqlite3_close_v2","number",["number"]),V=S("sqlite3_exec","number",["number","string","number","number","number"]),te=S("sqlite3_changes","number",["number"]),le=S("sqlite3_prepare_v2","number",["number","string","number","number","number"]),_s=S("sqlite3_sql","string",["number"]),ua=S("sqlite3_normalized_sql","string",["number"]),ks=S("sqlite3_prepare_v2","number",["number","number","number","number","number"]),ha=S("sqlite3_bind_text","number",["number","number","number","number","number"]),Ms=S("sqlite3_bind_blob","number",["number","number","number","number","number"]),fa=S("sqlite3_bind_double","number",["number","number","number"]),ma=S("sqlite3_bind_int","number",["number","number","number"]),ga=S("sqlite3_bind_parameter_index","number",["number","string"]),pa=S("sqlite3_step","number",["number"]),ba=S("sqlite3_errmsg","string",["number"]),ya=S("sqlite3_column_count","number",["number"]),va=S("sqlite3_data_count","number",["number"]),wa=S("sqlite3_column_double","number",["number","number"]),Ls=S("sqlite3_column_text","string",["number","number"]),xa=S("sqlite3_column_blob","number",["number","number"]),Sa=S("sqlite3_column_bytes","number",["number","number"]),Ta=S("sqlite3_column_type","number",["number","number"]),$a=S("sqlite3_column_name","string",["number","number"]),Ca=S("sqlite3_reset","number",["number"]),Ea=S("sqlite3_clear_bindings","number",["number"]),_a=S("sqlite3_finalize","number",["number"]),Ds=S("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),ka=S("sqlite3_value_type","number",["number"]),Ma=S("sqlite3_value_bytes","number",["number"]),La=S("sqlite3_value_text","string",["number"]),Da=S("sqlite3_value_blob","number",["number"]),Aa=S("sqlite3_value_double","number",["number"]),Na=S("sqlite3_result_double","",["number","number"]),As=S("sqlite3_result_null","",["number"]),Ra=S("sqlite3_result_text","",["number","string","number","number"]),Oa=S("sqlite3_result_blob","",["number","number","number","number"]),Ia=S("sqlite3_result_int","",["number","number"]),ut=S("sqlite3_result_error","",["number","string","number"]),Ns=S("sqlite3_aggregate_context","number",["number","number"]),Rs=S("RegisterExtensionFunctions","number",["number"]),Os=S("sqlite3_update_hook","number",["number","number","number"]);l.prototype.bind=function(p){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(p)?this.Cb(p):p!=null&&typeof p=="object"?this.Db(p):!0},l.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var p=pa(this.Qa);switch(p){case 100:return!0;case 101:return!1;default:throw this.db.handleError(p)}},l.prototype.wb=function(p){return p==null&&(p=this.Oa,this.Oa+=1),wa(this.Qa,p)},l.prototype.Gb=function(p){if(p==null&&(p=this.Oa,this.Oa+=1),p=Ls(this.Qa,p),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(p)},l.prototype.Hb=function(p){return p==null&&(p=this.Oa,this.Oa+=1),Ls(this.Qa,p)},l.prototype.getBlob=function(p){p==null&&(p=this.Oa,this.Oa+=1);var _=Sa(this.Qa,p);p=xa(this.Qa,p);for(var O=new Uint8Array(_),q=0;q<_;q+=1)O[q]=L[p+q];return O},l.prototype.get=function(p,_){_=_||{},p!=null&&this.bind(p)&&this.step(),p=[];for(var O=va(this.Qa),q=0;q<O;q+=1)switch(Ta(this.Qa,q)){case 1:var U=_.useBigInt?this.Gb(q):this.wb(q);p.push(U);break;case 2:p.push(this.wb(q));break;case 3:p.push(this.Hb(q));break;case 4:p.push(this.getBlob(q));break;default:p.push(null)}return p},l.prototype.getColumnNames=function(){for(var p=[],_=ya(this.Qa),O=0;O<_;O+=1)p.push($a(this.Qa,O));return p},l.prototype.getAsObject=function(p,_){p=this.get(p,_),_=this.getColumnNames();for(var O={},q=0;q<_.length;q+=1)O[_[q]]=p[q];return O},l.prototype.getSQL=function(){return _s(this.Qa)},l.prototype.getNormalizedSQL=function(){return ua(this.Qa)},l.prototype.run=function(p){return p!=null&&this.bind(p),this.step(),this.reset()},l.prototype.sb=function(p,_){_==null&&(_=this.Oa,this.Oa+=1),p=ss(p);var O=ct(p,lt);this.lb.push(O),this.db.handleError(ha(this.Qa,_,O,p.length-1,0))},l.prototype.Bb=function(p,_){_==null&&(_=this.Oa,this.Oa+=1);var O=ct(p,lt);this.lb.push(O),this.db.handleError(Ms(this.Qa,_,O,p.length,0))},l.prototype.rb=function(p,_){_==null&&(_=this.Oa,this.Oa+=1),this.db.handleError((p===(p|0)?ma:fa)(this.Qa,_,p))},l.prototype.Eb=function(p){p==null&&(p=this.Oa,this.Oa+=1),Ms(this.Qa,p,0,0,0)},l.prototype.tb=function(p,_){switch(_==null&&(_=this.Oa,this.Oa+=1),typeof p){case"string":this.sb(p,_);return;case"number":this.rb(p,_);return;case"bigint":this.sb(p.toString(),_);return;case"boolean":this.rb(p+0,_);return;case"object":if(p===null){this.Eb(_);return}if(p.length!=null){this.Bb(p,_);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+p+")."},l.prototype.Db=function(p){var _=this;return Object.keys(p).forEach(function(O){var q=ga(_.Qa,O);q!==0&&_.tb(p[O],q)}),!0},l.prototype.Cb=function(p){for(var _=0;_<p.length;_+=1)this.tb(p[_],_+1);return!0},l.prototype.reset=function(){return this.freemem(),Ea(this.Qa)===0&&Ca(this.Qa)===0},l.prototype.freemem=function(){for(var p;(p=this.lb.pop())!==void 0;)dt(p)},l.prototype.free=function(){this.freemem();var p=_a(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,p},c.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var p=Ze(),_=Ce(4);We(b),We(_);try{this.db.handleError(ks(this.db.db,this.kb,-1,b,_)),this.kb=be(_,"i32");var O=be(b,"i32");return O===0?(this.mb(),{done:!0}):(this.Za=new l(O,this.db),this.db.fb[O]=this.Za,{value:this.Za,done:!1})}catch(q){throw this.pb=xt(this.kb),this.mb(),q}finally{Je(p)}},c.prototype.mb=function(){dt(this.eb),this.eb=null},c.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:xt(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(c.prototype[Symbol.iterator]=function(){return this}),f.prototype.run=function(p,_){if(!this.db)throw"Database closed";if(_){p=this.prepare(p,_);try{p.step()}finally{p.free()}}else this.handleError(V(this.db,p,0,0,b));return this},f.prototype.exec=function(p,_,O){if(!this.db)throw"Database closed";var q=Ze(),U=null;try{var Y=Ot(p),fe=Ce(4);for(p=[];be(Y,"i8")!==0;){We(b),We(fe),this.handleError(ks(this.db,Y,-1,b,fe));var ue=be(b,"i32");if(Y=be(fe,"i32"),ue!==0){var ce=null;for(U=new l(ue,this),_!=null&&U.bind(_);U.step();)ce===null&&(ce={columns:U.getColumnNames(),values:[]},p.push(ce)),ce.values.push(U.get(null,O));U.free()}}return p}catch(me){throw U&&U.free(),me}finally{Je(q)}},f.prototype.each=function(p,_,O,q,U){typeof _=="function"&&(q=O,O=_,_=void 0),p=this.prepare(p,_);try{for(;p.step();)O(p.getAsObject(null,U))}finally{p.free()}if(typeof q=="function")return q()},f.prototype.prepare=function(p,_){if(We(b),this.handleError(le(this.db,p,-1,b,0)),p=be(b,"i32"),p===0)throw"Nothing to prepare";var O=new l(p,this);return _!=null&&O.bind(_),this.fb[p]=O},f.prototype.iterateStatements=function(p){return new c(p,this)},f.prototype.export=function(){Object.values(this.fb).forEach(function(_){_.free()}),Object.values(this.Sa).forEach($e),this.Sa={},this.handleError(G(this.db));var p=ia(this.filename);return this.handleError(F(this.filename,b)),this.db=be(b,"i32"),Rs(this.db),p},f.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(p){p.free()}),Object.values(this.Sa).forEach($e),this.Sa={},this.Ya&&($e(this.Ya),this.Ya=void 0),this.handleError(G(this.db)),bs("/"+this.filename),this.db=null)},f.prototype.handleError=function(p){if(p===0)return null;throw p=ba(this.db),Error(p)},f.prototype.getRowsModified=function(){return te(this.db)},f.prototype.create_function=function(p,_){Object.prototype.hasOwnProperty.call(this.Sa,p)&&($e(this.Sa[p]),delete this.Sa[p]);var O=Ye(function(q,U,Y){U=a(U,Y);try{var fe=_.apply(null,U)}catch(ue){ut(q,ue,-1);return}s(q,fe)},"viii");return this.Sa[p]=O,this.handleError(Ds(this.db,p,_.length,1,0,O,0,0,0)),this},f.prototype.create_aggregate=function(p,_){var O=_.init||function(){return null},q=_.finalize||function(ce){return ce},U=_.step;if(!U)throw"An aggregate function must have a step function in "+p;var Y={};Object.hasOwnProperty.call(this.Sa,p)&&($e(this.Sa[p]),delete this.Sa[p]),_=p+"__finalize",Object.hasOwnProperty.call(this.Sa,_)&&($e(this.Sa[_]),delete this.Sa[_]);var fe=Ye(function(ce,me,jt){var Re=Ns(ce,1);Object.hasOwnProperty.call(Y,Re)||(Y[Re]=O()),me=a(me,jt),me=[Y[Re]].concat(me);try{Y[Re]=U.apply(null,me)}catch(Fa){delete Y[Re],ut(ce,Fa,-1)}},"viii"),ue=Ye(function(ce){var me=Ns(ce,1);try{var jt=q(Y[me])}catch(Re){delete Y[me],ut(ce,Re,-1);return}s(ce,jt),delete Y[me]},"vi");return this.Sa[p]=fe,this.Sa[_]=ue,this.handleError(Ds(this.db,p,U.length-1,1,0,0,fe,ue,0)),this},f.prototype.updateHook=function(p){this.Ya&&(Os(this.db,0,0),$e(this.Ya),this.Ya=void 0),p&&(this.Ya=Ye(function(_,O,q,U,Y){switch(O){case 18:_="insert";break;case 23:_="update";break;case 9:_="delete";break;default:throw"unknown operationCode in updateHook callback: "+O}if(q=q?ee(R,q):"",U=U?ee(R,U):"",Y>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";p(_,q,U,Number(Y))},"viiiij"),Os(this.db,this.Ya,0))},o.Database=f};var T={...o},y="./this.program",x=(s,a)=>{throw a},v="",E,M;if(w){var N=Fs;v=__dirname+"/",M=s=>(s=ne(s)?new URL(s):s,N.readFileSync(s)),E=async s=>(s=ne(s)?new URL(s):s,N.readFileSync(s,void 0)),!o.thisProgram&&1<process.argv.length&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),k.exports=o,x=(s,a)=>{throw process.exitCode=s,a}}else(g||m)&&(m?v=self.location.href:typeof document<"u"&&document.currentScript&&(v=document.currentScript.src),v=v.startsWith("blob:")?"":v.slice(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1),m&&(M=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),E=async s=>{if(ne(s))return new Promise((l,c)=>{var f=new XMLHttpRequest;f.open("GET",s,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?l(f.response):c(f.status)},f.onerror=c,f.send(null)});var a=await fetch(s,{credentials:"same-origin"});if(a.ok)return a.arrayBuffer();throw Error(a.status+" : "+a.url)});var z=o.print||console.log.bind(console),D=o.printErr||console.error.bind(console);Object.assign(o,T),T=null,o.thisProgram&&(y=o.thisProgram);var j=o.wasmBinary,I,W=!1,J,L,R,ae,Q,X,xe,B,se,ne=s=>s.startsWith("file://");function ie(){var s=I.buffer;o.HEAP8=L=new Int8Array(s),o.HEAP16=ae=new Int16Array(s),o.HEAPU8=R=new Uint8Array(s),o.HEAPU16=new Uint16Array(s),o.HEAP32=Q=new Int32Array(s),o.HEAPU32=X=new Uint32Array(s),o.HEAPF32=xe=new Float32Array(s),o.HEAPF64=se=new Float64Array(s),o.HEAP64=B=new BigInt64Array(s),o.HEAPU64=new BigUint64Array(s)}var ge=0,Le=null;function qe(s){var a;throw(a=o.onAbort)==null||a.call(o,s),s="Aborted("+s+")",D(s),W=!0,new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info.")}var yt;async function Bs(s){if(!j)try{var a=await E(s);return new Uint8Array(a)}catch{}if(s==yt&&j)s=new Uint8Array(j);else if(M)s=M(s);else throw"both async and sync fetching of the wasm failed";return s}async function Vs(s,a){try{var l=await Bs(s);return await WebAssembly.instantiate(l,a)}catch(c){D(`failed to asynchronously prepare wasm: ${c}`),qe(c)}}async function Gs(s){var a=yt;if(!j&&typeof WebAssembly.instantiateStreaming=="function"&&!ne(a)&&!w)try{var l=fetch(a,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(l,s)}catch(c){D(`wasm streaming compile failed: ${c}`),D("falling back to ArrayBuffer instantiation")}return Vs(a,s)}class vt{constructor(a){$(this,"name","ExitStatus");this.message=`Program terminated with exit(${a})`,this.status=a}}var Qt=s=>{for(;0<s.length;)s.shift()(o)},Xt=[],Yt=[],Ws=()=>{var s=o.preRun.shift();Yt.unshift(s)};function be(s,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":return L[s];case"i8":return L[s];case"i16":return ae[s>>1];case"i32":return Q[s>>2];case"i64":return B[s>>3];case"float":return xe[s>>2];case"double":return se[s>>3];case"*":return X[s>>2];default:qe(`invalid type for getValue: ${a}`)}}var wt=o.noExitRuntime||!0;function We(s){var a="i32";switch(a.endsWith("*")&&(a="*"),a){case"i1":L[s]=0;break;case"i8":L[s]=0;break;case"i16":ae[s>>1]=0;break;case"i32":Q[s>>2]=0;break;case"i64":B[s>>3]=BigInt(0);break;case"float":xe[s>>2]=0;break;case"double":se[s>>3]=0;break;case"*":X[s>>2]=0;break;default:qe(`invalid type for setValue: ${a}`)}}var Jt=typeof TextDecoder<"u"?new TextDecoder:void 0,ee=(s,a=0,l=NaN)=>{var c=a+l;for(l=a;s[l]&&!(l>=c);)++l;if(16<l-a&&s.buffer&&Jt)return Jt.decode(s.subarray(a,l));for(c="";a<l;){var f=s[a++];if(f&128){var b=s[a++]&63;if((f&224)==192)c+=String.fromCharCode((f&31)<<6|b);else{var S=s[a++]&63;f=(f&240)==224?(f&15)<<12|b<<6|S:(f&7)<<18|b<<12|S<<6|s[a++]&63,65536>f?c+=String.fromCharCode(f):(f-=65536,c+=String.fromCharCode(55296|f>>10,56320|f&1023))}}else c+=String.fromCharCode(f)}return c},xt=(s,a)=>s?ee(R,s,a):"",Zt=(s,a)=>{for(var l=0,c=s.length-1;0<=c;c--){var f=s[c];f==="."?s.splice(c,1):f===".."?(s.splice(c,1),l++):l&&(s.splice(c,1),l--)}if(a)for(;l;l--)s.unshift("..");return s},St=s=>{var a=s.charAt(0)==="/",l=s.slice(-1)==="/";return(s=Zt(s.split("/").filter(c=>!!c),!a).join("/"))||a||(s="."),s&&l&&(s+="/"),(a?"/":"")+s},es=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.slice(0,-1)),s+a)},et=s=>s&&s.match(/([^\/]+|\/)\/*$/)[1],Ks=()=>{if(w){var s=Fs;return a=>s.randomFillSync(a)}return a=>crypto.getRandomValues(a)},ts=s=>{(ts=Ks())(s)},Qs=(...s)=>{for(var a="",l=!1,c=s.length-1;-1<=c&&!l;c--){if(l=0<=c?s[c]:"/",typeof l!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!l)return"";a=l+"/"+a,l=l.charAt(0)==="/"}return a=Zt(a.split("/").filter(f=>!!f),!l).join("/"),(l?"/":"")+a||"."},Tt=[],Ke=s=>{for(var a=0,l=0;l<s.length;++l){var c=s.charCodeAt(l);127>=c?a++:2047>=c?a+=2:55296<=c&&57343>=c?(a+=4,++l):a+=3}return a},ye=(s,a,l,c)=>{if(!(0<c))return 0;var f=l;c=l+c-1;for(var b=0;b<s.length;++b){var S=s.charCodeAt(b);if(55296<=S&&57343>=S){var F=s.charCodeAt(++b);S=65536+((S&1023)<<10)|F&1023}if(127>=S){if(l>=c)break;a[l++]=S}else{if(2047>=S){if(l+1>=c)break;a[l++]=192|S>>6}else{if(65535>=S){if(l+2>=c)break;a[l++]=224|S>>12}else{if(l+3>=c)break;a[l++]=240|S>>18,a[l++]=128|S>>12&63}a[l++]=128|S>>6&63}a[l++]=128|S&63}}return a[l]=0,l-f},ss=(s,a)=>{var l=Array(Ke(s)+1);return s=ye(s,l,0,l.length),a&&(l.length=s),l},as=[];function ns(s,a){as[s]={input:[],output:[],cb:a},Mt(s,Xs)}var Xs={open(s){var a=as[s.node.rdev];if(!a)throw new A(43);s.tty=a,s.seekable=!1},close(s){s.tty.cb.fsync(s.tty)},fsync(s){s.tty.cb.fsync(s.tty)},read(s,a,l,c){if(!s.tty||!s.tty.cb.xb)throw new A(60);for(var f=0,b=0;b<c;b++){try{var S=s.tty.cb.xb(s.tty)}catch{throw new A(29)}if(S===void 0&&f===0)throw new A(6);if(S==null)break;f++,a[l+b]=S}return f&&(s.node.atime=Date.now()),f},write(s,a,l,c){if(!s.tty||!s.tty.cb.qb)throw new A(60);try{for(var f=0;f<c;f++)s.tty.cb.qb(s.tty,a[l+f])}catch{throw new A(29)}return c&&(s.node.mtime=s.node.ctime=Date.now()),f}},Ys={xb(){e:{if(!Tt.length){var s=null;if(w){var a=Buffer.alloc(256),l=0,c=process.stdin.fd;try{l=N.readSync(c,a,0,256)}catch(f){if(f.toString().includes("EOF"))l=0;else throw f}0<l&&(s=a.slice(0,l).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(s=window.prompt("Input: "),s!==null&&(s+=`
`));if(!s){s=null;break e}Tt=ss(s,!0)}s=Tt.shift()}return s},qb(s,a){a===null||a===10?(z(ee(s.output)),s.output=[]):a!=0&&s.output.push(a)},fsync(s){var a;0<((a=s.output)==null?void 0:a.length)&&(z(ee(s.output)),s.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},Js={qb(s,a){a===null||a===10?(D(ee(s.output)),s.output=[]):a!=0&&s.output.push(a)},fsync(s){var a;0<((a=s.output)==null?void 0:a.length)&&(D(ee(s.output)),s.output=[])}},H={Wa:null,Xa(){return H.createNode(null,"/",16895,0)},createNode(s,a,l,c){if((l&61440)===24576||(l&61440)===4096)throw new A(63);return H.Wa||(H.Wa={dir:{node:{Ta:H.La.Ta,Ua:H.La.Ua,lookup:H.La.lookup,hb:H.La.hb,rename:H.La.rename,unlink:H.La.unlink,rmdir:H.La.rmdir,readdir:H.La.readdir,symlink:H.La.symlink},stream:{Va:H.Ma.Va}},file:{node:{Ta:H.La.Ta,Ua:H.La.Ua},stream:{Va:H.Ma.Va,read:H.Ma.read,write:H.Ma.write,ib:H.Ma.ib,jb:H.Ma.jb}},link:{node:{Ta:H.La.Ta,Ua:H.La.Ua,readlink:H.La.readlink},stream:{}},ub:{node:{Ta:H.La.Ta,Ua:H.La.Ua},stream:aa}}),l=ds(s,a,l,c),oe(l.mode)?(l.La=H.Wa.dir.node,l.Ma=H.Wa.dir.stream,l.Na={}):(l.mode&61440)===32768?(l.La=H.Wa.file.node,l.Ma=H.Wa.file.stream,l.Ra=0,l.Na=null):(l.mode&61440)===40960?(l.La=H.Wa.link.node,l.Ma=H.Wa.link.stream):(l.mode&61440)===8192&&(l.La=H.Wa.ub.node,l.Ma=H.Wa.ub.stream),l.atime=l.mtime=l.ctime=Date.now(),s&&(s.Na[a]=l,s.atime=s.mtime=s.ctime=l.atime),l},Sb(s){return s.Na?s.Na.subarray?s.Na.subarray(0,s.Ra):new Uint8Array(s.Na):new Uint8Array(0)},La:{Ta(s){var a={};return a.dev=(s.mode&61440)===8192?s.id:1,a.ino=s.id,a.mode=s.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=s.rdev,oe(s.mode)?a.size=4096:(s.mode&61440)===32768?a.size=s.Ra:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.atime=new Date(s.atime),a.mtime=new Date(s.mtime),a.ctime=new Date(s.ctime),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},Ua(s,a){for(var l of["mode","atime","mtime","ctime"])a[l]!=null&&(s[l]=a[l]);a.size!==void 0&&(a=a.size,s.Ra!=a&&(a==0?(s.Na=null,s.Ra=0):(l=s.Na,s.Na=new Uint8Array(a),l&&s.Na.set(l.subarray(0,Math.min(a,s.Ra))),s.Ra=a)))},lookup(){throw H.vb},hb(s,a,l,c){return H.createNode(s,a,l,c)},rename(s,a,l){try{var c=De(a,l)}catch{}if(c){if(oe(s.mode))for(var f in c.Na)throw new A(55);_t(c)}delete s.parent.Na[s.name],a.Na[l]=s,s.name=l,a.ctime=a.mtime=s.parent.ctime=s.parent.mtime=Date.now()},unlink(s,a){delete s.Na[a],s.ctime=s.mtime=Date.now()},rmdir(s,a){var l=De(s,a),c;for(c in l.Na)throw new A(55);delete s.Na[a],s.ctime=s.mtime=Date.now()},readdir(s){return[".","..",...Object.keys(s.Na)]},symlink(s,a,l){return s=H.createNode(s,a,41471,0),s.link=l,s},readlink(s){if((s.mode&61440)!==40960)throw new A(28);return s.link}},Ma:{read(s,a,l,c,f){var b=s.node.Na;if(f>=s.node.Ra)return 0;if(s=Math.min(s.node.Ra-f,c),8<s&&b.subarray)a.set(b.subarray(f,f+s),l);else for(c=0;c<s;c++)a[l+c]=b[f+c];return s},write(s,a,l,c,f,b){if(a.buffer===L.buffer&&(b=!1),!c)return 0;if(s=s.node,s.mtime=s.ctime=Date.now(),a.subarray&&(!s.Na||s.Na.subarray)){if(b)return s.Na=a.subarray(l,l+c),s.Ra=c;if(s.Ra===0&&f===0)return s.Na=a.slice(l,l+c),s.Ra=c;if(f+c<=s.Ra)return s.Na.set(a.subarray(l,l+c),f),c}b=f+c;var S=s.Na?s.Na.length:0;if(S>=b||(b=Math.max(b,S*(1048576>S?2:1.125)>>>0),S!=0&&(b=Math.max(b,256)),S=s.Na,s.Na=new Uint8Array(b),0<s.Ra&&s.Na.set(S.subarray(0,s.Ra),0)),s.Na.subarray&&a.subarray)s.Na.set(a.subarray(l,l+c),f);else for(b=0;b<c;b++)s.Na[f+b]=a[l+b];return s.Ra=Math.max(s.Ra,f+c),c},Va(s,a,l){if(l===1?a+=s.position:l===2&&(s.node.mode&61440)===32768&&(a+=s.node.Ra),0>a)throw new A(28);return a},ib(s,a,l,c,f){if((s.node.mode&61440)!==32768)throw new A(43);if(s=s.node.Na,f&2||!s||s.buffer!==L.buffer){f=!0,c=65536*Math.ceil(a/65536);var b=Cs(65536,c);if(b&&R.fill(0,b,b+c),c=b,!c)throw new A(48);s&&((0<l||l+a<s.length)&&(s.subarray?s=s.subarray(l,l+a):s=Array.prototype.slice.call(s,l,l+a)),L.set(s,c))}else f=!1,c=s.byteOffset;return{Kb:c,Ab:f}},jb(s,a,l,c){return H.Ma.write(s,a,0,c,l,!1),0}}},is=(s,a)=>{var l=0;return s&&(l|=365),a&&(l|=146),l},$t=null,rs={},ze=[],Zs=1,Se=null,os=!1,ls=!0,cs={},A=class{constructor(s){$(this,"name","ErrnoError");this.Pa=s}},ea=class{constructor(){$(this,"gb",{});$(this,"node",null)}get flags(){return this.gb.flags}set flags(s){this.gb.flags=s}get position(){return this.gb.position}set position(s){this.gb.position=s}},ta=class{constructor(s,a,l,c){$(this,"La",{});$(this,"Ma",{});$(this,"ab",null);s||(s=this),this.parent=s,this.Xa=s.Xa,this.id=Zs++,this.name=a,this.mode=l,this.rdev=c,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(s){s?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(s){s?this.mode|=146:this.mode&=-147}};function de(s,a={}){if(!s)throw new A(44);a.nb??(a.nb=!0),s.charAt(0)==="/"||(s="//"+s);var l=0;e:for(;40>l;l++){s=s.split("/").filter(F=>!!F);for(var c=$t,f="/",b=0;b<s.length;b++){var S=b===s.length-1;if(S&&a.parent)break;if(s[b]!==".")if(s[b]==="..")f=es(f),c=c.parent;else{f=St(f+"/"+s[b]);try{c=De(c,s[b])}catch(F){if((F==null?void 0:F.Pa)===44&&S&&a.Jb)return{path:f};throw F}if(!c.ab||S&&!a.nb||(c=c.ab.root),(c.mode&61440)===40960&&(!S||a.$a)){if(!c.La.readlink)throw new A(52);c=c.La.readlink(c),c.charAt(0)==="/"||(c=es(f)+"/"+c),s=c+"/"+s.slice(b+1).join("/");continue e}}}return{path:f,node:c}}throw new A(32)}function Ct(s){for(var a;;){if(s===s.parent)return s=s.Xa.zb,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}}function Et(s,a){for(var l=0,c=0;c<a.length;c++)l=(l<<5)-l+a.charCodeAt(c)|0;return(s+l>>>0)%Se.length}function _t(s){var a=Et(s.parent.id,s.name);if(Se[a]===s)Se[a]=s.bb;else for(a=Se[a];a;){if(a.bb===s){a.bb=s.bb;break}a=a.bb}}function De(s,a){var l=oe(s.mode)?(l=Ue(s,"x"))?l:s.La.lookup?0:2:54;if(l)throw new A(l);for(l=Se[Et(s.id,a)];l;l=l.bb){var c=l.name;if(l.parent.id===s.id&&c===a)return l}return s.La.lookup(s,a)}function ds(s,a,l,c){return s=new ta(s,a,l,c),a=Et(s.parent.id,s.name),s.bb=Se[a],Se[a]=s}function oe(s){return(s&61440)===16384}function us(s){var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a}function Ue(s,a){if(ls)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function hs(s,a){if(!oe(s.mode))return 54;try{return De(s,a),20}catch{}return Ue(s,"wx")}function fs(s,a,l){try{var c=De(s,a)}catch(f){return f.Pa}if(s=Ue(s,"wx"))return s;if(l){if(!oe(c.mode))return 54;if(c===c.parent||Ct(c)==="/")return 10}else if(oe(c.mode))return 31;return 0}function tt(s){if(!s)throw new A(63);return s}function re(s){if(s=ze[s],!s)throw new A(8);return s}function ms(s,a=-1){if(s=Object.assign(new ea,s),a==-1)e:{for(a=0;4096>=a;a++)if(!ze[a])break e;throw new A(33)}return s.fd=a,ze[a]=s}function sa(s,a=-1){var l,c;return s=ms(s,a),(c=(l=s.Ma)==null?void 0:l.Rb)==null||c.call(l,s),s}function kt(s,a,l){var c=s==null?void 0:s.Ma.Ua;s=c?s:a,c??(c=a.La.Ua),tt(c),c(s,l)}var aa={open(s){var a,l;s.Ma=rs[s.node.rdev].Ma,(l=(a=s.Ma).open)==null||l.call(a,s)},Va(){throw new A(70)}};function Mt(s,a){rs[s]={Ma:a}}function gs(s,a){var l=a==="/";if(l&&$t)throw new A(10);if(!l&&a){var c=de(a,{nb:!1});if(a=c.path,c=c.node,c.ab)throw new A(10);if(!oe(c.mode))throw new A(54)}a={type:s,Wb:{},zb:a,Ib:[]},s=s.Xa(a),s.Xa=a,a.root=s,l?$t=s:c&&(c.ab=a,c.Xa&&c.Xa.Ib.push(a))}function st(s,a,l){var c=de(s,{parent:!0}).node;if(s=et(s),!s)throw new A(28);if(s==="."||s==="..")throw new A(20);var f=hs(c,s);if(f)throw new A(f);if(!c.La.hb)throw new A(63);return c.La.hb(c,s,a,l)}function na(s,a=438){return st(s,a&4095|32768,0)}function pe(s,a=511){return st(s,a&1023|16384,0)}function at(s,a,l){typeof l>"u"&&(l=a,a=438),st(s,a|8192,l)}function Lt(s,a){if(!Qs(s))throw new A(44);var l=de(a,{parent:!0}).node;if(!l)throw new A(44);a=et(a);var c=hs(l,a);if(c)throw new A(c);if(!l.La.symlink)throw new A(63);l.La.symlink(l,a,s)}function ps(s){var a=de(s,{parent:!0}).node;s=et(s);var l=De(a,s),c=fs(a,s,!0);if(c)throw new A(c);if(!a.La.rmdir)throw new A(63);if(l.ab)throw new A(10);a.La.rmdir(a,s),_t(l)}function bs(s){var a=de(s,{parent:!0}).node;if(!a)throw new A(44);s=et(s);var l=De(a,s),c=fs(a,s,!1);if(c)throw new A(c);if(!a.La.unlink)throw new A(63);if(l.ab)throw new A(10);a.La.unlink(a,s),_t(l)}function Qe(s,a){return s=de(s,{$a:!a}).node,tt(s.La.Ta)(s)}function ys(s,a,l,c){kt(s,a,{mode:l&4095|a.mode&-4096,ctime:Date.now(),Fb:c})}function nt(s,a){s=typeof s=="string"?de(s,{$a:!0}).node:s,ys(null,s,a)}function vs(s,a,l){if(oe(a.mode))throw new A(31);if((a.mode&61440)!==32768)throw new A(28);var c=Ue(a,"w");if(c)throw new A(c);kt(s,a,{size:l,timestamp:Date.now()})}function He(s,a,l=438){if(s==="")throw new A(44);if(typeof a=="string"){var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof c>"u")throw Error(`Unknown file open mode: ${a}`);a=c}if(l=a&64?l&4095|32768:0,typeof s=="object")c=s;else{var f=s.endsWith("/");s=de(s,{$a:!(a&131072),Jb:!0}),c=s.node,s=s.path}var b=!1;if(a&64)if(c){if(a&128)throw new A(20)}else{if(f)throw new A(31);c=st(s,l|511,0),b=!0}if(!c)throw new A(44);if((c.mode&61440)===8192&&(a&=-513),a&65536&&!oe(c.mode))throw new A(54);if(!b&&(f=c?(c.mode&61440)===40960?32:oe(c.mode)&&(us(a)!=="r"||a&576)?31:Ue(c,us(a)):44))throw new A(f);return a&512&&!b&&(f=c,f=typeof f=="string"?de(f,{$a:!0}).node:f,vs(null,f,0)),a&=-131713,f=ms({node:c,path:Ct(c),flags:a,seekable:!0,position:0,Ma:c.Ma,Lb:[],error:!1}),f.Ma.open&&f.Ma.open(f),b&&nt(c,l&511),!o.logReadFiles||a&1||s in cs||(cs[s]=1),f}function Dt(s){if(s.fd===null)throw new A(8);s.ob&&(s.ob=null);try{s.Ma.close&&s.Ma.close(s)}catch(a){throw a}finally{ze[s.fd]=null}s.fd=null}function ws(s,a,l){if(s.fd===null)throw new A(8);if(!s.seekable||!s.Ma.Va)throw new A(70);if(l!=0&&l!=1&&l!=2)throw new A(28);s.position=s.Ma.Va(s,a,l),s.Lb=[]}function xs(s,a,l,c,f){if(0>c||0>f)throw new A(28);if(s.fd===null)throw new A(8);if((s.flags&2097155)===1)throw new A(8);if(oe(s.node.mode))throw new A(31);if(!s.Ma.read)throw new A(28);var b=typeof f<"u";if(!b)f=s.position;else if(!s.seekable)throw new A(70);return a=s.Ma.read(s,a,l,c,f),b||(s.position+=a),a}function Ss(s,a,l,c,f){if(0>c||0>f)throw new A(28);if(s.fd===null)throw new A(8);if((s.flags&2097155)===0)throw new A(8);if(oe(s.node.mode))throw new A(31);if(!s.Ma.write)throw new A(28);s.seekable&&s.flags&1024&&ws(s,0,2);var b=typeof f<"u";if(!b)f=s.position;else if(!s.seekable)throw new A(70);return a=s.Ma.write(s,a,l,c,f,void 0),b||(s.position+=a),a}function ia(s){var a,l=He(s,l||0);s=Qe(s).size;var c=new Uint8Array(s);return xs(l,c,0,s,0),a=c,Dt(l),a}function Te(s,a,l){s=St("/dev/"+s);var c=is(!!a,!!l);Te.yb??(Te.yb=64);var f=Te.yb++<<8|0;Mt(f,{open(b){b.seekable=!1},close(){var b;(b=l==null?void 0:l.buffer)!=null&&b.length&&l(10)},read(b,S,F,G){for(var V=0,te=0;te<G;te++){try{var le=a()}catch{throw new A(29)}if(le===void 0&&V===0)throw new A(6);if(le==null)break;V++,S[F+te]=le}return V&&(b.node.atime=Date.now()),V},write(b,S,F,G){for(var V=0;V<G;V++)try{l(S[F+V])}catch{throw new A(29)}return G&&(b.node.mtime=b.node.ctime=Date.now()),V}}),at(s,c,f)}var Z={};function Ae(s,a,l){if(a.charAt(0)==="/")return a;if(s=s===-100?"/":re(s).path,a.length==0){if(!l)throw new A(44);return s}return s+"/"+a}function it(s,a){Q[s>>2]=a.dev,Q[s+4>>2]=a.mode,X[s+8>>2]=a.nlink,Q[s+12>>2]=a.uid,Q[s+16>>2]=a.gid,Q[s+20>>2]=a.rdev,B[s+24>>3]=BigInt(a.size),Q[s+32>>2]=4096,Q[s+36>>2]=a.blocks;var l=a.atime.getTime(),c=a.mtime.getTime(),f=a.ctime.getTime();return B[s+40>>3]=BigInt(Math.floor(l/1e3)),X[s+48>>2]=l%1e3*1e6,B[s+56>>3]=BigInt(Math.floor(c/1e3)),X[s+64>>2]=c%1e3*1e6,B[s+72>>3]=BigInt(Math.floor(f/1e3)),X[s+80>>2]=f%1e3*1e6,B[s+88>>3]=BigInt(a.ino),0}var rt=void 0,ot=()=>{var s=Q[+rt>>2];return rt+=4,s},At=0,ra=[0,31,60,91,121,152,182,213,244,274,305,335],oa=[0,31,59,90,120,151,181,212,243,273,304,334],Xe={},Ts=s=>{var a;J=s,wt||0<At||((a=o.onExit)==null||a.call(o,s),W=!0),x(s,new vt(s))},la=s=>{if(!W)try{if(s(),!(wt||0<At))try{J=s=J,Ts(s)}catch(a){a instanceof vt||a=="unwind"||x(1,a)}}catch(a){a instanceof vt||a=="unwind"||x(1,a)}},Nt={},$s=()=>{if(!Rt){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"},a;for(a in Nt)Nt[a]===void 0?delete s[a]:s[a]=Nt[a];var l=[];for(a in s)l.push(`${a}=${s[a]}`);Rt=l}return Rt},Rt,Ot=s=>{var a=Ke(s)+1,l=Ce(a);return ye(s,R,l,a),l},ca=(s,a,l,c)=>{var f={string:V=>{var te=0;return V!=null&&V!==0&&(te=Ot(V)),te},array:V=>{var te=Ce(V.length);return L.set(V,te),te}};s=o["_"+s];var b=[],S=0;if(c)for(var F=0;F<c.length;F++){var G=f[l[F]];G?(S===0&&(S=Ze()),b[F]=G(c[F])):b[F]=c[F]}return l=s(...b),l=(function(V){return S!==0&&Je(S),a==="string"?V?ee(R,V):"":a==="boolean"?!!V:V})(l)},lt=0,ct=(s,a)=>(a=a==1?Ce(s.length):Ft(s.length),s.subarray||s.slice||(s=new Uint8Array(s)),R.set(s,a),a),Ne,It=[],ve,$e=s=>{Ne.delete(ve.get(s)),ve.set(s,null),It.push(s)},Ye=(s,a)=>{if(!Ne){Ne=new WeakMap;var l=ve.length;if(Ne)for(var c=0;c<0+l;c++){var f=ve.get(c);f&&Ne.set(f,c)}}if(l=Ne.get(s)||0)return l;if(It.length)l=It.pop();else{try{ve.grow(1)}catch(G){throw G instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":G}l=ve.length-1}try{ve.set(l,s)}catch(G){if(!(G instanceof TypeError))throw G;if(typeof WebAssembly.Function=="function"){var b=WebAssembly.Function;c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},f={parameters:[],results:a[0]=="v"?[]:[c[a[0]]]};for(var S=1;S<a.length;++S)f.parameters.push(c[a[S]]);a=new b(f,s)}else{c=[1],f=a.slice(0,1),a=a.slice(1),S={i:127,p:127,j:126,f:125,d:124,e:111},c.push(96);var F=a.length;128>F?c.push(F):c.push(F%128|128,F>>7);for(b of a)c.push(S[b]);f=="v"?c.push(0):c.push(1,S[f]),a=[0,97,115,109,1,0,0,0,1],b=c.length,128>b?a.push(b):a.push(b%128|128,b>>7),a.push(...c),a.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),a=new WebAssembly.Module(new Uint8Array(a)),a=new WebAssembly.Instance(a,{e:{f:s}}).exports.f}ve.set(l,a)}return Ne.set(s,l),l};Se=Array(4096),gs(H,"/"),pe("/tmp"),pe("/home"),pe("/home/web_user"),(function(){pe("/dev"),Mt(259,{read:()=>0,write:(c,f,b,S)=>S,Va:()=>0}),at("/dev/null",259),ns(1280,Ys),ns(1536,Js),at("/dev/tty",1280),at("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,l=()=>(a===0&&(ts(s),a=s.byteLength),s[--a]);Te("random",l),Te("urandom",l),pe("/dev/shm"),pe("/dev/shm/tmp")})(),(function(){pe("/proc");var s=pe("/proc/self");pe("/proc/self/fd"),gs({Xa(){var a=ds(s,"fd",16895,73);return a.Ma={Va:H.Ma.Va},a.La={lookup(l,c){l=+c;var f=re(l);return l={parent:null,Xa:{zb:"fake"},La:{readlink:()=>f.path},id:l+1},l.parent=l},readdir(){return Array.from(ze.entries()).filter(([,l])=>l).map(([l])=>l.toString())}},a}},"/proc/self/fd")})(),H.vb=new A(44),H.vb.stack="<generic error, no stack>";var da={a:(s,a,l,c)=>qe(`Assertion failed: ${s?ee(R,s):""}, at: `+[a?a?ee(R,a):"":"unknown filename",l,c?c?ee(R,c):"":"unknown function"]),i:function(s,a){try{return s=s?ee(R,s):"",nt(s,a),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},L:function(s,a,l){try{if(a=a?ee(R,a):"",a=Ae(s,a),l&-8)return-28;var c=de(a,{$a:!0}).node;return c?(s="",l&4&&(s+="r"),l&2&&(s+="w"),l&1&&(s+="x"),s&&Ue(c,s)?-2:0):-44}catch(f){if(typeof Z>"u"||f.name!=="ErrnoError")throw f;return-f.Pa}},j:function(s,a){try{var l=re(s);return ys(l,l.node,a,!1),0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},h:function(s){try{var a=re(s);return kt(a,a.node,{timestamp:Date.now(),Fb:!1}),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},b:function(s,a,l){rt=l;try{var c=re(s);switch(a){case 0:var f=ot();if(0>f)break;for(;ze[f];)f++;return sa(c,f).fd;case 1:case 2:return 0;case 3:return c.flags;case 4:return f=ot(),c.flags|=f,0;case 12:return f=ot(),ae[f+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},g:function(s,a){try{var l=re(s),c=l.node,f=l.Ma.Ta;s=f?l:c,f??(f=c.La.Ta),tt(f);var b=f(s);return it(a,b)}catch(S){if(typeof Z>"u"||S.name!=="ErrnoError")throw S;return-S.Pa}},H:function(s,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{if(isNaN(a))return 61;var l=re(s);if(0>a||(l.flags&2097155)===0)throw new A(28);return vs(l,l.node,a),0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},G:function(s,a){try{if(a===0)return-28;var l=Ke("/")+1;return a<l?-68:(ye("/",R,s,a),l)}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},K:function(s,a){try{return s=s?ee(R,s):"",it(a,Qe(s,!0))}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},C:function(s,a,l){try{return a=a?ee(R,a):"",a=Ae(s,a),pe(a,l),0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},J:function(s,a,l,c){try{a=a?ee(R,a):"";var f=c&256;return a=Ae(s,a,c&4096),it(l,f?Qe(a,!0):Qe(a))}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},x:function(s,a,l,c){rt=c;try{a=a?ee(R,a):"",a=Ae(s,a);var f=c?ot():0;return He(a,l,f).fd}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return-b.Pa}},v:function(s,a,l,c){try{if(a=a?ee(R,a):"",a=Ae(s,a),0>=c)return-28;var f=de(a).node;if(!f)throw new A(44);if(!f.La.readlink)throw new A(28);var b=f.La.readlink(f),S=Math.min(c,Ke(b)),F=L[l+S];return ye(b,R,l,c+1),L[l+S]=F,S}catch(G){if(typeof Z>"u"||G.name!=="ErrnoError")throw G;return-G.Pa}},u:function(s){try{return s=s?ee(R,s):"",ps(s),0}catch(a){if(typeof Z>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},f:function(s,a){try{return s=s?ee(R,s):"",it(a,Qe(s))}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return-l.Pa}},r:function(s,a,l){try{return a=a?ee(R,a):"",a=Ae(s,a),l===0?bs(a):l===512?ps(a):qe("Invalid flags passed to unlinkat"),0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return-c.Pa}},q:function(s,a,l){try{a=a?ee(R,a):"",a=Ae(s,a,!0);var c=Date.now(),f,b;if(l){var S=X[l>>2]+4294967296*Q[l+4>>2],F=Q[l+8>>2];F==1073741823?f=c:F==1073741822?f=null:f=1e3*S+F/1e6,l+=16,S=X[l>>2]+4294967296*Q[l+4>>2],F=Q[l+8>>2],F==1073741823?b=c:F==1073741822?b=null:b=1e3*S+F/1e6}else b=f=c;if((b??f)!==null){s=f;var G=de(a,{$a:!0}).node;tt(G.La.Ua)(G,{atime:s,mtime:b})}return 0}catch(V){if(typeof Z>"u"||V.name!=="ErrnoError")throw V;return-V.Pa}},m:()=>qe(""),l:()=>{wt=!1,At=0},A:function(s,a){s=-9007199254740992>s||9007199254740992<s?NaN:Number(s),s=new Date(1e3*s),Q[a>>2]=s.getSeconds(),Q[a+4>>2]=s.getMinutes(),Q[a+8>>2]=s.getHours(),Q[a+12>>2]=s.getDate(),Q[a+16>>2]=s.getMonth(),Q[a+20>>2]=s.getFullYear()-1900,Q[a+24>>2]=s.getDay();var l=s.getFullYear();Q[a+28>>2]=(l%4!==0||l%100===0&&l%400!==0?oa:ra)[s.getMonth()]+s.getDate()-1|0,Q[a+36>>2]=-(60*s.getTimezoneOffset()),l=new Date(s.getFullYear(),6,1).getTimezoneOffset();var c=new Date(s.getFullYear(),0,1).getTimezoneOffset();Q[a+32>>2]=(l!=c&&s.getTimezoneOffset()==Math.min(c,l))|0},y:function(s,a,l,c,f,b,S){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var F=re(c);if((a&2)!==0&&(l&2)===0&&(F.flags&2097155)!==2)throw new A(2);if((F.flags&2097155)===1)throw new A(2);if(!F.Ma.ib)throw new A(43);if(!s)throw new A(28);var G=F.Ma.ib(F,s,f,a,l),V=G.Kb;return Q[b>>2]=G.Ab,X[S>>2]=V,0}catch(te){if(typeof Z>"u"||te.name!=="ErrnoError")throw te;return-te.Pa}},z:function(s,a,l,c,f,b){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b);try{var S=re(f);if(l&2){if(l=b,(S.node.mode&61440)!==32768)throw new A(43);if(!(c&2)){var F=R.slice(s,s+a);S.Ma.jb&&S.Ma.jb(S,F,l,a,c)}}}catch(G){if(typeof Z>"u"||G.name!=="ErrnoError")throw G;return-G.Pa}},n:(s,a)=>{if(Xe[s]&&(clearTimeout(Xe[s].id),delete Xe[s]),!a)return 0;var l=setTimeout(()=>{delete Xe[s],la(()=>Es(s,performance.now()))},a);return Xe[s]={id:l,Xb:a},0},B:(s,a,l,c)=>{var f=new Date().getFullYear(),b=new Date(f,0,1).getTimezoneOffset();f=new Date(f,6,1).getTimezoneOffset(),X[s>>2]=60*Math.max(b,f),Q[a>>2]=+(b!=f),a=S=>{var F=Math.abs(S);return`UTC${0<=S?"-":"+"}${String(Math.floor(F/60)).padStart(2,"0")}${String(F%60).padStart(2,"0")}`},s=a(b),a=a(f),f<b?(ye(s,R,l,17),ye(a,R,c,17)):(ye(s,R,c,17),ye(a,R,l,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:s=>{var a=R.length;if(s>>>=0,2147483648<s)return!1;for(var l=1;4>=l;l*=2){var c=a*(1+.2/l);c=Math.min(c,s+100663296);e:{c=(Math.min(2147483648,65536*Math.ceil(Math.max(s,c)/65536))-I.buffer.byteLength+65535)/65536|0;try{I.grow(c),ie();var f=1;break e}catch{}f=void 0}if(f)return!0}return!1},E:(s,a)=>{var l=0;return $s().forEach((c,f)=>{var b=a+l;for(f=X[s+4*f>>2]=b,b=0;b<c.length;++b)L[f++]=c.charCodeAt(b);L[f]=0,l+=c.length+1}),0},F:(s,a)=>{var l=$s();X[s>>2]=l.length;var c=0;return l.forEach(f=>c+=f.length+1),X[a>>2]=c,0},e:function(s){try{var a=re(s);return Dt(a),0}catch(l){if(typeof Z>"u"||l.name!=="ErrnoError")throw l;return l.Pa}},p:function(s,a){try{var l=re(s);return L[a]=l.tty?2:oe(l.mode)?3:(l.mode&61440)===40960?7:4,ae[a+2>>1]=0,B[a+8>>3]=BigInt(0),B[a+16>>3]=BigInt(0),0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},w:function(s,a,l,c){try{e:{var f=re(s);s=a;for(var b,S=a=0;S<l;S++){var F=X[s>>2],G=X[s+4>>2];s+=8;var V=xs(f,L,F,G,b);if(0>V){var te=-1;break e}if(a+=V,V<G)break;typeof b<"u"&&(b+=V)}te=a}return X[c>>2]=te,0}catch(le){if(typeof Z>"u"||le.name!=="ErrnoError")throw le;return le.Pa}},D:function(s,a,l,c){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{if(isNaN(a))return 61;var f=re(s);return ws(f,a,l),B[c>>3]=BigInt(f.position),f.ob&&a===0&&l===0&&(f.ob=null),0}catch(b){if(typeof Z>"u"||b.name!=="ErrnoError")throw b;return b.Pa}},I:function(s){var l;try{var a=re(s);return(l=a.Ma)!=null&&l.fsync?a.Ma.fsync(a):0}catch(c){if(typeof Z>"u"||c.name!=="ErrnoError")throw c;return c.Pa}},t:function(s,a,l,c){try{e:{var f=re(s);s=a;for(var b,S=a=0;S<l;S++){var F=X[s>>2],G=X[s+4>>2];s+=8;var V=Ss(f,L,F,G,b);if(0>V){var te=-1;break e}if(a+=V,V<G)break;typeof b<"u"&&(b+=V)}te=a}return X[c>>2]=te,0}catch(le){if(typeof Z>"u"||le.name!=="ErrnoError")throw le;return le.Pa}},k:Ts},P;(async function(){var l;function s(c){var f;return P=c.exports,I=P.M,ie(),ve=P.O,ge--,(f=o.monitorRunDependencies)==null||f.call(o,ge),ge==0&&Le&&(c=Le,Le=null,c()),P}ge++,(l=o.monitorRunDependencies)==null||l.call(o,ge);var a={a:da};return o.instantiateWasm?new Promise(c=>{o.instantiateWasm(a,(f,b)=>{s(f),c(f.exports)})}):(yt??(yt=o.locateFile?o.locateFile("sql-wasm.wasm",v):v+"sql-wasm.wasm"),s((await Gs(a)).instance))})(),o._sqlite3_free=s=>(o._sqlite3_free=P.P)(s),o._sqlite3_value_text=s=>(o._sqlite3_value_text=P.Q)(s),o._sqlite3_prepare_v2=(s,a,l,c,f)=>(o._sqlite3_prepare_v2=P.R)(s,a,l,c,f),o._sqlite3_step=s=>(o._sqlite3_step=P.S)(s),o._sqlite3_reset=s=>(o._sqlite3_reset=P.T)(s),o._sqlite3_exec=(s,a,l,c,f)=>(o._sqlite3_exec=P.U)(s,a,l,c,f),o._sqlite3_finalize=s=>(o._sqlite3_finalize=P.V)(s),o._sqlite3_column_name=(s,a)=>(o._sqlite3_column_name=P.W)(s,a),o._sqlite3_column_text=(s,a)=>(o._sqlite3_column_text=P.X)(s,a),o._sqlite3_column_type=(s,a)=>(o._sqlite3_column_type=P.Y)(s,a),o._sqlite3_errmsg=s=>(o._sqlite3_errmsg=P.Z)(s),o._sqlite3_clear_bindings=s=>(o._sqlite3_clear_bindings=P._)(s),o._sqlite3_value_blob=s=>(o._sqlite3_value_blob=P.$)(s),o._sqlite3_value_bytes=s=>(o._sqlite3_value_bytes=P.aa)(s),o._sqlite3_value_double=s=>(o._sqlite3_value_double=P.ba)(s),o._sqlite3_value_int=s=>(o._sqlite3_value_int=P.ca)(s),o._sqlite3_value_type=s=>(o._sqlite3_value_type=P.da)(s),o._sqlite3_result_blob=(s,a,l,c)=>(o._sqlite3_result_blob=P.ea)(s,a,l,c),o._sqlite3_result_double=(s,a)=>(o._sqlite3_result_double=P.fa)(s,a),o._sqlite3_result_error=(s,a,l)=>(o._sqlite3_result_error=P.ga)(s,a,l),o._sqlite3_result_int=(s,a)=>(o._sqlite3_result_int=P.ha)(s,a),o._sqlite3_result_int64=(s,a)=>(o._sqlite3_result_int64=P.ia)(s,a),o._sqlite3_result_null=s=>(o._sqlite3_result_null=P.ja)(s),o._sqlite3_result_text=(s,a,l,c)=>(o._sqlite3_result_text=P.ka)(s,a,l,c),o._sqlite3_aggregate_context=(s,a)=>(o._sqlite3_aggregate_context=P.la)(s,a),o._sqlite3_column_count=s=>(o._sqlite3_column_count=P.ma)(s),o._sqlite3_data_count=s=>(o._sqlite3_data_count=P.na)(s),o._sqlite3_column_blob=(s,a)=>(o._sqlite3_column_blob=P.oa)(s,a),o._sqlite3_column_bytes=(s,a)=>(o._sqlite3_column_bytes=P.pa)(s,a),o._sqlite3_column_double=(s,a)=>(o._sqlite3_column_double=P.qa)(s,a),o._sqlite3_bind_blob=(s,a,l,c,f)=>(o._sqlite3_bind_blob=P.ra)(s,a,l,c,f),o._sqlite3_bind_double=(s,a,l)=>(o._sqlite3_bind_double=P.sa)(s,a,l),o._sqlite3_bind_int=(s,a,l)=>(o._sqlite3_bind_int=P.ta)(s,a,l),o._sqlite3_bind_text=(s,a,l,c,f)=>(o._sqlite3_bind_text=P.ua)(s,a,l,c,f),o._sqlite3_bind_parameter_index=(s,a)=>(o._sqlite3_bind_parameter_index=P.va)(s,a),o._sqlite3_sql=s=>(o._sqlite3_sql=P.wa)(s),o._sqlite3_normalized_sql=s=>(o._sqlite3_normalized_sql=P.xa)(s),o._sqlite3_changes=s=>(o._sqlite3_changes=P.ya)(s),o._sqlite3_close_v2=s=>(o._sqlite3_close_v2=P.za)(s),o._sqlite3_create_function_v2=(s,a,l,c,f,b,S,F,G)=>(o._sqlite3_create_function_v2=P.Aa)(s,a,l,c,f,b,S,F,G),o._sqlite3_update_hook=(s,a,l)=>(o._sqlite3_update_hook=P.Ba)(s,a,l),o._sqlite3_open=(s,a)=>(o._sqlite3_open=P.Ca)(s,a);var Ft=o._malloc=s=>(Ft=o._malloc=P.Da)(s),dt=o._free=s=>(dt=o._free=P.Ea)(s);o._RegisterExtensionFunctions=s=>(o._RegisterExtensionFunctions=P.Fa)(s);var Cs=(s,a)=>(Cs=P.Ga)(s,a),Es=(s,a)=>(Es=P.Ha)(s,a),Je=s=>(Je=P.Ia)(s),Ce=s=>(Ce=P.Ja)(s),Ze=()=>(Ze=P.Ka)();o.stackSave=()=>Ze(),o.stackRestore=s=>Je(s),o.stackAlloc=s=>Ce(s),o.cwrap=(s,a,l,c)=>{var f=!l||l.every(b=>b==="number"||b==="boolean");return a!=="string"&&f&&!c?o["_"+s]:(...b)=>ca(s,a,l,b)},o.addFunction=Ye,o.removeFunction=$e,o.UTF8ToString=xt,o.ALLOC_NORMAL=lt,o.allocate=ct,o.allocateUTF8OnStack=Ot;function Pt(){function s(){var f;if(o.calledRun=!0,!W){if(!o.noFSInit&&!os){var a,l;os=!0,c??(c=o.stdin),a??(a=o.stdout),l??(l=o.stderr),c?Te("stdin",c):Lt("/dev/tty","/dev/stdin"),a?Te("stdout",null,a):Lt("/dev/tty","/dev/stdout"),l?Te("stderr",null,l):Lt("/dev/tty1","/dev/stderr"),He("/dev/stdin",0),He("/dev/stdout",1),He("/dev/stderr",1)}if(P.N(),ls=!1,(f=o.onRuntimeInitialized)==null||f.call(o),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var c=o.postRun.shift();Xt.unshift(c)}Qt(Xt)}}if(0<ge)Le=Pt;else{if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)Ws();Qt(Yt),0<ge?Le=Pt:o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),s()},1)):s()}}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return Pt(),h}),t)};k.exports=i,k.exports.default=i})(qt)),qt.exports}var Wa=Ga();const Ka=Ua(Wa),gt=100,Us=0,Qa="https://sql.js.org/dist/",ht={berdl_tables:{configId:"berdl_tables",configPath:"/config/berdl-tables.json",version:"1.0.0",description:"BERDL tables configuration"},genome_data_tables:{configId:"genome_data_tables",configPath:"/config/genome-data-tables.json",version:"1.0.0",description:"Genome data tables configuration"}},Oe={"/data/berdl_tables.db":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"},"/data/berdl_tables_ecoli_562_61143.db":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/0":{dbPath:"/data/berdl_tables_ecoli_562_61143.db",configId:"berdl_tables"},"test/test/1":{dbPath:"/data/berdl_tables.db",configId:"berdl_tables"}},zt={},Vt={debug:0,info:1,warn:2,error:3};function Xa(){var e;const k=(e=zt==null?void 0:zt.VITE_LOG_LEVEL)==null?void 0:e.toLowerCase();return k&&k in Vt?k:"warn"}const Ya=Xa();function ft(k){return Vt[k]>=Vt[Ya]}function Ee(k,e){return`[${new Date().toISOString()}] [${k}] ${e}`}const K={debug(k,e){ft("debug")&&(e!==void 0?console.info(Ee("DEBUG",k),e):console.info(Ee("DEBUG",k)))},info(k,e){ft("info")&&(e!==void 0?console.info(Ee("INFO",k),e):console.info(Ee("INFO",k)))},warn(k,e){ft("warn")&&(e!==void 0?console.warn(Ee("WARN",k),e):console.warn(Ee("WARN",k)))},error(k,e){ft("error")&&(e!==void 0?console.error(Ee("ERROR",k),e):console.error(Ee("ERROR",k)))}},he=class he{constructor(){$(this,"db",null);$(this,"currentDbPath",null);$(this,"sqlPromise",null)}static getInstance(){return he.instance||(he.instance=new he),he.instance}static isLocalDb(e){return e in Oe||e.startsWith("local/")}static getConfigDefinition(e){return ht[e]||null}static getDatabaseMapping(e){return Oe[e]||null}static getConfigPath(e){const t=Oe[e];if(!t){if(e.startsWith("/data/")||e.startsWith("./data/")){const n=e.startsWith("./")?e.substring(2):e,r=Oe[n];if(r){const d=ht[r.configId];return r.configPath||(d==null?void 0:d.configPath)||null}}return null}const i=ht[t.configId];return i?t.configPath||i.configPath:null}static getDatabasePath(e){const t=Oe[e];return t?t.dbPath:e.startsWith("/data/")||e.startsWith("./data/")?e.startsWith("./")?e.substring(2):e:e.startsWith("local/")?`/data/${e.replace("local/","")}.db`:null}static getAllConfigDefinitions(){return{...ht}}static getAllDatabaseMappings(){return{...Oe}}static getDatabasesForConfig(e){return Object.values(Oe).filter(t=>t.configId===e)}async initSql(){return this.sqlPromise||(this.sqlPromise=Ka({locateFile:e=>`${Qa}${e}`})),this.sqlPromise}async loadDatabase(e){if(this.db&&this.currentDbPath===e)return;this.db&&(this.db.close(),this.db=null);const t=await this.initSql(),i=await fetch(e);if(!i.ok)throw new Error(`Failed to load database: ${i.status} ${i.statusText}`);const n=await i.arrayBuffer();this.db=new t.Database(new Uint8Array(n)),this.currentDbPath=e}async loadDatabaseFromBuffer(e,t="uploaded.db"){this.db&&(this.db.close(),this.db=null);const i=await this.initSql();this.db=new i.Database(new Uint8Array(e)),this.currentDbPath=t}async listTables(e){let t=null,i=null;if(t=he.getDatabasePath(e),i=he.getConfigPath(e),!t&&e.startsWith("local/")){const r=e.replace("local/","");t=`/data/${r}.db`,i=he.getConfigPath(`/data/${r}.db`)||`/config/${r}.json`}if(!t)throw new Error(`Unknown local database: ${e}`);if(await this.loadDatabase(t),!this.db)throw new Error("Database not loaded");let n={};if(i)try{const r=await fetch(i);r.ok&&(n=await r.json())}catch(r){K.warn("Failed to load config",r)}return this.listTablesFromDb(t,n)}async listTablesFromDb(e,t={}){var r;if(!t||Object.keys(t).length===0){const d=he.getConfigPath(e);if(d)try{const h=await fetch(d);h.ok&&(t=await h.json())}catch(h){console.warn("Failed to load config:",h)}}if(await this.loadDatabase(e),!this.db)throw new Error("Database not loaded");const i=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),n=[];if(i.length>0&&i[0].values)for(const d of i[0].values){const h=d[0],u=this.db.exec(`SELECT COUNT(*) FROM "${h}"`),o=u.length>0?u[0].values[0][0]:0,g=this.db.exec(`PRAGMA table_info("${h}")`),m=g.length>0?g[0].values.length:0,w=(r=t.tables)==null?void 0:r[h];n.push({name:h,displayName:(w==null?void 0:w.displayName)||h,row_count:o,column_count:m,description:w==null?void 0:w.description})}return{tables:n,type:"berdl_tables",object_type:"KBaseFBA.GenomeDataLakeTables-2.0"}}async getTableData(e,t){let i=null;if(i=he.getDatabasePath(e),!i&&e.startsWith("local/")&&(this.currentDbPath?i=this.currentDbPath:i=`/data/${e.replace("local/","")}.db`),!i)throw new Error(`Unknown local database: ${e}`);if(await this.loadDatabase(i),!this.db)throw new Error("Database not loaded");const n=t.table_name,r=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'");if(!(r.length>0?r[0].values.map(B=>B[0]):[]).includes(n))throw new Error(`Table "${n}" not found in database`);const h=t.limit||gt,u=t.offset||0;let o="*";if(t.columns&&t.columns.length>0){const B=this.db.exec(`PRAGMA table_info("${n}")`),se=B.length>0?B[0].values.map(ie=>ie[1]):[],ne=t.columns.filter(ie=>se.includes(ie));if(ne.length===0&&t.columns.length>0)throw new Error(`None of the requested columns exist in table "${n}"`);o=ne.map(ie=>`"${ie}"`).join(", ")}if(t.aggregations&&t.aggregations.length>0)return this.getAggregatedData(t);const g=[],m=[],w=this.db.exec(`PRAGMA table_info("${n}")`),T={};if(w.length>0)for(const B of w[0].values){const se=B[1],ne=(B[2]||"TEXT").toUpperCase();T[se]=ne}if(t.filters&&t.filters.length>0){const B=this.buildAdvancedFiltersWithTypes(t.filters,m,T);g.push(...B)}if(t.search_value&&t.search_value.trim()){const B=this.db.exec(`PRAGMA table_info("${n}")`);if(B.length>0){const se=B[0].values.map(ie=>`CAST("${ie[1]}" AS TEXT) LIKE ?`);g.push(`(${se.join(" OR ")})`);const ne=`%${t.search_value}%`;for(let ie=0;ie<B[0].values.length;ie++)m.push(ne)}}if(t.col_filter){const B=new Set((t.filters||[]).map(se=>se.column));for(const[se,ne]of Object.entries(t.col_filter))!B.has(se)&&ne!==void 0&&ne!==null&&ne!==""&&(g.push(`CAST("${se}" AS TEXT) LIKE ?`),m.push(`%${ne}%`))}const y=g.length>0?`WHERE ${g.join(" AND ")}`:"";let x="";if(t.sort_column){const B=t.sort_order||"ASC";x=`ORDER BY "${t.sort_column}" ${B}`}const v=`SELECT COUNT(*) FROM "${n}" ${y}`,E=this.db.prepare(v);m.length>0&&E.bind(m),E.step();const M=E.get()[0];E.free();const N=`SELECT ${o} FROM "${n}" ${y} ${x} LIMIT ? OFFSET ?`,z=[...m,h,u],D=this.db.prepare(N);D.bind(z);const j=[],I=[];for(;D.step();){const B=D.get();if(j.length===0){const se=D.getColumnNames();j.push(...se)}I.push(B)}D.free();const W=this.db.exec(`PRAGMA table_info("${n}")`),J=[];if(W.length>0)for(const B of W[0].values){const se=B[1],ne=B[2]||"TEXT",ie=B[3]===1,ge=B[4],Le=B[5]===1;J.push({name:se,type:ne,notnull:ie,pk:Le,dflt_value:ge}),j.length===0&&j.push(se)}const L=t.columns,R=L&&L.length>0?J.filter(B=>L.includes(B.name)):J,ae=g.length>0?`WHERE ${g.join(" AND ")}`:"",Q=t.sort_column?`ORDER BY "${t.sort_column}" ${t.sort_order||"ASC"}`:"",xe={query_type:"select",sql:`SELECT ${o} FROM "${n}" ${ae} ${Q} LIMIT ? OFFSET ?`,filters_applied:g.length,has_search:!!t.search_value,has_sort:!!t.sort_column,has_group_by:!1,has_aggregations:!1};return{headers:j,data:I,total_count:M,column_types:R,column_schema:R,query_metadata:xe,limit:h,offset:u,table_name:n}}buildAdvancedFiltersWithTypes(e,t,i){const n=[];for(const r of e){const{column:d,operator:h,value:u,value2:o}=r,g=i[d]||"TEXT",m=g.includes("INT")||g.includes("REAL")||g.includes("NUMERIC");let w=u,T=o;if(m&&(h==="eq"||h==="ne"||h==="gt"||h==="gte"||h==="lt"||h==="lte"||h==="between")){if(typeof u=="string"){const x=parseFloat(u);!isNaN(x)&&isFinite(x)&&(w=g.includes("INT")?Math.floor(x):x)}else typeof u=="number"&&(w=g.includes("INT")?Math.floor(u):u);if(o!==void 0)if(typeof o=="string"){const x=parseFloat(o);!isNaN(x)&&isFinite(x)&&(T=g.includes("INT")?Math.floor(x):x)}else typeof o=="number"&&(T=g.includes("INT")?Math.floor(o):o)}let y="";switch(h){case"eq":y=`"${d}" = ?`,t.push(w);break;case"ne":y=`"${d}" != ?`,t.push(w);break;case"gt":y=`"${d}" > ?`,t.push(w);break;case"gte":y=`"${d}" >= ?`,t.push(w);break;case"lt":y=`"${d}" < ?`,t.push(w);break;case"lte":y=`"${d}" <= ?`,t.push(w);break;case"like":y=`"${d}" LIKE ?`,t.push(`%${u}%`);break;case"ilike":y=`LOWER("${d}") LIKE LOWER(?)`,t.push(`%${u}%`);break;case"in":if(Array.isArray(u)&&u.length>0){const x=u.map(()=>"?").join(",");y=`"${d}" IN (${x})`,t.push(...u)}break;case"not_in":if(Array.isArray(u)&&u.length>0){const x=u.map(()=>"?").join(",");y=`"${d}" NOT IN (${x})`,t.push(...u)}break;case"between":T!==void 0&&(y=`"${d}" BETWEEN ? AND ?`,t.push(w,T));break;case"is_null":y=`"${d}" IS NULL`;break;case"is_not_null":y=`"${d}" IS NOT NULL`;break;case"regex":y=`"${d}" LIKE ?`,t.push(`%${u}%`);break}y&&n.push(y)}return n}async getAggregatedData(e){if(!this.db)throw new Error("Database not loaded");const t=e.table_name,i=[];e.group_by&&e.group_by.length>0&&i.push(...e.group_by.map(L=>`"${L}"`));for(const L of e.aggregations||[]){let R="";switch(L.function){case"count":R=`COUNT(${L.column==="*"?"*":`"${L.column}"`})`;break;case"sum":R=`SUM("${L.column}")`;break;case"avg":R=`AVG("${L.column}")`;break;case"min":R=`MIN("${L.column}")`;break;case"max":R=`MAX("${L.column}")`;break;case"stddev":R=`(AVG("${L.column}" * "${L.column}") - AVG("${L.column}") * AVG("${L.column}"))`;break;case"variance":R=`(AVG("${L.column}" * "${L.column}") - AVG("${L.column}") * AVG("${L.column}"))`;break;case"distinct_count":R=`COUNT(DISTINCT "${L.column}")`;break}const ae=L.alias||`${L.function}_${L.column}`;i.push(`${R} AS "${ae}"`)}const n=i.join(", "),r=[],d=[],h=this.db.exec(`PRAGMA table_info("${t}")`),u={};if(h.length>0)for(const L of h[0].values){const R=L[1],ae=(L[2]||"TEXT").toUpperCase();u[R]=ae}if(e.filters&&e.filters.length>0){const L=this.buildAdvancedFiltersWithTypes(e.filters,d,u);r.push(...L)}const o=r.length>0?`WHERE ${r.join(" AND ")}`:"",g=e.group_by&&e.group_by.length>0?`GROUP BY ${e.group_by.map(L=>`"${L}"`).join(", ")}`:"";let m="";if(e.sort_column){const L=e.sort_order||"ASC";m=`ORDER BY "${e.sort_column}" ${L}`}const w=`SELECT ${n} FROM "${t}" ${o} ${g} ${m} LIMIT ? OFFSET ?`,T=[...d,e.limit||gt,e.offset||Us],y=this.db.prepare(w);y.bind(T);const x=[],v=[];for(;y.step();){const L=y.get();x.length===0&&x.push(...y.getColumnNames()),v.push(L)}y.free();const E=`SELECT COUNT(*) as count FROM (SELECT ${n} FROM "${t}" ${o} ${g})`,M=this.db.prepare(E);d.length>0&&M.bind(d),M.step();const N=M.get()[0];M.free();const z=[];if(e.group_by&&e.group_by.length>0){const L=this.db.exec(`PRAGMA table_info("${t}")`);if(L.length>0)for(const R of L[0].values){const ae=R[1];e.group_by.includes(ae)&&z.push({name:ae,type:R[2]||"TEXT",notnull:R[3]===1,pk:R[5]===1,dflt_value:R[4]})}}e.aggregations&&e.aggregations.forEach(L=>{z.push({name:L.alias||`${L.function}_${L.column}`,type:L.function==="count"||L.function==="distinct_count"?"INTEGER":"REAL",notnull:!1,pk:!1,dflt_value:null})});const D=r.length>0?`WHERE ${r.join(" AND ")}`:"",j=e.group_by&&e.group_by.length>0?`GROUP BY ${e.group_by.map(L=>`"${L}"`).join(", ")}`:"",I=e.sort_column?`ORDER BY "${e.sort_column}" ${e.sort_order||"ASC"}`:"",J={query_type:"aggregate",sql:`SELECT ${n} FROM "${t}" ${D} ${j} ${I} LIMIT ? OFFSET ?`,filters_applied:r.length,has_search:!1,has_sort:!!e.sort_column,has_group_by:!!(e.group_by&&e.group_by.length>0),has_aggregations:!!(e.aggregations&&e.aggregations.length>0)};return{headers:x,data:v,total_count:N,column_types:z.length>0?z:void 0,column_schema:z.length>0?z:void 0,query_metadata:J,limit:e.limit||gt,offset:e.offset||0,table_name:t}}async getTableSchema(e){if(!this.db)throw new Error("Database not loaded");const t=this.db.exec(`PRAGMA table_info("${e}")`);return t.length===0||!t[0].values?[]:t[0].values.map(i=>({name:i[1],type:i[2]||"TEXT",notnull:i[3]===1,pk:i[5]===1}))}async getAllSchemas(){if(!this.db)throw new Error("Database not loaded");const e=this.db.exec("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),t={};if(e.length>0&&e[0].values)for(const i of e[0].values){const n=i[0];t[n]=await this.getTableSchema(n)}return t}close(){this.db&&(this.db.close(),this.db=null,this.currentDbPath=null)}};$(he,"instance",null);let ke=he;const Be=Object.freeze(Object.defineProperty({__proto__:null,LocalDbClient:ke},Symbol.toStringTag,{value:"Module"})),Ut={};class js{constructor(e={}){$(this,"baseUrl");$(this,"token");$(this,"environment");$(this,"customHeaders");$(this,"cache");$(this,"cacheTTL");$(this,"localDb");this.environment=e.environment||"appdev",e.apiConfig?(this.baseUrl=e.apiConfig.url,this.customHeaders=e.apiConfig.headers||{}):(this.baseUrl=e.baseUrl||this.getDefaultUrl(this.environment),this.customHeaders=e.headers||{}),this.token=e.token||null,this.cache=new Map,this.cacheTTL=3e5,this.localDb=ke.getInstance()}async getTableSchema(e,t){if(ke.isLocalDb(e))return await this.localDb.getTableSchema(t);try{const i=await this.request(`/schema/${e}/tables/${t}`,"GET",void 0,!0);if(i&&Array.isArray(i.columns))return i.columns;if(Array.isArray(i))return i}catch(i){console.warn("[ApiClient] Remote schema fetch failed, falling back to local if available",i)}return ke.isLocalDb(e)?this.localDb.getTableSchema(t):[]}getDefaultUrl(e){const t=(Ut==null?void 0:Ut.VITE_API_URL)||typeof window<"u"&&window.__API_URL__;if(t)return t;const i={appdev:"https://appdev.kbase.us/services/berdl_table_scanner",prod:"https://kbase.us/services/berdl_table_scanner",local:"http://127.0.0.1:8000"};return i[e]||i.appdev}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json",...this.customHeaders};if(this.token){const t=this.token.startsWith("Bearer ")?this.token:`Bearer ${this.token}`;e.Authorization=t}return e}getCacheKey(e,t){return`${e}:${JSON.stringify(t||{})}`}getFromCache(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTTL?t.data:null}setCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}setToken(e){this.token=e,this.clearCache()}updateConfig(e){this.baseUrl=e.url,this.customHeaders=e.headers||{},this.clearCache()}setEnvironment(e){this.environment=e,this.baseUrl=this.getDefaultUrl(e),this.clearCache()}async request(e,t,i,n=!1){const r=this.getCacheKey(e,i);if(n&&t==="GET"){const m=this.getFromCache(r);if(m)return m}if(n&&t==="POST"){const m=this.getFromCache(r);if(m)return m}const d=e.startsWith("http")?e:`${this.baseUrl}${e}`,h={method:t,headers:this.getHeaders()};let u=d;if(i)if(t==="GET"){const m=new URL(d);Object.entries(i).forEach(([w,T])=>{T!=null&&m.searchParams.set(w,String(T))}),u=m.toString()}else h.body=JSON.stringify(i);const o=await fetch(u,h);if(!o.ok){let m=`HTTP ${o.status}`,w=null;try{const y=await o.json();w=y,y.detail&&typeof y.detail=="string"&&y.detail.length>0?m=y.detail:m=y.message||y.error||y.msg||m,o.status===500&&y.detail&&y.detail.includes("shock-api")&&(m=y.detail)}catch{m=await o.text().catch(()=>"")||`${m}: ${o.statusText}`}const T=new Error(m);throw T.status=o.status,T.details=w,T}const g=await o.json();return n&&this.setCache(r,g),g}async listTables(e){return ke.isLocalDb(e)?this.localDb.listTables(e):this.request(`/object/${e}/tables`,"GET",void 0,!0)}async getTableData(e){if(ke.isLocalDb(e.berdl_table_id))return this.localDb.getTableData(e.berdl_table_id,e);const t={...e,limit:e.limit||gt,offset:e.offset||Us,kb_env:this.environment};return this.request("/table-data","POST",t,!1)}async getSchema(e){try{return await this.request(`/schema/${e}/tables`,"GET",void 0,!0)}catch{return null}}}class Hs{constructor(){$(this,"registry");$(this,"schemaMatchCache",new Map);$(this,"defaultConfigCache",null);this.registry=Ge.getInstance()}async resolve(e,t={}){const i=this.findStaticConfig(e,t.objectType);if(i)return{config:i,source:"static",sourceDetail:`static:${i.id}`,fromCache:!0};if(t.schema&&t.schema.tables.length>0){const r=await this.findSchemaMatch(t.schema);if(r)return{config:r.config,source:"schema_match",sourceDetail:`schema_match:${r.configId} (score: ${r.score.toFixed(2)})`,fromCache:!1,warning:`No pattern match found. Matched by schema similarity (${(r.score*100).toFixed(0)}% match).`}}const n=await this.loadDefaultConfig();return n?{config:n,source:"default",sourceDetail:"default_config",fromCache:!1,warning:`No configuration found for "${e}". Using default configuration. Consider adding a mapping in index.json.`}:(K.warn(`[ConfigResolver] No config found for ${e}, using minimal fallback`),{config:this.createDefaultConfig(e),source:"default",sourceDetail:"minimal_fallback",fromCache:!1,warning:`No configuration found for "${e}". Database will be rendered with basic settings.`})}async resolveTable(e,t,i={}){var r;return((r=(await this.resolve(e,i)).config.tables)==null?void 0:r[t])??null}async resolveAndRegister(e,t={}){const i=await this.resolve(e,t);return i.config?(i.config.id||(i.config.id=this.generateConfigId(e)),this.registry.registerDataType(i.config),K.debug(`[ConfigResolver] Registered ${i.config.id} from ${i.source}`),i.config):null}hasStaticConfig(e,t){return this.findStaticConfig(e,t)!==null}async getResolutionHints(e){const t=this.hasStaticConfig(e);return{hasStaticConfig:t,recommendedSource:t?"static":"default"}}findStaticConfig(e,t){var n,r;const i=this.registry.getAppConfig();if(!(i!=null&&i.dataTypes))return null;for(const[d,h]of Object.entries(i.dataTypes))if((n=h.matches)!=null&&n.some(u=>this.matchPattern(e,u))){const u=this.registry.getDataType(d);if(u)return u}if(t){for(const[d,h]of Object.entries(i.dataTypes))if((r=h.matches)!=null&&r.some(u=>this.matchPattern(t,u))){const u=this.registry.getDataType(d);if(u)return u}}return null}matchPattern(e,t){if(t.includes("*")){const i=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return e===t}createDefaultConfig(e){return{id:this.generateConfigId(e),name:`Auto-generated: ${e}`,version:"1.0.0",description:"Minimal configuration generated from source reference",tables:{}}}generateConfigId(e){return`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`}async findSchemaMatch(e){const t=this.getSchemaCacheKey(e),i=this.schemaMatchCache.get(t);if(i&&Date.now()-i.timestamp<3e5){const u=this.registry.getDataType(i.configId);if(u)return{config:u,configId:i.configId,score:i.score}}const n=this.registry.getAppConfig();if(!(n!=null&&n.dataTypes))return null;let r=null;const d=new Set(e.tables.map(u=>u.toLowerCase())),h=new Map;for(const[u,o]of Object.entries(e.columns))h.set(u.toLowerCase(),new Set(o.map(g=>g.toLowerCase())));for(const[u,o]of Object.entries(n.dataTypes)){const g=o.schemaMatch;if(!(g!=null&&g.enabled))continue;const m=this.registry.getDataType(u);if(!(m!=null&&m.tables))continue;const w=g.requiredTables||[],T=g.requiredColumns||{},y=g.minMatchScore||.6;let x=0,v=0;for(const M of w)if(v++,d.has(M.toLowerCase())){x+=1;const N=T[M]||[];if(N.length>0){const z=h.get(M.toLowerCase());if(z){const D=N.filter(j=>z.has(j.toLowerCase())).length;x+=D/N.length*.5}}}if(v===0)continue;const E=x/v;E>=y&&(!r||E>r.score)&&(r={config:m,configId:u,score:E})}return r&&this.schemaMatchCache.set(t,{configId:r.configId,score:r.score,timestamp:Date.now()}),r}getSchemaCacheKey(e){const t=e.tables.sort().join(","),i=Object.entries(e.columns).sort(([n],[r])=>n.localeCompare(r)).map(([n,r])=>`${n}:${r.sort().join(",")}`).join("|");return`${t}|${i}`}async loadDefaultConfig(){var e;if(this.defaultConfigCache)return this.defaultConfigCache;try{const t=this.registry.getAppConfig(),i=((e=t==null?void 0:t.defaultConfig)==null?void 0:e.configUrl)||"/config/default-config.json",n=await fetch(i);if(n.ok){const r=await n.json();return this.defaultConfigCache=r,K.info("[ConfigResolver] Loaded default config"),r}}catch(t){K.warn("[ConfigResolver] Failed to load default config",t)}return null}}let Ht=null;function pt(){return Ht||(Ht=new Hs),Ht}const Ja=Object.freeze(Object.defineProperty({__proto__:null,ConfigResolver:Hs,getConfigResolver:pt},Symbol.toStringTag,{value:"Module"})),Bt={pageSize:50,theme:"light",density:"default",showRowNumbers:!0,locale:"en-US",dateFormat:"YYYY-MM-DD",numberFormat:{decimals:2,thousandsSeparator:",",decimalSeparator:"."}},Ve={pageSize:50,density:"default",showRowNumbers:!0,enableSelection:!0,enableExport:!0,enableColumnReorder:!1,enableColumnResize:!0,defaultSortColumn:"",defaultSortOrder:"asc"},mt={visible:!0,sortable:!0,filterable:!0,searchable:!0},Za={number:"right",integer:"right",float:"right",percentage:"right",currency:"right",filesize:"right",duration:"right",boolean:"center",date:"center",datetime:"center",timestamp:"center"},_e=class _e{constructor(){$(this,"appConfig",null);$(this,"dataTypes",new Map);$(this,"loadedUrls",new Set);$(this,"apiConfigs",new Map);$(this,"defaultApiId",null);$(this,"matchMap",new Map);$(this,"globalSettings",{...Bt})}static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}static reset(){_e.instance=null}async initialize(e){if(this.appConfig=e,e.defaults&&(this.globalSettings={...Bt,...e.defaults,numberFormat:{...Bt.numberFormat,...e.defaults.numberFormat}}),e.apis)if(Object.values(e.apis).forEach(i=>{this.apiConfigs.set(i.id,i)}),e.apis.default)this.defaultApiId="default";else{const i=Object.keys(e.apis)[0];i&&(this.defaultApiId=i)}const t=[];for(const[i,n]of Object.entries(e.dataTypes))n.matches&&n.matches.forEach(r=>this.matchMap.set(r,i)),n.autoLoad!==!1&&t.push(this.loadDataType(i,n));await Promise.all(t)}async loadDataType(e,t){if(t.config){this.registerDataType(t.config);return}if(t.configUrl&&!this.loadedUrls.has(t.configUrl))try{const i=await fetch(t.configUrl);if(!i.ok){K.warn(`Failed to load config from ${t.configUrl}: ${i.status}`);return}const n=await i.json();this.registerDataType(n),this.loadedUrls.add(t.configUrl)}catch(i){K.error(`Error loading data type config from ${t.configUrl}`,i)}}registerDataType(e){if(!e.id){K.error("DataTypeConfig must have an id");return}e.version||(K.warn(`DataTypeConfig ${e.id} missing version, defaulting to 1.0.0`),e.version="1.0.0"),this.dataTypes.set(e.id,e),K.debug(`Registered data type: ${e.id} v${e.version}`)}unregisterDataType(e){return this.dataTypes.delete(e)}getDataType(e){return this.dataTypes.get(e)}hasDataType(e){return this.dataTypes.has(e)}getAllDataTypes(){return Array.from(this.dataTypes.values())}getDataTypeIds(){return Array.from(this.dataTypes.keys())}getTableSchema(e,t){const i=this.dataTypes.get(e);if(i)return i.tables[t]}getColumnSchema(e,t,i){const n=this.getTableSchema(e,t);if(n)return n.columns.find(r=>r.column===i)}getTableNames(e){const t=this.dataTypes.get(e);return t?Object.keys(t.tables):[]}getResolvedTableConfig(e,t){var u,o,g,m,w,T,y,x,v,E,M;const i=this.dataTypes.get(e);if(!i)return null;const n=i.tables[t];if(!n)return null;const r={...Ve,pageSize:((u=i.defaults)==null?void 0:u.pageSize)??Ve.pageSize,density:((o=i.defaults)==null?void 0:o.density)??Ve.density,showRowNumbers:((g=i.defaults)==null?void 0:g.showRowNumbers)??Ve.showRowNumbers,enableSelection:((m=i.defaults)==null?void 0:m.enableSelection)??Ve.enableSelection,enableExport:((w=i.defaults)==null?void 0:w.enableExport)??Ve.enableExport,...n.settings},d=[...i.sharedCategories||[],...n.categories||[]],h=n.columns.map(N=>this.resolveColumnConfig(N));return{name:t,displayName:n.displayName||t,settings:r,categories:d,columns:h,virtualColumns:n.virtualColumns||[],rowConfig:{selectable:((T=n.rowConfig)==null?void 0:T.selectable)??!0,clickable:((y=n.rowConfig)==null?void 0:y.clickable)??!1,clickAction:((x=n.rowConfig)==null?void 0:x.clickAction)??"",heightMode:((v=n.rowConfig)==null?void 0:v.heightMode)??"auto",height:((E=n.rowConfig)==null?void 0:E.height)??"auto",conditionalStyles:((M=n.rowConfig)==null?void 0:M.conditionalStyles)??[]}}}resolveColumnConfig(e){const t=e.dataType||"string",i=Za[t]||"left";return{column:e.column,displayName:e.displayName||e.column.replace(/_/g," "),dataType:t,visible:e.visible??mt.visible,sortable:e.sortable??mt.sortable,filterable:e.filterable??mt.filterable,searchable:e.searchable??mt.searchable,copyable:e.copyable??t==="id",width:e.width||"auto",align:e.align||i,categories:e.categories||[],transform:e.transform}}getGlobalSettings(){return{...this.globalSettings}}getAppConfig(){return this.appConfig}getApiUrl(){var e,t;return((e=this.appConfig)==null?void 0:e.app.apiUrl)||this.defaultApiId&&((t=this.apiConfigs.get(this.defaultApiId))==null?void 0:t.url)||null}getApi(e){return e?this.apiConfigs.get(e):this.defaultApiId?this.apiConfigs.get(this.defaultApiId):void 0}getApis(){return Array.from(this.apiConfigs.values())}getDefaultApiId(){return this.defaultApiId}getAppName(){var e;return((e=this.appConfig)==null?void 0:e.app.name)||"DataTables Viewer"}detectDataType(e){const t=e.dataType||e.type||e.objectType||e.object_type;if(!t)return null;if(this.hasDataType(t))return t;if(this.matchMap.has(t))return this.matchMap.get(t)??null;const i=t.toLowerCase().replace(/[^a-z0-9]/g,"_");if(this.hasDataType(i))return i;const n=this.getDataTypeIds()[0];return n?(K.warn(`Unknown data type "${t}", falling back to "${n}"`),n):null}static fromLegacyConfig(e){var i,n,r;const t={};if(e.tables)for(const[d,h]of Object.entries(e.tables))t[d]={displayName:h.name||d,categories:h.categories||[],columns:(h.columns||[]).map(u=>({column:u.column,displayName:u.displayName,dataType:u.dataType||"string",visible:u.visible,sortable:u.sortable,filterable:u.filterable,width:u.width,categories:u.categories,transform:u.transform})),settings:h.settings};return{id:"legacy",name:e.name||"Legacy Config",version:"1.0.0",description:e.description,defaults:{pageSize:(i=e.defaultSettings)==null?void 0:i.pageSize,density:(n=e.defaultSettings)==null?void 0:n.density,showRowNumbers:(r=e.defaultSettings)==null?void 0:r.showRowNumbers},tables:t}}async resolveAndRegister(e,t){const n=await pt().resolve(e,t);return n.config?(n.config.id||(n.config.id=`auto_${e.replace(/[^a-zA-Z0-9]/g,"_")}`),this.registerDataType(n.config),K.debug(`[DataTypeRegistry] Registered ${n.config.id} from ${n.source}`),n.config):null}isRemoteConfigEnabled(){return!1}getConfigApiSettings(){return null}setAuthToken(e){}async resolveConfig(e,t){return pt().resolve(e,t)}async hasConfigFor(e,t){var n;const i=this.getAppConfig();if(i!=null&&i.dataTypes){for(const[r,d]of Object.entries(i.dataTypes))if((n=d.matches)!=null&&n.some(h=>this.matchPattern(e,h)))return{hasConfig:!0,source:"static"}}return{hasConfig:!1,source:"none"}}matchPattern(e,t){if(t.includes("*")){const i=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return e===t}};$(_e,"instance",null);let Ge=_e;class qs{constructor(e){$(this,"registry");$(this,"legacyConfig",null);$(this,"currentDataTypeId",null);$(this,"isLegacyMode",!1);this.registry=Ge.getInstance(),e&&(this.isNewConfigFormat(e)?this.initializeFromAppConfig(e):this.initializeFromLegacyConfig(e))}isNewConfigFormat(e){var t;return e&&(e.dataTypes||((t=e.app)==null?void 0:t.name))}initializeFromAppConfig(e){this.isLegacyMode=!1,Object.entries(e.dataTypes||{}).forEach(([t,i])=>{i.config&&(this.registry.registerDataType(i.config),this.currentDataTypeId||(this.currentDataTypeId=t))})}initializeFromLegacyConfig(e){this.isLegacyMode=!0,this.legacyConfig=e;const t=Ge.fromLegacyConfig(e);this.registry.registerDataType(t),this.currentDataTypeId="legacy"}async initializeAsync(e){if(e)try{const t=await fetch(e);if(!t.ok){console.warn(`Failed to load config from ${e}`);return}const i=await t.json();if(this.isNewConfigFormat(i)){await this.registry.initialize(i);const n=this.registry.getDataTypeIds();n.length>0&&(this.currentDataTypeId=n[0])}else this.initializeFromLegacyConfig(i)}catch(t){console.error("Error loading configuration:",t)}}setCurrentDataType(e){if(this.registry.hasDataType(e))return this.currentDataTypeId=e,!0;const t=this.registry.detectDataType({dataType:e});return t?(this.currentDataTypeId=t,!0):(K.warn(`Data type "${e}" not found in registry`),!1)}getCurrentDataTypeId(){return this.currentDataTypeId}getCurrentDataType(){if(this.currentDataTypeId)return this.registry.getDataType(this.currentDataTypeId)}detectDataType(e){const t=this.registry.detectDataType(e);return t&&(this.currentDataTypeId=t),t}getTableConfig(e){var t,i;if(this.currentDataTypeId){const n=this.registry.getResolvedTableConfig(this.currentDataTypeId,e);if(n)return this.convertResolvedToLegacy(n)}if((i=(t=this.legacyConfig)==null?void 0:t.tables)!=null&&i[e]){const n=this.legacyConfig.tables[e];return{name:n.name||e,categories:n.categories||[],columns:n.columns||[],settings:{...this.legacyConfig.defaultSettings,...n.settings||{}}}}return{name:e,categories:[],columns:[],settings:this.getGlobalSettings()}}getTableSchema(e){if(this.currentDataTypeId)return this.registry.getTableSchema(this.currentDataTypeId,e)}getResolvedTableConfig(e){return this.currentDataTypeId?this.registry.getResolvedTableConfig(this.currentDataTypeId,e):null}hasTableConfig(e){var t;return this.currentDataTypeId&&this.registry.getTableSchema(this.currentDataTypeId,e)?!0:!!((t=this.legacyConfig)!=null&&t.tables&&Object.prototype.hasOwnProperty.call(this.legacyConfig.tables,e))}getTableNames(){var e;return this.currentDataTypeId?this.registry.getTableNames(this.currentDataTypeId):(e=this.legacyConfig)!=null&&e.tables?Object.keys(this.legacyConfig.tables):[]}getAppName(){var e;return this.registry.getAppName()||((e=this.legacyConfig)==null?void 0:e.name)||"DataTables Viewer"}getApi(e){return this.registry.getApi(e)}getApis(){return this.registry.getApis()}getDefaultApiId(){return this.registry.getDefaultApiId()}getApiUrl(){var e;return this.registry.getApiUrl()||((e=this.legacyConfig)==null?void 0:e.apiUrl)||null}getEnvironment(){var t;const e=this.registry.getAppConfig();return(e==null?void 0:e.app.environment)||((t=this.legacyConfig)==null?void 0:t.environment)||"local"}getGlobalSettings(){var i;const e=this.registry.getGlobalSettings(),t=((i=this.legacyConfig)==null?void 0:i.defaultSettings)||{};return{...e,...t}}convertResolvedToLegacy(e){return{name:e.displayName,categories:e.categories.map(t=>({id:t.id,name:t.name,icon:t.icon,color:t.color,description:t.description,defaultVisible:t.defaultVisible})),columns:e.columns.map(t=>({column:t.column,displayName:t.displayName,description:t.description,width:t.width,visible:t.visible,sortable:t.sortable,filterable:t.filterable,categories:t.categories,transform:Array.isArray(t.transform)?{type:"chain",options:{transforms:t.transform}}:t.transform})),settings:{pageSize:e.settings.pageSize,density:e.settings.density,showRowNumbers:e.settings.showRowNumbers,enableSelection:e.settings.enableSelection,enableExport:e.settings.enableExport}}}getRegistry(){return this.registry}isLegacy(){return this.isLegacyMode}async resolveConfig(e,t){const n=await pt().resolve(e,t);return n.config&&(this.registry.hasDataType(n.config.id)||this.registry.registerDataType(n.config),this.currentDataTypeId=n.config.id),n}isRemoteEnabled(){return!1}setAuthToken(e){}}const zs={berdlTableId:null,activeTableName:null,availableTables:[],headers:[],columns:[],visibleColumns:new Set,data:[],totalCount:0,filteredCount:0,currentPage:0,pageSize:50,sortColumn:null,sortDirection:"asc",sortOrder:"asc",columnFilters:{},advancedFilters:void 0,aggregations:void 0,groupBy:void 0,searchQuery:"",searchValue:"",selectedRows:new Set,loading:!1,error:null,theme:"light",density:"normal",showRowNumbers:!0,queryCached:!1,queryTime:void 0};class en{constructor(e={}){$(this,"state");$(this,"listeners");this.state={...zs,...e},this.listeners=new Set}getState(){return{...this.state}}update(e){e.sortDirection&&!e.sortOrder?e.sortOrder=e.sortDirection:e.sortOrder&&!e.sortDirection&&(e.sortDirection=e.sortOrder),e.searchQuery!==void 0&&e.searchValue===void 0?e.searchValue=e.searchQuery:e.searchValue!==void 0&&e.searchQuery===void 0&&(e.searchQuery=e.searchValue),this.state={...this.state,...e},this.notify()}reset(){this.state={...zs},this.notify()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state))}}class tn{constructor(e){$(this,"categories");$(this,"columnsByCategory");$(this,"initialVisibleCategories");$(this,"uncategorizedColumns");this.categories=new Map,this.columnsByCategory=new Map,this.initialVisibleCategories=new Set,this.uncategorizedColumns=new Set,this.initialize(e)}initialize(e){(e.categories||[]).forEach(i=>{this.categories.set(i.id,i),this.columnsByCategory.set(i.id,new Set),i.defaultVisible!==!1&&this.initialVisibleCategories.add(i.id)}),e.columns&&this.setColumns(e.columns)}setColumns(e){this.uncategorizedColumns.clear(),this.categories.forEach((t,i)=>{var n;return(n=this.columnsByCategory.get(i))==null?void 0:n.clear()}),e.forEach(t=>{const i=t.column;let n=!1;t.categories&&Array.isArray(t.categories)&&t.categories.length>0&&t.categories.forEach(r=>{var d;this.categories.has(r)&&((d=this.columnsByCategory.get(r))==null||d.add(i),n=!0)}),n||this.uncategorizedColumns.add(i)})}getInitialVisibleColumns(){const e=new Set;return this.initialVisibleCategories.forEach(t=>{const i=this.columnsByCategory.get(t);i&&i.forEach(n=>e.add(n))}),this.uncategorizedColumns.forEach(t=>e.add(t)),e}getColumnsForCategory(e){return this.columnsByCategory.get(e)||new Set}calculateVisibilityChange(e,t){const i=this.columnsByCategory.get(e);if(!i||i.size===0)return new Set(t);const n=new Set(t),r=Array.from(i);return r.every(h=>t.has(h))?r.forEach(h=>n.delete(h)):r.forEach(h=>n.add(h)),n}getAllCategories(e){return Array.from(this.categories.values()).map(t=>{const i=this.columnsByCategory.get(t.id),n=(i==null?void 0:i.size)||0,r=n>0&&Array.from(i||[]).every(d=>e.has(d));return{...t,visible:r,columnCount:n}})}getColumnsByCategory(){const e=new Map;return this.columnsByCategory.forEach((t,i)=>{e.set(i,Array.from(t))}),e}getUncategorizedColumns(){return Array.from(this.uncategorizedColumns)}}class Kt{constructor(e){$(this,"container");$(this,"id");$(this,"dom",{});this.container=e.container,this.id=e.id||`cmp-${Math.random().toString(36).substr(2,9)}`}mount(){this.render(),this.bindEvents()}destroy(){this.container.innerHTML="",this.dom={}}cacheDom(e){this.dom={};for(const[t,i]of Object.entries(e)){const n=this.container.querySelector(i);n&&(this.dom[t]=n)}}}class sn extends Kt{constructor(t){super(t);$(this,"configManager");$(this,"stateManager");$(this,"categoryManager",null);$(this,"options");$(this,"expandedCategories",new Set);this.configManager=t.configManager,this.stateManager=t.stateManager,this.options=t,this.stateManager.subscribe(i=>{this.dom.loadBtn&&(this.dom.loadBtn.innerHTML=i.loading?'<span class="ts-spinner"></span> Loading...':'<i class="bi bi-lightning-charge-fill"></i> Load Data',this.dom.loadBtn.disabled=i.loading),this.updateLoadingState(i),!i.loading&&i.availableTables.length>0&&i.data.length>0&&i.activeTableName&&setTimeout(()=>{this.dom.sourceBody&&this.dom.sourceBody.style.display!=="none"&&(this.dom.sourceBody.style.display="none",this.dom.sourceArrow.classList.add("collapsed"))},500),i.activeTableName&&i.availableTables.length>0&&this.updateTableInfo(i.activeTableName),i.columns.length>0&&this.dom.controlList&&this.renderControlList(),this.renderFilterChips(),this.updateAggregationsDisplay(i)})}get onLoadData(){return this.options.onLoadData}updateAggregationsDisplay(t){var r,d;if(!this.dom.aggregationsSection||!this.dom.aggregationsInfo)return;const i=t.aggregations&&t.aggregations.length>0,n=t.groupBy&&t.groupBy.length>0;if(i||n){this.dom.aggregationsSection.style.display="block";const h=((r=t.aggregations)==null?void 0:r.map(o=>`${o.function.toUpperCase()}(${o.column})`).join(", "))||"None",u=((d=t.groupBy)==null?void 0:d.join(", "))||"None";this.dom.aggregationsInfo.innerHTML=`
                <div style="margin-bottom:4px"><strong>Functions:</strong> ${h}</div>
                <div><strong>Group By:</strong> ${u}</div>
            `}else this.dom.aggregationsSection.style.display="none"}setCategoryManager(t){this.categoryManager=t,this.renderControlList(),this.expandColumnsSection()}expandColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="block")}collapseColumnsSection(){this.dom.controlSection&&(this.dom.controlSection.style.display="none")}render(){const t=this.configManager.getAppName()||"DataTables Viewer";this.container.innerHTML=`
            <header class="ts-sidebar-header">
                <div class="ts-brand">
                    <div class="ts-brand-icon"><i class="bi bi-grid-3x3-gap-fill"></i></div>
                    <span class="ts-brand-name">${t}</span>
                </div>
            </header>

            <div class="ts-sidebar-body">
                <!-- Connection -->
                <section class="ts-section" id="ts-source-section" style="padding: 0 4px;">
                    <div class="ts-section-header collapsible" id="ts-source-head">
                        <span class="ts-section-title">Data Source</span>
                        <div style="display:flex; align-items:center; gap:8px">
                            <i class="bi bi-chevron-down ts-section-arrow" id="ts-source-arrow"></i>
                            <i class="bi bi-database-fill-gear ts-text-muted"></i>
                        </div>
                    </div>
                    <div id="ts-source-body">
                        <div class="ts-field">
                            <label class="ts-label">Auth Token <span style="color:red">*</span></label>
                            <input type="password" class="ts-input" id="ts-token" placeholder="Enter KBase token...">
                        </div>
                        <div class="ts-field">
                            <label class="ts-label">Object ID / UPA</label>
                            <input type="text" class="ts-input" id="ts-berdl" 
                                placeholder="e.g., 76990/7/2" value="76990/7/2">
                        </div>
                        <button class="ts-btn-primary" id="ts-load" style="height: 34px; width: 100%;">
                            <i class="bi bi-lightning-charge-fill"></i> Load Data
                        </button>
                        <div style="margin-top: 12px; display: flex; align-items: center; gap: 8px;">
                            <div style="height: 1px; background: var(--c-border-subtle); flex: 1;"></div>
                            <span style="font-size: 11px; color: var(--c-text-muted); text-transform: uppercase;">OR</span>
                            <div style="height: 1px; background: var(--c-border-subtle); flex: 1;"></div>
                        </div>
                        <div class="ts-field" style="margin-top: 12px;">
                            <label class="ts-label">Local DB path / URL</label>
                            <input type="text" class="ts-input" id="ts-local-db-path"
                                placeholder="e.g. /data/my.db">
                        </div>
                        <button class="ts-btn-secondary" id="ts-load-local-db" style="height: 34px; width: 100%; margin-top: 8px;">
                            <i class="bi bi-folder2-open"></i> Load Local DB
                        </button>
                        <div id="ts-loading-indicator" style="display:none;margin-top:12px;padding:12px;background:var(--c-bg-surface);border-radius:var(--radius-sm);border:1px solid var(--c-border-subtle)">
                            <div style="display:flex;align-items:center;gap:10px;color:var(--c-text-secondary);font-size:13px">
                                <span class="ts-spinner" style="width:16px;height:16px"></span>
                                <span id="ts-loading-text">Loading data...</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table Selection -->
                <section class="ts-section" id="ts-nav-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Table</span>
                    </div>
                    <select class="ts-select" id="ts-table-select"></select>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
                        <button class="ts-btn-secondary" id="ts-view-schema">
                            <i class="bi bi-file-earmark-code"></i> Schema
                        </button>
                        <button class="ts-btn-secondary" id="ts-view-stats">
                            <i class="bi bi-graph-up"></i> Stats
                        </button>
                    </div>
                </section>

                <!-- Data Control (Unified Categories & Columns) -->
                <section class="ts-section" id="ts-control-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Data Control</span>
                        <div class="ts-section-actions">
                            <button class="ts-section-action" id="ts-control-expand-all">Expand All</button>
                            <button class="ts-section-action" id="ts-control-show-all">Show All</button>
                        </div>
                    </div>
                    <div class="ts-control-list" id="ts-control-list"></div>
                </section>

                <!-- Active Filters -->
                <section class="ts-section" id="ts-filters-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Active Filters</span>
                        <div style="display:flex;gap:4px">
                            <button class="ts-section-action" id="ts-advanced-filters" title="Advanced Filters">
                                <i class="bi bi-funnel-fill"></i> Advanced
                            </button>
                            <button class="ts-section-action" id="ts-clear-filters">Clear All</button>
                        </div>
                    </div>
                    <div class="ts-filter-chips" id="ts-filter-chips"></div>
                </section>
                
                <!-- Aggregations -->
                <section class="ts-section" id="ts-aggregations-section" style="display:none; padding: 0 4px;">
                    <div class="ts-section-header">
                        <span class="ts-section-title">Aggregations</span>
                        <button class="ts-section-action" id="ts-aggregations-btn">
                            <i class="bi bi-calculator"></i> Configure
                        </button>
                    </div>
                    <div id="ts-aggregations-info" style="padding:8px;font-size:12px;color:var(--c-text-muted)">
                        No aggregations configured
                    </div>
                </section>
            </div>

            <footer class="ts-sidebar-footer">
                <div class="ts-btn-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="ts-btn-secondary" id="ts-export">
                        <i class="bi bi-download"></i> Export
                    </button>
                    <button class="ts-btn-secondary" id="ts-reset">
                        <i class="bi bi-arrow-counterclockwise"></i> Reset
                    </button>
                </div>
            </footer>
        `,this.cacheDom({token:"#ts-token",berdl:"#ts-berdl",loadBtn:"#ts-load",sourceHead:"#ts-source-head",sourceBody:"#ts-source-body",sourceArrow:"#ts-source-arrow",loadingIndicator:"#ts-loading-indicator",loadingText:"#ts-loading-text",navSection:"#ts-nav-section",tableSelect:"#ts-table-select",viewSchema:"#ts-view-schema",viewStats:"#ts-view-stats",controlSection:"#ts-control-section",controlList:"#ts-control-list",controlExpandAll:"#ts-control-expand-all",controlShowAll:"#ts-control-show-all",filtersSection:"#ts-filters-section",filterChips:"#ts-filter-chips",clearFilters:"#ts-clear-filters",advancedFilters:"#ts-advanced-filters",aggregationsSection:"#ts-aggregations-section",aggregationsBtn:"#ts-aggregations-btn",aggregationsInfo:"#ts-aggregations-info",export:"#ts-export",reset:"#ts-reset",localDbPath:"#ts-local-db-path",loadLocalDb:"#ts-load-local-db"})}bindEvents(){var i,n,r,d,h,u,o,g,m,w,T;(i=this.dom.loadBtn)==null||i.addEventListener("click",()=>{this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.options.onLoadData()}),(n=this.dom.sourceHead)==null||n.addEventListener("click",()=>{const y=this.dom.sourceBody.style.display==="none";this.dom.sourceBody.style.display=y?"block":"none",this.dom.sourceArrow.classList.toggle("collapsed",!y)}),(r=this.dom.berdl)==null||r.addEventListener("keypress",y=>{y.key==="Enter"&&this.dom.loadBtn.click()});const t=()=>{var E,M;const y=((M=(E=this.dom.localDbPath)==null?void 0:E.value)==null?void 0:M.trim())||"";if(!y||!this.options.onLoadDbPath)return;const v=(y.split("?")[0].split("#")[0].split("/").pop()||y).replace(/\.(db|sqlite)$/i,"");this.dom.berdl&&v&&(this.dom.berdl.value=`local/${v}`),this.options.onLoadDbPath(y)};(d=this.dom.loadLocalDb)==null||d.addEventListener("click",t),(h=this.dom.localDbPath)==null||h.addEventListener("keypress",y=>{y.key==="Enter"&&t()}),(u=this.dom.tableSelect)==null||u.addEventListener("change",y=>{this.options.onTableChange(y.target.value)}),(o=this.dom.export)==null||o.addEventListener("click",()=>this.options.onExport()),(g=this.dom.reset)==null||g.addEventListener("click",()=>this.options.onReset()),(m=this.dom.controlList)==null||m.addEventListener("click",y=>{const x=y.target;if(x.closest(".ts-switch")){const v=x.closest(".ts-cat-group"),E=v==null?void 0:v.dataset.cat;if(E&&this.categoryManager){const M=this.stateManager.getState().visibleColumns,N=this.categoryManager.calculateVisibilityChange(E,M);this.stateManager.update({visibleColumns:N})}return}if(x.closest(".ts-cat-head")){const v=x.closest(".ts-cat-group"),E=v==null?void 0:v.dataset.cat;E&&(this.expandedCategories.has(E)?this.expandedCategories.delete(E):this.expandedCategories.add(E),v==null||v.classList.toggle("expanded"));return}if(x.matches('input[type="checkbox"]')){const v=x.dataset.col;if(v){const E=this.stateManager.getState();x.checked?E.visibleColumns.add(v):E.visibleColumns.delete(v),this.stateManager.update({visibleColumns:E.visibleColumns})}}}),(w=this.dom.controlExpandAll)==null||w.addEventListener("click",()=>{const y=this.dom.controlList.querySelectorAll(".ts-cat-group"),x=Array.from(y).some(v=>!v.classList.contains("expanded"));y.forEach(v=>{const E=v.dataset.cat;x?(v.classList.add("expanded"),E&&this.expandedCategories.add(E)):(v.classList.remove("expanded"),E&&this.expandedCategories.delete(E))}),this.dom.controlExpandAll.textContent=x?"Collapse All":"Expand All"}),(T=this.dom.controlShowAll)==null||T.addEventListener("click",()=>{this.toggleAllColumns()}),this.dom.viewSchema&&this.dom.viewSchema.addEventListener("click",()=>{const y=this.stateManager.getState();if(y.activeTableName)this.options.onShowSchema(y.activeTableName);else{const x=this.dom.tableSelect;x!=null&&x.value&&this.options.onShowSchema(x.value)}}),this.dom.viewStats&&this.dom.viewStats.addEventListener("click",()=>{const y=this.stateManager.getState();if(y.activeTableName)this.options.onShowStats(y.activeTableName);else{const x=this.dom.tableSelect;x!=null&&x.value&&this.options.onShowStats(x.value)}}),this.dom.clearFilters&&this.dom.clearFilters.addEventListener("click",()=>{this.stateManager.update({columnFilters:{},advancedFilters:void 0,currentPage:0})}),this.dom.advancedFilters&&this.dom.advancedFilters.addEventListener("click",()=>{this.showAdvancedFilterPanel()}),this.dom.aggregationsBtn&&this.dom.aggregationsBtn.addEventListener("click",()=>{this.showAggregationsPanel()})}showAdvancedFilterPanel(){const t=this.stateManager.getState(),i=t.columns.map(r=>({column:r.column,displayName:r.displayName||r.column,type:r.dataType||"TEXT"})),n=document.createElement("div");n.className="ts-modal-overlay show",n.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Advanced Filters</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body" id="ts-advanced-filter-container"></div>
            </div>
        `,document.body.appendChild(n),we(async()=>{const{AdvancedFilterPanel:r}=await import("./AdvancedFilterPanel-CGvq6EZB.js");return{AdvancedFilterPanel:r}},[]).then(({AdvancedFilterPanel:r})=>{var u;const d=n.querySelector("#ts-advanced-filter-container");if(!d)return;const h=new r({container:d,columns:i,onApply:o=>{this.stateManager.update({advancedFilters:o,currentPage:0}),document.body.removeChild(n),this.options.onLoadData()},onCancel:()=>{document.body.removeChild(n)}});t.advancedFilters&&h.setFilters(t.advancedFilters),(u=n.querySelector(".ts-modal-close"))==null||u.addEventListener("click",()=>{document.body.removeChild(n)}),h.mount()})}showAggregationsPanel(){var o,g,m,w;const t=this.stateManager.getState(),i=t.columns.map(T=>({column:T.column,displayName:T.displayName||T.column,type:T.dataType||"TEXT"})),n=document.createElement("div");n.className="ts-modal-overlay show",n.innerHTML=`
            <div class="ts-modal" style="max-width:600px">
                <div class="ts-modal-header">
                    <h3>Configure Aggregations</h3>
                    <button class="ts-modal-close"><i class="bi bi-x"></i></button>
                </div>
                <div class="ts-modal-body">
                    <div style="margin-bottom:16px">
                        <label style="display:block;margin-bottom:8px;font-weight:500">Group By Columns</label>
                        <select multiple class="ts-select" id="ts-group-by" style="min-height:100px">
                            ${i.map(T=>`<option value="${T.column}">${T.displayName||T.column}</option>`).join("")}
                        </select>
                        <small style="color:var(--c-text-muted)">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                    <div id="ts-aggregations-list"></div>
                    <button class="ts-btn-secondary" id="ts-add-aggregation" style="margin-top:12px">
                        <i class="bi bi-plus"></i> Add Aggregation
                    </button>
                </div>
                <div class="ts-modal-footer">
                    <button class="ts-btn-secondary" id="ts-agg-cancel">Cancel</button>
                    <button class="ts-btn-primary" id="ts-agg-apply">Apply</button>
                </div>
            </div>
        `,document.body.appendChild(n);const r=t.aggregations||[],d=t.groupBy||[],h=()=>{const T=n.querySelector("#ts-aggregations-list");if(T){if(r.length===0){T.innerHTML='<p style="color:var(--c-text-muted);font-size:13px">No aggregations. Click "Add Aggregation" to create one.</p>';return}T.innerHTML=r.map((y,x)=>`
                <div class="ts-agg-item" style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;margin-bottom:8px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm)">
                    <select class="ts-select" data-agg-col="${x}">
                        ${i.map(v=>`<option value="${v.column}" ${y.column===v.column?"selected":""}>${v.displayName||v.column}</option>`).join("")}
                    </select>
                    <select class="ts-select" data-agg-func="${x}">
                        <option value="count" ${y.function==="count"?"selected":""}>Count</option>
                        <option value="sum" ${y.function==="sum"?"selected":""}>Sum</option>
                        <option value="avg" ${y.function==="avg"?"selected":""}>Average</option>
                        <option value="min" ${y.function==="min"?"selected":""}>Min</option>
                        <option value="max" ${y.function==="max"?"selected":""}>Max</option>
                        <option value="stddev" ${y.function==="stddev"?"selected":""}>StdDev</option>
                        <option value="variance" ${y.function==="variance"?"selected":""}>Variance</option>
                        <option value="distinct_count" ${y.function==="distinct_count"?"selected":""}>Distinct Count</option>
                    </select>
                    <button class="ts-btn-secondary" data-agg-remove="${x}" style="padding:8px">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `).join(""),T.querySelectorAll("[data-agg-col]").forEach(y=>{y.addEventListener("change",x=>{const v=parseInt(x.target.dataset.aggCol||"0");r[v].column=x.target.value})}),T.querySelectorAll("[data-agg-func]").forEach(y=>{y.addEventListener("change",x=>{const v=parseInt(x.target.dataset.aggFunc||"0");r[v].function=x.target.value})}),T.querySelectorAll("[data-agg-remove]").forEach(y=>{y.addEventListener("click",x=>{const v=parseInt(x.target.dataset.aggRemove||"0");r.splice(v,1),h()})})}};(o=n.querySelector("#ts-add-aggregation"))==null||o.addEventListener("click",()=>{var T;r.push({column:((T=i[0])==null?void 0:T.column)||"",function:"count"}),h()}),(g=n.querySelector("#ts-agg-apply"))==null||g.addEventListener("click",()=>{const T=n.querySelector("#ts-group-by"),y=Array.from(T.selectedOptions).map(x=>x.value);this.stateManager.update({aggregations:r.length>0?r:void 0,groupBy:y.length>0?y:void 0,currentPage:0}),document.body.removeChild(n),this.options.onLoadData&&this.options.onLoadData()}),(m=n.querySelector("#ts-agg-cancel"))==null||m.addEventListener("click",()=>{document.body.removeChild(n)}),(w=n.querySelector(".ts-modal-close"))==null||w.addEventListener("click",()=>{document.body.removeChild(n)}),h();const u=n.querySelector("#ts-group-by");d&&Array.from(u.options).forEach(T=>{T.selected=d.includes(T.value)})}updateTables(t){this.dom.navSection&&(t.length>0?(this.dom.navSection.style.display="block",this.dom.tableSelect.innerHTML="",t.forEach(i=>{const n=document.createElement("option");n.value=i.name;const r=i.row_count??i.count,d=typeof r=="number"?r.toLocaleString():"?";n.textContent=`${i.displayName||i.name} (${d} rows)`,this.dom.tableSelect.appendChild(n)})):this.dom.navSection.style.display="none")}updateTableInfo(t){this.dom.tableSelect&&this.dom.tableSelect.value!==t&&(this.dom.tableSelect.value=t)}renderControlList(){if(!this.dom.controlList)return;this.dom.controlSection.style.display="block";const t=this.stateManager.getState(),i=this.categoryManager?this.categoryManager.getAllCategories(t.visibleColumns):[],n=this.categoryManager?this.categoryManager.getColumnsByCategory():new Map,r=this.categoryManager?this.categoryManager.getUncategorizedColumns():t.columns.map(u=>u.column);let d="";i.forEach(u=>{const o=n.get(u.id)||[];o.length!==0&&(d+=this.renderCategoryGroup(u,o,t))}),r.length>0&&(d+=this.renderCategoryGroup({id:"other",name:"Other Attributes",icon:"bi-three-dots",color:"#64748b",visible:!0},r,t,!0)),this.dom.controlList.innerHTML=d;const h=t.columns.every(u=>t.visibleColumns.has(u.column));this.dom.controlShowAll&&(this.dom.controlShowAll.textContent=h?"Hide All":"Show All")}renderCategoryGroup(t,i,n,r=!1){const d=n.columns.reduce((u,o)=>(u[o.column]=o,u),{});return`
            <div class="ts-cat-group ${this.expandedCategories.has(t.id)?"expanded":""}" data-cat="${t.id}">
                <div class="ts-cat-head">
                    <div class="ts-cat-info">
                        <i class="bi bi-chevron-down ts-cat-arrow"></i>
                        <i class="${t.icon||"bi bi-folder-fill"}" style="color:${t.color||"var(--c-accent)"}"></i>
                        <span class="ts-cat-name">${t.name}</span>
                        <span class="ts-cat-count">${i.length}</span>
                    </div>
                    ${r?"":`<div class="ts-switch ${t.visible?"on":""}"></div>`}
                </div>
                <div class="ts-cat-cols">
                    ${i.map(u=>{const o=d[u]||{displayName:u};return`
                            <label class="ts-col-item">
                                <input type="checkbox" data-col="${u}" ${n.visibleColumns.has(u)?"checked":""}>
                                <span>${o.displayName||u}</span>
                            </label>
                        `}).join("")}
                </div>
            </div>
        `}renderFilterChips(){const t=this.stateManager.getState(),i=t.columnFilters,n=t.advancedFilters,r=Object.keys(i).length>0||n&&n.length>0;if(this.dom.filtersSection&&(this.dom.filtersSection.style.display=r?"block":"none"),!this.dom.filterChips)return;const d=[],h=new Set((n||[]).map(u=>u.column));Object.entries(i).forEach(([u,o])=>{h.has(u)||d.push(`
                    <div class="ts-chip">
                        <span class="ts-chip-label">${u}:</span>
                        <span class="ts-chip-value">${o}</span>
                        <button class="ts-chip-clear" data-col="${u}"><i class="bi bi-x"></i></button>
                    </div>
                `)}),n&&n.length>0&&n.forEach((u,o)=>{const g=this.getOperatorLabel(u.operator),m=u.operator==="between"?`${u.value} - ${u.value2}`:u.operator==="in"||u.operator==="not_in"?Array.isArray(u.value)?u.value.join(", "):String(u.value):u.operator==="is_null"||u.operator==="is_not_null"?"":String(u.value||"");d.push(`
                    <div class="ts-chip ts-chip-advanced">
                        <span class="ts-chip-label">${u.column} ${g}:</span>
                        <span class="ts-chip-value">${m}</span>
                        <button class="ts-chip-clear" data-adv-filter="${o}"><i class="bi bi-x"></i></button>
                    </div>
                `)}),this.dom.filterChips.innerHTML=d.join(""),this.dom.filterChips.querySelectorAll(".ts-chip-clear").forEach(u=>{u.addEventListener("click",o=>{var w;const g=o.currentTarget.dataset.col,m=o.currentTarget.dataset.advFilter;if(g){const T={...this.stateManager.getState().columnFilters};delete T[g],this.stateManager.update({columnFilters:T,currentPage:0})}else if(m!==void 0){const T=this.stateManager.getState(),y=(w=T.advancedFilters)==null?void 0:w[parseInt(m)],x=[...T.advancedFilters||[]];x.splice(parseInt(m),1);const v={...T.columnFilters};y!=null&&y.column&&delete v[y.column],this.stateManager.update({columnFilters:v,advancedFilters:x.length>0?x:void 0,currentPage:0})}})})}getOperatorLabel(t){return{eq:"=",ne:"!=",gt:">",gte:">=",lt:"<",lte:"<=",like:"contains",ilike:"contains (i)",in:"in",not_in:"not in",between:"between",is_null:"is null",is_not_null:"is not null",regex:"regex"}[t]||t}toggleAllColumns(){const t=this.stateManager.getState(),i=t.columns.every(r=>t.visibleColumns.has(r.column)),n=new Set(t.visibleColumns);t.columns.forEach(r=>{i?n.delete(r.column):n.add(r.column)}),this.stateManager.update({visibleColumns:n}),this.renderControlList()}getToken(){var t;return((t=this.dom.token)==null?void 0:t.value)||""}getBerdlId(){var t;return((t=this.dom.berdl)==null?void 0:t.value)||""}renderCategories(){this.renderControlList()}renderColumnList(){this.renderControlList()}updateLoadingState(t){if(!this.dom.loadingIndicator||!this.dom.loadingText)return;t.loading&&t.availableTables.length===0?(this.dom.loadingIndicator.style.display="block",this.dom.sourceBody&&(this.dom.sourceBody.style.display="block",this.dom.sourceArrow.classList.remove("collapsed")),this.dom.loadingText.textContent="Fetching tables..."):this.dom.loadingIndicator.style.display="none"}}class an extends Kt{constructor(t){super(t);$(this,"options");$(this,"searchTimer");this.options=t}render(){this.container.innerHTML=`
            <div class="ts-search-box">
                <div class="ts-search-input-wrap">
                    <input type="text" id="ts-search" class="ts-search" 
                        placeholder="Highlight matches (doesn't filter rows)..." 
                        aria-label="Highlight matches in table (does not filter rows)">
                    <button class="ts-search-clear" id="ts-search-clear" aria-label="Clear search">
                        <i class="bi bi-x-lg"></i>
                    </button>
                    <i class="bi bi-search ts-search-icon"></i>
                </div>
                <div class="ts-search-nav">
                    <button class="ts-search-nav-btn" id="ts-search-prev" title="Previous match (Shift+Enter)" aria-label="Previous match">
                        <i class="bi bi-chevron-up"></i>
                    </button>
                    <span class="ts-search-nav-info" id="ts-search-info">0/0</span>
                    <button class="ts-search-nav-btn" id="ts-search-next" title="Next match (Enter)" aria-label="Next match">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div class="ts-spacer" style="flex:1"></div>
            <div class="ts-toolbar-actions">
                <button class="ts-tb-btn" id="ts-refresh" title="Refresh Data">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="ts-tb-icon" id="ts-settings-btn" title="Settings">
                    <i class="bi bi-gear-fill"></i>
                </button>
            </div>
        `,this.cacheDom({search:"#ts-search",searchClear:"#ts-search-clear",searchPrev:"#ts-search-prev",searchNext:"#ts-search-next",searchInfo:"#ts-search-info",refresh:"#ts-refresh",settings:"#ts-settings-btn"})}bindEvents(){var t,i,n,r,d,h;(t=this.dom.search)==null||t.addEventListener("input",()=>{clearTimeout(this.searchTimer);const u=this.dom.search.value;this.updateSearchNav(),this.searchTimer=setTimeout(()=>{this.options.onSearch(u),setTimeout(()=>this.updateSearchNav(),350)},300)}),(i=this.dom.search)==null||i.addEventListener("keydown",u=>{var o,g,m,w;u.key==="Enter"&&!u.shiftKey?(u.preventDefault(),(g=(o=this.options).onSearchNext)==null||g.call(o),this.updateSearchNav()):u.key==="Enter"&&u.shiftKey&&(u.preventDefault(),(w=(m=this.options).onSearchPrev)==null||w.call(m),this.updateSearchNav())}),(n=this.dom.searchClear)==null||n.addEventListener("click",()=>{this.dom.search.value="",this.options.onSearch(""),this.updateSearchNav(),this.dom.search.focus()}),(r=this.dom.searchPrev)==null||r.addEventListener("click",()=>{var u,o;(o=(u=this.options).onSearchPrev)==null||o.call(u),this.updateSearchNav()}),(d=this.dom.searchNext)==null||d.addEventListener("click",()=>{var u,o;(o=(u=this.options).onSearchNext)==null||o.call(u),this.updateSearchNav()}),(h=this.dom.refresh)==null||h.addEventListener("click",()=>this.options.onRefresh()),setTimeout(()=>this.updateSearchNav(),100)}updateSearchNav(){var r;const t=this.dom.search,i=((r=t==null?void 0:t.value)==null?void 0:r.trim())||"",n=this.container.querySelector(".ts-search-nav");if(n){if(i)n.style.opacity="1",n.style.pointerEvents="auto";else{n.style.opacity="0",n.style.pointerEvents="none";return}if(this.options.getSearchMatchInfo){const d=this.options.getSearchMatchInfo();this.dom.searchInfo&&(d.total>0?(this.dom.searchInfo.textContent=`${d.current}/${d.total}`,this.dom.searchPrev.disabled=!1,this.dom.searchNext.disabled=!1):(this.dom.searchInfo.textContent="0/0",this.dom.searchPrev.disabled=!0,this.dom.searchNext.disabled=!0))}}}getSettingsButton(){return this.dom.settings}setSearch(t){this.dom.search&&(this.dom.search.value=t)}focusSearch(){this.dom.search&&(this.dom.search.focus(),this.dom.search.select())}}const C=class C{static escapeHtml(e){if(e==null)return"";const t=document.createElement("div");return t.textContent=String(e),t.innerHTML}static apply(e,t,i){if(!t)return e!=null?C.escapeHtml(String(e)):"";if(Array.isArray(t))return C.chain(e,{transforms:t},i);const n=t;if(n.condition&&!C.evaluateCondition(n.condition,e,i))return n.fallback?typeof n.fallback=="string"?C.escapeHtml(n.fallback):C.apply(e,n.fallback,i):e!=null?C.escapeHtml(String(e)):"";const r=t.type;if(typeof C[r]=="function")return C[r](e,t.options||{},i);if(C.customTransformers.has(r)){const d=C.customTransformers.get(r);if(d)return d(e,t.options||{},i)}return K.warn(`Unknown transformer type: "${r}"`),e!=null?C.escapeHtml(String(e)):""}static evaluateCondition(e,t,i){const n=e.column?i[e.column]:t,r=e.value;switch(e.operator){case"eq":return n===r;case"neq":return n!==r;case"gt":return Number(n)>Number(r);case"gte":return Number(n)>=Number(r);case"lt":return Number(n)<Number(r);case"lte":return Number(n)<=Number(r);case"contains":return String(n).includes(String(r));case"startsWith":return String(n).startsWith(String(r));case"endsWith":return String(n).endsWith(String(r));case"regex":return new RegExp(String(r)).test(String(n));case"isEmpty":return n==null||n==="";case"isNotEmpty":return n!=null&&n!=="";default:return!0}}static chain(e,t,i){if(!t.transforms||!Array.isArray(t.transforms))return C.escapeHtml(String(e??""));let n=e;for(const r of t.transforms){if(t.transforms.indexOf(r)===t.transforms.length-1)return C.apply(n,r,i);n=C.apply(n,r,i)}return C.escapeHtml(String(n??""))}static number(e,t,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.decimals??2,d=t.locale||"en-US",h=t.prefix||"",u=t.suffix||"";let o;return t.notation==="scientific"?o=n.toExponential(r):t.notation==="compact"?o=new Intl.NumberFormat(d,{notation:"compact",maximumFractionDigits:r}).format(n):t.notation==="engineering"?o=n.toExponential(r):o=new Intl.NumberFormat(d,{minimumFractionDigits:t.minDecimals??0,maximumFractionDigits:r}).format(n),`<span class="ts-number">${C.escapeHtml(h)}${o}${C.escapeHtml(u)}</span>`}static percentage(e,t,i){if(e==null||e==="")return"";let n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));t.scale100!==!1&&n>=0&&n<=1&&(n*=100);const r=t.decimals??1,d=n.toFixed(r);if(t.showBar){const h=Math.min(100,Math.max(0,n)),u=t.color||"#6366f1";return`
                <div class="ts-percentage">
                    <div class="ts-percentage-bar" style="width:${h}%;background:${u}"></div>
                    <span class="ts-percentage-value">${d}%</span>
                </div>
            `}return`<span class="ts-number">${d}%</span>`}static currency(e,t,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.locale||"en-US",d=t.currency||"USD";return`<span class="ts-currency">${new Intl.NumberFormat(r,{style:"currency",currency:d,minimumFractionDigits:t.decimals??2,maximumFractionDigits:t.decimals??2}).format(n)}</span>`}static filesize(e,t,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.binary!==!1,d=r?["B","KiB","MiB","GiB","TiB","PiB"]:["B","KB","MB","GB","TB","PB"],h=r?1024:1e3;let u=n,o=0;for(;u>=h&&o<d.length-1;)u/=h,o++;const g=t.decimals??(o===0?0:2);return`<span class="ts-filesize">${u.toFixed(g)} ${d[o]}</span>`}static duration(e,t,i){if(e==null||e==="")return"";let n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.format||"short";if(r==="clock"){const u=Math.floor(n/3600),o=Math.floor(n%3600/60),g=Math.floor(n%60);return u>0?`<span class="ts-duration">${u}:${String(o).padStart(2,"0")}:${String(g).padStart(2,"0")}</span>`:`<span class="ts-duration">${o}:${String(g).padStart(2,"0")}</span>`}const d=[{name:r==="long"?"day":"d",seconds:86400},{name:r==="long"?"hour":"h",seconds:3600},{name:r==="long"?"minute":"m",seconds:60},{name:r==="long"?"second":"s",seconds:1}],h=[];for(const u of d)if(n>=u.seconds){const o=Math.floor(n/u.seconds);n%=u.seconds,r==="long"?h.push(`${o} ${u.name}${o!==1?"s":""}`):h.push(`${o}${u.name}`)}return`<span class="ts-duration">${h.join(r==="long"?", ":" ")||"0s"}</span>`}static date(e,t,i){if(e==null||e==="")return"";const n=new Date(e);if(isNaN(n.getTime()))return C.escapeHtml(String(e));const r=t.locale||"en-US";return t.relative?`<span class="ts-date" title="${n.toISOString()}">${C.relativeTime(n)}</span>`:`<span class="ts-date">${new Intl.DateTimeFormat(r,{dateStyle:t.dateStyle||"medium"}).format(n)}</span>`}static datetime(e,t,i){if(e==null||e==="")return"";const n=new Date(e);if(isNaN(n.getTime()))return C.escapeHtml(String(e));const r=t.locale||"en-US",d=t.timezone||void 0;return`<span class="ts-datetime">${new Intl.DateTimeFormat(r,{dateStyle:t.dateStyle||"medium",timeStyle:t.timeStyle||"short",timeZone:d}).format(n)}</span>`}static relativeTime(e){const i=new Date().getTime()-e.getTime(),n=Math.abs(i/1e3),r=i<0,d=[[31536e3,"year"],[2592e3,"month"],[86400,"day"],[3600,"hour"],[60,"minute"],[1,"second"]];for(const[h,u]of d)if(n>=h){const o=Math.floor(n/h),g=o!==1?"s":"";return r?`in ${o} ${u}${g}`:`${o} ${u}${g} ago`}return"just now"}static boolean(e,t,i){const n=e===!0||e==="true"||e===1||e==="1";if(t.trueIcon||t.falseIcon){const h=n?t.trueIcon||"bi-check-circle-fill":t.falseIcon||"bi-x-circle",u=n?t.trueColor||"#22c55e":t.falseColor||"#ef4444";return`<i class="${h}" style="color:${u};font-size:1.1em"></i>`}const r=n?t.trueText||"Yes":t.falseText||"No";return`<span class="ts-boolean" style="color:${n?t.trueColor||"#22c55e":t.falseColor||"#94a3b8"}">${C.escapeHtml(r)}</span>`}static heatmap(e,t,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.min??-4,d=t.max??4,h=t.colorScale||"diverging",u=(n-r)/(d-r),o=Math.max(0,Math.min(1,u));let g,m;if(h==="diverging"){let y,x,v;if(o<.5){const E=o*2;y=Math.round(59+196*E),x=Math.round(130+125*E),v=Math.round(246+9*E),m=E<.5?"#fff":"#1e293b"}else{const E=(o-.5)*2;y=Math.round(255+-16*E),x=Math.round(255+-187*E),v=Math.round(255+-187*E),m=E>.5?"#fff":"#1e293b"}g=`rgb(${y}, ${x}, ${v})`}else if(h==="sequential"){const y=Math.round(236+-228*o),x=Math.round(254+-109*o),v=Math.round(255+-77*o);g=`rgb(${y}, ${x}, ${v})`,m=o>.5?"#fff":"#1e293b"}else g="transparent",m="inherit";const w=t.decimals??2,T=t.showValue!==!1?n.toFixed(w):"";return`<span class="ts-heatmap" style="background:${g};color:${m}">${T}</span>`}static progress(e,t,i){if(e==null||e==="")return"";const n=Number(e);if(isNaN(n))return C.escapeHtml(String(e));const r=t.max??100,d=Math.min(100,Math.max(0,n/r*100)),h=t.color||"#6366f1",u=t.showValue!==!1;return`
            <div class="ts-progress">
                <div class="ts-progress-bar" style="width:${d}%;background:${h}"></div>
                ${u?`<span class="ts-progress-value">${n}${t.suffix||""}</span>`:""}
            </div>
        `}static link(e,t,i={}){if(e==null||e==="")return"";const n=String(e),r=encodeURIComponent(n);let d=t.urlTemplate.replace(/\{value\}/g,r);i&&Object.keys(i).length>0&&Object.keys(i).forEach(m=>{const w=`{${m}}`;d.includes(w)&&(d=d.replace(new RegExp(w.replace(/[{}]/g,"\\$&"),"g"),encodeURIComponent(String(i[m]||""))))});let h=n;t.labelTemplate&&(h=t.labelTemplate.replace(/\{value\}/g,n),i&&Object.keys(i).length>0&&Object.keys(i).forEach(m=>{h=h.replace(new RegExp(`\\{${m}\\}`,"g"),String(i[m]||""))}));const u=t.target||"_blank",o=u==="_blank"?' rel="noopener noreferrer"':"",g=t.icon?`<i class="${t.icon}"></i> `:"";return`<a href="${d}" target="${u}"${o} class="ts-cell-link">${g}${C.escapeHtml(h)}</a>`}static replace(e,t){if(e==null||e==="")return"";const i=String(e),n=t.pattern||t.find,r=t.replaceWith||t.replace||"";if(!n)return i;if(t.isRegex)try{const d=t.flags||"g",h=new RegExp(n,d);return i.replace(h,r)}catch(d){return K.error("Invalid regex in replace transformer",d),i}return i.split(n).join(r)}static merge(e,t,i){if(!i||!t.columns||!Array.isArray(t.columns))return"";const n=t.skipEmpty!==!1;if(t.template){let h=t.template;return t.columns.forEach(u=>{const o=i[u],g=`{${u}}`;n&&(o==null||o==="")?(h=h.replace(new RegExp(`\\s*\\(${g}\\)`,"g"),""),h=h.replace(new RegExp(`${g}\\s*[|,;:]\\s*`,"g"),""),h=h.replace(new RegExp(`\\s*[|,;:]\\s*${g}`,"g"),""),h=h.replace(g,"")):h=h.replace(g,String(o||""))}),C.escapeHtml(h.trim())}const r=t.separator||" | ",d=t.columns.map(h=>i[h]).filter(h=>!n||h!=null&&h!=="").map(h=>String(h));return C.escapeHtml(d.join(r))}static badge(e,t,i){if(e==null||e==="")return"";const n=String(e);let h=(t.colorMap||{})[n]||t.color||t.defaultColor;if(!h){const g=["#6366f1","#ef4444","#10b981","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316"];let m=0;for(let w=0;w<n.length;w++)m=n.charCodeAt(w)+((m<<5)-m);h=g[Math.abs(m)%g.length]}const u=t.variant||"default";let o;return u==="subtle"?o=`background:${h}15;color:${h};border:none`:u==="outline"?o=`background:transparent;color:${h};border:1px solid ${h}`:o=`background:${h}20;color:${h};border:1px solid ${h}40`,`<span class="ts-badge" style="${o}">${C.escapeHtml(n)}</span>`}static array(e,t,i){if(e==null)return"";let n;if(Array.isArray(e))n=e;else if(typeof e=="string"){const o=t.separator||",";n=e.split(o).map(g=>g.trim()).filter(Boolean)}else return C.escapeHtml(String(e));const r=t.limit||5,d=n.slice(0,r),h=n.length-r,u=d.map(o=>C.badge(o,{color:t.color||"#6366f1",variant:"subtle"},i)).join(" ");return h>0?`${u} <span class="ts-badge-more">+${h}</span>`:u}static sequence(e,t){if(!e)return"";let i=String(e);if(t.chunkSize&&t.chunkSize>0){const u=new RegExp(`.{1,${t.chunkSize}}`,"g"),o=i.match(u);o&&(i=o.join(" "))}const n=t.maxLength||30,r=i,d=t.showCopyButton!==!1;i.length>n&&(i=i.substring(0,n)+"...");const h=d?`<button class="ts-copy-btn" data-id="${C.escapeHtml(r)}" title="Copy sequence"><i class="bi bi-clipboard"></i></button>`:"";return`<span class="ts-sequence" title="${C.escapeHtml(r)}">${C.escapeHtml(i)}${h}</span>`}static truncate(e,t){if(!e)return"";const i=String(e),n=t.length||50,r=t.ellipsis??"...";if(i.length<=n)return C.escapeHtml(i);const d=i.substring(0,n)+r;return`<span title="${C.escapeHtml(i)}">${C.escapeHtml(d)}</span>`}static preLoadOntology(e,t="custom"){const i=Date.now();Object.entries(e).forEach(([n,r])=>{const d=`${t}:${n}`;C.ontologyCache.set(d,{name:r,timestamp:i})})}static ontology(e,t,i){if(e==null||e==="")return"";const n=t.delimiter;if(n&&typeof e=="string"&&e.includes(n)){const r=e.split(n).map(d=>d.trim()).filter(Boolean);return r.length===0?"":`<div class="ts-ontology-list" style="display:flex;flex-wrap:wrap;gap:4px">
                ${r.map(d=>C.renderSingleOntologyTerm(d,t)).join("")}
            </div>`}return C.renderSingleOntologyTerm(String(e).trim(),t)}static renderSingleOntologyTerm(e,t){const i=`${t.ontologyType||"custom"}:${e}`,n=C.ontologyCache.get(i);return n&&Date.now()-n.timestamp<C.cacheTimeout?C.formatOntologyTerm(e,n.name,t):(C.lookupOntologyTerm(e,t,i),C.formatOntologyTerm(e,null,t))}static lookup(e,t,i){if(e==null||e==="")return"";const n=String(e);if(t.map&&typeof t.map=="object"){const r=t.map[n];if(r!==void 0)return C.escapeHtml(String(r))}if(t.apiUrl){const r=`lookup:${t.apiUrl}:${n}`,d=C.lookupCache.get(r);return d&&Date.now()-d.timestamp<C.cacheTimeout?C.escapeHtml(d.value):(C.performAsyncLookup(n,t,r),C.escapeHtml(n)+' <span class="ts-loading-indicator">...</span>')}return t.fallback?C.escapeHtml(t.fallback):C.escapeHtml(n)}static formatOntologyTerm(e,t,i){const n=i.showId!==!1,r=C.escapeHtml(e),d=i.style||"default";let h="#";i.urlTemplate&&(h=i.urlTemplate.replace(/\{value\}/g,encodeURIComponent(e))),t&&i.urlTemplate&&i.urlTemplate.includes("{name}")&&(h=h.replace(/\{name\}/g,encodeURIComponent(t)));const u=i.urlTemplate?"a":"span",o=i.urlTemplate?` href="${h}" target="_blank" rel="noopener noreferrer"`:"";if(d==="badge")return t?`<${u}${o} class="ts-badge ts-ontology-badge" data-term="${r}" style="text-decoration:none">${C.escapeHtml(t)}</${u}>`:`<${u}${o} class="ts-badge ts-ontology-badge ts-loading-term" data-term="${r}" style="text-decoration:none">${r}</${u}>`;if(t){const g=C.escapeHtml(t);return n?`<${u}${o} class="ts-ontology" data-term="${r}">${g} <span class="ts-ontology-id">(${r})</span></${u}>`:`<${u}${o} class="ts-ontology" data-term="${r}">${g}</${u}>`}return`<${u}${o} class="ts-ontology ts-loading-term" data-term="${r}">${r}</${u}>`}static async lookupOntologyTerm(e,t,i){try{let n=null;if(t.map&&t.map[e])n=t.map[e];else switch(t.ontologyType){case"GO":n=await C.lookupGO(e);break;case"KEGG":n=e;break;case"EC":n=e;break;case"custom":t.lookupEndpoint&&(n=await C.lookupCustom(e,t.lookupEndpoint));break}n&&(C.ontologyCache.set(i,{name:n,timestamp:Date.now()}),C.updateOntologyElements(e,n,t))}catch(n){K.warn(`Ontology lookup failed for ${e}`,n)}}static updateOntologyElements(e,t,i){document.querySelectorAll(`.ts-ontology[data-term="${e}"], .ts-ontology-badge[data-term="${e}"]`).forEach(r=>{r.classList.remove("ts-loading-term");const d=i.showId!==!1;r.classList.contains("ts-ontology-badge")?r.textContent=t:d?r.innerHTML=`${C.escapeHtml(t)} <span class="ts-ontology-id">(${C.escapeHtml(e)})</span>`:r.textContent=t})}static async lookupGO(e){var n,r;const t=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${e}`,{headers:{Accept:"application/json"}});return t.ok&&((r=(n=(await t.json()).results)==null?void 0:n[0])==null?void 0:r.name)||null}static async lookupCustom(e,t){const i=t.replace("{value}",encodeURIComponent(e)),n=await fetch(i);if(!n.ok)return null;const r=await n.json();return r.name||r.label||r.term||null}static async performAsyncLookup(e,t,i){try{const n=t.apiUrl.replace("{value}",encodeURIComponent(e)),r=await fetch(n);if(r.ok){const d=await r.json(),h=t.valuePath?d[t.valuePath]:d.value||d.name||d;h&&C.lookupCache.set(i,{value:String(h),timestamp:Date.now()})}}catch(n){K.error("Async lookup failed",n)}}static conditional(e,t,i){if(!t.conditions||!Array.isArray(t.conditions))return C.escapeHtml(String(e??""));for(const n of t.conditions)if(C.evaluateCondition(n.when,e,i)){if(n.transform)return C.apply(e,n.transform,i);if(n.value!==void 0)return C.escapeHtml(String(n.value))}return t.default?typeof t.default=="object"&&t.default.type?C.apply(e,t.default,i):C.escapeHtml(String(t.default)):C.escapeHtml(String(e??""))}static ontologyLookup(e,t,i){if(e==null||e==="")return"";let n;if(typeof e=="string"){const u=e.trim();if(u.startsWith("["))try{const o=JSON.parse(u);n=Array.isArray(o)?o.filter(Boolean).map(String):[u]}catch{n=[u]}else n=u.split(/[,;]/).map(o=>o.trim()).filter(Boolean)}else Array.isArray(e)?n=e.filter(Boolean).map(String):n=[String(e)];if(n.length===0)return"";const r=n.slice(0,t.limit||5).map(u=>C.renderOntologyLookupTerm(u,t)),d=n.length-(t.limit||5),h=d>0?`<span class="ts-ontology-more" title="${n.slice(t.limit||5).join(", ")}">+${d}</span>`:"";return`<div class="ts-ontology-lookup-list">${r.join("")}${h}</div>`}static renderOntologyLookupTerm(e,t){const i=t.idPattern||"(rxn\\d+|cpd\\d+)",n=e.match(new RegExp(i,"i")),r=n?n[1]:e,d=`ontolookup:${t.ontologyType||"custom"}:${r}`,h=C.ontologyCache.get(d),u=C.escapeHtml(e),o=t.showId!==!1,g=t.maxLength||50,m=t.style||"inline";let w="#";return t.urlTemplate&&(w=t.urlTemplate.replace(/\{id\}/g,encodeURIComponent(r))),h&&Date.now()-h.timestamp<C.cacheTimeout?C.formatOntologyLookupTerm(r,u,h.name,w,o,g,m):(C.lookupOntologyDescription(r,t,d),C.formatOntologyLookupTerm(r,u,null,w,o,g,m))}static formatOntologyLookupTerm(e,t,i,n,r,d,h){const u=C.escapeHtml(e),o=n!=="#",g=o?`href="${n}" target="_blank" rel="noopener noreferrer"`:"",m=o?"a":"span";if(h==="badge"){if(i){const w=i.length>d?i.substring(0,d)+"":i,T=`${t}: ${i}`;return`<${m} ${g} class="ts-badge ts-ontology-lookup-badge" data-term="${u}" title="${C.escapeHtml(T)}" style="text-decoration:none">
                    ${r?`<span class="ts-ontology-id">${u}</span>: `:""}
                    <span class="ts-ontology-name">${C.escapeHtml(w)}</span>
                </${m}>`}return`<${m} ${g} class="ts-badge ts-ontology-lookup-badge ts-loading-term" data-term="${u}" title="${t}" style="text-decoration:none">${u}</${m}>`}if(i){const w=i.length>d?i.substring(0,d)+"":i,T=`${t}: ${i}`;return`<${m} ${g} class="ts-ontology-lookup" data-term="${u}" title="${C.escapeHtml(T)}">
                ${r?`<span class="ts-ontology-id">${u}</span>: `:""}
                <span class="ts-ontology-name">${C.escapeHtml(w)}</span>
            </${m}>`}return`<${m} ${g} class="ts-ontology-lookup ts-loading-term" data-term="${u}" title="${t}">
            <span class="ts-ontology-id">${u}</span>
            <span class="ts-loading-indicator"></span>
        </${m}>`}static async lookupOntologyDescription(e,t,i){try{let n=null;switch(t.ontologyType||"custom"){case"modelseed_reactions":n=await C.lookupModelSeedReaction(e);break;case"modelseed_compounds":n=await C.lookupModelSeedCompound(e);break;case"go":n=await C.lookupGOTerm(e);break;case"kegg":n=await C.lookupKEGGOrtholog(e);break;case"pfam":n=await C.lookupPfamDomain(e);break;case"cog":n=await C.lookupCOG(e);break;case"ec":n=await C.lookupECNumber(e);break;case"so":n=await C.lookupSequenceOntology(e);break;case"uniref":n=await C.lookupUniRef(e);break;case"custom":if(t.apiUrl){const d=t.apiUrl.replace(/\{id\}/g,encodeURIComponent(e)),h=await fetch(d);if(h.ok){const u=await h.json();n=u.name||u.definition||u.equation||null}}break}n&&(C.ontologyCache.set(i,{name:n,timestamp:Date.now()}),C.updateOntologyLookupElements(e,n,t))}catch(n){K.warn(`Ontology lookup failed for ${e}`,n)}}static async lookupModelSeedReaction(e){var t,i;try{const n=await fetch(`https://modelseed.org/solr/reactions/select?q=id:${e}&wt=json`);if(!n.ok)return null;const r=await n.json();if(((i=(t=r.response)==null?void 0:t.docs)==null?void 0:i.length)>0){const d=r.response.docs[0];return d.definition||d.name||d.equation||null}return null}catch{return null}}static async lookupModelSeedCompound(e){var t,i;try{const n=await fetch(`https://modelseed.org/solr/compounds/select?q=id:${e}&wt=json`);if(!n.ok)return null;const r=await n.json();if(((i=(t=r.response)==null?void 0:t.docs)==null?void 0:i.length)>0){const d=r.response.docs[0];return d.name||d.formula||null}return null}catch{return null}}static async lookupGOTerm(e){var t,i;try{const n=e.startsWith("GO:")?e:`GO:${e}`,r=await fetch(`https://www.ebi.ac.uk/QuickGO/services/ontology/go/terms/${encodeURIComponent(n)}`,{headers:{Accept:"application/json"}});if(!r.ok)return null;const d=await r.json();return(i=(t=d.results)==null?void 0:t[0])!=null&&i.name?d.results[0].name:null}catch{return null}}static async lookupKEGGOrtholog(e){try{const t=e.replace(/^KEGG:/i,"").replace(/^ko:/i,""),i=await fetch(`https://rest.kegg.jp/get/${t}`);if(!i.ok)return null;const n=await i.text(),r=n.match(/^DEFINITION\s+(.+?)(?:\n|$)/m);if(r)return r[1].trim();const d=n.match(/^NAME\s+(.+?)(?:\n|$)/m);return d?d[1].trim():null}catch{return null}}static async lookupPfamDomain(e){var t;try{const i=e.startsWith("PF")?e:`PF${e}`,n=await fetch(`https://www.ebi.ac.uk/interpro/api/entry/pfam/${i}`,{headers:{Accept:"application/json"}});return n.ok&&((t=(await n.json()).metadata)==null?void 0:t.name)||null}catch{return null}}static async lookupCOG(e){try{const t=e.replace(/^COG:/i,"").trim();return t.length===1&&/^[A-Z]$/i.test(t)?await C.lookupCOGCategory(t.toUpperCase()):/^COG\d+$/i.test(t)?await C.lookupCOGId(t.toUpperCase()):null}catch{return null}}static async lookupCOGCategory(e){var t,i;try{const n=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/?cat=${encodeURIComponent(e)}&format=json`);if(n.ok){const r=await n.json();if((i=(t=r.results)==null?void 0:t[0])!=null&&i.fun_cat_description)return r.results[0].fun_cat_description}return null}catch{return null}}static async lookupCOGId(e){try{const t=await fetch(`https://www.ncbi.nlm.nih.gov/research/cog/api/cog/${encodeURIComponent(e)}/?format=json`);if(!t.ok)return null;const i=await t.json();return i.cog_name?i.cog_name:i.fun_cat_description?i.fun_cat_description:null}catch{return null}}static async lookupECNumber(e){try{const t=e.replace(/^EC:/i,"").trim(),i=await fetch(`https://rest.kegg.jp/get/ec:${t}`);if(!i.ok)return null;const r=(await i.text()).match(/^NAME\s+(.+?)(?:\n|$)/m);return r?r[1].split(";")[0].trim():null}catch{return null}}static async lookupSequenceOntology(e){var t,i,n,r,d,h,u,o;try{const m=(e.startsWith("SO:")?e:`SO:${e}`).replace(":","_"),w=await fetch(`https://www.ebi.ac.uk/ols4/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!w.ok){const y=await fetch(`https://www.ebi.ac.uk/ols/api/ontologies/so/terms?iri=http://purl.obolibrary.org/obo/${m}`,{headers:{Accept:"application/json"}});if(!y.ok)return null;const x=await y.json();return(n=(i=(t=x._embedded)==null?void 0:t.terms)==null?void 0:i[0])!=null&&n.label?x._embedded.terms[0].label:null}const T=await w.json();return(h=(d=(r=T._embedded)==null?void 0:r.terms)==null?void 0:d[0])!=null&&h.label?T._embedded.terms[0].label:(o=(u=T.elements)==null?void 0:u[0])!=null&&o.label?T.elements[0].label:null}catch{return null}}static async lookupUniRef(e){var t,i,n,r,d;try{let h=e;const u=e.match(/UniRef\d+_(\w+)/i);u&&(h=u[1]);const o=await fetch(`https://rest.uniprot.org/uniprotkb/${h}.json`);if(!o.ok)return null;const m=(await o.json()).proteinDescription;return(i=(t=m==null?void 0:m.recommendedName)==null?void 0:t.fullName)!=null&&i.value?m.recommendedName.fullName.value:(d=(r=(n=m==null?void 0:m.submissionNames)==null?void 0:n[0])==null?void 0:r.fullName)!=null&&d.value?m.submissionNames[0].fullName.value:null}catch{return null}}static updateOntologyLookupElements(e,t,i){const n=i.maxLength||50,r=i.showId!==!1,d=t.length>n?t.substring(0,n)+"":t;document.querySelectorAll(`.ts-ontology-lookup[data-term="${e}"], .ts-ontology-lookup-badge[data-term="${e}"]`).forEach(u=>{u.classList.remove("ts-loading-term"),u.setAttribute("title",`${e}: ${t}`);const o=r?`<span class="ts-ontology-id">${C.escapeHtml(e)}</span>: `:"";u.innerHTML=`${o}<span class="ts-ontology-name">${C.escapeHtml(d)}</span>`})}static register(e,t){C.customTransformers.set(e,t),K.info(`Registered custom transformer: ${e}`)}static unregister(e){return C.customTransformers.delete(e)}static getAvailableTransformers(){const e=["number","percentage","currency","filesize","duration","date","datetime","boolean","heatmap","progress","link","replace","merge","badge","array","sequence","truncate","ontology","ontologyLookup","lookup","chain","conditional"],t=Array.from(C.customTransformers.keys());return[...e,...t]}static custom(e,t,i){const n=C.customTransformers.get(t.functionName);if(!n)return e?String(e):"";try{return n(e,t.params||{},i)}catch(r){return console.error("Custom transformer error",r),e?String(e):""}}};$(C,"ontologyCache",new Map),$(C,"lookupCache",new Map),$(C,"cacheTimeout",36e5),$(C,"customTransformers",new Map);let Me=C;class nn extends Kt{constructor(t){super(t);$(this,"stateManager");$(this,"options");$(this,"tooltip",null);$(this,"focusedFilterCol",null);$(this,"selectionStart",null);$(this,"selectionEnd",null);$(this,"filterDebounceTimer",null);$(this,"searchMatches",[]);$(this,"currentMatchIndex",-1);$(this,"selection",new Set);this.stateManager=t.stateManager,this.options=t,this.stateManager.subscribe(()=>{this.render()})}render(){const t=this.stateManager.getState();if(t.columns.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-inbox-fill"></i></div>
                    <h3 class="ts-empty-title">No Data Loaded</h3>
                    <p class="text-muted">Select a data source from the sidebar to begin.</p>
                </div>`;return}const i=t.columns.filter(h=>t.visibleColumns.has(h.column));if(i.length===0){this.container.innerHTML=`
                <div class="ts-empty">
                    <div class="ts-empty-icon"><i class="bi bi-layout-three-columns"></i></div>
                    <h3 class="ts-empty-title">All Columns Hidden</h3>
                    <p class="text-muted">Enable columns in the sidebar to view data.</p>
                </div>`;return}const n=t.searchValue?t.searchValue.trim().toLowerCase():"";let r='<table class="ts-table"><thead><tr>';const d=t.data.length>0&&t.data.every((h,u)=>this.selection.has(u));if(r+=`<th class="ts-col-select ts-col-fixed"><input type="checkbox" id="ts-select-all" ${d?"checked":""}></th>`,t.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed">#</th>'),i.forEach((h,u)=>{const g=u===0&&!t.showRowNumbers?"ts-col-fixed":"",m=h.sortable?"sortable":"",w=t.sortColumn===h.column?t.sortOrder==="asc"?' <i class="bi bi-sort-up"></i>':' <i class="bi bi-sort-down"></i>':"",T=h.width&&h.width!=="auto"?`width:${h.width}`:"min-width:80px";r+=`<th class="${g} ${m}" data-col="${h.column}" style="${T}">${h.displayName||h.column}${w}</th>`}),r+='</tr><tr class="ts-filter-row">',r+='<th class="ts-col-select ts-col-fixed" style="width:48px"></th>',t.showRowNumbers&&(r+='<th class="ts-col-num ts-col-fixed" style="width:60px"></th>'),i.forEach((h,u)=>{const g=u===0&&!t.showRowNumbers?"ts-col-fixed":"",m=t.columnFilters[h.column]||"",w=h.width&&h.width!=="auto"?`width:${h.width}`:"min-width:80px",T=this.options.getColumnType?this.options.getColumnType(h.column):"TEXT",y=["INTEGER","REAL","NUMERIC"].includes(T.toUpperCase()),x=y?"e.g., <500, >=100, =50":"Filter...",v=y?"Supports: <, <=, >, >=, =, !=, between, or just number":"Text search, =value, !=value, in(list), between";r+=`<th class="${g}" style="${w}">`,h.filterable!==!1?r+=`<div class="ts-filter-wrap"><input class="ts-filter-input ${m?"has-value":""}" data-col="${h.column}" data-type="${T}" value="${Me.escapeHtml(m)}" placeholder="${x}" title="${v}"><button class="ts-filter-clear" data-col="${h.column}"><i class="bi bi-x"></i></button></div>`:r+='<div style="height:28px"></div>',r+="</th>"}),r+="</tr></thead><tbody>",t.data.length===0){const h=i.length+(t.showRowNumbers?1:0);r+=`<tr><td colspan="${h}" style="text-align:center;padding:32px;color:var(--text-muted)"><i class="bi bi-search" style="font-size:20px;opacity:.3;display:block;margin-bottom:6px"></i>No matching records</td></tr>`}else{const h=t.currentPage*t.pageSize+1;t.data.forEach((u,o)=>{const g=this.isRowSelected(o),m=h+o;r+=`<tr class="${g?"selected":""}" data-idx="${o}">`,r+=`<td class="ts-col-select ts-col-fixed"><input type="checkbox" class="ts-row-checkbox" data-idx="${o}" ${g?"checked":""}></td>`,t.showRowNumbers&&(r+=`<td class="ts-col-num ts-col-fixed">${m}</td>`),i.forEach((w,T)=>{const x=T===0&&!t.showRowNumbers?"ts-col-fixed":"",v=u[w.column];let E="";const M=v!=null?String(v):"";if(w.transform)E=Me.apply(v,w.transform,u);else if(w.column.includes("ID")||w.column==="ID"){const N=Me.escapeHtml(M);E=`<span class="ts-copy-id"><span class="ts-mono">${N}</span><button class="ts-copy-btn" data-id="${N}"><i class="bi bi-clipboard"></i></button></span>`}else E=Me.escapeHtml(M);n&&n.trim()&&(E=this.highlightText(E,n).content),r+=`<td class="${x}" data-row="${o}" data-col="${w.column}">${E}</td>`}),r+="</tr>"})}r+="</tbody></table>",this.container.innerHTML=r,t.searchValue&&t.searchValue.trim()?this.trackSearchMatches(t.searchValue.trim()):(this.searchMatches=[],this.currentMatchIndex=-1),this.bindEvents(),this.restoreFocus()}restoreFocus(){if(this.focusedFilterCol){const t=this.container.querySelector(`input.ts-filter-input[data-col="${this.focusedFilterCol}"]`);t&&(t.focus(),this.selectionStart!==null&&this.selectionEnd!==null&&t.setSelectionRange(this.selectionStart,this.selectionEnd))}}getSelection(){return this.selection}clearSelection(){this.selection.clear(),this.render()}selectAll(){this.stateManager.getState().data.forEach((i,n)=>this.selection.add(n)),this.render(),this.options.onRowSelect(-1,!0,!0)}clearFilterFocus(){this.focusedFilterCol=null,this.selectionStart=null,this.selectionEnd=null,this.filterDebounceTimer&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null)}isRowSelected(t){return this.selection.has(t)}bindEvents(){this.container.addEventListener("change",t=>{const i=t.target;if(i.id==="ts-select-all"){const n=this.stateManager.getState();i.checked?n.data.forEach((r,d)=>this.selection.add(d)):this.selection.clear(),this.render(),this.options.onRowSelect(-1,i.checked,!0);return}if(i.classList.contains("ts-row-checkbox")){const n=parseInt(i.dataset.idx||"-1");n>=0&&(i.checked?this.selection.add(n):this.selection.delete(n),this.render(),this.options.onRowSelect(n,i.checked));return}}),this.container.onclick=t=>{var h;const i=t.target,n=i.closest("th.sortable");if(n){const u=n.dataset.col;if(u){const o=this.stateManager.getState(),g=o.sortColumn===u&&o.sortOrder==="asc"?"desc":"asc";this.options.onSort(u,g)}return}const r=i.closest(".ts-filter-clear");if(r){const u=r.dataset.col;u&&this.options.onFilter(u,"");return}if(i.tagName!=="BUTTON"&&i.tagName!=="INPUT"&&!i.closest("a")&&!i.closest(".ts-copy-btn")){const u=i.closest("tr");if(u&&((h=u.parentElement)==null?void 0:h.tagName)==="TBODY"){const o=parseInt(u.dataset.idx||"-1");if(o>=0){const g=this.selection.has(o);g?this.selection.delete(o):this.selection.add(o),this.render(),this.options.onRowSelect(o,!g)}}}const d=i.closest(".ts-copy-btn");if(d){const u=d.dataset.id;u&&navigator.clipboard.writeText(u)}},this.container.oninput=t=>{const i=t.target;if(i.classList.contains("ts-filter-input")){const n=i.dataset.col;n&&(this.focusedFilterCol=n,this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd,this.filterDebounceTimer&&clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=setTimeout(()=>{this.options.onFilter(n,i.value)},300))}},this.container.onkeyup=t=>{const i=t.target;i.classList.contains("ts-filter-input")&&(this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd)},this.container.addEventListener("focusin",t=>{const i=t.target;i.classList.contains("ts-filter-input")?this.focusedFilterCol=i.dataset.col||null:this.focusedFilterCol=null}),this.container.onmouseover=t=>{var n;const i=t.target.closest("td");if(i&&i.scrollWidth>i.clientWidth){const r=(n=i.textContent)==null?void 0:n.trim();r&&this.showTooltip(t,r)}},this.container.onmouseout=t=>{t.target.closest("td")&&this.hideTooltip()}}showTooltip(t,i){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="ts-tooltip",this.tooltip.id="ts-tooltip",document.body.appendChild(this.tooltip)),this.tooltip.textContent=i,this.tooltip.classList.add("show"),this.tooltip.style.left=t.clientX+10+"px",this.tooltip.style.top=t.clientY+10+"px"}hideTooltip(){this.tooltip&&this.tooltip.classList.remove("show")}highlightText(t,i){if(!i||!i.trim())return{content:t,hasMatches:!1};const n=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${n})`,"gi"),d=document.createElement("div");d.innerHTML=t;const h=(d.textContent||d.innerText||"").toLowerCase();if(!h.includes(i.toLowerCase()))return{content:t,hasMatches:!1};if(!t.includes("<")||t===Me.escapeHtml(h))return r.lastIndex=0,{content:t.replace(r,'<mark class="highlight">$1</mark>'),hasMatches:!0};const o=document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null),g=[];let m;for(;m=o.nextNode();)if(m.textContent&&(r.lastIndex=0,r.test(m.textContent))){r.lastIndex=0;const w=m.textContent.replace(r,'<mark class="highlight">$1</mark>');g.push({node:m,replacement:w})}return g.forEach(({node:w,replacement:T})=>{const y=w.parentElement;if(y){const x=document.createElement("span");for(x.innerHTML=T;x.firstChild;)y.insertBefore(x.firstChild,w);y.removeChild(w)}}),{content:d.innerHTML,hasMatches:g.length>0}}trackSearchMatches(t){if(this.searchMatches=[],!t||!t.trim()){this.currentMatchIndex=-1;return}this.container.querySelectorAll("mark.highlight").forEach(n=>{const r=n.closest("td[data-row][data-col]");r&&this.searchMatches.push({element:n,row:parseInt(r.getAttribute("data-row")||"0"),col:0})}),this.searchMatches.length>0?(this.currentMatchIndex=0,this.highlightCurrentMatch()):this.currentMatchIndex=-1}navigateToNextMatch(){return this.searchMatches.length===0?!1:(this.currentMatchIndex=(this.currentMatchIndex+1)%this.searchMatches.length,this.highlightCurrentMatch(),!0)}navigateToPreviousMatch(){return this.searchMatches.length===0?!1:(this.currentMatchIndex=this.currentMatchIndex<=0?this.searchMatches.length-1:this.currentMatchIndex-1,this.highlightCurrentMatch(),!0)}highlightCurrentMatch(){if(this.container.querySelectorAll("mark.highlight").forEach(t=>{t.classList.remove("active")}),this.currentMatchIndex>=0&&this.currentMatchIndex<this.searchMatches.length){const t=this.searchMatches[this.currentMatchIndex];t.element.classList.add("active"),this.scrollToMatch(t.element)}}scrollToMatch(t){const i=t.closest("td");if(!i)return;const n=this.container.closest(".ts-grid");if(!n)return;const r=i.getBoundingClientRect(),d=n.getBoundingClientRect(),h=50;if(!(r.top>=d.top+h&&r.bottom<=d.bottom-h&&r.left>=d.left+h&&r.right<=d.right-h)){const o=n,g=i.offsetTop,m=i.offsetLeft,w=o.clientHeight,T=o.clientWidth,y=g-w/2+i.clientHeight/2,x=m-T/2+i.clientWidth/2;o.scrollTo({top:Math.max(0,y),left:Math.max(0,x),behavior:"smooth"})}}getSearchMatchInfo(){return{current:this.currentMatchIndex>=0?this.currentMatchIndex+1:0,total:this.searchMatches.length}}hasSearchMatches(){return this.searchMatches.length>0}}class rn{constructor(e){$(this,"configManager");$(this,"stateManager");$(this,"client");$(this,"createModal");$(this,"switchTable");$(this,"fetchData");$(this,"getSchemaForTable");$(this,"getConfigColumns");$(this,"getStateColumns");$(this,"searchTerm","");$(this,"searchResults",[]);$(this,"isSearchingData",!1);$(this,"modal",null);$(this,"schemaCache",{});$(this,"loadingTables",new Set);this.configManager=e.configManager,this.stateManager=e.stateManager,this.client=e.client,this.createModal=e.createModal,this.switchTable=e.switchTable.bind(e.switchTable),this.fetchData=e.fetchData.bind(e.fetchData),this.getSchemaForTable=e.getSchemaForTable,this.getConfigColumns=e.getConfigColumns,this.getStateColumns=e.getStateColumns}renderSchemaItem(e){const t=[];e.sortable&&t.push({l:"Sortable",bg:"#dbeafe",fg:"#1d4ed8"}),e.filterable&&t.push({l:"Filterable",bg:"#d1fae5",fg:"#059669"}),e.copyable&&t.push({l:"Copyable",bg:"#e2e8f0",fg:"#475569"}),e.pin&&t.push({l:"Pinned",bg:"#ede9fe",fg:"#7c3aed"}),e.pk&&t.push({l:"Primary",bg:"#fee2e2",fg:"#b91c1c"}),e.notnull&&t.push({l:"Not Null",bg:"#fef9c3",fg:"#92400e"});const i=t.map(r=>`<span style="font-size:10px;padding:3px 8px;border-radius:4px;background:${r.bg};color:${r.fg};margin-right:6px;font-weight:500">${r.l}</span>`).join(""),n=(e.type||e.dataType||"string").toString().toUpperCase();return`
            <div class="ts-schema-item">
                <div style="padding-top:4px;flex-shrink:0"><i class="bi bi-hash" style="color:var(--c-accent);font-size:16px"></i></div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:12px">
                        <span class="ts-schema-name">${e.displayName||e.column}</span>
                        <span class="ts-schema-type">${n}</span>
                    </div>
                    ${e.description?`<div class="ts-schema-desc">${e.description}</div>`:""}
                    <div style="display:flex;align-items:center;margin-top:8px;flex-wrap:wrap;gap:4px">
                        ${i}
                        <span style="font-size:11px;color:var(--c-text-muted);font-family:'JetBrains Mono',monospace;margin-left:auto">col: ${e.column}</span>
                    </div>
                </div>
            </div>
        `}async show(e){const t=this.stateManager.getState(),i=t.availableTables||[],n=e||null;this.searchTerm="",this.searchResults=[],this.isSearchingData=!1;const r=(v,E="")=>{const M=E.trim().length>0;return`
                <div class="glass-sidebar" style="width:260px;display:flex;flex-direction:column;height:100%">
                    <div style="padding:16px;border-bottom:1px solid var(--c-border-subtle)">
                        <h3 style="font-size:11px;text-transform:uppercase;color:var(--c-text-muted);font-weight:700;letter-spacing:0.08em;display:flex;align-items:center;gap:8px;margin-bottom:12px">
                            <i class="bi bi-database" style="font-size:14px"></i> Database Schema
                        </h3>
                        <div style="position:relative;margin-bottom:8px">
                            <input type="text" id="ts-db-search" placeholder="Search tables, columns, data..." 
                                value="${E}"
                                style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:100%;outline:none;color:var(--c-text-primary);box-sizing:border-box">
                            <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted);pointer-events:none"></i>
                            ${M?'<button id="ts-db-search-clear" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--c-text-muted);cursor:pointer;padding:2px;font-size:14px"><i class="bi bi-x"></i></button>':""}
                        </div>
                        ${M?`
                            <div style="display:flex;gap:4px;margin-top:4px">
                                <button id="ts-search-data-btn" class="ts-btn-secondary" style="flex:1;height:28px;font-size:11px;padding:0 8px;${this.isSearchingData?"opacity:0.6":""}" ${this.isSearchingData?"disabled":""}>
                                    <i class="bi bi-${this.isSearchingData?"hourglass-split":"search"}"></i> ${this.isSearchingData?"Searching...":"Search Data"}
                                </button>
                            </div>
                        `:""}
                    </div>
                    <div style="flex:1;overflow-y:auto;padding:12px">
                        ${M?`
                            <div style="margin-bottom:8px;padding:0 14px">
                                <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">
                                    ${this.searchResults.length>0?`Results (${this.searchResults.length})`:"No Results"}
                                </span>
                            </div>
                            ${this.searchResults.length>0?this.searchResults.map(N=>{const z=N.columns.length+(N.hasDataMatches?1:0);return`
                                    <div class="ts-nav-item ${v===N.table.name?"active":""}" 
                                         data-target="${N.table.name}" 
                                         data-search="${E}"
                                         style="cursor:pointer">
                                        <i class="bi bi-table"></i> 
                                        <div style="flex:1;min-width:0">
                                            <div style="font-weight:${v===N.table.name?"600":"500"}">${N.table.name}</div>
                                            <div style="font-size:10px;color:var(--c-text-muted);margin-top:2px">
                                                ${z} match${z!==1?"es":""}
                                                ${N.hasDataMatches?"  Has data matches":""}
                                            </div>
                                        </div>
                                    </div>
                                `}).join(""):`
                                <div style="padding:24px;text-align:center;color:var(--c-text-muted)">
                                    <i class="bi bi-search" style="font-size:24px;display:block;margin-bottom:8px;opacity:0.5"></i>
                                    <div style="font-size:12px">No matches found</div>
                                </div>
                            `}
                        `:`
                            <div class="ts-nav-item ${v?"":"active"}" data-target="__overview__">
                                <i class="bi bi-grid-1x2"></i> Overview
                            </div>
                            <div style="margin-top:12px;margin-bottom:8px;padding:0 14px">
                                <span style="font-size:10px;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);font-weight:600">Tables (${i.length})</span>
                            </div>
                            ${i.map(N=>`
                                <div class="ts-nav-item ${v===N.name?"active":""}" data-target="${N.name}">
                                    <i class="bi bi-table"></i> 
                                    <span style="flex:1">${N.name}</span>
                                    <span style="font-size:11px;color:var(--c-text-muted)">${(N.row_count||0).toLocaleString()}</span>
                                </div>
                            `).join("")}
                        `}
                    </div>
                </div>
            `},d=()=>{const v=i.length,E=i.reduce((M,N)=>M+(N.row_count||0),0);return this.searchTerm&&this.searchResults.length>0?`
                    <div style="padding:40px;max-width:960px;margin:0 auto">
                        <div style="margin-bottom:32px">
                            <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">
                                Search Results for "${this.searchTerm}"
                            </h2>
                            <p style="color:var(--c-text-secondary);font-size:14px">Found ${this.searchResults.length} table${this.searchResults.length!==1?"s":""} with matches</p>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:16px">
                            ${this.searchResults.map(M=>{const N=M.columns.length+(M.hasDataMatches?1:0);return`
                                    <div class="ts-card-nav" data-target="${M.table.name}" data-search="${this.searchTerm}" style="cursor:pointer">
                                        <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px">
                                            <i class="bi bi-table"></i>
                                        </div>
                                        <div style="flex:1">
                                            <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.table.name}</div>
                                            <div style="font-size:12px;color:var(--c-text-muted);margin-top:4px">
                                                ${N} match${N!==1?"es":""}
                                                ${M.hasDataMatches?"  Data matches":""}
                                                ${M.columns.length>0?`  ${M.columns.length} column${M.columns.length!==1?"s":""}`:""}
                                            </div>
                                            ${M.columns.length>0?`
                                                <div style="margin-top:8px;font-size:11px;color:var(--c-text-muted);max-height:60px;overflow-y:auto">
                                                    ${M.columns.slice(0,3).map(z=>`
                                                        <div style="padding:2px 0"> ${z.displayName||z.column}</div>
                                                    `).join("")}
                                                    ${M.columns.length>3?`<div style="padding:2px 0;font-style:italic">+ ${M.columns.length-3} more</div>`:""}
                                                </div>
                                            `:""}
                                        </div>
                                        <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                                    </div>
                                `}).join("")}
                        </div>
                    </div>
                `:`
                <div style="padding:48px;max-width:900px;margin:0 auto">
                    <div style="text-align:center;margin-bottom:48px">
                        <div style="width:80px;height:80px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 20px;box-shadow:0 8px 24px var(--c-accent-glow)">
                            <i class="bi bi-database"></i>
                        </div>
                        <h2 style="font-size:28px;font-weight:700;color:var(--c-text-primary);margin-bottom:8px">Database Overview</h2>
                        <p style="color:var(--c-text-secondary);font-size:14px">${t.berdlTableId||"Connected Database"}</p>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:20px;margin-bottom:48px">
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Tables</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${v}</div>
                        </div>
                        <div class="glass-panel" style="padding:28px;text-align:center">
                            <div style="font-size:13px;color:var(--c-text-muted);margin-bottom:8px;font-weight:500">Total Records</div>
                            <div style="font-size:40px;font-weight:700;color:var(--c-text-primary)">${E.toLocaleString()}</div>
                        </div>
                    </div>
                    <h3 style="font-size:12px;font-weight:700;margin-bottom:20px;color:var(--c-text-muted);text-transform:uppercase;letter-spacing:0.08em">Available Tables</h3>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px">
                        ${i.map(M=>`
                            <div class="ts-card-nav" data-target="${M.name}">
                                <div style="width:44px;height:44px;background:var(--c-accent-light);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--c-accent);font-size:20px"><i class="bi bi-table"></i></div>
                                <div style="flex:1">
                                    <div style="font-weight:600;font-size:14px;color:var(--c-text-primary)">${M.name}</div>
                                    <div style="font-size:12px;color:var(--c-text-muted);margin-top:2px">${(M.row_count||0).toLocaleString()} records</div>
                                </div>
                                <i class="bi bi-chevron-right" style="font-size:14px;color:var(--c-text-muted)"></i>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `},h=v=>{if(!v)return"STRING";const E=v.toUpperCase();return E.includes("INT")?"INTEGER":E.includes("REAL")||E.includes("DOUBLE")||E.includes("FLOAT")?"FLOAT":E.includes("CHAR")||E.includes("TEXT")||E.includes("CLOB")?"STRING":E.includes("BLOB")?"BLOB":E.includes("DATE")||E.includes("TIME")?"DATETIME":E},u=v=>{const E=this.configManager.getTableConfig(v),z=this.stateManager.getState().activeTableName===v?this.getStateColumns():[],D=this.schemaCache[v],j=D&&D.length>0?D:z.length>0?z:E.columns||[];if(D&&D.length>0)return D;const I=new Map((E.columns||[]).map(W=>[W.column,W]));return j.map(W=>{const J=W.column||W.name,L=I.get(J)||{},R=h(W.type||L.dataType||L.type);return{...L,...W,column:J,type:R,dataType:R}})},o=v=>{var I,W,J;const E=this.configManager.getTableConfig(v),M=t.activeTableName===v,N=u(v),z=this.loadingTables.has(v),D=(E==null?void 0:E.name)||v,j=((I=E==null?void 0:E.settings)==null?void 0:I.description)||"No description available for this table.";return`
                <div style="padding:40px;max-width:960px;margin:0 auto">
                    <div style="margin-bottom:36px">
                        <div style="display:flex;align-items:flex-start;gap:20px">
                            <div style="width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg, var(--c-accent-light) 0%, var(--c-accent-glow) 100%);color:var(--c-accent);display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;box-shadow:0 4px 16px var(--c-accent-glow)">
                                <i class="${((W=E==null?void 0:E.settings)==null?void 0:W.icon)||"bi bi-table"}"></i>
                            </div>
                            <div style="flex:1">
                                <h2 style="font-size:24px;font-weight:700;color:var(--c-text-primary);margin:0 0 8px 0">${D}</h2>
                                <div style="font-size:14px;color:var(--c-text-secondary);line-height:1.6;margin-bottom:16px;max-width:600px">
                                    ${j}
                                </div>
                                <div style="display:flex;gap:20px;font-size:13px;color:var(--c-text-muted)">
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-layout-three-columns"></i> ${N.length} Columns</span>
                                    ${M?`<span style="display:flex;align-items:center;gap:6px"><i class="bi bi-list-ol"></i> ${(J=t.totalCount)==null?void 0:J.toLocaleString()} Records</span>`:""}
                                    <span style="display:flex;align-items:center;gap:6px"><i class="bi bi-${M?'check-circle-fill" style="color:var(--success)':"circle"}"></i> ${M?"Currently Loaded":"Not Loaded"}</span>
                                </div>
                            </div>
                            <button id="ts-export-current" class="ts-btn-secondary" data-table="${v}" style="height:40px;padding:0 20px">
                                <i class="bi bi-download"></i> Export Schema
                            </button>
                        </div>
                    </div>
                    <div class="glass-panel" style="overflow:hidden">
                        <div style="padding:14px 20px;border-bottom:1px solid var(--c-border-subtle);display:flex;justify-content:space-between;align-items:center;background:rgba(248,250,252,0.3)">
                            <h4 style="margin:0;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--c-text-muted);display:flex;align-items:center;gap:8px">
                                <i class="bi bi-list-columns-reverse"></i> Schema Definition
                            </h4>
                            <div style="display:flex;align-items:center;gap:8px">
                                <button id="ts-refresh-schema" data-table="${v}" class="ts-btn-secondary" style="height:28px;padding:0 10px;font-size:11px">
                                    <i class="bi bi-arrow-repeat"></i> Refresh schema
                                </button>
                                <div style="position:relative">
                                <input type="text" id="ts-schema-filter" placeholder="Search columns..." style="background:var(--c-bg-input);border:1px solid var(--c-border-subtle);border-radius:var(--radius-sm);font-size:12px;padding:6px 12px 6px 32px;width:220px;outline:none;color:var(--c-text-primary)">
                                <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;color:var(--c-text-muted)"></i>
                            </div>
                            </div>
                        </div>
                        <div id="ts-schema-items-container" style="max-height:55vh;overflow-y:auto">
                            ${z?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-hourglass-split" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>Loading schema...</div>':N.length===0?'<div style="padding:48px;text-align:center;color:var(--c-text-muted)"><i class="bi bi-info-circle" style="font-size:24px;display:block;margin-bottom:12px;opacity:0.5"></i>No schema information yet. Click "Refresh schema" to fetch live schema.</div>':N.map(L=>this.renderSchemaItem(L)).join("")}
                        </div>
                    </div>
                </div>
             `},g=async v=>{if(!(!v||this.schemaCache[v]||this.loadingTables.has(v))){this.loadingTables.add(v),m(v);try{const E=await this.getSchemaForTable(v),M=this.getConfigColumns(v),N=new Map(M.map(D=>[D.column,D])),z=E.map(D=>{const j=D.column||D.name,I=N.get(j)||{},W=h(D.type||I.dataType||I.type);return{...I,column:j,displayName:I.displayName||j,type:W,dataType:W,description:I.description,sortable:I.sortable!==!1,filterable:I.filterable!==!1,copyable:I.copyable,pin:I.pin,pk:D.pk,notnull:D.notnull}});this.schemaCache[v]=z.length>0?z:M.map(D=>({...D,column:D.column,type:h(D.dataType||D.type),dataType:h(D.dataType||D.type)}))}catch(E){K.warn(`[SchemaViewer] Failed to load schema for table ${v}`,E)}finally{this.loadingTables.delete(v),m(v)}}},m=(v,E=this.searchTerm)=>{var z,D;const M=(z=this.modal)==null?void 0:z.querySelector("#ts-schema-sidebar"),N=(D=this.modal)==null?void 0:D.querySelector("#ts-schema-main");M&&(M.innerHTML=r(v==="__overview__"?null:v,E)),N&&(N.innerHTML=v==="__overview__"?d():o(v),N.scrollTop=0),T()},w=async(v,E=!1)=>{var z;if(this.searchTerm=v.trim(),this.searchResults=[],!this.searchTerm){m("__overview__");return}const M=this.searchTerm.toLowerCase(),N=this.stateManager.getState();for(const D of i){const j=D.name.toLowerCase().includes(M),I=this.configManager.getTableConfig(D.name),L=(N.activeTableName===D.name?N.columns:I.columns||[]).filter(R=>{const ae=(R.displayName||R.column||"").toLowerCase(),Q=(R.column||"").toLowerCase(),X=(R.description||"").toLowerCase();return ae.includes(M)||Q.includes(M)||X.includes(M)});(j||L.length>0)&&this.searchResults.push({table:D,columns:L,hasDataMatches:!1})}if(E&&N.berdlTableId){this.isSearchingData=!0;const D=(z=this.modal)==null?void 0:z.querySelector("#ts-schema-sidebar");D&&(D.innerHTML=r(null,this.searchTerm)),T();const j=i.map(async I=>{try{if((await this.client.getTableData({berdl_table_id:N.berdlTableId||"",table_name:I.name,limit:1,offset:0,search_value:this.searchTerm})).total_count>0){const J=this.searchResults.find(L=>L.table.name===I.name);J?J.hasDataMatches=!0:this.searchResults.push({table:I,columns:[],hasDataMatches:!0})}}catch(W){K.warn(`Failed to search data in table ${I.name}`,W)}});await Promise.all(j),this.isSearchingData=!1}m("__overview__")},T=()=>{if(!this.modal)return;const v=this.modal.querySelector("#ts-db-search"),E=this.modal.querySelector("#ts-db-search-clear"),M=this.modal.querySelector("#ts-search-data-btn");if(v){let D=null;v.addEventListener("input",()=>{const j=v.value;this.searchTerm=j,D&&clearTimeout(D),D=setTimeout(()=>{w(j,!1)},300)}),v.addEventListener("keypress",j=>{j.key==="Enter"&&(j.preventDefault(),D&&clearTimeout(D),w(v.value,!1))})}E&&E.addEventListener("click",()=>{v&&(v.value=""),this.searchTerm="",this.searchResults=[],this.isSearchingData=!1,m("__overview__","")}),M&&M.addEventListener("click",async()=>{!this.searchTerm||this.isSearchingData||await w(this.searchTerm,!0)}),this.modal.querySelectorAll(".ts-nav-item, .ts-card-nav").forEach(D=>{D.addEventListener("click",()=>{var W;const j=D.dataset.target,I=D.dataset.search;if(j)if(j!=="__overview__"&&I){const J=(W=this.modal)==null?void 0:W.querySelector(".ts-modal-close");J&&J.click(),this.switchTable(j).then(()=>{this.stateManager.update({searchValue:I,currentPage:0}),this.fetchData()})}else m(j,I||this.searchTerm),g(j)})});const N=this.modal.querySelector("#ts-schema-filter"),z=this.modal.querySelector("#ts-schema-items-container");if(N&&z&&N.addEventListener("input",()=>{const D=N.value.toLowerCase();z.querySelectorAll(".ts-schema-item").forEach(j=>{const I=(j.textContent||"").toLowerCase();j.style.display=I.includes(D)?"flex":"none"})}),this.modal){const D=this.modal.querySelector("#ts-export-current");D==null||D.addEventListener("click",()=>{var xe;const I=D.dataset.table;if(!I)return;const W=this.stateManager.getState(),J=this.configManager.getTableConfig(I),L=(xe=this.schemaCache[I])!=null&&xe.length?this.schemaCache[I]:W.activeTableName===I?W.columns:J.columns||[],R=JSON.stringify(J||{tableName:I,columns:L},null,2),ae=new Blob([R],{type:"application/json"}),Q=URL.createObjectURL(ae),X=document.createElement("a");X.href=Q,X.download=`${I}_schema.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(Q)});const j=this.modal.querySelector("#ts-refresh-schema");j==null||j.addEventListener("click",()=>{const I=j.dataset.table;I&&(delete this.schemaCache[I],g(I))})}},y=`
            <div style="display:flex;height:100%;overflow:hidden">
                <div id="ts-schema-sidebar">${r(n||null)}</div>
                <div id="ts-schema-main" style="flex:1;overflow-y:auto;background:var(--c-bg-app-solid);position:relative">
                    ${n?o(n):d()}
                </div>
            </div>
        `;this.modal=this.createModal("Database Explorer",y);const x=this.modal.querySelector(".ts-modal-body");x&&(x.style.padding="0",x.style.height="calc(80vh - 60px)"),T(),e&&g(e)}}class on{constructor(e){$(this,"stateManager");$(this,"createModal");$(this,"showAlert");this.stateManager=e.stateManager,this.createModal=e.createModal,this.showAlert=e.showAlert}async show(e){const t=this.stateManager.getState();if(!t.berdlTableId||!e){this.showAlert("No table selected","warning");return}try{this.stateManager.update({loading:!0});const i=t.berdlTableId.replace("local/",""),r=await fetch(`http://localhost:3000/object/${i}/tables/${e}/stats`);if(!r.ok)throw new Error("Failed to load statistics");const d=await r.json(),h=`
                <div style="padding:24px;max-width:800px;overflow-y:auto;max-height:80vh">
                    <h2 style="margin-bottom:20px;font-size:18px;font-weight:600">
                        <i class="bi bi-graph-up"></i> Column Statistics: ${e}
                    </h2>
                    <div style="margin-bottom:16px;padding:12px;background:var(--c-bg-surface-alt);border-radius:var(--radius-sm);font-size:13px">
                        <strong>Total Rows:</strong> ${d.row_count.toLocaleString()}
                    </div>
                    <div style="display:grid;gap:12px">
                        ${d.columns.map(u=>`
                            <div style="padding:16px;background:var(--c-bg-surface);border:1px solid var(--c-border-subtle);border-radius:var(--radius-md)">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                    <h3 style="font-size:14px;font-weight:600">${u.column}</h3>
                                    <span style="font-size:11px;color:var(--c-text-muted);text-transform:uppercase">${u.type}</span>
                                </div>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px;font-size:12px">
                                    <div><strong>Nulls:</strong> ${u.null_count.toLocaleString()}</div>
                                    <div><strong>Distinct:</strong> ${u.distinct_count.toLocaleString()}</div>
                                    ${u.min!==void 0?`<div><strong>Min:</strong> ${u.min}</div>`:""}
                                    ${u.max!==void 0?`<div><strong>Max:</strong> ${u.max}</div>`:""}
                                    ${u.mean!==void 0?`<div><strong>Mean:</strong> ${u.mean.toFixed(2)}</div>`:""}
                                    ${u.median!==void 0?`<div><strong>Median:</strong> ${u.median}</div>`:""}
                                    ${u.stddev!==void 0?`<div><strong>StdDev:</strong> ${u.stddev.toFixed(2)}</div>`:""}
                                </div>
                                ${u.sample_values&&u.sample_values.length>0?`
                                    <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--c-border-subtle)">
                                        <div style="font-size:11px;color:var(--c-text-muted);margin-bottom:6px">Sample Values:</div>
                                        <div style="display:flex;flex-wrap:wrap;gap:4px">
                                            ${u.sample_values.slice(0,10).map(o=>`
                                                <span style="padding:2px 8px;background:var(--c-bg-surface-alt);border-radius:4px;font-size:11px;font-family:monospace">${String(o).substring(0,30)}</span>
                                            `).join("")}
                                        </div>
                                    </div>
                                `:""}
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;this.createModal(`Column Statistics: ${e}`,h)}catch(i){K.error(`Failed to load statistics: ${i.message}`,i),this.showAlert(`Failed to load statistics: ${i.message}`,"danger")}finally{this.stateManager.update({loading:!1})}}}const Fe=class Fe{constructor(){$(this,"listeners",new Map);$(this,"wildcardListeners",new Set);$(this,"eventHistory",[]);$(this,"maxHistorySize",100);$(this,"debug",!1);typeof localStorage<"u"&&(this.debug=localStorage.getItem("DATATABLE_DEBUG")==="true")}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}on(e,t){var n;this.listeners.has(e)||this.listeners.set(e,new Set);const i={callback:t,once:!1};return(n=this.listeners.get(e))==null||n.add(i),()=>{var r;(r=this.listeners.get(e))==null||r.delete(i)}}once(e,t){var n;this.listeners.has(e)||this.listeners.set(e,new Set);const i={callback:t,once:!0};return(n=this.listeners.get(e))==null||n.add(i),()=>{var r;(r=this.listeners.get(e))==null||r.delete(i)}}off(e,t){if(!t){this.listeners.delete(e);return}const i=this.listeners.get(e);if(i){for(const n of i)if(n.callback===t){i.delete(n);break}}}onAny(e){return this.wildcardListeners.add(e),()=>{this.wildcardListeners.delete(e)}}emit(e,t){this.debug&&K.debug(`[EventBus] ${e}`,t),this.eventHistory.push({event:e,data:t,timestamp:Date.now()}),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift();const i=this.listeners.get(e);if(i){const n=[];for(const r of i)try{r.callback(t),r.once&&n.push(r)}catch(d){K.error(`[EventBus] Error in listener for ${e}`,d)}for(const r of n)i.delete(r)}for(const n of this.wildcardListeners)try{n(e,t)}catch(r){K.error("[EventBus] Error in wildcard listener",r)}if(this.listeners.has("*")){const n=this.listeners.get("*");if(n){const r={event:e,data:t};for(const d of n)d.callback(r)}}}getHistory(){return[...this.eventHistory]}clearHistory(){this.eventHistory=[]}setDebug(e){this.debug=e,typeof localStorage<"u"&&localStorage.setItem("DATATABLE_DEBUG",e?"true":"false")}listenerCount(e){var t;return((t=this.listeners.get(e))==null?void 0:t.size)??0}clear(e){e?this.listeners.delete(e):(this.listeners.clear(),this.wildcardListeners.clear())}};$(Fe,"instance");let Gt=Fe;const Ie=Gt.getInstance(),Pe=class Pe{constructor(){$(this,"defaults",{format:"csv",filename:"export",includeHeaders:!0,delimiter:",",lineEnding:"unix",jsonPretty:!1,chunkSize:1e3})}static getInstance(){return Pe.instance||(Pe.instance=new Pe),Pe.instance}async export(e,t){const i=Date.now(),n={...this.defaults,...t};Ie.emit("export:started",{format:n.format,rowCount:e.length});try{const r=n.columns||this.inferColumns(e);let d,h,u;switch(n.format){case"csv":d=this.toCSV(e,r,n),h="text/csv;charset=utf-8",u="csv";break;case"tsv":d=this.toCSV(e,r,{...n,delimiter:"	"}),h="text/tab-separated-values;charset=utf-8",u="tsv";break;case"json":d=this.toJSON(e,r,n),h="application/json;charset=utf-8",u="json";break;case"json-lines":d=this.toJSONLines(e,r,n),h="application/x-ndjson;charset=utf-8",u="jsonl";break;case"xlsx":console.warn("XLSX export not yet implemented, falling back to CSV"),d=this.toCSV(e,r,n),h="text/csv;charset=utf-8",u="csv";break;default:throw new Error(`Unsupported export format: ${n.format}`)}const o=`${n.filename}.${u}`;this.downloadFile(d,o,h);const g={success:!0,filename:o,format:n.format,rowCount:e.length,byteSize:new Blob([d]).size,duration:Date.now()-i};return Ie.emit("export:completed",g),g}catch(r){const d={success:!1,filename:n.filename,format:n.format,rowCount:0,byteSize:0,duration:Date.now()-i,error:r.message||String(r)};return Ie.emit("export:failed",{...d,error:d.error}),d}}async toClipboard(e,t){const i={format:"tsv",includeHeaders:!0,...t};try{const n=i.columns||this.inferColumns(e),r=this.toCSV(e,n,{...this.defaults,...i,delimiter:"	"});return await navigator.clipboard.writeText(r),Ie.emit("export:clipboard",{rowCount:e.length}),!0}catch(n){return console.error("Failed to copy to clipboard:",n),!1}}getExtension(e){return{csv:"csv",tsv:"tsv",json:"json","json-lines":"jsonl",xlsx:"xlsx"}[e]||"txt"}getMimeType(e){return{csv:"text/csv",tsv:"text/tab-separated-values",json:"application/json","json-lines":"application/x-ndjson",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}[e]||"text/plain"}toCSV(e,t,i){const n=[],r=i.lineEnding==="windows"?`\r
`:`
`,d=i.delimiter;i.includeHeaders&&n.push(t.map(h=>this.escapeCSV(h.header,d)).join(d));for(let h=0;h<e.length;h++){const u=e[h],o=t.map(g=>{let m=u[g.key];return g.transform&&(m=g.transform(m,u)),this.escapeCSV(this.formatValue(m),d)});if(n.push(o.join(d)),i.chunkSize&&h>0&&h%i.chunkSize===0){const g=h/e.length*100;Ie.emit("export:progress",{progress:g,processed:h,total:e.length})}}return n.join(r)}toJSON(e,t,i){const n=e.map(r=>{const d={};return t.forEach(h=>{let u=r[h.key];h.transform&&(u=h.transform(u,r)),d[h.key]=u}),d});return i.jsonPretty?JSON.stringify(n,null,2):JSON.stringify(n)}toJSONLines(e,t,i){const n=i.lineEnding==="windows"?`\r
`:`
`;return e.map(r=>{const d={};return t.forEach(h=>{let u=r[h.key];h.transform&&(u=h.transform(u,r)),d[h.key]=u}),JSON.stringify(d)}).join(n)}inferColumns(e){if(e.length===0)return[];const t=new Set;return e.forEach(i=>{Object.keys(i).forEach(n=>t.add(n))}),Array.from(t).map(i=>({key:i,header:i.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}))}escapeCSV(e,t){return e.includes('"')||e.includes(t)||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}formatValue(e){return e==null?"":typeof e=="object"?JSON.stringify(e):String(e)}downloadFile(e,t,i){const n=new Blob([e],{type:i}),r=URL.createObjectURL(n),d=document.createElement("a");d.href=r,d.download=t,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(r)}};$(Pe,"instance");let Wt=Pe;const ln=Wt.getInstance(),je=class je{constructor(){$(this,"shortcuts",new Map);$(this,"keyMap",new Map);$(this,"enabled",!0);this.bindGlobalHandler()}static getInstance(){return je.instance||(je.instance=new je),je.instance}register(e){const t=this.normalizeKeys(e.keys);this.keyMap.has(t)&&console.warn(`Shortcut conflict: ${e.keys} is already registered for ${this.keyMap.get(t)}`),this.shortcuts.set(e.id,{...e,enabled:e.enabled!==!1,preventDefault:e.preventDefault!==!1}),this.keyMap.set(t,e.id)}unregister(e){const t=this.shortcuts.get(e);if(t){const i=this.normalizeKeys(t.keys);this.keyMap.delete(i),this.shortcuts.delete(e)}}setEnabled(e,t){const i=this.shortcuts.get(e);i&&(i.enabled=t)}setGlobalEnabled(e){this.enabled=e}getShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(e){return this.getShortcuts().filter(t=>t.category===e)}showHelp(){Ie.emit("modal:opened",{type:"keyboard-help"});const e=this.renderHelpContent();document.dispatchEvent(new CustomEvent("keyboard-help",{detail:{content:e}}))}hideHelp(){Ie.emit("modal:closed",{type:"keyboard-help"})}bindGlobalHandler(){document.addEventListener("keydown",e=>{if(!this.enabled||this.isInputElement(e.target)&&e.key!=="Escape")return;const t=this.eventToNormalizedKey(e),i=this.keyMap.get(t);if(i){const n=this.shortcuts.get(i);if(n&&n.enabled){n.preventDefault&&e.preventDefault();try{n.handler(e)}catch(r){console.error(`Error in shortcut handler ${i}:`,r)}}}})}isInputElement(e){const t=e.tagName.toLowerCase();return t==="input"||t==="textarea"||t==="select"||e.contentEditable==="true"}normalizeKeys(e){const t=e.toLowerCase().split("+").map(r=>r.trim()),i=[];(t.includes("ctrl")||t.includes("control"))&&i.push("ctrl"),t.includes("alt")&&i.push("alt"),t.includes("shift")&&i.push("shift"),(t.includes("meta")||t.includes("cmd")||t.includes("command"))&&i.push("meta");const n=t.find(r=>!["ctrl","control","alt","shift","meta","cmd","command"].includes(r));return n&&i.push(n),i.join("+")}eventToNormalizedKey(e){const t=[];e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift"),e.metaKey&&t.push("meta");let i=e.key.toLowerCase();return i===" "&&(i="space"),i==="arrowup"&&(i="up"),i==="arrowdown"&&(i="down"),i==="arrowleft"&&(i="left"),i==="arrowright"&&(i="right"),["control","alt","shift","meta"].includes(i)||t.push(i),t.join("+")}renderHelpContent(){const e={navigation:{title:"Navigation",icon:"bi-compass"},selection:{title:"Selection",icon:"bi-check2-square"},actions:{title:"Actions",icon:"bi-lightning"},filters:{title:"Filters",icon:"bi-funnel"},general:{title:"General",icon:"bi-gear"}};let t='<div class="keyboard-help">';for(const[i,n]of Object.entries(e)){const r=this.getShortcutsByCategory(i);if(r.length!==0){t+=`
                <div class="keyboard-help-category">
                    <h3><i class="${n.icon}"></i> ${n.title}</h3>
                    <div class="keyboard-help-list">
            `;for(const d of r){const h=this.formatKeysForDisplay(d.keys);t+=`
                    <div class="keyboard-help-item">
                        <span class="keyboard-help-desc">${d.description}</span>
                        <span class="keyboard-help-keys">${h}</span>
                    </div>
                `}t+="</div></div>"}}return t+="</div>",t}formatKeysForDisplay(e){return e.split("+").map(t=>`<kbd>${t.charAt(0).toUpperCase()+t.slice(1)}</kbd>`).join(" + ")}};$(je,"instance");let bt=je;function cn(k){const e=bt.getInstance();e.register({id:"help",keys:"?",description:"Show keyboard shortcuts",category:"general",handler:()=>e.showHelp()}),e.register({id:"close-modal",keys:"Escape",description:"Close modal / Clear selection",category:"general",handler:()=>{var i;const t=document.querySelector(".ts-modal-overlay.show");if(t){t.classList.remove("show");return}(i=k.onClearSelection)==null||i.call(k)}}),k.onSearch&&(e.register({id:"search",keys:"Ctrl+F",description:"Focus search box",category:"filters",handler:k.onSearch}),e.register({id:"search-alt",keys:"/",description:"Focus search box",category:"filters",handler:k.onSearch})),k.onExport&&e.register({id:"export",keys:"Ctrl+E",description:"Export data",category:"actions",handler:k.onExport}),k.onRefresh&&e.register({id:"refresh",keys:"Ctrl+R",description:"Refresh data",category:"actions",handler:k.onRefresh,preventDefault:!0}),k.onReset&&e.register({id:"reset",keys:"Ctrl+Shift+R",description:"Reset all filters",category:"actions",handler:k.onReset,preventDefault:!0}),k.onShowSchema&&e.register({id:"schema",keys:"Ctrl+I",description:"Show database schema",category:"actions",handler:k.onShowSchema}),k.onSelectAll&&e.register({id:"select-all",keys:"Ctrl+A",description:"Select all rows",category:"selection",handler:k.onSelectAll}),k.onClearSelection&&e.register({id:"clear-selection",keys:"Ctrl+D",description:"Clear selection",category:"selection",handler:k.onClearSelection}),k.onNextPage&&e.register({id:"next-page",keys:"Ctrl+Right",description:"Next page",category:"navigation",handler:k.onNextPage}),k.onPrevPage&&e.register({id:"prev-page",keys:"Ctrl+Left",description:"Previous page",category:"navigation",handler:k.onPrevPage}),k.onFirstPage&&e.register({id:"first-page",keys:"Ctrl+Home",description:"First page",category:"navigation",handler:k.onFirstPage}),k.onLastPage&&e.register({id:"last-page",keys:"Ctrl+End",description:"Last page",category:"navigation",handler:k.onLastPage}),k.onToggleTheme&&e.register({id:"toggle-theme",keys:"Ctrl+Shift+T",description:"Toggle dark/light theme",category:"general",handler:k.onToggleTheme})}bt.getInstance();class dn{constructor(e){$(this,"container");$(this,"configUrl");$(this,"configManager");$(this,"registry");$(this,"client");$(this,"stateManager");$(this,"categoryManager",null);$(this,"sidebar");$(this,"toolbar");$(this,"grid");$(this,"schemaViewer");$(this,"statsViewer");$(this,"theme","light");$(this,"density","normal");$(this,"dom",{});$(this,"columnSchemas",{});if(!e.container)throw new Error("Container required");this.container=e.container,this.configUrl=e.configUrl||null,this.client=e.client||new js,this.registry=Ge.getInstance(),this.stateManager=new en,this.stateManager.subscribe(this.onStateChange.bind(this));const t=localStorage.getItem("ts-theme"),i=localStorage.getItem("ts-density");t&&(this.theme=t),i&&(this.density=i)}async init(){try{await this.loadConfiguration();const e=this.configManager.getEnvironment(),t=this.configManager.getApis(),n=this.configManager.getDefaultApiId()||(t.length>0?t[0].id:null);if(n){const d=this.configManager.getApi(n);d&&this.client.updateConfig(d)}else{const d=this.configManager.getApiUrl();d?this.client=new js({environment:e,baseUrl:d}):this.client.setEnvironment(e)}const r=this.configManager.getGlobalSettings();this.stateManager.update({pageSize:r.pageSize||50,showRowNumbers:r.showRowNumbers!==!1}),this.loadStateFromUrl(),this.renderLayout(),this.initComponents()}catch(e){this.container.innerHTML=`<div class="ts-alert ts-alert-danger"><i class="bi bi-x-circle-fill"></i> ${e.message}</div>`}}renderLayout(){this.container.innerHTML=`
            <div class="ts-app" data-theme="${this.theme}" data-density="${this.density}">
                <aside class="ts-sidebar" id="ts-sidebar-container"></aside>
                <main class="ts-main">
                    <header class="ts-toolbar" id="ts-toolbar-container"></header>
                    <div id="ts-alert"></div>

                    <div class="ts-grid-header" id="ts-grid-header" style="display:none">
                        <div class="ts-grid-header-content">
                            <div class="ts-db-info">
                                <i class="bi bi-database"></i>
                                <span id="ts-db-name">Database</span>
                            </div>
                            <div class="ts-table-info">
                                <i class="bi bi-table"></i>
                                <span id="ts-active-table-name">Table</span>
                            </div>
                        </div>
                    </div>
                    <div class="ts-grid-wrapper" style="position:relative">
                        <div class="ts-loading-overlay" id="ts-loading-overlay" style="display:none">
                            <div class="ts-loading-spinner-wrapper">
                                <span class="ts-spinner" style="width:32px;height:32px"></span>
                                <span class="ts-loading-text" style="margin-top:12px;font-size:13px;color:var(--c-text-secondary)">Loading...</span>
                            </div>
                        </div>
                        <div class="ts-grid" id="ts-grid-container"></div>
                    </div>
                    <footer class="ts-footer">
                        <div class="ts-status" id="ts-status">Ready</div>
                        <div class="ts-table-name" id="ts-table-name"></div>
                        <div class="ts-pager" id="ts-pager"></div>
                    </footer>
                </main>
                
                <div class="ts-settings-popup" id="ts-settings-popup" style="top: 70px; right: 24px; bottom: auto;">
                    <div class="ts-settings-header">Settings</div>
                     <div class="ts-settings-body">
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-moon-stars"></i> Theme</div>
                            <div class="ts-switch ${this.theme==="dark"?"on":""}" id="ts-theme-toggle"></div>
                        </div>
                        <div class="ts-settings-row">
                            <div class="ts-settings-label"><i class="bi bi-arrows-angle-expand"></i> Density</div>
                            <div class="ts-density-options">
                                <button class="ts-density-opt ${this.density==="compact"?"active":""}" data-density="compact" title="Compact"><i class="bi bi-list"></i></button>
                                <button class="ts-density-opt ${this.density==="normal"?"active":""}" data-density="normal" title="Normal"><i class="bi bi-list-ul"></i></button>
                                <button class="ts-density-opt ${this.density==="comfortable"?"active":""}" data-density="comfortable" title="Comfortable"><i class="bi bi-card-heading"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,this.dom.status=this.container.querySelector("#ts-status"),this.dom.pager=this.container.querySelector("#ts-pager"),this.dom.alert=this.container.querySelector("#ts-alert"),this.dom.tableName=this.container.querySelector("#ts-table-name"),this.dom.loadingOverlay=this.container.querySelector("#ts-loading-overlay")}initComponents(){this.sidebar=new sn({container:this.container.querySelector("#ts-sidebar-container"),configManager:this.configManager,stateManager:this.stateManager,onApiChange:r=>this.switchApi(r),onLoadData:()=>this.handleLoadData(),onTableChange:r=>this.switchTable(r),onExport:()=>this.exportCsv(),onReset:()=>this.reset(),onShowSchema:r=>this.showDatabaseSchema(r),onShowStats:r=>this.showColumnStatistics(r),onLoadDbPath:r=>this.loadDatabaseFromPath(r)}),this.sidebar.mount(),this.toolbar=new an({container:this.container.querySelector("#ts-toolbar-container"),onSearch:r=>{const d=r?r.trim():"";this.stateManager.update({searchValue:d})},onRefresh:()=>this.softRefresh(),onSearchNext:()=>{this.grid&&(this.grid.navigateToNextMatch(),this.toolbar.updateSearchNav())},onSearchPrev:()=>{this.grid&&(this.grid.navigateToPreviousMatch(),this.toolbar.updateSearchNav())},getSearchMatchInfo:()=>this.grid?this.grid.getSearchMatchInfo():{current:0,total:0}}),this.toolbar.mount(),this.initKeyboardShortcuts();const e=this.toolbar.getSettingsButton();e&&e.addEventListener("click",r=>{r.stopPropagation();const d=this.container.querySelector("#ts-settings-popup");d==null||d.classList.toggle("show")});const t=this.container.querySelector("#ts-theme-toggle"),i=this.container.querySelectorAll(".ts-density-opt"),n=this.container.querySelector(".ts-app");t==null||t.addEventListener("click",()=>{this.toggleTheme(),t.classList.toggle("on",this.theme==="dark")}),i.forEach(r=>{r.addEventListener("click",()=>{this.density=r.dataset.density,n==null||n.setAttribute("data-density",this.density),i.forEach(d=>d.classList.remove("active")),r.classList.add("active"),localStorage.setItem("ts-density",this.density)})}),this.grid=new nn({container:this.container.querySelector("#ts-grid-container"),stateManager:this.stateManager,onSort:(r,d)=>{this.stateManager.update({sortColumn:r,sortOrder:d,currentPage:0}),this.fetchData()},onFilter:async(r,d)=>{const h=this.stateManager.getState();if(!h.activeTableName)return;const{parseFilterInput:u,normalizeColumnType:o}=await we(async()=>{const{parseFilterInput:w,normalizeColumnType:T}=await import("./filter-parser-HXU3E1Qm.js");return{parseFilterInput:w,normalizeColumnType:T}},[]),g=o(this.getColumnType(h.activeTableName,r)),m=u(d,g);if(m&&d.trim()){const w=h.advancedFilters||[],T=w.findIndex(x=>x.column===r);T>=0?w[T]={column:r,operator:m.operator,value:m.value,value2:m.value2}:w.push({column:r,operator:m.operator,value:m.value,value2:m.value2});const y={...h.columnFilters};y[r]=d,this.stateManager.update({columnFilters:y,advancedFilters:w.length>0?w:void 0,currentPage:0}),this.sidebar.renderFilterChips()}else{const w={...h.columnFilters};delete w[r];const T=(h.advancedFilters||[]).filter(y=>y.column!==r);this.stateManager.update({columnFilters:w,advancedFilters:T.length>0?T:void 0,currentPage:0}),this.sidebar.renderFilterChips()}this.fetchData()},getColumnType:r=>{const d=this.stateManager.getState();return d.activeTableName?this.getColumnType(d.activeTableName,r):"TEXT"},onRowSelect:()=>this.updateSelectionStatus()}),this.grid.mount(),this.schemaViewer=new rn({configManager:this.configManager,stateManager:this.stateManager,client:this.client,createModal:this.createModal.bind(this),switchTable:this.switchTable.bind(this),fetchData:this.fetchData.bind(this),getSchemaForTable:async r=>(await this.loadTableSchema(r),this.getSchemaColumns(r)),getConfigColumns:r=>{const d=this.configManager.getTableConfig(r);return(d==null?void 0:d.columns)||[]},getStateColumns:()=>this.stateManager.getState().columns}),this.statsViewer=new on({stateManager:this.stateManager,createModal:this.createModal.bind(this),showAlert:this.showAlert.bind(this)})}handleLoadData(){const e=this.stateManager.getState();if(!e.berdlTableId||e.availableTables.length===0){this.loadObject();return}this.fetchData()}initKeyboardShortcuts(){cn({onSearch:()=>this.toolbar.focusSearch(),onExport:()=>this.exportCsv(),onRefresh:()=>this.softRefresh(),onReset:()=>this.reset(),onSelectAll:()=>this.grid.selectAll(),onClearSelection:()=>this.grid.clearSelection(),onToggleTheme:()=>this.toggleTheme(),onShowSchema:()=>{const e=this.stateManager.getState();e.activeTableName&&this.showDatabaseSchema(e.activeTableName)},onNextPage:()=>this.nextPage(),onPrevPage:()=>this.prevPage(),onFirstPage:()=>this.goToPage(0),onLastPage:()=>{const e=this.stateManager.getState(),t=Math.ceil(e.totalCount/e.pageSize);this.goToPage(t-1)}})}async loadObject(){const e=this.sidebar.getToken(),t=this.sidebar.getBerdlId();if(!t||t.trim()===""){this.showAlert("Object ID or database name is required","danger");return}const i=t.trim();if(i==="test/test/test")this.switchApi("test_data");else{this.switchApi("default");const{LocalDbClient:n}=await we(async()=>{const{LocalDbClient:d}=await Promise.resolve().then(()=>Be);return{LocalDbClient:d}},void 0);if(!n.isLocalDb(i)&&!e){this.showAlert("Auth token required for remote databases","danger");return}}this.client.setToken(e||""),this.stateManager.update({berdlTableId:i,loading:!0,error:null});try{let n,r="",d=!1;try{n=await this.client.listTables(i)}catch(x){r=x.message||"Failed to load database";const{LocalDbClient:v}=await we(async()=>{const{LocalDbClient:M}=await Promise.resolve().then(()=>Be);return{LocalDbClient:M}},void 0),E=v.isLocalDb(i);if(!E&&i.startsWith("local/")){const M=i.replace("local/","");try{await this.loadDatabaseFromFile(M);return}catch(N){d=!0,r=`Remote API failed: ${x.message}. Local file also failed: ${N.message}`}}else if(E){const M=i.replace("local/","");try{await this.loadDatabaseFromFile(M);return}catch(N){d=!0,r=`Failed to load local database: ${N.message}`}}throw new Error(r)}if(!n)throw new Error("No response from server");const h=n.tables||[];if(h.length===0){const x=`No tables found in database "${i}". The database may be empty or inaccessible.`;this.showAlert(x,"warning"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1}),this.sidebar.updateTables([]);return}let u=this.extractSchemaInfo(n,h);if(Object.keys(u.columns).length===0){const x=await this.fetchSchemaInfo(i);x&&(u=x)}const{getConfigResolver:o}=await we(async()=>{const{getConfigResolver:x}=await Promise.resolve().then(()=>Ja);return{getConfigResolver:x}},void 0),m=await o().resolve(i,{objectType:n.object_type||n.type,schema:u.tables.length>0?u:void 0});if(m.warning&&this.showAlert(m.warning,"warning"),m.config)this.registry.registerDataType(m.config),this.configManager.setCurrentDataType(m.config.id);else{const x=this.registry.detectDataType(n);x&&this.configManager.setCurrentDataType(x)}this.stateManager.update({availableTables:h}),this.sidebar.updateTables(h);const w=this._initialTable,T=w&&h.find(x=>x.name===w)?w:h[0].name,y=d?`Loaded database "${i}" (using fallback method)`:`Loaded database "${i}" - ${h.length} table${h.length!==1?"s":""} found`;this.showAlert(y,"success"),await this.switchTable(T)}catch(n){let r=n.message||"Failed to load database";r.includes("404")||r.includes("Not Found")?r=`Database or object "${i}" not found. Please check the ID and try again.`:r.includes("401")||r.includes("Unauthorized")?r.includes("shock-api")||r.includes("Failed to access database")?r=`TableScanner cannot access the database. This usually means:
1. Your token doesn't have permission to access object "${i}"
2. The object exists in a different environment (prod vs appdev)
3. The token is expired or invalid

Original error: ${r}`:r=`Authentication failed. Please check your token and try again.

Details: ${r}`:r.includes("403")||r.includes("Forbidden")?r=`Access denied to database "${i}". Please check your permissions.

Details: ${r}`:r.includes("500")||r.includes("Internal Server Error")?r.includes("shock-api")||r.includes("Failed to access database")?r=`TableScanner service error: Cannot access database from KBase.

This usually means:
 Your token doesn't have permission to access this object
 The object is in a different environment than your token
 Try using a token from the correct environment (appdev vs prod)

Error details: ${r}`:r=`TableScanner service error: ${r}`:r.includes("Network")||r.includes("fetch")?r="Network error: Unable to connect to database service. Please check your connection and try again.":r.includes("Failed to load database")?r=`${r}

This may be a permissions issue. Verify your token has access to object "${i}".`:r=`Failed to load database "${i}": ${r}`,this.showAlert(r,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:r}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async switchTable(e){this.stateManager.update({activeTableName:e});const t=this.configManager.getTableConfig(e);this.categoryManager=new tn(t),this.sidebar.setCategoryManager(this.categoryManager),this.sidebar.updateTableInfo(e),this.stateManager.update({currentPage:0,sortColumn:null,columnFilters:{},searchValue:"",data:[],headers:[],columns:[]}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.loadTableDependencies(e).then(()=>{const i=this.stateManager.getState();i.activeTableName===e&&this.stateManager.update({data:[...i.data]})}),await this.fetchData()}async loadTableDependencies(e){var n;const i=this.configManager.getTableConfig(e).columns||[];for(const r of i){if(!r.transform)continue;const d=Array.isArray(r.transform)?r.transform:[r.transform];for(const h of d)if(h.type==="ontology"&&((n=h.options)!=null&&n.lookupTable)){const u=h.options.lookupTable,o=h.options.lookupKey||"id",g=h.options.lookupValue||"name";try{const m=this.stateManager.getState();if(!m.berdlTableId)continue;const w=await this.client.getTableData({berdl_table_id:m.berdlTableId,table_name:u,limit:1e4,offset:0}),T={},y=w.headers,x=y.indexOf(o),v=y.indexOf(g);x!==-1&&v!==-1&&(w.data.forEach(E=>{const M=String(E[x]),N=String(E[v]);T[M]=N}),Me.preLoadOntology(T,h.options.ontologyType||"custom"))}catch(m){console.warn(`Failed to load dependency table ${u}`,m)}}}}async fetchData(){var t;const e=this.stateManager.getState();if(!(!e.activeTableName||!e.berdlTableId)){this.stateManager.update({loading:!0});try{const i={},n=new Set(((t=e.advancedFilters)==null?void 0:t.map(u=>u.column))||[]);for(const[u,o]of Object.entries(e.columnFilters))!n.has(u)&&o!==void 0&&o!==null&&o!==""&&(i[u]=o);const r=await this.client.getTableData({berdl_table_id:e.berdlTableId,table_name:e.activeTableName,limit:e.pageSize,offset:e.currentPage*e.pageSize,sort_column:e.sortColumn||void 0,sort_order:e.sortOrder==="asc"?"ASC":"DESC",col_filter:Object.keys(i).length>0?i:void 0,filters:e.advancedFilters,aggregations:e.aggregations,group_by:e.groupBy});this.processColumns(r.headers,e.activeTableName);const d=e.activeTableName;r.column_schema&&r.column_schema.length>0&&d?(this.columnSchemas[d]||(this.columnSchemas[d]={}),(r.column_schema||[]).forEach(o=>{this.columnSchemas[d][o.name]={type:o.type,notnull:o.notnull,pk:o.pk}})):e.activeTableName&&await this.loadTableSchema(e.activeTableName);let h=(r.data||[]).map(u=>{const o={};return r.headers.forEach((g,m)=>{o[g]=u[m]}),o});e.sortColumn&&h.length>0&&(h=this.sortWithNullsLast(h,e.sortColumn,e.sortOrder||"asc")),this.stateManager.update({headers:r.headers,data:h,totalCount:r.total_count||0,queryCached:r.cached||!1,queryTime:r.execution_time_ms}),this.toolbar&&this.grid&&requestAnimationFrame(()=>{setTimeout(()=>{this.toolbar.updateSearchNav()},50)})}catch(i){const n=(i==null?void 0:i.message)||"Failed to load table data";K.error("Failed to fetch table data",i),this.showAlert(n,"danger"),this.stateManager.update({data:[],headers:[],columns:[],error:n})}finally{this.stateManager.update({loading:!1})}}}processColumns(e,t){const n=this.configManager.getTableConfig(t).columns||[],r=[],d=new Set;n.forEach(u=>{r.push({...u,visible:u.visible!==!1,sortable:u.sortable!==!1,filterable:u.filterable!==!1,width:u.width||"auto",categories:u.categories||[]}),d.add(u.column)});const h=u=>{const o=u.toLowerCase(),g=[];return(o.match(/^(id|name|display_name|label)$/)||o.endsWith("_id")||o.endsWith("_name")||o.includes("locus")||o.includes("symbol")||o.includes("alias")||o.includes("contig"))&&g.push("core"),(o.includes("function")||o.includes("product")||o.includes("annotation")||o.includes("subsystem")||o.includes("class")||o.includes("reaction")||o.includes("ec")||o.includes("cog")||o.includes("pfam")||o.includes("tigrfam")||o.includes("go")||o.includes("kegg")||o.includes("note")||o.includes("inference")||o.includes("type"))&&g.push("functional"),(o.includes("uniprot")||o.includes("xref")||o.includes("reference")||o.includes("link")||o.includes("url")||o.includes("dbxref"))&&g.push("external"),(o.includes("sequence")||o.includes("start")||o.includes("stop")||o.includes("length")||o.includes("strand")||o.includes("protein_length")||o.includes("molecular_weight")||o.includes("isoelectric"))&&g.push("sequence"),(o.match(/^(deleted|row_hash|last_synced|created_at|updated_at|sync_.*)$/)||o.includes("hash")||o.includes("sync"))&&g.push("metadata"),(o.match(/^(error|status|report|message|valid|significance)$/)||o.includes("error")||o.includes("valid"))&&g.push("status"),g.length===0&&(o.match(/^[a-z_]*id$/i)||o.endsWith("_id")?g.push("core"):g.push("functional")),g};if(e.forEach(u=>{d.has(u)||r.push({column:u,displayName:u.replace(/_/g," "),visible:!0,sortable:!0,filterable:!0,width:"auto",categories:h(u)})}),this.stateManager.update({columns:r}),this.categoryManager){this.categoryManager.setColumns(r);const u=this.stateManager.getState();if(u.visibleColumns.size===0)this.stateManager.update({visibleColumns:this.categoryManager.getInitialVisibleColumns()});else{const o=new Set(u.visibleColumns),g=new Set(r.map(m=>m.column));o.forEach(m=>{g.has(m)||o.delete(m)}),this.stateManager.update({visibleColumns:o})}}}async loadTableSchema(e){if(!(!e||this.columnSchemas[e]))try{const t=this.stateManager.getState();if(!t.berdlTableId)return;let i=[];try{i=await this.client.getTableSchema(t.berdlTableId,e)}catch(n){K.warn("[TableRenderer] Failed to load schema from ApiClient",n)}i.length>0&&(this.columnSchemas[e]={},i.forEach(n=>{this.columnSchemas[e][n.name]={type:n.type,notnull:!!n.notnull,pk:!!n.pk}}))}catch(t){K.warn("[TableRenderer] Error loading schema:",t)}}getColumnType(e,t){var i,n;return((n=(i=this.columnSchemas[e])==null?void 0:i[t])==null?void 0:n.type)||"TEXT"}getSchemaColumns(e){const t=this.columnSchemas[e];return t?Object.entries(t).map(([i,n])=>({column:i,type:n.type,notnull:n.notnull,pk:n.pk})):[]}switchApi(e){const t=this.configManager.getApi(e);t&&(this.client.updateConfig(t),this.reset())}softRefresh(){this.fetchData()}reset(){this.grid.clearFilterFocus(),this.stateManager.update({sortColumn:null,sortOrder:"asc",searchValue:"",columnFilters:{},currentPage:0}),this.toolbar.setSearch(""),this.grid.clearSelection(),this.sidebar.renderFilterChips(),this.fetchData()}nextPage(){const e=this.stateManager.getState(),t=Math.ceil(e.totalCount/e.pageSize);e.currentPage<t-1&&this.goToPage(e.currentPage+1)}prevPage(){const e=this.stateManager.getState();e.currentPage>0&&this.goToPage(e.currentPage-1)}goToPage(e){e>=0&&(this.stateManager.update({currentPage:e}),this.fetchData())}toggleTheme(){this.theme=this.theme==="light"?"dark":"light",localStorage.setItem("ts-theme",this.theme);const e=this.container.querySelector(".ts-app");e&&e.setAttribute("data-theme",this.theme)}async exportCsv(){const e=this.stateManager.getState();if(e.data.length===0)return;const t=this.grid.getSelection(),n=t.size>0?e.data.filter((r,d)=>t.has(d)):e.data;await ln.export(n,{format:"csv",filename:`export_${e.activeTableName||"data"}_${new Date().toISOString().split("T")[0]}`,columns:e.columns.filter(r=>e.visibleColumns.has(r.column)).map(r=>({key:r.column,header:r.displayName||r.column})),includeHeaders:!0})}onStateChange(e){this.updateStatusBar(e),this.updatePagination(e),this.updateLoadingOverlay(e),this.syncStateToUrl(),e.error&&this.showAlert(e.error,"danger"),this.toolbar&&this.grid&&setTimeout(()=>{this.toolbar.updateSearchNav()},100)}updateLoadingOverlay(e){if(!this.dom.loadingOverlay)return;e.loading&&e.availableTables.length>0?this.dom.loadingOverlay.style.display="flex":this.dom.loadingOverlay.style.display="none"}updateStatusBar(e){var h,u;if(!this.dom.status)return;let t="";const i=[];if(e.queryCached&&i.push(" Cached"),e.queryTime!==void 0&&i.push(`${e.queryTime}ms`),e.totalCount>0){const o=e.currentPage*e.pageSize+1,g=Math.min((e.currentPage+1)*e.pageSize,e.totalCount),m=Math.ceil(e.totalCount/e.pageSize);t=`<div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-size:13px;font-weight:600;color:var(--c-text-primary)">Rows: <strong>${o.toLocaleString()}</strong>  <strong>${g.toLocaleString()}</strong> of <strong>${e.totalCount.toLocaleString()}</strong></div>
                <div style="font-size:11px;color:var(--c-text-muted);display:flex;gap:8px;align-items:center">
                    <span>Page ${e.currentPage+1} of ${m||1}</span>
                    ${i.length>0?`<span style="display:flex;align-items:center;gap:4px">${i.join("  ")}</span>`:""}
                </div>
            </div>`;const w=((u=(h=this.grid)==null?void 0:h.getSelection())==null?void 0:u.size)||0;w>0&&(t+=`<div style="margin-top:4px;font-size:11px"><span class="ts-selection-info">${w} row${w!==1?"s":""} selected</span></div>`)}else t='<div style="font-size:13px">Ready</div>';this.dom.status.innerHTML=t,this.dom.tableName&&(e.activeTableName?this.dom.tableName.innerHTML=`<span style="color:var(--c-text-muted);font-size:13px;font-weight:500">${e.activeTableName}</span>`:this.dom.tableName.innerHTML="");const n=this.container.querySelector("#ts-grid-header"),r=this.container.querySelector("#ts-db-name"),d=this.container.querySelector("#ts-active-table-name");n&&r&&d&&(e.activeTableName&&e.berdlTableId?(n.style.display="block",r.textContent=e.berdlTableId,d.textContent=e.activeTableName):n.style.display="none")}updateSelectionStatus(){const e=this.stateManager.getState();this.updateStatusBar(e)}updatePagination(e){if(!this.dom.pager)return;const t=Math.ceil(e.totalCount/e.pageSize),i=e.currentPage;this.dom.pager.innerHTML=`
            <button class="ts-page-btn" data-page="${i-1}" ${i<=0?"disabled":""}><i class="bi bi-chevron-left"></i></button>
            <span class="ts-page-info">${i+1} / ${t||1}</span>
            <button class="ts-page-btn" data-page="${i+1}" ${i>=t-1?"disabled":""}><i class="bi bi-chevron-right"></i></button>
        `,this.dom.pager.querySelectorAll(".ts-page-btn").forEach(n=>{n.addEventListener("click",()=>{const r=parseInt(n.dataset.page||"0");r>=0&&r<t&&this.goToPage(r)})})}syncStateToUrl(){const e=this.stateManager.getState(),t=new URLSearchParams;e.activeTableName&&t.set("table",e.activeTableName),e.sortColumn&&t.set("sort",`${e.sortColumn}:${e.sortOrder}`),e.currentPage>0&&t.set("page",String(e.currentPage+1));const i=t.toString()?`?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}loadStateFromUrl(){const t=new URLSearchParams(window.location.search).get("table");t&&(this._initialTable=t)}async loadConfiguration(){const e="/config/index.json";try{const i=await fetch(e);if(i.ok){const n=await i.json();if(n.dataTypes){await this.registry.initialize(n),this.configManager=new qs(n);return}}}catch{}let t={};if(this.configUrl)try{const i=await fetch(this.configUrl);i.ok&&(t=await i.json())}catch{}!Object.keys(t).length&&window.DEFAULT_CONFIG&&(t=window.DEFAULT_CONFIG),this.configManager=new qs(t)}showAlert(e,t){if(this.dom.alert){const n=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),d=t==="danger"?8e3:e.length>100?6e3:4e3;this.dom.alert.innerHTML=`<div class="ts-alert ts-alert-${t}">${n}</div>`,setTimeout(()=>{this.dom.alert&&(this.dom.alert.innerHTML="")},d)}}showDatabaseSchema(e){this.schemaViewer.show(e)}isValueEmpty(e){if(e==null)return!0;if(typeof e=="string"){const t=e.trim();if(t===""||t.length===0||t.toLowerCase()==="null"||t.toLowerCase()==="undefined"||t==="-")return!0}return!!(Array.isArray(e)&&e.length===0||typeof e=="number"&&isNaN(e)||typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0)}sortWithNullsLast(e,t,i){return!e||e.length===0||!t||!e.some(r=>t in r)?e:[...e].sort((r,d)=>{const h=r==null?void 0:r[t],u=d==null?void 0:d[t],o=this.isValueEmpty(h),g=this.isValueEmpty(u);if(o&&g)return 0;if(o)return 1;if(g)return-1;let m=0;if(typeof h==="number"&&typeof u==="number"){if(isNaN(h)&&isNaN(u))return 0;if(isNaN(h))return 1;if(isNaN(u))return-1;m=h-u}else if(h instanceof Date&&u instanceof Date)m=h.getTime()-u.getTime();else{const y=String(h??"").trim().toLowerCase(),x=String(u??"").trim().toLowerCase();y<x?m=-1:y>x?m=1:m=0}return i==="desc"?-m:m})}async loadDatabaseFromFile(e){var t;try{if(this.stateManager.update({loading:!0,error:null}),!e||e.trim()==="")throw new Error("Database filename is required");const i=e.trim(),n=`/data/${i}.db`;let r=null,d=null;const{LocalDbClient:h}=await we(async()=>{const{LocalDbClient:T}=await Promise.resolve().then(()=>Be);return{LocalDbClient:T}},void 0);if(d=h.getConfigPath(n),!d){const T=`local/${i}`,y=this.registry.getAppConfig();let x=this.registry.detectDataType({dataType:T,type:i});if(!x&&(y!=null&&y.dataTypes)){for(const[v,E]of Object.entries(y.dataTypes))if(E.matches){for(const M of E.matches)if(this.matchConfigPattern(T,M)||this.matchConfigPattern(i,M)){x=v;break}if(x)break}}if(x){const v=(t=y==null?void 0:y.dataTypes)==null?void 0:t[x];v!=null&&v.configUrl&&(d=v.configUrl)}}d||(d=`/config/${i}.json`);try{const T=await fetch(d);if(T.ok){r=await T.json(),this.registry.registerDataType(r);const y=r.id||i;this.configManager.setCurrentDataType(y),K.debug(`Loaded config for ${i} from ${d}, config ID: ${y}`)}}catch(T){K.warn(`No config file found at ${d}, using default settings`,T)}const u=h.getInstance(),o=`local/${i}`;try{await u.loadDatabase(n)}catch(T){throw T.message.includes("404")||T.message.includes("Failed to load database")?new Error(`Database file not found: ${n}. Please ensure the file exists in the /data/ directory.`):new Error(`Failed to load database file: ${T.message}`)}let g;try{g=await u.listTablesFromDb(n,r)}catch(T){throw new Error(`Failed to read database structure: ${T.message}`)}const m=g.tables||[];if(m.length===0)throw new Error(`Database "${i}" contains no tables. The database may be empty or corrupted.`);this.stateManager.update({availableTables:m,berdlTableId:o}),this.sidebar.updateTables(m);const w=m[0].name;await this.switchTable(w),this.showAlert(`Successfully loaded database "${i}" - ${m.length} table${m.length!==1?"s":""} found`,"success")}catch(i){let n=i.message||"Failed to load database";throw n.includes("not found")||n.includes("404")?n=`Database file not found: "${e}". Please check that the file exists at /data/${e}.db`:n.includes("No tables found")?n=`Database "${e}" contains no tables. The database may be empty or corrupted.`:n.includes("Failed to load")||(n=`Failed to load database "${e}": ${n}`),this.showAlert(n,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:n}),this.sidebar.updateTables([]),i}finally{this.stateManager.update({loading:!1})}}async loadDatabaseFromPath(e){var t;try{this.stateManager.update({loading:!0,error:null});const i=(e||"").trim();if(!i)throw new Error("Database path is required");if(i.toLowerCase().startsWith("file://"))throw new Error("file:// paths are not supported in the browser. In dev use an absolute path (Vite /@fs), or host the DB under /data/ in production.");const r=i.split("#")[0].split("?")[0],h=(r.split("/").pop()||"database").trim().replace(/\.(db|sqlite)$/i,"")||"database",u=/^https?:\/\//i.test(i);let o=i;!u&&!o.startsWith("/")&&(o=`/${o}`);let g=null;try{const{LocalDbClient:v}=await we(async()=>{const{LocalDbClient:z}=await Promise.resolve().then(()=>Be);return{LocalDbClient:z}},void 0),E=[i,r,o,o.replace(/^\/@fs/,"")];let M=null;for(const z of E)if(M=v.getConfigPath(z),M)break;if(!M){const z=`local/${h}`,D=this.registry.getAppConfig();let j=this.registry.detectDataType({dataType:z,type:h});if(!j&&(D!=null&&D.dataTypes)){for(const[I,W]of Object.entries(D.dataTypes))if(W.matches){for(const J of W.matches)if(this.matchConfigPattern(z,J)||this.matchConfigPattern(h,J)){j=I;break}if(j)break}}if(j){const I=(t=D==null?void 0:D.dataTypes)==null?void 0:t[j];I!=null&&I.configUrl&&(M=I.configUrl)}}M||(M=`/config/${h}.json`);const N=await fetch(M);if(N.ok){g=await N.json(),this.registry.registerDataType(g);const z=g.id||h;this.configManager.setCurrentDataType(z),K.debug(`Loaded config for ${h} from ${M}, config ID: ${z}`)}}catch(v){K.warn("No config file found, using default settings",v)}const{LocalDbClient:m}=await we(async()=>{const{LocalDbClient:v}=await Promise.resolve().then(()=>Be);return{LocalDbClient:v}},void 0),w=m.getInstance();await w.loadDatabase(o);const y=(await w.listTablesFromDb(o,g||{})).tables||[];if(y.length===0)throw new Error(`Database "${h}" contains no tables. The database may be empty or corrupted.`);const x=`local/${h}`;this.stateManager.update({availableTables:y,berdlTableId:x}),this.sidebar.updateTables(y),await this.switchTable(y[0].name),this.showAlert(`Successfully loaded database "${h}" - ${y.length} table${y.length!==1?"s":""} found`,"success")}catch(i){const n=(i==null?void 0:i.message)||"Failed to load database";this.showAlert(n,"danger"),this.stateManager.update({availableTables:[],activeTableName:null,data:[],columns:[],visibleColumns:new Set,loading:!1,error:n}),this.sidebar.updateTables([])}finally{this.stateManager.update({loading:!1})}}async loadDatabaseFromFileObject(e){try{if(this.stateManager.update({loading:!0,error:null}),!e.name.endsWith(".db")&&!e.name.endsWith(".sqlite")){this.showAlert("Please select a valid SQLite database file (.db or .sqlite)","warning"),this.stateManager.update({loading:!1});return}const t=await e.arrayBuffer(),{LocalDbClient:i}=await we(async()=>{const{LocalDbClient:u}=await Promise.resolve().then(()=>Be);return{LocalDbClient:u}},void 0),n=i.getInstance();await n.loadDatabaseFromBuffer(t,e.name);const r=`local/${e.name.replace(/\.(db|sqlite)$/,"")}`;let d;try{d=await n.listTablesFromDb(e.name)}catch(u){throw new Error(`Failed to read database structure: ${u.message}`)}const h=d.tables||[];this.stateManager.update({berdlTableId:r,availableTables:h,activeTableName:null,loading:!1}),this.sidebar.updateTables(h),h.length>0?(await this.switchTable(h[0].name),this.showAlert(`Loaded local file: ${e.name}`,"success")):this.showAlert("Database loaded but contains no tables.","warning")}catch(t){K.error("Failed to load uploaded database",t),this.showAlert(`Failed to load file: ${t.message}`,"danger"),this.stateManager.update({loading:!1})}}async showColumnStatistics(e){await this.statsViewer.show(e)}extractSchemaInfo(e,t){const i=t.map(r=>r.name||r),n={};if(e.schemas&&typeof e.schemas=="object")for(const[r,d]of Object.entries(e.schemas))d&&typeof d=="object"&&(n[r]=Object.keys(d));if(Object.keys(n).length===0)for(const r of t){const d=r.name||r;r.columns&&Array.isArray(r.columns)?n[d]=r.columns.map(h=>typeof h=="string"?h:h.name||h.column):r.column_names&&Array.isArray(r.column_names)?n[d]=r.column_names:r.schema&&typeof r.schema=="object"&&(n[d]=Object.keys(r.schema))}return{tables:i,columns:n}}matchConfigPattern(e,t){if(t.includes("*")){const i=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return e===t}async fetchSchemaInfo(e){try{const t=await this.client.getSchema(e);if(t){const i=Object.keys(t),n={};for(const[r,d]of Object.entries(t))d&&typeof d=="object"&&(n[r]=Object.keys(d));return{tables:i,columns:n}}}catch{}return null}createModal(e,t){var d;const i=document.querySelector(".ts-modal-overlay");i&&i.remove();const n=document.createElement("div");n.className="ts-modal-overlay",n.innerHTML=`
            <div class="ts-modal">
                <div class="ts-modal-header">
                    <span class="ts-modal-title">${e}</span>
                    <button class="ts-modal-close"><i class="bi bi-x-lg"></i></button>
                </div>
                <div class="ts-modal-body">${t}</div>
            </div>
        `,document.body.appendChild(n),requestAnimationFrame(()=>n.classList.add("show"));const r=()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),200)};return(d=n.querySelector(".ts-modal-close"))==null||d.addEventListener("click",r),n.addEventListener("click",h=>{h.target===n&&r()}),n}}document.addEventListener("DOMContentLoaded",async()=>{const k=document.querySelector("#app");if(k){const t=new URLSearchParams(window.location.search).get("db"),i=new dn({container:k,configUrl:"genome-data.config.json"});if(await i.init(),t)try{await i.loadDatabaseFromFile(t)}catch(n){K.error("Failed to load database from URL parameter",n),k.innerHTML=`
                    <div class="ts-alert ts-alert-danger">
                        <i class="bi bi-x-circle-fill"></i> 
                        Failed to load database: ${n.message}
                        <br><br>
                        <small>Usage: ?db=filename (without .db extension)</small>
                        <br>
                        <small>Database file should be at: /data/${t}.db</small>
                    </div>
                `}}else K.error("App container #app not found")});export{Kt as C};
